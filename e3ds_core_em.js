(()=>{var e={242:function(e){var t;function n(e){clearTimeout(t),t=setTimeout((function(){N()}),500)}var o=void 0;function s(){o.style.width=2+o.value.length+"ch",console.log("onchangehiddenInputText : "+o.style.width)}function i(e){return e>=112&&e<=123||9===e}new Map,setInterval((function(){o&&console.log("1111  hiddenInput.style.display : "+o.style.display)}),1e3);const r={BackSpace:8,Shift:16,Control:17,Alt:18,RightShift:253,RightControl:254,RightAlt:255};function a(e){return e.keyCode===r.Shift&&"ShiftRight"===e.code?r.RightShift:e.keyCode===r.Control&&"ControlRight"===e.code?r.RightControl:e.keyCode===r.Alt&&"AltRight"===e.code?r.RightAlt:e.keyCode}function l(){var e=document.getElementById("streamingVideo");if(e){var t=document.getElementById("AudioBtnImg");t&&(t.src=e.muted?"https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/mute.svg":"https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/unmute.svg",console.log(t.src))}}function c(e){console.log("setVolume val: "+e);var t=document.getElementById("streamingVideo");t.volume=e,console.log("streamingVideo.volume: "+t.volume),yn||(yn=document.getElementById("Audio")),yn.volume=e,console.log("audioElem.volume: "+yn.volume)}function d(){yn?yo():Ye("audioElem not found: ",-937307130),console.log("11111111111111 streamingVideo.muted ="+streamingVideo?.muted),l()}function u(){if(Cn){var e=document.getElementById("streamingVideo");e&&e.muted&&(Cn=!1,function(e){var t=document.getElementById("streamingVideo");if(console.warn("1 ahsan hack . streamingVideo.paused:  "+t.paused),Ft(t,e),console.warn("2 ahsan hack . streamingVideo.paused:  "+t.paused),console.trace(),t.muted!=e&&(console.warn("3 ahsan hack . most probbaly a vuideo pasue just happeend "),t.play(),console.warn("4 ahsan hack . streamingVideo.paused:  "+t.paused)),console.log("streamingVideo.muted: "+t.muted),yn||(yn=document.getElementById("Audio")),yn&&(Ft(yn,e),console.log("audioElem2.muted: "+yn.muted)),!e&&(yn||(yn=document.createElement("Audio")),yn)){yn.autoplay=!0,null!=Sn&&(yn.srcObject=Sn);var n=yn.play();void 0!==n&&n.then((()=>{console.log("switchAudioTo() Created new audio element to play seperate audio stream.")})).catch((e=>{console.warn("Autoplay  audio was prevented.deleting audioElem "),delete yn}))}console.log("11111111111111 streamingVideo.muted ="+t?.muted),l()}(!document.getElementById("streamingVideo").muted))}}let h;function m(){h=setInterval((()=>{const e=["W","S","D"],t=e[Math.floor(Math.random()*e.length)],n=new KeyboardEvent("keydown",{key:t,keyCode:t.charCodeAt(0),which:t.charCodeAt(0),code:`Key${t.toUpperCase()}`});document.dispatchEvent(n),setTimeout((()=>{const e=new KeyboardEvent("keypress",{key:t,keyCode:t.charCodeAt(0),charCode:t.charCodeAt(0),which:t.charCodeAt(0),code:`Key${t.toUpperCase()}`});document.dispatchEvent(e)}),2e3),setTimeout((()=>{const e=new KeyboardEvent("keyup",{key:t,keyCode:t.charCodeAt(0),charCode:t.charCodeAt(0),which:t.charCodeAt(0),code:`Key${t.toUpperCase()}`});document.dispatchEvent(e)}),100)}),200)}function g(e){window.top.postMessage(e,"*")}function p(e){if(console.log(" handleUnrealResponse(descriptor) : "+e),"function"==typeof onResponseFromUnreal?onResponseFromUnreal(e):console.log("not found onResponseFromUnreal"),e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onResponseFromUnreal&&e3ds_controller.callbacks.onResponseFromUnreal(e),window.top.postMessage(e,"*"),"getCmdLineArgs"===e){let e={};e.cmdLineArgs=Gn,console.log("33333333333333 sendDataToUE4App emitUIInteraction: "+JSON.stringify(e)),b(e)}else{let t;try{t=JSON.parse(e),console.log("5555555555555 handleUnrealResponse JSON.stringify(JSON.parse(descriptor)) : "+JSON.stringify(t))}catch(e){console.log("5555555555555 handleUnrealResponse JSON.parse fails")}!function(e){if(console.log("5555555555555 ahsanHandleResponseFunction(obj) :"+JSON.stringify(e)),null!=e)switch(console.log("5555555555555 ahsanHandleResponseFunction obj.cmd :"+e.cmd),e.cmd){case"misctasks":N();break;case"takeFocusedWidgetText_old":f&&(f=!1,s(),e.value);break;case"takeFocusedWidgetText":f&&(f=!1,o.value=e.value,o.style.display="block",s(),o.focus());break;case"getCmdLineArgs":{let e={};e.cmdLineArgs=Gn,console.log("33333333333333 sendDataToUE4App emitUIInteraction: "+JSON.stringify(e)),b(e)}break;case"getIpaddress":{let e={Ipaddress:"contactAhsanASAP"};console.log("33333333333333 sendDataToUE4App emitUIInteraction: "+JSON.stringify(e)),b(e)}break;case"redirectTo":window.location.href=e.value;break;case"launchKeyBoard":case"lunchKeyBoard":break;case"sendLocalFileToUE4":!function(e){console.log("Browsing");const t=document.createElement("input");t.setAttribute("type","file"),t.style.display="none",document.getElementsByTagName("body")[0].appendChild(t),t.addEventListener("change",(()=>{const n=t.files[0];Ls=n,console.log("file",n),function(e,t,n,o,s){var i={type:"getUploadUrl",content_type:e,owner:n,appName:t,file_name:o,pathToSaveFile:s};console.log(JSON.stringify(i)),In.send(JSON.stringify(i))}(n.type,Zt,De,n.name,e)})),t.click()}(e.pathToSaveFile);break;case"ToggleBrowserMouse":ln=!ln,xn();break;case"showBrowserMouse":ln=!0,xn();break;case"hideBrowserMouse":ln=!1,xn();break;case"lunchCallApp":console.log(e.value),window.open("tel:"+e.value,"_self");break;case"lunchMailApp":var t="mailto:"+e.value+"?subject="+e.value+"&body="+e.value;window.open(t,"_blank");break;case"sendDeviceInfo":b({type:"takeUserDeviceInfo",userDeviceInfo:Nn,clientInfo:dn});break;case"sendUserInfoInPlainJson":let r={};r=dn,b(r);break;case"sendUserInfo":b({clientInfo:dn});break;case"generateDownloadableCSV":console.log(JSON.stringify(e.value)),function(e,t){for(var n=function(e){for(var t="",n=0;n<e.length;n++){var o=null===e[n]?"":e[n].toString();e[n]instanceof Date&&(o=e[n].toLocaleString());var s=o.replace(/"/g,'""');s.search(/("|,|\n)/g)>=0&&(s='"'+s+'"'),n>0&&(t+=","),t+=s}return t+"\n"},o="",s=0;s<t.length;s++)o+=n(t[s]);console.log("5555555555555 csvFile content :"+o),console.log("5555555555555 csvFile filename :"+e);var i=new Blob([o],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(i,e);else{var r=document.createElement("a");if(void 0!==r.download){var a=URL.createObjectURL(i);r.setAttribute("href",a),r.setAttribute("download",e),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}}}(e.filename,e.csvRows);break;case"captureScreenShot":Vo();break;case"toggleFullscreen":_o();break;case"enterFullscreen":Fo();break;case"exitFullscreen":Do();break;case"ForeceEndTab":try{if(!window.close)throw new Error("window.close is not supported");if(window.close(),!window.closed)throw new Error("Failed to close the window")}catch(e){console.error("Error:",e),Dt("Denied. Scripts may close only the windows that were opened by them.",{color:"red",timeout:5e3})}break;case"ForeceEndSession":console.log("ForeceEndSession diderrorhappend:",Tt),Tt?console.log(" no error"):window.location="/assets/pages/SessionEnded.htm";break;case"setVolume":console.log(e.value),c(e.value);break;case"askChatGpt":!async function(e){var t={type:"askChatGpt",question:e};console.log(JSON.stringify(t)),In.send(JSON.stringify(t))}(e.value);break;case"doInAppPurchase":!function(e){var t="https://"+Fe.domain+":"+Fe.httpsPort+"/inAppPurchaseResult/";const n=qt.ue4AppExe,o=n.match(/([^\\]+)\.exe$/)[1],s=n.replace(/[^\\]+\.exe$/,""),i=n.match(/\\(\d+)\\/)[1];console.log("Exe Name:",o),console.log("Path:",s),console.log("Number 13:",i);var r={owner:De,currency:"USD",amount:e.value,reportingUrl:t,href_emulated:_e,exe:o,v:i,timeOfInitiation:Date.now()},a=JSON.stringify(r);console.log("doenecrytion fsfsf: "+a),R(a)}(e);break;case"sendClipBoardData":!async function(){const e=await navigator.permissions.query({name:"clipboard-read"});if("granted"!==e.state&&"prompt"!==e.state)return console.log("Clipboard Permission denied by user "),void Dt("Clipboard Permission in browser for this domain denied by user",{color:"red",timeout:5e3});if(document.hasFocus()){if(!navigator.clipboard||!navigator.clipboard.readText)return void console.log("clipboard API not supported in browser");window.navigator.clipboard.readText().then((e=>{if(console.log("sendClipBoardData: "+e),In&&In.readyState===Bn){var t={type:"setclipboardDataOnStreamerMachine",textToSetclipboardData:e};t=JSON.stringify(t),console.log("setclipboardDataOnStreamerMachine ws.send(): "+t),In.send(t)}b({ClipBoardData:e})})).catch((e=>{console.error("Failed to read clipboard data: ",e)}))}else console.log("sendClipBoardData: Page is not in focus")}();break;case"copytoclipboard":!async function(e){const t=await navigator.permissions.query({name:"clipboard-read"});if("granted"!==t.state&&"prompt"!==t.state)return console.log("Clipboard Permission denied by user "),void Dt("Clipboard Permission in browser for this domain denied by user",{color:"red",timeout:5e3});navigator.clipboard.writeText(e).then((()=>{console.log("Text successfully copied to clipboard")})).catch((e=>{console.error("Unable to copy text to clipboard",e),Dt("Unable to copy text to clipboard",{color:"red",timeout:5e3})}))}(e.value);break;case"setBrowserSideMouseCursorTo":""!=e.value&&null!=e.value&&(cn=e.value),xn();break;case"getInGameCustomizationData":var n={type:"getInGameCustomizationData",slotId:e.slotId};In.send(JSON.stringify(n));break;case"launchUrl":case"lunchUrl":console.log(e.value),window.open(e.value,"_blank");break;case"editorModeId":!function(e){document.getElementById("videoContainer").style.display="none",document.getElementById("imageContainer").style.display="none",console.log(e),document.getElementById("GameDataSlots").value=e.slotId,document.getElementById("idsInSlot").value=e.assetId;var t=JSON.stringify({type:"sendAllVideoAssetsUrls",owner:De});null==eo&&(In.send(t),console.log(" ws.send(): "+t)),t=JSON.stringify({type:"sendAll2dAssetsUrls",owner:De}),null==to&&(In.send(t),console.log(" ws.send(): "+t)),"video"===e.assetType?(document.getElementById("assetType").value="video",null!=e.value?($e=e.value,document.getElementById("videoAssets").value=$e):($e=void 0,document.getElementById("videoAssets").value=""),document.getElementById("videoContainer").style.display="block"):"image"===e.assetType&&(document.getElementById("assetType").value="image",null!=e.value?($e=e.value,document.getElementById("imageAssets").value=$e):($e=void 0,document.getElementById("imageAssets").value=""),document.getElementById("imageContainer").style.display="block"),t=JSON.stringify({type:"sendAllGameCustomizationData",owner:De}),null==oo&&(In.send(t),console.log(" ws.send(): "+t));const n=document.getElementById("editor-sidebar");document.getElementById("sidebarTitle").innerText="Asset Editor",n.style.width="400px"}(e);break;case"freezeResolutionAt":T(e.x,e.y);break;case"getDownloadUrlOfLocalFile":var i=JSON.stringify({type:"forwardToEL",objFromUE4:e});In&&(console.log(" ws.send(): "+JSON.stringify(i)),In.send(i));break;case"downloadLocalFileOnUserDevice":i=JSON.stringify({type:"forwardToEL",objFromUE4:e}),In&&(console.log(" ws.send(): "+JSON.stringify(i)),In.send(i))}}(t)}}document.addEventListener("keypress",(function(e){u();const t=e.which||e.code;let n=e.key;n||(n=String.fromCharCode(t))})),g({type:"stage3_slotOccupied"});var f=!1;function v(){M(new Uint8Array([C.RequestQualityControl]).buffer)}function y(e,t){var n={"Resolution.Width":e,"Resolution.Height":t};1==Oe&&console.log(n),je=n,E(n),"function"==typeof window?.pixelStreaming?.emitCommand&&window.pixelStreaming.emitCommand(n)}function S(e){null!==e.PrioritiseQuality&&b({Console:"Streamer.PrioritiseQuality "+e.PrioritiseQuality}),null!==e.LowBitrate&&b({Console:"Streamer.LowBitrate "+e.LowBitrate}),null!==e.HighBitrate&&b({Console:"Streamer.HighBitrate "+e.HighBitrate}),null!==e.MinFPS&&b({Console:"Streamer.MinFPS "+e.MinFPS})}const C={IFrameRequest:0,RequestQualityControl:1,MaxFpsRequest:2,AverageBitrateRequest:3,StartStreaming:4,StopStreaming:5,LatencyTest:6,RequestInitialSettings:7,UIInteraction:50,Command:51,KeyDown:60,KeyUp:61,KeyPress:62,MouseEnter:70,MouseLeave:71,MouseDown:72,MouseUp:73,MouseMove:74,MouseWheel:75,TouchStart:80,TouchEnd:81,TouchMove:82,GamepadButtonPressed:90,GamepadButtonReleased:91,GamepadAnalog:92};function w(e,t){let n=JSON.stringify(t);1==Oe&&console.log("33333333333333 descriptorAsString: "+n);let o=new DataView(new ArrayBuffer(3+2*n.length)),s=0;o.setUint8(s,e),s++,o.setUint16(s,n.length,!0),s+=2;for(let e=0;e<n.length;e++)o.setUint16(s,n.charCodeAt(e),!0),s+=2;M(o.buffer)}function b(e){w(C.UIInteraction,e)}function E(e){w(C.Command,e)}function T(e,t){bt.resolutionType_ue4="Custom",y(e,t)}function k(e){console.log("receiveCommand: "+JSON.stringify(e));try{const t=JSON.parse(e.data);null!=t.Type?(console.log("Command received, parsed and accepted: %s",e.data),b(t)):"EmulatePlayButtonPressed"==t.cmd?ds():"freezeResolutionAt"==t.cmd?T(t.x,t.y):"sendToUe4"==t.cmd?b(t.value):"iframe-tester"==t.cmd?Se=!0:"ssitest"==t.cmd?b({requestId:t.requestId,jsonObjecived:JSON.stringify(t)}):console.log("Command received and parsed, but not accepted: %s",e.data)}catch(t){console.log("error receiveCommand(): Command received, but could not parse: "+JSON.stringify(e.data))}}"undefined"!=typeof e3ds_controller&&(e3ds_controller.sendToUnreal=function(e){b(e)});var x=0,P=void 0;function I(e){}function R(e){x++,console.log("--\x3e collectLocationInfoAttempt: "+x);var t="https://fb-server.eagle3dstreaming.com/api/v1/miscellaneous/encrypt-string?decryptedString="+e,n=new XMLHttpRequest;n.isDOne=!1,n.onreadystatechange=function(){if(console.log("doenecrytion() xmlHttp.responseText: "+n.responseText),429==n.status)return null!=P&&clearTimeout(P),void(P=setTimeout(R,2e3));if(422!=n.status)if(""!=n.responseText&&null!=n.responseText&&200==n.status){if(n.isDOne)return;n.isDOne=!0,clearTimeout(P);try{var e="https://payment.eaglepixelstreaming.com/v1/?key="+JSON.parse(n.responseText).data;console.log("doenecrytion: "+e),window.open(e,"_blank")}catch(e){console.log("Error parsing JSON response: ",e)}}else null!=P&&clearTimeout(P)},n.open("GET",t,!0);try{n.send(null)}catch(e){console.log("Error in doenecrytion try-catch: ",e)}}function M(e){const t=function(e){const t=Object.entries(C);for(const[n,o]of t)if(o===e)return n;return null}(new DataView(e).getUint8(0));var n;n={eventType:t},Qn()?g(n):e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onReceivingDataFromE3DSStreamingUI&&e3ds_controller.callbacks.onReceivingDataFromE3DSStreamingUI(n),(jo.controlScheme!==$o.LockedMouse||os)&&(kt||tn||Rn&&(K(e),Rn.send(e)))}const L={QualityControlOwnership:0,Response:1,Command:2,FreezeFrame:3,UnfreezeFrame:4,VideoEncoderAvgQP:5,LatencyTest:6,InitialSettings:7};var B,A,O,_,F="N/A";function D(e){vo(e),ko()}function U(e){N()}function N(e){null!=bt.ForceLandScapeMode&&0!=bt.ForceLandScapeMode&&(_n=document.getElementById("rotateOverlay"))&&(window.innerHeight>window.innerWidth?_n.style.display="block":_n.style.display="none");var t=document.getElementById("player");t&&(st&&(z(),function(){let e=bt?.qualityPreset;if(e){switch(e){case"low":qo(51);break;case"medium":qo(34);break;case"high":qo(17);break;case"ultra":qo(1)}const t=document.querySelectorAll("#qualityList li");for(let e of t)e.classList.contains("selectedQuality")&&e.classList.remove("selectedQuality");document.getElementById(e)?.classList.add("selectedQuality")}}()),t.classList.contains("fixed-size")||(function(e){let t=e.getElementsByTagName("VIDEO"),n=window.innerHeight/window.innerWidth,o=e.clientHeight/e.clientWidth,s=t.videoHeight/t.videoWidth;var i;isNaN(s)?(B=window.innerWidth,A=window.innerHeight,i="top: "+(O=0)+"px; left: "+(_=0)+"px; width: "+B+"px; height: "+A+"px; "+mn):n<o?(B=Math.floor(window.innerHeight/s),A=window.innerHeight,O=0,_=Math.floor(.5*(window.innerWidth-B)),i="top: "+O+"px; left: "+_+"px; width: "+B+"px; height: "+A+"px; cursor: "+styleCursor+"; "+mn):(B=window.innerWidth,A=Math.floor(window.innerWidth*s),i="top: "+(O=Math.floor(.5*(window.innerHeight-A)))+"px; left: "+(_=0)+"px; width: "+B+"px; height: "+A+"px; cursor: "+styleCursor+"; "+mn),function(e,t){if(!(Nt.length>0)||st)if(2==Lo||null==Kt){e.style=t+";background-image: 'none';",document.getElementsByClassName("loader"),document.getElementById("videoPlayOverlay");var n="#FFFFFFFF"}else if(null!=Kt){e.style=t+";background-image: url("+Kt+");";const s=document.querySelectorAll(".loader");for(let e=0;e<s?.length;e++)s[e].style.setProperty("--darkBG",`url("${Kt}")`,"important");n="#FFFFFF00";var o=document.getElementById("loaderStep1");o.style.background=n,(o=document.getElementById("loaderStep3")).style.background=n}}(e,i)}(t),$n=t.getBoundingClientRect(),Ds(),q()))}var G=!0;function H(){if(G){var e=document.getElementById("player");e&&"Dynamic"==bt.resolutionType_ue4&&y(e.clientWidth,e.clientHeight)}}function z(){if(null==Hn)return H(),void(Hn=(new Date).getTime());(new Date).getTime()-Hn>St?(H(),Hn=(new Date).getTime()):(console.log("Resizing too often - skipping"),clearTimeout(On),On=setTimeout(z,St))}var W={receiving:!1,size:0,jpeg:void 0,height:0,width:0,valid:!1};function V(){W.valid&&(Wn.style.display="block")}function q(){if(0!==W.width&&0!==W.height){let e=0,t=0,n=0,o=0;{let s=window.innerWidth/window.innerHeight,i=W.width/W.height;s<i?(e=window.innerWidth,t=Math.floor(window.innerWidth/i),n=Math.floor(.5*(window.innerHeight-t)),o=0):(e=Math.floor(window.innerHeight*i),t=window.innerHeight,n=0,o=Math.floor(.5*(window.innerWidth-e)))}Wn.style.width=e+"px",Wn.style.height=t+"px",Wn.style.left=o+"px",Wn.style.top=n+"px"}}var $={enabled:!1,warnTimeout:void 0,closeTimeout:void 0,active:!1,overlay:void 0,warnTimer:void 0,countdown:0,countdownTimer:void 0,runningCountdown:!1,isAfkUiUp:!1};function j(){if(!$.overlay)return;const e=document.getElementById("afk-second-text");e&&$&&(e.innerText=$.countdown),$.overlay.style.display="block"}function J(){$.runningCountdown=!1,clearInterval($.countdownTimer),Q(),kt=!1}function Q(){"0"!=bt.isAfkEnabled?($.warnTimeout=60*bt.afkWarnTimeout,$.closeTimeout=60*bt.afkCloseTimeout,$.active=!0,$.enabled=!0,K()):console.log("AFK is disabled")}function K(e){e&&1===e.byteLength||$.active&&(clearTimeout($.warnTimer),$.overlay&&($.overlay.style.display="none",$.isAfkUiUp=!1),$.warnTimer=setTimeout((function(){console.log("Showing afk overlay"),function(){if($.enabled)if(!isNaN($.countdown)&&$.warnTimeout>0&&$.warnTimeout<1e3){if($.countdown=$.closeTimeout,$.isAfkUiUp=!0,kt=!0,jo.controlScheme==$o.LockedMouse)try{"function"==typeof document.exitPointerLock&&document.exitPointerLock()}catch(e){}if(clearInterval($.countdownTimer),$.countdownTimer=setInterval((function(){$.countdown--,0==$.countdown?(gn=!0,In&&In.close(4e3,"afk disconnected"),console.log("You have been disconnected for not being active,please refresh the page "),Qn()?qs("You have been disconnected for not being active,please refresh the page "):qs("You have been disconnected for not being active,to start a new session please visit: "+location.href)):j()}),1e3),$.overlay)return j(),void($.runningCountdown=!0);$.active=!1,$.overlay=document.getElementById("afkOverlay"),function(e,t,n){const o=document.getElementById("player");t&&o.appendChild(t),$.overlay&&n&&$.overlay.addEventListener("click",n),o.classList.add("clickableState")}(0,$.overlay,(e=>{J()}))}else console.log("AFK ",$.countdown,$.warnTimeout);else console.log("Not showing overlay because afk disabled.")}()}),1e3*$.warnTimeout))}function X(e){const t=Math.floor(e/1e3%60),n=Math.floor(e/6e4%60),o=Math.floor(e/36e5);let s="";return o>0&&(s+=`${o}h `),(n>0||o>0)&&(s+=`${n}m `),t>0&&(s+=`${t}s`),s.trim()}function Y(){Tn<0||(clearTimeout(Pn),Pn=setTimeout((function(){if(window.isAppPreparationprocessGoingOn||Fs)return Y(),void console.log("startExpireOnCountDown--\x3e window.isAppPreparationprocessGoingOn: "+window.isAppPreparationprocessGoingOn);Ht=!1,zt=!1,ws4queue_shouldTryToReconnect=!1,ws4queue&&ws4queue.close(4e3,"Timeout_ExpireOnCountDown"),In&&In.close(4e3,"Timeout_ExpireOnCountDown"),"function"==typeof onSessionExpired?onSessionExpired():e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onSessionExpired?e3ds_controller.callbacks.onSessionExpired():Qn()?qs("Session lasted for "+X(Tn)+"Session expired, please refresh the page "):qs("Session lasted for "+X(Tn)+". Session expired, to start a new session please visit: "+location.href),Qn()?qs("Session lasted for "+X(Tn)+". Session expired, please refresh the page "):qs("Session lasted for "+X(Tn)+". Session expired, to start a new session please visit: "+location.href)}),Tn))}function Z(){if(console.log("111111111111  onFirstHumanInteraction()"),yn)if("success"==yn.ahsanHack)window.removeEventListener("touchend",Z),window.removeEventListener("mouseup",Z);else{var e=document.getElementById("streamingVideo");e&&(e.muted=!1),d()}}function ee(){if(te){if(pn)document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),pn=!1;else{let e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),screen.orientation.lock("landscape"),pn=!0}clearInterval(Dn),clearTimeout(Un),te=!1}}Date.now();var te=!1;function ne(e){return e.length>123&&(e=e.substring(0,123)),e}function oe(e,t,n=!0,o=void 0,s=void 0){if(console.trace(),console.log("ForceReloadPageWithproperInfo diderrorhappend:"+Tt),fn&&(fn.domainName,fn.topLevelDomainName),window.location.href,JSON.stringify(dn),JSON.stringify(qt),JSON.stringify(Nn),n&&nt(e,o),s&&In&&In.readyState===Bn){const t=function(){const e=new Date;return`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}-${String(e.getUTCDate()).padStart(2,"0")}T${String(e.getUTCHours()).padStart(2,"0")}:${String(e.getUTCMinutes()).padStart(2,"0")}:${String(e.getUTCSeconds()).padStart(2,"0")}.000Z`}();var i={href:window.location.href,type:s,msg:e,date:t,cirrusServer:Fe,appName:Zt,owner:De,clientInfo:dn,ue4ExeInfo:qt,userDeviceInfo:Nn};In.send(JSON.stringify({type:"DoFBEntreyofSystemIssue",obj:i})),setTimeout((function(){Ht=!1,In&&In.close(4e3,ne("ForceReloadPageWithproperInfo() : "+e))}),1e3)}else Ht=!1,In&&In.close(4e3,ne("ForceReloadPageWithproperInfo() : "+e));Dt(e,{color:"Red"}),setTimeout((function(){location.reload()}),t)}function se(e){if(null==timeRecords.appLoadingStageStartedAt&&addToTimeRecords("appLoadingStageStartedAt",getCurrentDate()),!(Nt.length>0)){qn+=e,console.log("LunchingProgressAmount:"+qn),e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onReceivingAppStartingProgress&&e3ds_controller.callbacks.onReceivingAppStartingProgress(qn);var t=document.getElementById("LunchingProgress"),n=document.getElementById("Title_LunchingProgress"),o=document.getElementById("videoPlayOverlay");o&&(o.style.display="none"),window.isAppPreparationprocessGoingOn||n&&(n.style.display="block"),null!==t&&(window.isAppPreparationprocessGoingOn||t&&(t.style.display="block"),t.value=qn),qn>=100&&null==timeRecords.appLoadingStageFinishedAt&&addToTimeRecords("appLoadingStageFinishedAt",getCurrentDate())}}function ie(e,t){if(e.iceServers.length!==t.iceServers.length)return!1;const n=sortIceServers(e.iceServers),o=sortIceServers(t.iceServers);for(let e=0;e<n.length;e++)if(!re(n[e],o[e]))return!1;return!0}function ie(e,t){if(e.iceServers.length!==t.iceServers.length)return!1;for(let n=0;n<e.iceServers.length;n++)if(!re(e.iceServers[n],t.iceServers[n]))return!1;return!0}function re(e,t){if(e.username!==t.username||e.credential!==t.credential)return!1;const n=ae(e.urls),o=ae(t.urls);return JSON.stringify(n)===JSON.stringify(o)}function ae(e){return e&&Array.isArray(e)?e.slice().sort():[]}function le(e){addToTimeRecords("onConfigCalledAt",getCurrentDate()),Ue=e,console.log("onConfig() config.peerConnectionOptions1: \n"+JSON.stringify(e.peerConnectionOptions,null,2));var t=e.peerConnectionOptions;null!=Be&&(mergedIceServers=Be.iceServers.concat(e.peerConnectionOptions.iceServers),t.iceServers=mergedIceServers,console.log("merged ice_serversObj: "+JSON.stringify(t,null,2)));var n=[{urls:["stun:stun.l.google.com:19302"]}].concat(t.iceServers);fsfsf1111=[{username:"PixelStreamingUser",credential:"AnotherTURNintheroad",urls:["stun:stun.l.google.com:19302","turn:172.7.191.70:443"]}],t.iceServers=n,e.peerConnectionOptions=t,console.log(" final peerConnectionOptions: \n"+JSON.stringify(e.peerConnectionOptions,null,2));let o=document.getElementById("player");Rn||(Rn=new Io({peerConnectionOptions:t}),yn||(yn=document.createElement("Audio"))),console.log(" webRtcPlayerObj.cfg:",Rn.cfg),console.log("webRtcPlayerObj.cfg.iceServers:",Rn.cfg.iceServers),console.log("ice_serversObj:",t),console.log("ice_serversObj.iceServers:",t.iceServers),t.iceServers==Rn.cfg.iceServers&&console.log("same");const s=ie(t,Rn.cfg);console.log("Are the configurations equal?",s),Rn.cfg=t,o.appendChild(Rn.video),function(e){e&&(function(e){e.onmouseenter=function(t){if(!tn){Ln&&console.log("mouse enter:"+e.id);var n=new DataView(new ArrayBuffer(1));n.setUint8(0,C.MouseEnter),M(n.buffer),e.pressMouseButtons(t)}},e.onmouseleave=function(t){if(!tn){Ln&&console.log("mouse leave: "+e.id);var n=new DataView(new ArrayBuffer(1));n.setUint8(0,C.MouseLeave),M(n.buffer),e.releaseMouseButtons(t)}}}(e),as(e))}(ft),0!=Me&&(Ke=[],Rn?(console.log("Creating offer"),ls("Starting connection to server, please wait"),se(5),Rn.createOffer(),clearTimeout(is)):(console.log("WebRTC player not setup, cannot create offer"),ms("Unable to setup video")));let i=ft;switch(N(),jo.controlScheme){case $o.HoveringMouse:!function(e){e.onmousemove=function(e){Jo(e.offsetX,e.offsetY,e.movementX,e.movementY),e.preventDefault()},e.onmousedown=function(e){u(),Ko(e.button,e.offsetX,e.offsetY),e.preventDefault()},e.onmouseup=function(e){u(),Xo(e.button,e.offsetX,e.offsetY),e.preventDefault()},e.oncontextmenu=function(e){Xo(e.button,e.offsetX,e.offsetY),e.preventDefault()},"onmousewheel"in e?e.onmousewheel=function(e){Yo(e.wheelDelta,e.offsetX,e.offsetY),e.preventDefault()}:e.addEventListener("DOMMouseScroll",(function(e){Yo(-120*e.detail,e.offsetX,e.offsetY),e.preventDefault()}),!1),e.pressMouseButtons=function(e){ns(e.buttons,e.offsetX,e.offsetY)},e.releaseMouseButtons=function(e){ts(e.buttons,e.offsetX,e.offsetY)}}(i);break;case $o.LockedMouse:ss(i);break;default:console.log(`ERROR: Unknown control scheme ${jo.controlScheme}`),ss(i)}}function ce(e){"use strict";if(it=new Date,pt(),"whiteTheme"===bt.StreamingUiTheme){var t=document.getElementById("queueNumberText");t&&(t.style.display="none");var n=document.getElementById("InQueue_Text");n&&(n.style.display="none");var s=document.getElementById("videoPlayOverlay");s&&(s.style.display="none")}if(console.log(" connectss cirrusServer:  "+JSON.stringify(e)),console.log("111111111111  load()"),(Wn=document.createElement("img")).id="freezeFrameOverlay",Wn.style.display="none",Wn.style.pointerEvents="none",Wn.style.position="absolute",Wn.style.zIndex="30",document.onkeydown=function(e){if(13==e.keyCode&&($.isAfkUiUp||$.runningCountdown))return J(),void document.getElementById("afkOverlay").focus();9===e.keyCode&&(e.preventDefault(),e.stopPropagation()),u(),o&&o.value,Ln&&console.log(`key down ${e.keyCode}, repeat = ${e.repeat}`),229==e.keyCode?ve=!1:(ve=!0,M(new Uint8Array([C.KeyDown,a(e),e.repeat]).buffer)),e.keyCode===r.BackSpace&&document.onkeypress({charCode:r.BackSpace}),e.ctrlKey&&e.altKey&&"e"===e.key&&(console.log("111111111111111111111111 keyCode: "+e.keyCode),Vo()),jo.suppressBrowserKeys&&i(e.keyCode)&&e.preventDefault()},document.onkeyup=function(e){$.isAfkUiUp||(u(),Ln&&console.log(`************ key up ${e.keyCode}`),M(new Uint8Array([C.KeyUp,a(e)]).buffer),jo.suppressBrowserKeys&&i(e.keyCode)&&e.preventDefault())},document.onkeypress=function(e){if($.isAfkUiUp)return;u(),Ln&&console.log(`key press ${e.charCode}`);let t=new DataView(new ArrayBuffer(3));t.setUint8(0,C.KeyPress),t.setUint16(1,e.charCode,!0),M(t.buffer)},c=p,zn.set("responseHandler01",c),!gn)if(window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket){var l="wss://"+e.domain+"/ws/"+e.httpsPort+"/";console.log(" connectss url:  "+l),addToTimeRecords("ss_WebSocketConnectionCalledAt",getCurrentDate()),(In=new WebSocket(l)).onopen=function(t){if(addToTimeRecords("ss_WebSocketConnectionEstablishedAt",getCurrentDate()),console.log("11111111111111111111 ws.onopen  "),"VrApp"==bt.platform){var n={type:"vrApp",serverPublicIp:e.elInfo.serverPublicIp,port:3389};console.log("6666666666666 JSON.stringify(josnObj): "+JSON.stringify(n));var o=function(e){var t=JSON.stringify(e);console.log("encryptJosn JSON.stringify(josnObj): "+t);var n=btoa(t);return console.log("encryptJosn btoa: "+n),console.log("encryptJosn atob: "+atob(n)),n}(n),s="e3dsrdp://"+o;console.log("opening Vr connector:"+s),e3ds_alert("opening Vr connector:"+s,{color:"blue"}),window.open(s,"_blank")}JSON.stringify({type:"xirsysResponse",responseText:JSON.stringify({})})},In.onmessage=function(e){var t;console.log(`<- SS: ${e.data}`);try{t=JSON.parse(e.data),console.log("SS--\x3e ws (msg.type: "+t.type),me(t)}catch(t){console.error("Failed to parse JSON data:",t),console.error("event.data:"),console.error(e.data)}},In.reconnectAttempt=0,In.onerror=function(e){console.error(`WS error: ${JSON.stringify(e)}`),console.error("redirecting to: "+window.location.href),d(e,"Connection lost. Redirecting you in 3 sec to re-establish connection. ")},In.onclose=function(e){console.error(`WS closed: ${JSON.stringify(e.code)} - ${e.reason}`),console.error("WS closed:"+JSON.stringify(e)),d(e,"Connection lost. Redirecting you in 3 sec to re-establish connection. ")},In.onclose111=function(e){console.warn(`WS closed: ${JSON.stringify(e.code)} - ${e.reason}`+window.location.href),In=void 0;let t=document.getElementById("player");Rn&&(t.removeChild(Rn.video),Rn.close(),Rn=void 0),ms(`Disconnected: ${e.reason}`),setTimeout(start,4e3)}}else alert("Your browser doesn't support WebSocket");var c;function d(e,t){if(Ht){In&&(In.reconnectAttempt++,console.error("ssReconnec() reconnectAttempt:"+In.reconnectAttempt)),In=void 0;var n="";if(null!=e.code){var o=function(e){if(e>=0&&e<=999)return"(Unused)";if(e>=1016){if(e<=1999)return"(For WebSocket standard)";if(e<=2999)return"(For WebSocket extensions)";if(e<=3999)return"(For libraries and frameworks)";if(e<=4999)return"(For applications)"}return void 0!==$t[e]?$t[e]:"(Unknown)"}(e.code);n=t+JSON.stringify(e.code)+" : "+e.reason+" : "+o}else n=t+" Could not connect to Web-socket.";var s=!1;1e3!=e.code&&1001!=e.code&&1006!=e.code||(s=!0),console.error(`WS closed: ${JSON.stringify(e.code)} - ${e.reason}`),oe(n,5e3,s,-972634118)}}}function de(e){if(e.apps.data.blobs.length<=0||e.apps.data.blobs[0].files.length<=0)to=[];else{var t=to=e.apps.data.blobs[0].files;if(!(t<=0)){var n=document.getElementById("imageAssets");if(n){if(void 0===$e){var o=document.createElement("option");o.text=o.value="",$e===o.value&&(o.selected=!0),n.appendChild(o)}for(var s=0;s<t.length;s++){var i=t[s].url,r=document.createElement("option");r.text=he(i),r.value=i,$e===r.value&&(r.selected=!0),n.appendChild(r)}}}}}function ue(e){e.apps.data.blobs.length<=0||e.apps.data.blobs[0].files.length<=0?no=[]:(e.apps.data.blobs[0].files.forEach((e=>{no.includes(e.url)||no.push(e.url)})),console.log(no))}function he(e){const t=e.split("/");return t[t.length-1]}function me(e){if("config"===e.type)null==qt&&null!=e.ue4ExeInfo&&(qt=e.ue4ExeInfo,vt=new Date,addToTimeRecords("time_ue4ExeInfoArrivedAt",getCurrentDate())),le(e);else if("playerCount"===e.type)zo(e.count-1);else if("muteUser"===e.type){const t=document.getElementById("button-microphone");t&&t.src.includes("voipmicOn")&&e.id==window.playerId&&t.click()}else if("offer"===e.type)addToTimeRecords("playerReceivedOfferOfAppAt",getCurrentDate()),console.log(" <- SS arvind offer --\x3e  msg.sdp: %o",e.sdp),D(e);else if("answer"===e.type)addToTimeRecords("playerReceivedAnswerOfAppAt",getCurrentDate()),console.log(" answer : "+JSON.stringify(e)),Rn.receiveAnswer(e),ko(),se(5);else if("gettings"===e.type)console.log("message type:gettings:  "+JSON.stringify(e)),console.log("message type:gettings msg.data:  "+JSON.stringify(e.data));else if("addInExistingGuestList"===e.type)(n=document.getElementById("Guest-filter"))&&e.guestList.forEach((function(e){var t=document.createElement("option");t.text=t.value=e,n.add(t,n.length-1)}));else if("GuestJoined"===e.type){if(0==an){const t=document.getElementById("meetingGuestList");if(t){let n=document.createElement("li");n.id=`guestRow-${e.guestPlayerId}`,n.className="list-group-item",n.innerHTML=`<span>${e.guestPlayerId}</span> \n\t\t\t\t<div>\n\t\t\t\t<button id="toggleControlForGuest-${e.guestPlayerId}"> <img src="https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/UIimages/controllOff.svg"/> </button> <button id="kickGuest-${e.guestPlayerId}"> <img src="https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/UIimages/kick.svg"/> </button> \n\t\t\t\t</div>`,t.appendChild(n);const o=document.getElementById(`toggleControlForGuest-${e.guestPlayerId}`);o&&(o.onclick=function(){const t=o.getElementsByTagName("img")[0];let n="";t.src.includes("controllOff")?(n="on",t.src="https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/UIimages/controllOn.svg"):(n="off",t.src="https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/UIimages/controllOff.svg"),window.dispatchToggleControl(n,e.guestPlayerId)});const s=document.getElementById(`kickGuest-${e.guestPlayerId}`);s&&(s.onclick=function(){In.send(JSON.stringify({type:"KickSelctedGuest",playerIDToKick:e.guestPlayerId}))})}}if(n=document.getElementById("Guest-filter")){var t=document.createElement("option");t.text=t.value=e.guestPlayerId,n.add(t,n.length-1)}}else if("GuestLeft"===e.type){const t=document.getElementById(`guestRow-${e.guestPlayerId}`);var n;if(t&&t.remove(),n=document.getElementById("Guest-filter"))for(var o=0;o<n.length;o++)n.options[o].value==e.guestPlayerId&&n.remove(o)}else if("updateGuestName"==e.type){const t=document.getElementById(`guestRow-${e.guestPlayerId}`);t&&(t.getElementsByTagName("span")[0].innerText=e.guestName)}else if("takeChatGptAnswer"===e.type)b({ChatGptQuestion:e.ChatGptQuestion,ChatGptAnswer:e.ChatGptAnswer});else if("takeGameCustomizationData"===e.type)b(e);else if("takeUploadUrl"===e.type)Bs(e.uploadURL,e.input.content_type,e.input.file_name,e.input.pathToSaveFile);else if("sendplayerType"===e.type){null!=e.playerId&&(ye=e.playerId,window.playerId=e.playerId,Yt&&0==an&&document.getElementById("popupForVoipUsername"))&&(document.getElementById("joinBtn").innerText="Join Meeting",document.getElementById("popupForVoipUsername").style.display="flex",document.getElementById("voipUserName").select(),document.getElementById("popupForVoipUsernameForm").onsubmit=function(e){e.preventDefault();const t=document.getElementById("voipUserName").value;In&&In.send(JSON.stringify({type:"updateGuestName",guestPlayerId:ye,guestName:t})),document.getElementById("popupForVoipUsername").style.display="none"});var s=void 0;pe&&(s=pe.get("appVersion")),null==s&&(s=-1),null==dn&&(dn="undefined"),bt.clientSideInfo={},bt.clientSideInfo.url=window.location.href,bt.clientSideInfo.userAgent=navigator.userAgent,bt.clientSideInfo.clientInfo=dn,bt.clientSideInfo.userDeviceInfo=Nn;let t={type:"takePlayerType",isSpectator:tn,hostMeetingId:Xt,appDownloadInfo:at,GuestMeetingId:Yt,version:s,uInfo:Ne,userDeviceInfo:Nn,configName:en,urlVersion:Lt,appName:sn("appName"),navigationType:window.location.href,url:window.location.href,href_emulated:_e,userAgent:navigator.userAgent,clientInfo:dn,serverOwner:De,forceMeetingMode:nn,accessedTopLevelDomainName:_t,url_searchParams:String(pe),configuration:bt};if(null!=Ge){const e=Ge?.email;x=e,["@eagle3dstreaming.com","@eaglepixelstreaming.com"].some((e=>x.endsWith(e)))&&(t.e3ds_employee=!0)}var i=JSON.stringify(t);console.log(" ws.send(): "+JSON.stringify(i)),In.send(i)}else if("handleshuttingDownVM"===e.type)Tt=!0,oe(r="shutting down this VM .So redirecting you in 3 sec to re-establish connection",5e3);else if("handleElDisconnected"===e.type){Tt=!0;var r="EL crashed: "+e.errormsg;if(Rn&&Rn.pcClient){const e=Rn.pcClient.iceConnectionState;if("connected"===e){var a="handleElDisconnected() EL crashed but Video stream is streaming. so returning";return console.log(a),void Ye(a,-4089034249)}"failed"!==e&&"disconnected"!==e&&"closed"!==e||(r=r+" ice connectionState: "+e)}r+=" .So redirecting you in 3 sec to re-establish connection",console.log(r),oe(r,5e3,!0,-972942690,"handleElDisconnected")}else if("handleStreamerDisconnected"===e.type){let e=gt(getCurrentDate(),timeRecords.datachannelconnectedAt);if(1==bt.injectStreamFromEditor){let t=`Remote Editor stream lasted for ${e} seconds`;return console.log(`postToTelegram: ${t}`),nt(t,-4767276367),void oe("Streamer Disconnected",3e3,!1)}Tt=!0,oe(r=`Stream duration: ${e||"undefined"} seconds. Streamer Disconnected.So redirecting you in 3 sec to re-establish connection`,5e3,!0,e?-0xe95c7c2279:-828953428,"StreamerDisconnected")}else if("ping"===e.type)In.send(JSON.stringify({type:"pong"}));else if("reload"===e.type)location.reload();else if("ConfigUpdateOnClientSide"===e.type)window.location.href=window.location.href;else if("redirectTo"===e.type)console.log("222222 <- SS: msg.data.url: "+e.url),window.location.replace(e.url);else if("jsonMessageForUE4"===e.type)console.log("jsonMessageForUE4: "+JSON.stringify(e.jsonObj)),b(e.jsonObj);else if("ShowThisHtmlPage"===e.type)gn=!0,In&&In.close(),self.location=e.htmlPage;else if("setGuestId"===e.type)document.getElementById("GuestTitle")&&(document.getElementById("GuestTitle").innerHTML=e.guestId);else if("sendtoUnrealinAppPurchaseResult"===e.type)console.log("222222 <- SS: sendtoUnrealinAppPurchaseResult msg.data.info: "+e.data.purchasResult),b({purchasResult:e.data.purchasResult});else if("ShowE3ds_alert"===e.type){console.log("222222 <- SS: ShowE3ds_alert msg.data.info: "+e.data.info);var l={};null!=e.data.color&&(l.color=e.data.color),null!=e.data.timeout&&(l.timeout=e.data.timeout),Dt(e.data.info,l)}else if("includeInTimeRecords"===e.type){var c=e.timeRecords_ssSide;for(const e in c)if(timeRecords.hasOwnProperty(e)){var d=!0;if(Object.keys(timeRecords).forEach((t=>{t.startsWith(e)&&(console.log(t),timeRecords[t]===c[e])&&(d=!1)})),d){let t=1,n=e+t;for(;timeRecords.hasOwnProperty(n);)t++,n=e+t;timeRecords[n]=c[e]}}else timeRecords[e]=c[e];console.log(timeRecords)}else if("UE5Editorlunched"===e.type){console.log(JSON.stringify(e));var u="http://"+e.url+":"+e.port;console.log("UE5Editorlunched url "+u),location.assign(u)}else if("UE4LogFromEL"===e.type)console.info(e.data.logLine);else if("showPageWIthMsg"===e.type)qs(e.data.info);else if("ShowInfoToInjectStreamFromEditor"===e.type){var h="ws://"+Fe.domain+":"+Fe.ue4StreamerToSS;console.log("injectStreamFromEditorInfo: "+h),obj=document.getElementById("loaderStep1"),obj&&(obj.style.display="none"),document.getElementById("Info4injectStreamFromEditor").value=h;var m=document.getElementById("popupForinjectStreamFromEditorInfo");m&&(m.style.display="flex")}else if("ShowInfo"===e.type){if(console.log("222222 <- SS: msg.data.info: "+e.data.info),l={},null!=e.data.color&&(l.color=e.data.color),null!=e.data.timeout&&(l.timeout=e.data.timeout),e.data.info.startsWith("showPageWIthMsg:"))return void qs(e.data.info.replace("showPageWIthMsg:",""));if(e.data.info.startsWith("EL Error:")){let t=e.data.info.replace("EL Error:","");console.error(JSON.stringify(e.data)),console.error(t),t.startsWith("Upload system having critical Isssue.")&&nt(t,-977631986),t.startsWith("No exe found in any subdirectories")&&qs("Invalid App. No exe found in any subdirectories "),Dt(t,l)}try{var p=JSON.parse(e.data.info);console.log("33333 <- SS: msg.data.info: "+JSON.stringify(p));var f=document.getElementById("Title_AcquiringProgresss"),v=document.getElementById("AcquiringProgress"),y=document.getElementById("Title_PreparingProgress"),S=document.getElementById("PreparingProgress"),C=document.getElementById("LunchingProgress"),w=document.getElementById("Title_LunchingProgress");if("AppAcquiringData"==p.datatype){null==timeRecords.AppAcquiringStartedAt&&(ge=!0,addToTimeRecords("AppAcquiringStartedAt",getCurrentDate()),nt(`App acquiring started at ${getCurrentDate()}\n`,-0xe96ac01e27)),console.log("5555 <- AppAcquiringData AcquiringProgress: "+p.data.percent);var E=document.getElementById("videoPlayOverlay");if(E&&(E.style.display="none"),e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onReceivingAppAcquiringProgress&&e3ds_controller.callbacks.onReceivingAppAcquiringProgress(p.data.percent),f.style.display="block",window.isAppPreparationprocessGoingOn=!0,it=new Date,null!==v){v.value=100*p.data.percent;var T={type:"stage3_1_AppAcquiringProgress",percent:p.data.percent};g(T),C.style.display="none",w.style.display="none",v.style.display="block",v.value>=100&&(null==timeRecords.AppAcquiringFinishedAt&&addToTimeRecords("AppAcquiringFinishedAt",getCurrentDate()),y.style.display="block",null!==S&&(S.value=0,S.style.display="block"))}}else"AppPreparationData"==p.datatype&&(null==timeRecords.AppPreparationStartedAt&&addToTimeRecords("AppPreparationStartedAt",getCurrentDate()),window.isAppPreparationprocessGoingOn=!0,it=new Date,e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onReceivingAppPreparationProgress&&e3ds_controller.callbacks.onReceivingAppPreparationProgress(p.data.percent),T={type:"stage3_2_AppPreparationProgress",percent:p.data.percent},g(T),p.data.percent>=100&&(null==timeRecords.AppPreparationFinishedAt&&addToTimeRecords("AppPreparationFinishedAt",getCurrentDate()),window.isAppPreparationprocessGoingOn=!1,Y(),Q()),null!==S&&(S.value=p.data.percent,S.style.display="block",y.style.display="block",C.style.display="none",w.style.display="none",S.value>=100&&(w.style.display="block",null!==C&&(C.value=0,C.style.display="block"))))}catch(e){}}else if("TakeuserDeviceInfo"===e.type)"Oculus Browser"==(Nn=e.userDeviceInfo).client.name&&(Nn.device.type="hmd"),console.log(`userDeviceInfo : ${JSON.stringify(Nn)}`),console.log(`elInfo : ${JSON.stringify(e.elInfo)}`),console.log(" 1111111111111 useExtendedTyping > "+rn);else if("OnLocalFileUploadingFinished"===e.type){var k=e.data.objFromUE4;if(null!=k)switch(k.cmd){case"downloadLocalFileOnUserDevice":window.open(e.data.Location,"_blank");break;case"getDownloadUrlOfLocalFile":b({type:"takeDownloadUrlOfLocalFile",downloadURL:e.data.Location,localFile:k.fileToDownload})}}else if("OnFinishingOfClientFileDownladOnEL"===e.type){let t={cmd:"onUploadedFileAvailable",filename:e.data.filename};b(t),console.log(t)}else"ue4Version"===e.type?(Vt=e.currentAppsUE4Version,Se&&g({type:"ueVersion",value:Vt?.versionString})):"PsPluginPixelStreamingDireExist"===e.type?(console.log("****PsPluginPixelStreamingDireExist : "+e.PsPluginPixelStreamingDireExist),We=e.PsPluginPixelStreamingDireExist):"PsPluginEntryInManifestFile"===e.type?(console.log("****PsPluginEntryInManifestFile : "+e.PsPluginEntryInManifestFile),Ve=e.PsPluginEntryInManifestFile):"ue4ExeInfoMsg"===e.type?(qt=e.ue4ExeInfo,Vt=qt.versionString,vt=new Date,console.log("ue4AppExe path:"+qt.ue4AppExe),se(2)):"iceCandidate"===e.type?(Rn&&Rn.handleCandidateFromServer(e.candidate),se(5)):"DisableControlFromOthers"===e.type?tn=!0:"AllAssetsUrls"===e.type||"AllVideoAssetsUrls"===e.type?ue(e):"All2dAssetsUrls"===e.type?de(e):"GiveControlToThisGuest"===e.type?tn=!1:console.warn(`invalid SS message type: ${e.type}`);var x}Number.prototype.clamp=function(e,t){return Math.min(Math.max(this,e),t)},document.getElementById("Title_AcquiringProgresss"),document.getElementById("AcquiringProgress"),document.getElementById("Title_PreparingProgress"),document.getElementById("PreparingProgress"),document.getElementById("LunchingProgress"),document.getElementById("Title_LunchingProgress"),"undefined"==typeof e3ds_controller&&(e3ds_controller={}),void 0===e3ds_controller.callbacks&&(e3ds_controller.callbacks={});var ge=!1;const pe=new URLSearchParams(window.location.search),fe=performance.getEntriesByType("navigation")[0];fe&&performance.mark("request-initiated",{startTime:fe.fetchStart});let ve=!0;var ye=void 0,Se=!1,Ce={},we=void 0,be=[];let Ee=!1,Te=0;var ke=void 0,xe=console,Pe=console.log,Ie=console.warn;Jt(0);var Re=void 0,Me=!0,Le=[];window.onSuccessfulGoogleLogin=function(e){console.log("user: \n "+JSON.stringify(e,null,2)),b({type:"onSuccessfulGoogleLogin",data:e})};var Be=void 0;let Ae="https://global.xirsys.net/_turn/prod-global-2-22-2023";Ae="https://global.xirsys.net/_turn/prod-7-8-2024",function e(){let t=new XMLHttpRequest;t.onreadystatechange=function(e){4==t.readyState&&(0==t.status?JSON.stringify({}):200==t.status&&""!=t.responseText&&(JSON.parse(t.responseText).s,function(e){try{console.log("buildxirsysIceServersConfig() responseText:  "+e);var t=JSON.parse(e);if(console.log("buildxirsysIceServersConfig() obj:  "+JSON.stringify(t)),t.v.iceServers){var n={iceServers:[{username:t.v.iceServers.username,credential:t.v.iceServers.credential,urls:t.v.iceServers.urls}]};Be=n}console.log("buildxirsysIceServersConfig() xirysGeoLocationBasedTurnSever:  "+JSON.stringify(Be))}catch(e){console.error(`buildxirsysIceServersConfig(): Cannot parse   responseText: ${e}`)}}(t.responseText)))},t.onerror=function(){e3ds_alert("xirsys errror.trying again ",{color:"Blue"}),e()};try{t.open("PUT","https://global.xirsys.net/_turn/prod-7-8-2024",!0),t.setRequestHeader("Authorization","Basic "+btoa("eagle3dstreaming:c280e804-72d9-11eb-8e31-0242ac150006")),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify({format:"urls"}))}catch(e){e3ds_alert("xirsys errror: "+e,{color:"Blue"}),e3ds_alert("xirsys errror: "+e.message,{color:"Blue"})}}();var Oe=0;let _e;var Fe=void 0;let De,Ue,Ne,Ge,He=!1,ze=!1,We=!1,Ve=!1,qe=!1;var $e=void 0,je=void 0,Je=void 0;let Qe,Ke,Xe=[];function Ye(e,t){e.includes("chrome-extension")||(1==Oe&&console.log("postToTelegram(): "+e),function(e,t=-4276927023){1!=He&&fetch("https://notifications.eagle3dstreaming.com/message_sent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input_chat_id:t,message:e})}).then((e=>{})).catch((e=>{console.error(e)}))}(e,t))}function Ze(){if(!Fe||!Fe.elInfo)return;const e=function(e,t,n,o){const s=et(n-e),i=et(o-t),r=Math.sin(s/2)*Math.sin(s/2)+Math.cos(et(e))*Math.cos(et(n))*Math.sin(i/2)*Math.sin(i/2);return 3958.8*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}(Fe.elInfo.clientInfo.latitude,Fe.elInfo.clientInfo.longitude,dn.fullInfo.latitude,dn.fullInfo.longitude);return console.log("Distance between the points:",e.toFixed(2),"miles"),Fe.elInfo.clientInfo.city+", "+Fe.elInfo.clientInfo.region+", "+Fe.elInfo.clientInfo.country_name+",  ->  "+dn.fullInfo.city+", "+dn.fullInfo.region+", "+dn.country_name+" -> distance: "+e+" miles"}function et(e){return e*(Math.PI/180)}function tt(e){const t=Object.keys(e).sort(((t,n)=>e[t]-e[n])),n={};var o={};console.dir(t),t.forEach((function(t){if(e.hasOwnProperty(t)){const s=new Date(e[t]),i=`${String(s.getUTCHours()).padStart(2,"0")}:${String(s.getUTCMinutes()).padStart(2,"0")}:${String(s.getUTCSeconds()).padStart(2,"0")}:${String(s.getUTCMilliseconds()).padStart(3,"0")}`;n[t]=e[t],o[t]=i}}));const s=Object.entries(o).sort((([,e],[,t])=>{const n=e=>e.split(":").reduce(((e,t,n)=>{const o=[36e5,6e4,1e3,1][n];return e+parseInt(t,10)*o}),0);return n(e)-n(t)})),i=Object.fromEntries(s);return console.log(i),{humanReadableData:n,timeOnlyData:o=i}}function nt(e,t){if(!e.includes("chrome-extension")){var n=_e;if(Qn()&&(n=n+" : ----\x3eisInIframe: "+Qn()),Fe&&Fe.elInfo&&(n=n+" : ----\x3e"+Fe.elInfo.instanceId_exeLuncher+" : "+Fe.elInfo.computerName),dn){var o={ip_address:dn.fullInfo.ip_address,city:dn.fullInfo.city,country:dn.fullInfo.country,continent:dn.fullInfo.continent,longitude:dn.fullInfo.longitude,latitude:dn.fullInfo.latitude,security:dn.fullInfo.security,connection:dn.fullInfo.connection};n=n+" : ->"+JSON.stringify(o)}if(Nn&&(n=n+" : ----\x3e"+JSON.stringify(Nn)),n=n+" : ----\x3eappname: "+Zt+" , owner: "+De+" , "+JSON.stringify(qt),null!=Ue&&(n=n+" : ----\x3e config.peerConnectionOptions: "+JSON.stringify(Ue.peerConnectionOptions)+" : ----\x3e"),n=e+" : "+n,timeRecords){const e=tt(timeRecords);n=n+" : ----\x3etimeRecords : "+JSON.stringify(e.timeOnlyData,null,2)}je&&(n=n+" : ----\x3elastSetResCmdSend : "+je),Je&&(n=n+" : ----\x3elastIceConnectionState : "+Je),ut&&(n=n+" : ----\x3ereTryAttemptForWebrtcReconnection : "+ut),n=(n=(n=(n=(n=null==Ke?n+" -> accessibleCanddaites: "+Ke:n+" -> accessibleCanddaites.length: "+Ke.length)+" ->  "+Ze())+" ->  ShouldAutoPlay: "+wn)+" : ----\x3eiceConnectionStateChanges : "+JSON.stringify(be,null,2))+" : ----\x3eturnServerInfo : "+JSON.stringify(Ce,null,2),Ee&&(n=n+" : ----\x3eisIceRestart : "+Ee),Te>0&&(n=n+" : ----\x3ecountIceRestart : "+Te),n=n+" : ----\x3euserAgent : "+navigator.userAgent,null==t?Ye(n):Ye(n,t)}}window.onerror=function(e,t,n,o,s){if(nt){var i="window.onerror(): "+e+": "+t+": "+n+": "+o+":window.TelegramWebviewProxy "+window.TelegramWebviewProxy+": "+s;if(null!=window.TelegramWebviewProxy)return void console.log(i);nt(i,-4064029056)}},window.addEventListener("error",(function(e){if(nt){var t=`Uncaught Error: ${e.message}\nStack Trace: ${e.error?e.error.stack:"N/A"}`;if(null!=window.TelegramWebviewProxy)return void console.log(t);nt(t,-4064029056)}})),window.addEventListener("unhandledrejection",(function(e){var t=`111Unhandled Rejection: ${e.reason}`;null==window.TelegramWebviewProxy?nt(t,-4064029056):console.log(t)}));var ot=40,st=!1,it=void 0,rt=void 0,at=void 0,lt=void 0;let ct=-1;var dt=void 0,ut=0;function ht(){Ht=!1,wt&&clearInterval(wt),Ct&&clearInterval(Ct),In.close()}function mt(){try{if(!window.close)throw new Error("window.close is not supported");if(window.close(),!window.closed)throw new Error("Failed to close the window")}catch(e){console.error("Error:",e),Dt("Scripts may close only the windows that were opened by them.",{color:"red",timeout:5e3})}}function gt(e,t){const n=(new Date(e)-new Date(t))/1e3;return Math.ceil(n)}function pt(){1!=window.isAppPreparationprocessGoingOn?"1"!==bt.injectStreamFromEditor&&(rt=setInterval((function(){var e=new Date-it;if(st){clearTimeout(dt),clearInterval(rt);var t=e/1e3;we=t,Se&&g({type:"loadTime",value:`${t} sec`}),performance?.measure("Video Start Took Time:","request-initiated","videoPlayingEventCalledAt");const s=function(e){const t=performance.getEntriesByType("mark").sort(((e,t)=>e.startTime-t.startTime)),n=t.length>0?t[0].startTime:0,o={};return t.forEach((e=>{const t=e.startTime-n,s=t>=1e3?`${(t/1e3).toFixed(2)}s`:`${t.toFixed(2)}ms`;o[s]=e.name})),o}(),i=performance.getEntriesByType("measure")[0];var n="video stream took:"+t+" sec.  Url: "+window.location.href;Fe&&Fe.elInfo&&(n=Fe.elInfo.computerName+" : "+n),qt&&qt.ue4AppExe&&(n=n+" : "+JSON.stringify(qt));const r=tt(timeRecords);if(n=n+" : "+JSON.stringify(r.timeOnlyData,null,2),n+=`\nPerformance Marks: ${JSON.stringify(s,null,2)}`,n+=`\nPerformance Measures: ${JSON.stringify(i,null,2)}`,n=(n=(n=null==Ke?n+" : accessibleCanddaites: "+Ke:n+" : accessibleCanddaites.length: "+Ke.length)+" : reTryAttemptForWebrtcReconnection: "+ut)+" ->  ShouldAutoPlay: "+wn,null==bt.reloadOnSuccessfulStreaming||0==bt.reloadOnSuccessfulStreaming||1==bt.reloadOnSuccessfulStreaming&&setTimeout((function(){ht(),Dt("reloadOnSuccessfulStreaming: "+bt.reloadOnSuccessfulStreaming,{color:"Red"}),setTimeout((function(){appWindow22=window.open(_e,"_blank"),setTimeout((function(){mt()}),2e3)}),2e3)}),3e3),In&&In.send(JSON.stringify({type:"DoFBEntreyofThisJsonObj",jsonObj:{video_start_time_taken_seconds:t}})),n=(n=(n=n+" ->  "+Ze())+" : ----\x3eiceConnectionStateChanges : "+JSON.stringify(be,null,2))+" : ----\x3eturnServerInfo : "+JSON.stringify(Ce,null,2),1==Ee&&(n=n+" : ********** is Ice Restart : "+Ee),Te>0&&(n=n+" : ----\x3ecountIceRestart : "+Te),n=(n=n+" : ----\x3euserAgent : "+navigator.userAgent)+" : ----\x3ewindow.TelegramWebviewProxy : "+window.TelegramWebviewProxy,null==bt.reloadOnSuccessfulStreaming||0==bt.reloadOnSuccessfulStreaming){Ye(n,-4025536547);var o="video stream took:"+t+" sec.  Url: "+window.location.href;o+=`\nPerformance Marks: ${JSON.stringify(s,null,2)}`,Ye(o+=`\nPerformance Measures: ${JSON.stringify(i,null,2)}`,-4613384301)}}else if(e/1e3>300){var s="";if(0==wn&&1==qe)s="/assets/pages/youDidNotPressPlayBtn.htm";else if(null==Ke||Ke.length<=0)if(lt)if(1==lt.successfulStream){var i="Turn server blocked for ip:  "+Qe;console.log(i),nt(i-4164863420),s="/assets/pages/TurnServerBlocked.htm",nt(i+" .Video Stream failed to start after "+e/1e3+"seconds",-0xe9647f745c)}else 0==lt.successfulStream&&(0==lt.ue4ExeInfo.PsPluginPixelStreamingDireExist&&0==lt.ue4ExeInfo.PsPluginEntryInManifestFile?s="/assets/pages/PsPluginNotEnabled.htm":(s="/assets/pages/streamTestFailedToPass.htm",nt("streamTestFailedToPass:  .Video Stream failed to start after "+e/1e3+"seconds",-0xe9647f745c)));else i="PS plugin not enabled or Turn server blocked for "+Qe,console.log(i),nt(i,-4164863420),s="/assets/pages/TurnServerBlockedOrPsPluginNotEnabled.htm",nt(i+" .Video Stream failed to start after "+e/1e3+"seconds",-0xe9647f745c);else console.log("XXXX accessible Turn server accessibleCanddaites: "+Ke.length),s="/assets/pages/VideoStreamFailedToStart.htm",nt("Video Stream failed to start after "+e/1e3+"seconds",-0xe9647f745c);clearInterval(rt),setTimeout((function(){window.location=s}),2e3)}else e/1e3>ot&&(0==wn&&1==qe?e3ds_alert("Stream is ready. Please press the play button to start ",{color:"Blue"}):nt("no video. time passed:"+e/1e3+" sec.  Url: "+window.location.href+"  : clientInfo:"+JSON.stringify(dn),-4236326834),ot+=30)}),300)):setTimeout((function(){pt()}),1e3)}"undefined"!=typeof e3ds_controller&&(e3ds_controller.terminate=function(){ht()});var ft=void 0,vt=void 0;let yt=null;var St=50;let Ct,wt,bt,Et,Tt=!1,kt=!1;var xt="connector.eagle3dstreaming.com",Pt=void 0,It=void 0;let Rt,Mt,Lt,Bt,At,Ot,_t;function Ft(e,t){try{e.muted=t}catch(e){console.log("Error: "+e.message),nt("muteElement()",-937307130),nt(e.message,-937307130),nt(console.trace(),-937307130)}}function Dt(e,t){0!=sn("enableRuntimeNotifications")&&e3ds_alert&&e3ds_alert(e,t)}function Ut(e,t,n=1e3){null!=t?1===t.readyState?t.send(e):setTimeout((function(){Ut(e,t,n)}),1e3):console.error("ahsanWsSend--\x3ews2WorkWIth undefined  ")}var Nt=new Array,Gt=!1,Ht=!0,zt=!0,Wt=void 0,Vt=void 0,qt=void 0;let $t={1e3:"Normal Closure",1001:"Going Away",1002:"Protocol Error",1003:"Unsupported Data",1004:"(For future)",1005:"No Status Received",1006:"Abnormal Closure",1007:"Invalid frame payload data",1008:"Policy Violation",1009:"Message too big",1010:"Missing Extension",1011:"Internal Error",1012:"Service Restart",1013:"Try Again Later",1014:"Bad Gateway",1015:"TLS Handshake"};function jt(e){De=e}function Jt(e){0==e?(console=console||{},console.log=function(){},console.warn=function(){}):1==e&&(console=xe,console.log=Pe,console.warn=Ie)}var Qt="assets/images/UE4_Logo.png",Kt="assets/images/background.jpg";Kt=void 0;var Xt=void 0,Yt=void 0,Zt=void 0,en=void 0,tn=!1,nn=0,on=void 0;function sn(e){if(null!=bt){var t=bt[e];if(""==t||"undefined"==t||null==t)return;return t}return pe.get(e)}var rn=0,an=!1,ln=1,cn="cursor:default",dn=void 0,un="assets/images/background.jpg";un=void 0;var hn=!0,mn="",gn=!1,pn=!1,fn=void 0,vn=!1,yn=document.createElement("Audio"),Sn=void 0,Cn=!1,wn=1,bn=0,En=0,Tn=9e5,kn=0;function xn(){if(1==ln){console.log(" 1111111111111 showbrowserMouse === 1 > "),console.log(" 1111111111111 extractValueFromUrl(showbrowserMouse):"+sn("showbrowserMouse"));var e=sn("mouseCursorPointerStyle");""!=e&&null!=e&&(cn=e),mn=""==mn||mn.includes("cursor:")?cn:mn+" "+cn}else mn="cursor:none";console.log(" 1111111111111 styleAdditional > "+mn),N()}let Pn;var In,Rn=null,Mn=!1,Ln=!1;const Bn=1;var An,On,_n,Fn,Dn,Un,Nn,Gn,Hn=void 0,zn=new Map,Wn=null,Vn=!0;pn=!1,gn=!1,window.isAppPreparationprocessGoingOn=!1;let qn=0;var $n=void 0,jn=void 0,Jn=void 0;function Qn(){return!(window.location===window.parent.location||window.self===window.top)}function Kn(){if(void 0===At&&(At=window.location.search),void 0===pe&&(pe=new URLSearchParams(window.location.search)),"undefined"!=typeof e3ds_controller&&null==bt)if(Rt=.01,null!=e3ds_controller.core){null!=e3ds_controller.core.domain?xt=e3ds_controller.core.domain:console.warn("e3ds_controller.core.domain absent so setting to default one: "+xt),null!=e3ds_controller.core.userName?jt(e3ds_controller.core.userName):console.error("e3ds_controller.core.userName missing"),null!=e3ds_controller.core.appName?Pt=e3ds_controller.core.appName:console.error("e3ds_controller.core.appName missing"),null!=e3ds_controller.core.configurationName?It=e3ds_controller.core.configurationName:console.error("e3ds_controller.core.configurationName missing"),null==De&&console.error("userName missing"),null==Pt&&console.error("app missing"),null==It&&console.error("configurationName missing");var e="/v5/"+De+"/"+Pt+"/"+It;Bt=e,_e="https://"+xt+e,_e+=At,console.log("href_emulated: "+_e)}else console.error("e3ds_controller.core is missing ");for(var[t,n]of pe.entries()){console.log(t,n);var o=pe.get("app"),s=pe.get("owner"),i=pe.get("configuration");null!=o&&(Pt=o),null!=s&&jt(s),null!=i&&(It=i)}Bt=new URL(_e).pathname,Mt=Bt.split("/"),Lt=Mt[1],Ot=window.location.hostname.split("."),_t=Ot[1]+"."+Ot[2];for(const[e,t]of pe)"args"!==e&&"launcher"!==e||pe.set("exeLunchArgs",t),console.log(e,t);if("v5"==Lt)if("spectator"==Mt[2])tn=!0,nn=2,ce({domain:"ms6.eaglepixelstreaming.com",httpsPort:8084});else{jt(Mt[2]),Zt=Mt[3],en=Mt[4];var r=pe.get("appVersion");r&&(ct=r);for(const[e,t]of pe){if("hostMeetingId"==e){Xt=t,t&&(window.isHost=!0);break}if("GuestMeetingId"==e){Yt=t,en=Mt[3],Zt=void 0;break}}}else if("v4"==Lt)if(null==Mt[2])console.log("wrong url. missing parts of it");else{var a=Mt[2];console.log("/:configurationStr:"+a);var l=atob(a);console.log("/:configuration decryptedString:"+l);try{bt=JSON.parse(l),bt.systemVersion=4,jt(bt.owner),Zt=bt.appName}catch(e){console.log("wrong url"),e instanceof SyntaxError?(console.error(e.name),console.log(e)):(console.error(e.message),console.log(e))}}else if("v6"==Lt)if(null==Mt[2])console.log("wrong url. missing parts of it");else{var c=Mt[2];1==Oe&&console.log("/:jsonStr:"+c),l=atob(c),1==Oe&&console.log("/:configuration decryptedString:"+l);try{decryptedJson=JSON.parse(l),bt.systemVersion=6,jt(decryptedJson.owner),Zt=decryptedJson.appName,null==decryptedJson.configName?null==decryptedJson.ConfigName?(console.warn("ConfigName: "+decryptedJson.ConfigName),Dt("Invlaid encryted Url ",{color:"Red"})):null!=decryptedJson.ConfigName&&(en=decryptedJson.ConfigName):en=decryptedJson.configName}catch(e){console.log("wrong url"),e instanceof SyntaxError?(console.error(e.name),console.log(e)):(console.error(e.message),console.log(e))}}else console.log("Invalid url");var d=document.getElementById("resoulbar");d&&(d.style.transform="scaleX(-1)"),ft=document.getElementById("streamingVideo"),"v5"!=Lt&&"v4"!=Lt&&"v6"!=Lt||tn||Xs(),Gs()}var Xn=void 0,Yn=!1;function Zn(e=0,t,n){if(console.log("e3ds_session_token: "+t),console.log("clientUserName: "+n),null==t||""==t)return void console.info("invalid e3ds_session_token: "+t);if(null==n||""==n)return void console.info("invalid clientUserName");var o="https://token.eaglepixelstreaming.com/api/v1/token/verify?token="+t+"&client="+n;const s=new XMLHttpRequest;s.onreadystatechange=function(){if(422===s.status)return console.log("GetTokenInfo() received 422 status code. Returning default clientInfo object."),void ni();if(429===s.status)return console.log("GetTokenInfo() received 429 status code. Retrying after 2000ms."),null!=Xn&&clearTimeout(Xn),void(Xn=setTimeout(Zn,2e3,e));if(""!==s.responseText&&void 0!==s.responseText){if(Yn)return;Yn=!0,console.log("GetTokenInfo() request successful. Clearing retry timer."),clearTimeout(Xn),console.log("GetTokenInfo() xmlHttp.responseText: "+s.responseText);var t=void 0;if(200===s.status){try{t=JSON.parse(s.responseText)}catch(e){console.info(" e3ds_session_token verification parse failed"),console.info(e)}console.log("GetTokenInfo() decryptedJsone_3ds_controller1: "+JSON.stringify(t,null,"\t")),e3ds_controller.core=t.core,e3ds_controller.configurationToOverride=t.configurationToOverride,Kn()}else if(401===s.status){try{t=JSON.parse(s.responseText)}catch(e){console.info(" e3ds_session_token verification parse failed"),console.info(e)}if(t.error)return console.warn("GetTokenInfo() error: "+t.error),void console.info(t.error)}}else e<20?(console.log("GetTokenInfo() retrying after 2000ms."),null!=Xn&&clearTimeout(Xn),Xn=setTimeout(Zn,2e3,e+1)):(console.log("GetTokenInfo() maximum retries exceeded."),ni())},s.open("GET",o,!0),s.send(null)}"undefined"!=typeof e3ds_controller&&(e3ds_controller.main=function(e,t){if(null!=window.appconfigPassed2Ejs){if("string"==typeof window.appconfigPassed2Ejs)return void alert(window.appconfigPassed2Ejs);bt=window.appconfigPassed2Ejs,Ne=window.uInfo,_e=window.location.href,Kn()}else Zn(0,e,t)});var eo=void 0,to=void 0,no=[],oo=void 0;function so(){const e=document.getElementById("editor-sidebar");document.getElementById("imageContainer").style.display="none",document.getElementById("videoContainer").style.display="none",e.style.width="0"}function io(){var e={assetId:document.getElementById("idsInSlot")?.value,slotId:document.getElementById("GameDataSlots")?.value};"video"===document.getElementById("assetType")?.value?(e.assetType="video",e.value=document.getElementById("videoAssets")?.value):"image"===document.getElementById("assetType")?.value&&(e.assetType="image",e.value=document.getElementById("imageAssets")?.value),b({cmd:"editorUpdate",value:e})}function ro(){var e={};"video"===document.getElementById("assetType")?.value?(e.assetType="video",e.value=document.getElementById("videoAssets")?.value):"image"===document.getElementById("assetType")?.value&&(e.assetType="image",e.value=document.getElementById("imageAssets")?.value);var t=document.getElementById("idsInSlot")?.value,n={};n[t]=e;let o={type:"saveEditorUpdate",slotId:document.getElementById("GameDataSlots")?.value,data:n};console.log("save editor update: ",JSON.stringify(o)),In.send(JSON.stringify(o))}var ao=void 0;function lo(){return/Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function co(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)}function g(e){Qn()&&window.top.postMessage(e,"*")}var uo=!1,ho=void 0,mo=void 0;let go,po=[],fo=[];function vo(e){null!=Rn?(addToTimeRecords("receivedOfferAt",getCurrentDate()),console.log("AHSAN. receiveOffer() recoived an unhandled offer :",e),e.sfu&&(this.sfu=!0,delete e.sfu),Rn.pcClient||(console.log("Creating a new PeerConnection in the browser."),Rn.pcClient=new RTCPeerConnection(Rn.cfg),setupPeerConnection(Rn.pcClient),Rn.dcClient=createDataChannel(Rn.pcClient,"cirrus",Rn.dataChannelOptions)),Rn.pcClient.setRemoteDescription(e).then((()=>{setupTransceiversAsync(Rn.pcClient).finally((function(){Rn.pcClient.createAnswer().then((e=>(mungeSDP(e),Rn.pcClient.setLocalDescription(e)))).then((()=>{if(In&&In.readyState===Bn){let e=JSON.stringify(Rn.pcClient.currentLocalDescription);console.log("->arvind SS: SendAnswer"),In.send(e)}})).then((()=>{let e=Rn.pcClient.getReceivers();for(let t of e)t.playoutDelayHint=0})).catch((e=>console.error("createAnswer() failed:",e)))}))}))):setTimeout((function(){vo(e)}),1e3)}function yo(){addToTimeRecords("audioElemPlayCalledAt",getCurrentDate()),yn.play().then((()=>{addToTimeRecords("audioElemPlayCallSuccededAt",getCurrentDate()),yn.ahsanHack="success",yn.muted=!1,Ft(streamingVideo,!1),console.log("audioElem2.muted: "+yn.muted)})).catch((e=>{yn.ahsanHack="failed",console.warn("Autoplay  audio was prevented.waiting  for first interaction call "),console.log("handleOnAudioTrack() Error.message : "+e.message),console.log("handleOnAudioTrack() error.name : ",e.name),console.log("handleOnAudioTrack() error.stack : ",e.stack)}))}let So=1/0,Co=0,wo=0,bo=0,Eo=0;function To(e,t){if("RoundTripTime"===e)return t<So&&(So=t),t>wo&&(wo=t),bo+=t,Eo++,Co=bo/Eo,{minRoundTripTime:So.toFixed(3),maxRoundTripTime:wo.toFixed(3),avgRoundTripTime:Co.toFixed(3)}}function ko(){if(null==Rn)return;let e=3e5,t=e;Rn.onAggregatedStats=n=>{go={...go,...n},go={...go,...To("RoundTripTime",n.currentRoundTripTime)};let o=new Intl.NumberFormat(window.navigator.language,{maximumFractionDigits:0}),s=new Intl.NumberFormat(window.navigator.language,{maximumFractionDigits:0,minimumIntegerDigits:2}),i=(n.timestamp-n.timestampStart)/1e3,r=[],a=[60,60];for(let e=0;e<a.length;e++)r.push(i%a[e]),i/=a[e];r.push(i);let l=r[0],c=Math.floor(r[1]),d=Math.floor([r[2]]),u="B",h=n.hasOwnProperty("bytesReceived")?n.bytesReceived:0,m=["kB","MB","GB"];for(let e=0;e<m.length&&!(h<1e5);e++)h/=1e3,u=m[e];let g="kB",p=n.hasOwnProperty("audiobytesReceived")?n.audiobytesReceived:0,f=["MB","GB"];p/=1e3;for(let e=0;e<f.length&&!(p<1e5);e++)p/=1e3,g=f[e];var v="B",y=n.hasOwnProperty("databytesReceived")?n.databytesReceived:0;let S=["kB","MB","GB"];for(let e=0;e<S.length&&!(y<1e5);e++)y/=1e3,v=S[e];var C="B",w=n.hasOwnProperty("databytesSent")?n.databytesSent:0;let b=["kB","MB","GB"];for(let e=0;e<b.length&&!(w<1e5);e++)w/=1e3,C=b[e];let E=document.getElementById("qualityStatus"),T=document.getElementById("networkQualityStatus"),k=function(e){let t=e,n=1,o=setInterval((function(){n-=.1,E&&(E.style=`opacity: ${Math.abs(2*(n-.5))}`),T&&(T.style=`opacity: ${Math.abs(2*(n-.5))}`),n<=.1&&(0==--t?clearInterval(o):n=1)}),100/e)},x="",P="lime";F>35?(P="red",k(2),x+=`<div style="color: ${P}">Bad network connection</div>`):F>26&&(P="orange",k(1),x+=`<div style="color: ${P}">Spotty network connection</div>`,console.log("Spotty network connection")),E&&(E.className=`${P}Status`),T&&(T.className=`${P}Status`),x+=`<div>Duration: ${s.format(d)}:${s.format(c)}:${s.format(l)}</div>`,x+=`<div>Video Resolution: ${n.hasOwnProperty("frameWidth")&&n.frameWidth&&n.hasOwnProperty("frameHeight")&&n.frameHeight?n.frameWidth+"x"+n.frameHeight:"N/A"}</div>`,x+=`<div>Received (${u}): ${o.format(h)}</div>`,x+=`<div>Video_arvi Received (${u}): ${o.format(h)}</div>`,x+=`<div>Audio Received (${g}): ${o.format(p)}</div>`,x+=`<div>Data Received (${v}): ${o.format(y)}</div>`,x+=`<div>Data Sent (${C}): ${o.format(w)}</div>`,x+=`<div>Frames Decoded: ${n.hasOwnProperty("framesDecoded")?o.format(n.framesDecoded):"N/A"}</div>`,x+=`<div>Packets Lost: ${n.hasOwnProperty("packetsLost")?o.format(n.packetsLost):"N/A"}</div>`,x+=`<div style="color: ${P}">Bitrate (kbps): ${n.hasOwnProperty("bitrate")?o.format(n.bitrate):"N/A"}</div>`,x+=`<div>Framerate: ${n.hasOwnProperty("framerate")?o.format(n.framerate):"N/A"}</div>`,x+=`<div>Frames dropped: ${n.hasOwnProperty("framesDropped")?o.format(n.framesDropped):"N/A"}</div>`,x+=`<div>Latency (ms): ${n.hasOwnProperty("currentRoundTripTime")?o.format(1e3*n.currentRoundTripTime):"N/A"}</div>`,x+=`<div style="color: ${P}">Video Quantization Parameter: ${F}</div>`;let I=document.getElementById("stats");I&&(I.innerHTML=x);let R="";void 0!==As&&As.systemInfo&&As.systemInfo.graphics&&(As.systemInfo.cpu&&(cpu=As.systemInfo.cpu,R+=`<div id="cpu-stats" style="color: lime">CPU: ${cpu.manufacturer} ${cpu.brand??"Unknown"}</div>`),As.systemInfo.graphics.controllers&&As.systemInfo.graphics.controllers.length>0&&(gpu=As.systemInfo.graphics.controllers[0],R+=`<div id="gpu-stats" style="color: lime">GPU: ${gpu.model??"Unknown"}</div>`),As.systemInfo.memory&&(memory=As.systemInfo.memory,R+=`<div id="total-memory-stats" style="color: lime">Total Memory: ${Ks(memory.total??0)} GB</div>`)),R+=x;let M=document.getElementById("statsInfoExtra");M&&(M.innerHTML=R),Mn&&(console.log(`-> SS: stats\n${JSON.stringify(n)}`),console.log("-> SS: stats"),n.timestampStart&&n.timestamp-n.timestampStart>t&&(In&&In.readyState===Bn&&(console.log("-> SS: stats"),In.send(JSON.stringify({type:"stats",data:n}))),t+=e))},Rn.aggregateStats(1e3),Rn.latencyTestTimings.OnAllLatencyTimingsReady=function(e){if(!e.BrowserReceiptTimeMs)return;let t=e.BrowserReceiptTimeMs-e.TestStartTimeMs,n=0==e.UEPreEncodeTimeMs||0==e.UEPreCaptureTimeMs?"???":e.UEPostEncodeTimeMs-e.UEPreCaptureTimeMs,o=e.UEPostCaptureTimeMs-e.UEPreCaptureTimeMs,s=e.UEPostEncodeTimeMs-e.UEPreEncodeTimeMs,i=e.UETransmissionTimeMs-e.UEReceiptTimeMs,r=t-i,a=t-r-i,l=null,c=null;console.log("timings.FrameDisplayDeltaTimeMs: "+e.FrameDisplayDeltaTimeMs),console.log("timings.BrowserReceiptTimeMs: "+e.BrowserReceiptTimeMs),e.FrameDisplayDeltaTimeMs&&e.BrowserReceiptTimeMs&&(l=e.FrameDisplayDeltaTimeMs+t,c=l-r-i),console.log("endToEndLatency: "+l),console.log("browserSideLatency: "+c);let d="";d+=`<div>Net latency RTT (ms): ${r}</div>`,d+=`<div>UE Capture+Encode (ms): ${n}</div>`,d+=`<div>UE Capture (ms): ${o}</div>`,d+=`<div>UE Encode (ms): ${s}</div>`,d+=`<div>Total UE latency (ms): ${i}</div>`,d+=`<div>Browser send latency (ms): ${a}</div>`,d+=e.FrameDisplayDeltaTimeMs&&e.BrowserReceiptTimeMs?`<div>Browser receive latency (ms): ${e.FrameDisplayDeltaTimeMs}</div>`:"",d+=c?`<div>Total browser latency (ms): ${c}</div>`:"",d+=`<div>Total latency (excluding browser) (ms): ${t}</div>`,d+=l?`<div>Total latency (ms): ${l}</div>`:"",console.log(d),document.getElementById("LatencyStats").innerHTML=d}}function xo(){let e=btoa(W.jpeg.reduce(((e,t)=>e+String.fromCharCode(t)),""));Wn.src="data:image/jpeg;base64,"+e,Wn.onload=function(){W.height=Wn.naturalHeight,W.width=Wn.naturalWidth,q(),Vn?(us(),N()):V()}}var Po=[];function Io(e){addToTimeRecords("webRtcPlayerConstructorCalledAt",getCurrentDate()),e=e||{};var t=this;1==bt.forceNoTurnServer&&(e.peerConnectionOptions=void 0),e.peerConnectionOptions?this.cfg=e.peerConnectionOptions:this.cfg={},this.cfg.sdpSemantics="unified-plan",this.cfg.offerExtmapAllowMixed=!1,this.pcClient=null,this.dcClient=null,this.tnClient=null,this.sdpConstraints={offerToReceiveAudio:1,offerToReceiveVideo:1},this.dataChannelOptions={ordered:!0},this.latencyTestTimings={TestStartTimeMs:null,UEReceiptTimeMs:null,UEPreCaptureTimeMs:null,UEPostCaptureTimeMs:null,UEPreEncodeTimeMs:null,UEPostEncodeTimeMs:null,UETransmissionTimeMs:null,BrowserReceiptTimeMs:null,FrameDisplayDeltaTimeMs:null,Reset:function(){this.TestStartTimeMs=null,this.UEReceiptTimeMs=null,this.UEPreCaptureTimeMs=null,this.UEPostCaptureTimeMs=null,this.UEPreEncodeTimeMs=null,this.UEPostEncodeTimeMs=null,this.UETransmissionTimeMs=null,this.BrowserReceiptTimeMs=null,this.FrameDisplayDeltaTimeMs=null},SetUETimings:function(e){this.UEReceiptTimeMs=e.ReceiptTimeMs,this.UEPreCaptureTimeMs=e.PreCaptureTimeMs,this.UEPostCaptureTimeMs=e.PostCaptureTimeMs,this.UEPreEncodeTimeMs=e.PreEncodeTimeMs,this.UEPostEncodeTimeMs=e.PostEncodeTimeMs,this.UETransmissionTimeMs=e.TransmissionTimeMs,this.BrowserReceiptTimeMs=Date.now(),this.OnAllLatencyTimingsReady(this)},SetFrameDisplayDeltaTime:function(e){null==this.FrameDisplayDeltaTimeMs&&(this.FrameDisplayDeltaTimeMs=Math.round(e),this.OnAllLatencyTimingsReady(this))},OnAllLatencyTimingsReady:function(e){}},createWebRtcVideo=function(){var e=ft;if(setInterval((function(){e.readyState}),1e3),1==wn&&(Nt.length>0||(e.autoplay=!0,Ft(e,!0)),e.disablepictureinpicture=!0,l()),e.addEventListener("loadstart",(function(){addToTimeRecords("videoLoadStartEventCalledAt",getCurrentDate())})),e.addEventListener("durationchange",(function(e){}),!0),e.addEventListener("loadeddata",(function(e){addToTimeRecords("videoLoadeddataEventCalledAt",getCurrentDate()),console.log("loadeddata video() e.target.duration:",e.target.duration)}),!0),e.addEventListener("seeking",(e=>{console.log("Video is seeking a new position.")})),e.addEventListener("seeked",(e=>{console.log("Video found the playback position it was looking for.")})),e.addEventListener("playing",(e=>{if(addToTimeRecords("videoPlayingEventCalledAt",getCurrentDate()),console.log("Video is no longer paused"),st=!0,Mo(),null!=Re&&nt("video streame started with isCceConnectionState: "+Re,-4511332363),document.getElementById("e3ds_alert_container")&&(document.getElementById("e3ds_alert_container").innerHTML="",window.e3ds_alert_contents=[]),clearTimeout(dt),bt&&1==bt.injectStreamFromEditor){var t=document.getElementById("popupForinjectStreamFromEditorInfo");t&&(t.style.display="none")}})),e.addEventListener("waiting",(e=>{console.log("Video is waiting for more data.")})),e.addEventListener("ended",(e=>{console.log("Video stopped either because 1) it was over, or 2) no further data is available.")})),e.addEventListener("volumechange",(e=>{console.log("The volume changed.")})),e.addEventListener("emptied",(e=>{console.log("Uh oh. The media is empty. Did you call load()?")})),e.addEventListener("stalled",(e=>{console.log("Failed to fetch data, but trying.")})),e.addEventListener("progress",(function(e){}),!0),e.addEventListener("canplay",(function(e){}),!0),e.addEventListener("canplaythrough",(function(e){}),!0),e.addEventListener("loadedmetadata",(function(e){addToTimeRecords("videoLoadedMetaDataEventCalledAt",getCurrentDate()),console.log("loadedmetadata video():",new Date);var t=new Date-ho;Math.round(t/6e4),console.log("Time cost :",t/6e4),clearInterval(mo),In&&In.readyState===Bn&&(console.log("----------------- webRtcPlayerObj.onVideoInitialised()--\x3eWS_OPEN_STATE"),1==sn("isE3DSEngineApp")&&function(){if(1!=sn("isE3DSEngineApp"))return console.warn("Engine version below 4.26. so skipping settingsButton VideoEncoderQP -> : "+F),void Dt("Require Atleast E3DS-UE4-Engine 4.26 "+(Math.random()*(.12-.02)+.02).toFixed(4),{timeout:2e3,color:"blue"});var e=JSON.stringify({type:"settings",data:{quality:sn("quality"),minBitrate:sn("minBitrate"),maxBitrate:sn("maxBitrate"),resolution:sn("resolution"),rateCtrl:sn("rateCtrl")}});0==sn("qualityLevel")?e.minBitrate=0:1==sn("qualityLevel")&&(e.minBitrate=2e7),console.log("applyInitialeStreamSettings--\x3e "+e),In.send(e)}(),Vn&&(us(),N()))}),!0),"requestVideoFrameCallback"in HTMLVideoElement.prototype){const n=(o,s)=>{if(s.receiveTime&&s.expectedDisplayTime){const e=s.presentationTime-s.receiveTime;t.aggregatedStats||(t.aggregatedStats={}),t.aggregatedStats.receiveToCompositeMs=e}e.requestVideoFrameCallback(n)};e.requestVideoFrameCallback(n)}return e},this.video=createWebRtcVideo(),onsignalingstatechange=function(e){console.log("signaling state change:",e)},oniceconnectionstatechange=function(e){console.log("XXXXXXX-> ice connection state change.evt.target.iceConnectionState:",e.target.iceConnectionState,"  -> ",new Date),console.log("webRtcPlayerObj.pcClient.iceConnectionState:",Rn.pcClient.iceConnectionState,"  -> ",new Date);let t={state:e.target.iceConnectionState,timestamp:new Date};switch(be.push(t),Je=e.target.iceConnectionState,e.target.iceConnectionState){case"new":console.log("ICE connection state: New connection.");break;case"checking":console.log("ICE connection state: Checking connectivity.");break;case"connected":case"completed":console.log("ICE connection state: Connection established.");break;case"disconnected":console.log("ICE connection state: Disconnected from the remote peer."),console.log(" XXXXXXX-> restartICEWithoutTurn"),Rn.pcClient&&(console.log("Closing existing PeerConnection"),Rn.pcClient.close(),Rn.pcClient=null),Ee=!0,Rn?(console.log("Creating offer"),Te+=1,console.log("countIceRestart:"+Te),Rn.createOffer()):console.log("WebRTC player not setup, cannot create offer");break;case"failed":console.log("ICE connection state: Connection failed."),Re=0,nt(e.target.iceConnectionState,-4244805422);break;case"closed":console.log("ICE connection state: Connection closed.");break;default:console.log("Unknown ICE connection state.")}if("disconnected"==e.target.iceConnectionState)console.warn("ice server diconnected");else if("connected"==e.target.iceConnectionState){addToTimeRecords("iceConnectedAt",getCurrentDate());var n=new Date-vt,o="iceConnectionState connected at : "+Math.round(n/6e4);console.log(o),o>10&&nt(o,-984137241),mo=setInterval((function(){console.log("High load.Might take upto 3 min. dont close tab ")}),15e3)}"failed"===Rn.pcClient.iceConnectionState&&(Re=1,nt(Rn.pcClient.iceConnectionState+" --\x3e failed",-4244805422))},onicegatheringstatechange=function(e){console.log("ice gathering state change:",e),se(5),"complete"===Rn.pcClient.iceGatheringState&&(null==Ke&&(Ke=[]),Xe.length>0&&Xe.forEach((e=>{if(console.log(Qe,e.address),Qe===e.address)return console.log("stun/turn server accessible from "+Qe),void Ke.push(e)})))},handleTrackRemoved=function(e){console.log("A remote track has been removed"),"video"===e.track.kind&&(addToTimeRecords("handleTrackRemovedVideoCalledAt",getCurrentDate()),console.log(" video stream has stopped."))},handleOnTrack=function(e){if(console.log("handleOnTrack",e.streams),e.track&&console.log("Got track - "+e.track.kind+" id="+e.track.id+" readyState="+e.track.readyState),"audio"==e.track.kind)return addToTimeRecords("handleOnTrackAudioCalledAt",getCurrentDate()),void(Wt=e.streams[0]);if("video"==e.track.kind&&(t.video.srcObject,e.streams[0]),addToTimeRecords("handleOnTrackVideoCalledAt",getCurrentDate()),null!=yt&&yt!==e.track&&console.log("Video track has changed"),yt=e.track,yt.onended=function(){addToTimeRecords("currentVideoTrackEndedAt",getCurrentDate()),console.log("XXXXXXXXXXXX Video has stopped.")},se(5),Nt.length>0){let n=document.getElementById("skip_video");console.log(wn),parseInt(wn)?t.video.srcObject=e.streams[0]:parseInt(wn)||(document.getElementById("skip_video").style.display="block",null!==n&&(n.onclick=function(n){document.getElementById("skip_video").style.display="none",t.video.srcObject=e.streams[0]})),null!=sn("LoadingScreenSkipButtonText")&&""!=sn("LoadingScreenSkipButtonText")&&(document.getElementById("skip_video").innerHTML=sn("LoadingScreenSkipButtonText"))}else t.video.srcObject=e.streams[0];return console.log("Set video source from video track ontrack."),In&&In.send(JSON.stringify({type:"DoFBEntreyofVideoStreamStartedAt",loggedInUserData:Ge})),Ct&&clearInterval(Ct),void(Ct=setInterval((function(){Mo(),console.log("latest aggregated stats: ",go),In&&In.send(JSON.stringify({type:"updateFBEntryofVideoStreamContinueHeartBeat",loadTime:we,ue4ExeInfo:qt,acquiringPhase:ge,webRtcStatsData:go,turnServerInfo:Ce,timeRecords,candidates_selected:Le,isIceRestart:Ee,countIceRestart:Te,iceConnectionStateChanges:be}))}),3e4))},this.handleOnAudioTrack=function(e){addToTimeRecords("handleOnAudioTrackCalledAt",getCurrentDate()),console.log("handleOnAudioTrack()111:",new Date),t.video.srcObject!=e&&t.video.srcObject&&t.video.srcObject!==e&&(yn.autoplay=!0,yn.srcObject=e,Sn=e,yn.addEventListener("loadedmetadata",(function(e){}),!0),yn.addEventListener("loadstart",(function(){})),yn.addEventListener("durationchange",(function(e){}),!0),yn.addEventListener("loadeddata",(function(e){}),!0),yn.addEventListener("progress",(function(e){}),!0),yn.addEventListener("canplay",(function(e){}),!0),yn.addEventListener("canplaythrough",(function(e){}),!0),yo())},createDataChannel=function(e,t,n){addToTimeRecords("createDataChannelCalledAt",getCurrentDate());let o=e.createDataChannel(t,n);return console.log(`Created datachannel (${t})`),setupDataChannelCallbacks(o),o},setupDataChannelCallbacks=function(e){try{return e.binaryType="arraybuffer",e.addEventListener("open",(t=>{addToTimeRecords("datachannelconnectedAt",getCurrentDate()),console.log(`Data channel connected: ${e.label}(${e.id})`),"function"==typeof onDataChannelOpen?onDataChannelOpen():console.log("not found onDataChannelOpen"),e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onDataChannelOpen&&e3ds_controller.callbacks.onDataChannelOpen(),In&&In.readyState===Bn&&(ls("WebRTC connected, waiting for video"),se(100),b("4K"),z(),(new Date).toUTCString(),In&&In.send(JSON.stringify({type:"DoFBEntreyofDataChannelConnectedAt",loggedInUserData:Ge})),wt&&clearInterval(wt),wt=setInterval((function(){In&&In.send(JSON.stringify({type:"updateFBEntryofDataChannelHeartBeat"}))}),3e4)),clearTimeout(Fn),function(){let e={};Gn&&(e.cmdLineArgs=Gn,console.log("33333333333333 sendDataToUE4App emitUIInteraction: "+JSON.stringify(e)),b(e))}(),null!=bt.consoleCmdsToPassToUnrealApp&&""!=bt.consoleCmdsToPassToUnrealApp&&bt.consoleCmdsToPassToUnrealApp.split(";").forEach((e=>{var t=e.trim();console.log("Executing command:"+t);var n={ConsoleCommand:t};1==Oe&&console.log(n),E(n),"function"==typeof window?.pixelStreaming?.emitCommand&&window.pixelStreaming.emitCommand(n)}))})),e.addEventListener("close",(t=>{addToTimeRecords("datachannelClosedAt",getCurrentDate()),console.log(`Data channel disconnected: ${e.label}(${e.id}`,t),wt&&clearInterval(wt),"function"==typeof onDataChannelClose?onDataChannelClose():console.log("not found onDataChannelClose"),e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onDataChannelClose?e3ds_controller.callbacks.onDataChannelClose():console.log("not found e3ds_controller.callbacks.onDataChannelClose")})),e.addEventListener("message",(e=>{!function(e){var t=new Uint8Array(e);let n=new TextDecoder("utf-16").decode(e.slice(1));var o,s,i,r=n,a=void 0;try{a=JSON.parse(r),onProtocolMessage(a)}catch(e){}if(W.receiving){let e=new Uint8Array(W.jpeg.length+t.length);e.set(W.jpeg,0),e.set(t,W.jpeg.length),W.jpeg=e,W.jpeg.length===W.size?(W.receiving=!1,W.valid=!0,console.log(`received complete freeze frame ${W.size}`),xo()):W.jpeg.length>W.size?(console.error(`received bigger freeze frame than advertised: ${W.jpeg.length}/${W.size}`),W.jpeg=void 0,W.receiving=!1):console.log(`received next chunk (${t.length} bytes) of freeze frame: ${W.jpeg.length}/${W.size}`)}else if(t[0]===L.fmp4){var l=e.slice(1);console.log("fmp4 size "+l.byteLength),putPacket(l)}else if(t[0]===L.QualityControlOwnership){let e=0!==t[1];null!=An&&null!=e&&(An.disabled=e,An.checked=e)}else if(t[0]===L.Response){if(tn)return;let t=new TextDecoder("utf-16").decode(e.slice(1));console.log("111111111 response: "+t);for(let e of zn.values())e(t)}else if(t[0]===L.Command){let t=new TextDecoder("utf-16").decode(e.slice(1));console.log("111111111 commandAsString: "+t);let n=JSON.parse(t);"onScreenKeyboard"===n.command&&1==n.showOnScreenKeyboard&&(o=n.contents,s=document.getElementById("popupForOnScreenKeyboard"),i=document.getElementById("UserInput"),s&&lo()&&(i&&(i.value=""),o&&(i.value=o),s.style.display="flex",s.idFromUnreal=obj.id))}else if(t[0]===L.FreezeFrame)W.size=new DataView(t.slice(1,5).buffer).getInt32(0,!0),W.jpeg=t.slice(5),W.jpeg.length<W.size?(console.log(`received first chunk of freeze frame: ${W.jpeg.length}/${W.size}`),W.receiving=!0):(console.log(`received complete freeze frame: ${W.jpeg.length}/${W.size}`),xo());else if(t[0]===L.UnfreezeFrame)Wn.style.display="none",W.valid=!1;else if(t[0]===L.VideoEncoderAvgQP)F=new TextDecoder("utf-16").decode(e.slice(1));else if(t[0]==L.LatencyTest){let t=new TextDecoder("utf-16").decode(e.slice(1));console.log("Got latency timings from UE."),console.log(t);let n=JSON.parse(t);console.log("LatencyTest from ue:"+JSON.stringify(n,null,"\t")),Rn&&Rn.latencyTestTimings.SetUETimings(n)}else if(t[0]==L.InitialSettings){let t=new TextDecoder("utf-16").decode(e.slice(1)),n=JSON.parse(t);console.log("InitialSettings from ue:"+JSON.stringify(n,null,"\t")),Et=n;var c=document.getElementById("resoulbar");c&&(c.value=Et.Encoder.MaxQP)}else console.warn(`processResponseData data: unrecognised data received, packet ID ${t[0]}`+JSON.stringify(t[0])),console.log(n),console.log(e),console.log(t),console.log(JSON.stringify(t)),console.log()}(e.data)})),e.addEventListener("error",(t=>{console.error(`Data channel error: ${e.label}(${e.id}`,t)})),e}catch(e){return console.warn("Datachannel setup caused an exception: ",e),null}},onicecandidate=function(e){console.log("----- onicecandidate() ICE candidate: ",e);var t=e;if(t.candidate){if(po.push(e.candidate),Xe.push(e.candidate),Po.push(e.candidate.candidate),t.candidate.candidate&&In&&In.readyState===Bn&&(console.log("-> SS: iceCandidate"),e.candidate)){console.log("candidate--\x3e: "+e.candidate.candidate),console.log(e.candidate);const n=e.candidate.url,o=e.candidate.address,s=e.candidate.port;if(console.log("ICE Candidate:",e.candidate),console.log("Candidate url:",n),console.log("Candidate Address:",o),console.log("Candidate Port:",s),n){if(n.includes("xirsys.com")){if(Te<=1)return void console.log("xirsys candidate discarded:",e.candidate);console.log("xirsys candidate allowing . bcz countIceRestart:"+Te,e.candidate)}n.includes("twilio.com")}In.send(JSON.stringify({type:"iceCandidate",candidate:t.candidate}))}console.warn("onicecandidate()---\x3e e.candidate.type",t.candidate.type),t.candidate.type,"srflx"==t.candidate.type&&(console.warn("The STUN server is reachable!"),console.log(`   Your Public IP Address is: ${t.candidate.address}`)),"relay"==t.candidate.type&&console.warn("The TURN server is reachable !")}else console.warn("onicecandidate()---\x3e ICE candidate undefined",new Date)},handleCreateOffer=function(e){t.sdpConstraints.iceRestart=Ee,e.createOffer(t.sdpConstraints).then((function(t){if(sn("audioType"),mungeSDP(t),console.log("------offer.sdp: "+t.sdp),console.warn("111 pc.setLocalDescription(offer)",new Date),e.setLocalDescription(t),console.warn("222 pc.setLocalDescription(offer)",new Date),console.log("------offer.sdp: "+t.sdp),In&&In.readyState===Bn){let e=JSON.stringify(t);console.log("-> SS: offer:"),In.send(e)}}),(function(){console.warn("Couldn't create offer")}))},mungeSDP=function(e){let t=e.sdp.replace(/(a=fmtp:\d+ .*level-asymmetry-allowed=.*)\r\n/gm,"$1;x-google-start-bitrate=10000;x-google-max-bitrate=100000\r\n"),n="maxaveragebitrate=510000;";uo&&(n+="sprop-maxcapturerate=48000;"),n+="stereo=1;",n+="useinbandfec=1",t=t.replace("useinbandfec=1",n),e.sdp=t},handleCreateAnswer111=function(e){e.createAnswer().then((function(t){e.setLocalDescription(t).then((function(){if(console.log("answer %o",t.sdp),In&&In.readyState===Bn){let e=JSON.stringify(t);console.log("->arvind SS: SendAnswer"),In.send(e)}}))}),(function(){console.warn("Couldn't create offer")}))},setupPeerConnection=function(e){e.SetBitrate&&console.log("Hurray! there's RTCPeerConnection.SetBitrate function"),e.onsignalingstatechange=onsignalingstatechange,e.oniceconnectionstatechange=oniceconnectionstatechange,e.onicegatheringstatechange=onicegatheringstatechange,e.ontrack=handleOnTrack,e.onremovetrack=handleTrackRemoved,e.onicecandidate=onicecandidate,e.onnegotiationneeded=function(){console.warn("Negotiation Needed")},e.onicecandidateerrorIsSendToTlegarm=!1,e.onicecandidateerror=function(t){console.warn("onicecandidateerror(): "+t.errorCode),t.errorCode>=300&&t.errorCode<=699||t.errorCode>=700&&t.errorCode<=799&&701==t.errorCode&&(console.warn("Error 701 indicates that none of the ICE candidates were able to successfully make contact with the STUN or TURN server. The 701 error is fired only once per server URL from the list of available STUN or TURN servers provided when creating the RTCPeerConnection "),e.onicecandidateerrorIsSendToTlegarm||(e.onicecandidateerrorIsSendToTlegarm=!0))}},generateAggregatedStatsFunction111=function(){return t.aggregatedStats||(t.aggregatedStats={}),function(e){let n={};e.forEach((e=>{"inbound-rtp"!=e.type||e.isRemote||"audio"!=e.mediaType&&!e.id.toLowerCase().includes("audio")?"data-channel"==e.mediaType||e.id.toLowerCase().includes("data")?(n.databytesReceived=e.bytesReceived,n.databytesSent=e.bytesSent):"inbound-rtp"!=e.type||e.isRemote||"video"!=e.mediaType&&!e.id.toLowerCase().includes("video")||(n.timestamp=e.timestamp,n.bytesReceived=e.bytesReceived,n.framesDecoded=e.framesDecoded,n.packetsLost=e.packetsLost,n.bytesReceivedStart=t.aggregatedStats&&t.aggregatedStats.bytesReceivedStart?t.aggregatedStats.bytesReceivedStart:e.bytesReceived,n.framesDecodedStart=t.aggregatedStats&&t.aggregatedStats.framesDecodedStart?t.aggregatedStats.framesDecodedStart:e.framesDecoded,n.timestampStart=t.aggregatedStats&&t.aggregatedStats.timestampStart?t.aggregatedStats.timestampStart:e.timestamp,t.aggregatedStats&&t.aggregatedStats.timestamp&&(t.aggregatedStats.bytesReceived&&(n.bitrate=8*(n.bytesReceived-t.aggregatedStats.bytesReceived)/(n.timestamp-t.aggregatedStats.timestamp),n.bitrate=Math.floor(n.bitrate),n.lowBitrate=t.aggregatedStats.lowBitrate&&t.aggregatedStats.lowBitrate<n.bitrate?t.aggregatedStats.lowBitrate:n.bitrate,n.highBitrate=t.aggregatedStats.highBitrate&&t.aggregatedStats.highBitrate>n.bitrate?t.aggregatedStats.highBitrate:n.bitrate),t.aggregatedStats.bytesReceivedStart&&(n.avgBitrate=8*(n.bytesReceived-t.aggregatedStats.bytesReceivedStart)/(n.timestamp-t.aggregatedStats.timestampStart),n.avgBitrate=Math.floor(n.avgBitrate)),t.aggregatedStats.framesDecoded&&(n.framerate=(n.framesDecoded-t.aggregatedStats.framesDecoded)/((n.timestamp-t.aggregatedStats.timestamp)/1e3),n.framerate=Math.floor(n.framerate),n.lowFramerate=t.aggregatedStats.lowFramerate&&t.aggregatedStats.lowFramerate<n.framerate?t.aggregatedStats.lowFramerate:n.framerate,n.highFramerate=t.aggregatedStats.highFramerate&&t.aggregatedStats.highFramerate>n.framerate?t.aggregatedStats.highFramerate:n.framerate),t.aggregatedStats.framesDecodedStart&&(n.avgframerate=(n.framesDecoded-t.aggregatedStats.framesDecodedStart)/((n.timestamp-t.aggregatedStats.timestampStart)/1e3),n.avgframerate=Math.floor(n.avgframerate)))):n.audiobytesReceived=e.bytesReceived,"track"!=e.type||"video_label"!=e.trackIdentifier&&"video"!=e.kind||(n.framesDropped=e.framesDropped,n.framesReceived=e.framesReceived,n.framesDroppedPercentage=e.framesDropped/e.framesReceived*100,n.frameHeight=e.frameHeight,n.frameWidth=e.frameWidth,n.frameHeightStart=t.aggregatedStats&&t.aggregatedStats.frameHeightStart?t.aggregatedStats.frameHeightStart:e.frameHeight,n.frameWidthStart=t.aggregatedStats&&t.aggregatedStats.frameWidthStart?t.aggregatedStats.frameWidthStart:e.frameWidth),"candidate-pair"==e.type&&e.hasOwnProperty("currentRoundTripTime")&&0!=e.currentRoundTripTime&&(n.currentRoundTripTime=e.currentRoundTripTime)})),n.bitrate,n.framerate,n.framesDropped,n.packetsLost,t.aggregatedStats=n,t.onAggregatedStats&&t.onAggregatedStats(n)}},generateAggregatedStatsFunction=function(){return t.aggregatedStats||(t.aggregatedStats={}),function(e){let n={};e.forEach((e=>{"inbound-rtp"!=e.type||e.isRemote||"video"!=e.mediaType&&!e.id.toLowerCase().includes("video")||(n.timestamp=e.timestamp,n.bytesReceived=e.bytesReceived,n.framesDecoded=e.framesDecoded,n.packetsLost=e.packetsLost,n.bytesReceivedStart=t.aggregatedStats&&t.aggregatedStats.bytesReceivedStart?t.aggregatedStats.bytesReceivedStart:e.bytesReceived,n.framesDecodedStart=t.aggregatedStats&&t.aggregatedStats.framesDecodedStart?t.aggregatedStats.framesDecodedStart:e.framesDecoded,n.timestampStart=t.aggregatedStats&&t.aggregatedStats.timestampStart?t.aggregatedStats.timestampStart:e.timestamp,t.aggregatedStats&&t.aggregatedStats.timestamp&&(t.aggregatedStats.bytesReceived&&(n.bitrate=8*(n.bytesReceived-t.aggregatedStats.bytesReceived)/(n.timestamp-t.aggregatedStats.timestamp),n.bitrate=Math.floor(n.bitrate),n.lowBitrate=t.aggregatedStats.lowBitrate&&t.aggregatedStats.lowBitrate<n.bitrate?t.aggregatedStats.lowBitrate:n.bitrate,n.highBitrate=t.aggregatedStats.highBitrate&&t.aggregatedStats.highBitrate>n.bitrate?t.aggregatedStats.highBitrate:n.bitrate),t.aggregatedStats.bytesReceivedStart&&(n.avgBitrate=8*(n.bytesReceived-t.aggregatedStats.bytesReceivedStart)/(n.timestamp-t.aggregatedStats.timestampStart),n.avgBitrate=Math.floor(n.avgBitrate)),t.aggregatedStats.framesDecoded&&(n.framerate=(n.framesDecoded-t.aggregatedStats.framesDecoded)/((n.timestamp-t.aggregatedStats.timestamp)/1e3),n.framerate=Math.floor(n.framerate),n.lowFramerate=t.aggregatedStats.lowFramerate&&t.aggregatedStats.lowFramerate<n.framerate?t.aggregatedStats.lowFramerate:n.framerate,n.highFramerate=t.aggregatedStats.highFramerate&&t.aggregatedStats.highFramerate>n.framerate?t.aggregatedStats.highFramerate:n.framerate),t.aggregatedStats.framesDecodedStart&&(n.avgframerate=(n.framesDecoded-t.aggregatedStats.framesDecodedStart)/((n.timestamp-t.aggregatedStats.timestampStart)/1e3),n.avgframerate=Math.floor(n.avgframerate)))),"track"!=e.type||"video_label"!=e.trackIdentifier&&"video"!=e.kind||(n.framesDropped=e.framesDropped,n.framesReceived=e.framesReceived,n.framesDroppedPercentage=e.framesDropped/e.framesReceived*100,n.frameHeight=e.frameHeight,n.frameWidth=e.frameWidth,n.frameHeightStart=t.aggregatedStats&&t.aggregatedStats.frameHeightStart?t.aggregatedStats.frameHeightStart:e.frameHeight,n.frameWidthStart=t.aggregatedStats&&t.aggregatedStats.frameWidthStart?t.aggregatedStats.frameWidthStart:e.frameWidth),"candidate-pair"==e.type&&e.hasOwnProperty("currentRoundTripTime")&&0!=e.currentRoundTripTime&&(n.currentRoundTripTime=e.currentRoundTripTime)})),t.aggregatedStats.receiveToCompositeMs&&(n.receiveToCompositeMs=t.aggregatedStats.receiveToCompositeMs,t.latencyTestTimings.SetFrameDisplayDeltaTime(t.aggregatedStats.receiveToCompositeMs)),t.aggregatedStats=n,t.onAggregatedStats&&t.onAggregatedStats(n)}},setupTransceiversAsyncX=async function(e){e.addTransceiver("video",{direction:"recvonly"}),uo||e.addTransceiver("audio",{direction:"recvonly"})},setupTracksToSendAsync=async function(e){if(e.addTransceiver("video",{direction:"recvonly"}),uo){let n=!!uo&&{autoGainControl:!1,channelCount:1,echoCancellation:!1,latency:0,noiseSuppression:!1,sampleRate:16e3,volume:1};var t=void 0;try{t=await navigator.mediaDevices.getUserMedia({video:!1,audio:n})}catch(e){console.error(e.message),Dt(e.message,{color:"red"}),Dt("More deatils: https://eagle3dstreaming.atlassian.net/wiki/spaces/docs/pages/172818439/Microphone+access+to+the+user+s+device",{color:"blue"}),"NotAllowedError"===e.name?(console.error("Microphone Permission denied: ",e.message),Dt("Microphone Permission denied",{color:"red"})):console.error("Error accessing media devices: ",e.message)}if(t)for(const n of t.getTracks())n.kind&&"audio"==n.kind&&e.addTransceiver(n,{direction:"sendrecv"});else e.addTransceiver("audio",{direction:"recvonly"})}else e.addTransceiver("audio",{direction:"recvonly"})},this.startLatencyTest=function(e){t.video&&(t.latencyTestTimings.Reset(),t.latencyTestTimings.TestStartTimeMs=Date.now(),e(t.latencyTestTimings.TestStartTimeMs))},this.handleCandidateFromServer=function(e){if(t.pcClient.remoteDescription){fo.push(e);let n=new RTCIceCandidate(e);t.pcClient.addIceCandidate(n).then((e=>{console.log("remote ICE candidate successfully added")})),t.pcClient.addIceCandidate(e).catch((e=>{console.error("Error adding remote candidate:",e)}))}else setTimeout((()=>{console.warn("remoteDescription not set. so  will try again in0.1 sec"),Rn.handleCandidateFromServer(e)}),100)},this.createOffer=function(){if(addToTimeRecords("createOfferCalledAt",getCurrentDate()),t.pcClient&&(t.pcClient.close(),t.pcClient=null),console.log("window.RTCPeerConnection:"+window.RTCPeerConnection),null==window.RTCPeerConnection)return nt("window.RTCPeerConnection undefined"),void(navigator.userAgent.includes("Firefox")?window.location="/assets/pages/RTCPeerConnectionDisabled.htm":window.location="/assets/pages/webRtcBlocked.htm");addToTimeRecords("newRTCPeerConnectionCalledAt",getCurrentDate()),t.pcClient=new RTCPeerConnection(t.cfg),addToTimeRecords("newRTCPeerConnectionCalledPassedAt",getCurrentDate()),t.useMic=uo,setupTracksToSendAsync(t.pcClient).finally((function(){setupPeerConnection(t.pcClient),t.dcClient=createDataChannel(t.pcClient,"cirrus",t.dataChannelOptions),handleCreateOffer(t.pcClient)}))},setupTransceiversAsync=async function(e){let t=e.getTransceivers().length>0;if(e.addTransceiver("video",{direction:"recvonly"}),uo){let o=!!uo&&{autoGainControl:!1,channelCount:1,echoCancellation:!1,latency:0,noiseSuppression:!1,sampleRate:48e3,sampleSize:16,volume:1};var n=void 0;try{n=await navigator.mediaDevices.getUserMedia({video:!1,audio:o})}catch(e){console.error("Error: "+e.message),e3ds_alert("Please grant permission to access the microphone.",{color:"Blue"}),e3ds_alert(e.message,{color:"Red"}),e3ds_alert("Read more here:",{color:"Blue"}),e3ds_alert("https://eagle3dstreaming.atlassian.net/wiki/spaces/docs/pages/172818439/Microphone+access+to+the+user+s+device",{color:"Blue"})}if(n)if(t){for(let t of e.getTransceivers())if(t&&t.receiver&&t.receiver.track&&"audio"===t.receiver.track.kind)for(const e of n.getTracks())e.kind&&"audio"==e.kind&&(t.sender.replaceTrack(e),t.direction="sendrecv")}else for(const t of n.getTracks())t.kind&&"audio"==t.kind&&e.addTransceiver(t,{direction:"sendrecv"});else e.addTransceiver("audio",{direction:"recvonly"})}else e.addTransceiver("audio",{direction:"recvonly"})},this.receiveOffer111=function(e){addToTimeRecords("receivedOfferAt",getCurrentDate()),console.error("AHSAN. receiveOffer() recoived an unhandled offer :",e),e.sfu&&(this.sfu=!0,delete e.sfu),t.pcClient||(console.log("Creating a new PeerConnection in the browser."),t.pcClient=new RTCPeerConnection(t.cfg),setupPeerConnection(t.pcClient)),t.pcClient.setRemoteDescription(e).then((()=>{setupTransceiversAsync(t.pcClient).finally((function(){t.pcClient.createAnswer().then((e=>(mungeSDP(e),t.pcClient.setLocalDescription(e)))).then((()=>{if(In&&In.readyState===Bn){let e=JSON.stringify(t.pcClient.currentLocalDescription);console.log("->arvind SS: SendAnswer"),In.send(e)}})).then((()=>{let e=t.pcClient.getReceivers();for(let t of e)t.playoutDelayHint=0})).catch((e=>console.error("createAnswer() failed:",e)))}))}))},this.receiveAnswer=function(e){addToTimeRecords("playerReceivedAnswerAt",getCurrentDate());var n=new RTCSessionDescription(e);!async function(e,t){addToTimeRecords("setRemoteDescriptionCalledAt",getCurrentDate()),await e.pcClient.setRemoteDescription(t).then((function(){setTimeout((function(){}),5e3)})).catch((function(e){e?Ye("setRemoteDescription:"+e):(Dt("setRemoteDescription: reloading to test",{color:"Red"}),setTimeout((function(){location.reload()}),5e3))}))}(t,n)},this.close=function(){t.pcClient&&(t.pcClient.close(),t.pcClient=null),t.aggregateStatsIntervalId&&clearInterval(t.aggregateStatsIntervalId)},this.send=function(e){if(t.dcClient&&"open"==t.dcClient.readyState)try{t.dcClient.send(e)}catch(e){console.error(e.message),Dt(e.message,{color:"red"}),Dt("More deatils: https://eagle3dstreaming.atlassian.net/wiki/x/CICPIQ",{color:"blue"}),TypeError}},this.getStats=function(e){t.pcClient&&e&&t.pcClient.getStats(null).then((t=>{e(t)}))},this.aggregateStats=function(e){let n=generateAggregatedStatsFunction();t.aggregateStatsIntervalId=setInterval((()=>{t.getStats(n)}),e)}}async function Ro(e,t){try{const n=await e.getStats();let o=null;return n.forEach((e=>{"transport"===e.type&&e.id===t.id&&e.selectedCandidatePairId?o=n.get(e.selectedCandidatePairId):"candidate-pair"===e.type&&"succeeded"===e.state&&e.transportId===t.id&&(o=e)})),o}catch(e){return console.error("Error retrieving selected candidate pair:",e),null}}async function Mo(){var e=Rn.pcClient;const t=[];if(e)for(const n of e.getSenders())if(n.track){const o=n.track.kind;if(n.transport&&n.transport.iceTransport){let s;const i=n.transport.iceTransport;s="function"==typeof i.getSelectedCandidatePair?i.getSelectedCandidatePair():await Ro(e,n.transport),s&&t.push({type:"sending",media:o,localCandidate:s.local,remoteCandidate:s.remote})}}if(e)for(const n of e.getReceivers())if(n.track){const o=n.track.kind;if(n.transport&&n.transport.iceTransport){let s;const i=n.transport.iceTransport;s="function"==typeof i.getSelectedCandidatePair?i.getSelectedCandidatePair():await Ro(e,n.transport),s&&t.push({type:"receiving",media:o,localCandidate:s.local,remoteCandidate:s.remote})}}var n="";const o={usingTurnServer:!1};t.forEach(((e,t)=>{console.log(`Candidate Pair ${t+1} (${e.media} - ${e.type}):`),console.log("Local Candidate:",e.localCandidate),console.log("Remote Candidate:",e.remoteCandidate),console.log("-----------------------------------");const s=e.localCandidate,i=e.remoteCandidate;var r;r="xirsys.com",s.url&&s.url.includes(r)&&(n+=`${r} used in FE: ${s.url} for ${e.media} ${e.type}. `),i.url&&i.url.includes(r)&&(n+=`, ${r} used in Streamer: ${i.url} for media: ${e.media} ${e.type}. `),"relay"===s.type&&(o.usingTurnServer=!0,o.browserTurnServerUrl=s.url),"relay"===i.type&&(o.usingTurnServer=!0,o.streamerTurnServerUrl=i.url)})),Ce=o,""!==n&&nt(n,-4553255983)}var Lo=1;function Bo(e){capBpsCmd="Encoder.MaxBitrate "+e;let t={Console:capBpsCmd};b(t),console.log(t)}function Ao(e){capFpsCmd="t.maxFPS "+e;let t={Console:capFpsCmd};b(t),console.log(t)}function Oo(e){var t=document.getElementById("player")||document.getElementById("videoElementParent");vn=document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement&&null!==document.msFullscreenElement||document.fullscreenElement&&null!==document.fullscreenElement||t&&t.classList.contains("fullscreen");let n=document.getElementById("fullscreen-img");n&&(n.src=vn?"assets/images/MinimiseToFullscreen.png":"assets/images/MaximiseToFullscreen.png",n.alt=vn?"Shrink to normal size":"Maximise to Fullscreen")}function _o(){vn?Do():Fo()}function Fo(){/iPad|iPhone|iPod/.test(navigator.userAgent)&&window.MSStream;var e=document.getElementById("player")||document.getElementById("videoElementParent"),t=document.getElementsByClassName("text"),n=document.getElementById("header-tbl"),o=e.requestFullscreen;if(o||["mozRequestFullScreen","msRequestFullscreen","webkitRequestFullScreen"].forEach((function(t){o=o||e[t]})),o)o.call(e).catch((function(e){Dt("Switching to Full Screen rejected due to no first interact from user"),console.error("Fullscreen request failed:",e)}));else{if(e&&(e.classList.add("fullscreen"),e.classList.remove("fixed-size")),t)for(let e=0;e<t.length;e++)t[e].style.display="none";n&&(n.style.display="none"),Oo(),Uo()}}function Do(){var e=document.getElementById("player")||document.getElementById("videoElementParent"),t=document.getElementsByClassName("text"),n=document.getElementById("header-tbl"),o=document.exitFullscreen;if(o||["mozCancelFullScreen","msExitFullscreen","webkitExitFullscreen"].forEach((function(e){o=o||document[e]})),o)o.call(document);else{if(e&&(e.classList.remove("fullscreen"),e.classList.add("fixed-size"),e.style.left=""),t)for(let e=0;e<t.length;e++)t[e].style.display="block";n&&(n.style.display="table"),Oo(),Uo()}}function Uo(){var e=document.getElementById("player")||document.getElementById("videoElementParent");let t=e.getElementsByTagName("VIDEO");if(document.documentElement.style.position=vn?"fixed":"",document.body.style.position=vn?"fixed":"",vn){let n=window.innerHeight/window.innerWidth,o=e.clientHeight/e.clientWidth,s=t.videoHeight/t.videoWidth;isNaN(s)?(B=window.innerWidth,A=window.innerHeight,O=0,_=Math.floor(.5*(window.innerWidth-B)),e.style.width=B+"px",e.style.height=A+"px"):n<o?(B=Math.floor(window.innerHeight/s),A=window.innerHeight,O=0,_=Math.floor(.5*(window.innerWidth-B)),e.style.width=B+"px",e.style.height=A+"px"):(B=window.innerWidth,A=Math.floor(window.innerWidth*s),O=Math.floor(.5*(window.innerHeight-A)),_=0,e.style.width=B+"px",e.style.height=A+"px")}else e.style.height="",e.style.width=""}function No(){document.addEventListener&&(document.addEventListener("webkitfullscreenchange",Oo,!1),document.addEventListener("mozfullscreenchange",Oo,!1),document.addEventListener("fullscreenchange",Oo,!1),document.addEventListener("MSFullscreenChange",Oo,!1)),window.addEventListener("resize",U,!0),window.addEventListener("orientationchange",n),console.log("5555555555555555555  load()"),window.addEventListener("message",k,!1),g({type:"readyToReceiveMessage"}),N(),null!==(An=document.getElementById("quality-control-ownership-tgl"))&&(An.onchange=function(e){v(),"function"==typeof window?.pixelStreaming?._webRtcController?.sendRequestQualityControlOwnership&&pixelStreaming._webRtcController.sendRequestQualityControlOwnership()});let e=document.getElementById("overlayButton");null!==e&&(e.onclick=function(e){!function(){if(1==sn("showPsControl")){let e=document.getElementById("overlayPSSettings");"none"===e.style.display||""===e.style.display?e.style.display="block":"block"===e.style.display&&(e.style.display="none")}else document.getElementById("overlayPSSettings").style.display="none";if(1==sn("showWebrtcCtrlMenu")){let e=document.getElementById("overlayWebrtcCtrlMenu");"none"===e.style.display||""===e.style.display?e.style.display="block":"block"===e.style.display&&(e.style.display="none")}else document.getElementById("overlayWebrtcCtrlMenu").style.display="none"}()});let t=document.getElementById("ConsoleCmd_submit");null!==t&&(t.onclick=function(e){!function(){let e={ConsoleCommand:document.getElementById("ConsoleCmd_text").value};E(e),"function"==typeof window?.pixelStreaming?.emitCommand&&window.pixelStreaming.emitCommand(e)}()});let o=document.getElementById("closeVoipBtn");o&&(o.onclick=function(e){e.preventDefault(),document.getElementById("popupForVoipUsername").style.display="none"});let s=document.getElementById("sendRandomdataToUnrealFast_submit");null!==s&&(s.onclick=function(e){const t=new Uint8Array(262144);for(let e=0;e<100;e++)try{Rn?.send(t),"function"==typeof window?.pixelStreaming?._webRtcController?.sendMessageController?.dataChannelSender?.sendData&&window.pixelStreaming._webRtcController.sendMessageController.dataChannelSender.sendData(t),console.log(`Sent data chunk ${e+1}`)}catch(e){console.error("Error sending data:",e);break}});let i=document.getElementById("dataToSendToUnreal_submit");null!==i&&(i.onclick=function(e){!function(){let e={dataForUnreal:document.getElementById("dataToSendToUnreal_text").value};b(e),"function"==typeof window?.pixelStreaming?.emitUIInteraction&&window.pixelStreaming.emitUIInteraction(e)}()}),document.getElementById("randomMovementBtn")&&document.getElementById("randomMovementBtn").addEventListener("click",m),document.getElementById("stopRandomMovementBtn")&&document.getElementById("stopRandomMovementBtn").addEventListener("click",(()=>{clearInterval(h)}));let r=document.getElementById("btnPasswordSubmit");null!==r&&(r.onclick=function(e){e.preventDefault(),document.getElementById("PasswordToVerify").value==bt.passwordToStart?(clearInterval(passwordTimer),document.getElementById("popupForPasswordToStart").style.display="none",document.getElementById("videoPlayOverlay").style.display="flex",document.getElementById("streamingVideo")&&(document.getElementById("streamingVideo").style.display="block"),document.getElementById("popupForVoipUsername")&&!Yt&&1==an&&(document.getElementById("popupForVoipUsername").style.display="flex",document.getElementById("voipUserName").select()),it=new Date,null!=Yt&&Zs(),Qs()):(document.getElementById("alert__box").style.top="50px",document.getElementById("alert__close").addEventListener("click",(e=>{e.preventDefault(),(document.getElementById("alert__box").style.top="50px")&&(document.getElementById("alert__box").style.top="-50%")})))});let l=document.getElementById("btnPasswordCanecl");null!==l&&(l.onclick=function(e){e.preventDefault(),window.location="/assets/pages/kickedOut.htm"});let d=document.getElementById("btnUserInputCanecl");null!==d&&(d.onclick=function(e){e.preventDefault();var t=document.getElementById("popupForOnScreenKeyboard");t&&(t.style.display="none",document.getElementById("UserInput").value="")});let u=document.getElementById("btnUserInputSubmit");function p(e){let t,n;if(parseInt(e)){parseInt(e)>=0&&parseInt(e)<=12?n="ultra":parseInt(e)>=13&&parseInt(e)<=25?n="high":parseInt(e)>=26&&parseInt(e)<=38?n="medium":parseInt(e)>=39&&parseInt(e)<=51&&(n="low");const t=document.querySelectorAll("#qualityList li");for(let e of t)e.classList.contains("selectedQuality")&&e.classList.remove("selectedQuality");document.getElementById(n).classList.add("selectedQuality")}else if(!parseInt(e)){switch(e){case"low":t=51;break;case"medium":t=34;break;case"high":t=17;break;case"ultra":t=1}const n=document.getElementById("resoulbar");n&&(n.value=t)}}null!==u&&(u.onclick=function(e){e.preventDefault();var t=document.getElementById("popupForOnScreenKeyboard");t&&(t.style.display="none",document.getElementById("UserInput").value="")});const f=document.getElementById("qualityList");f&&(f.onclick=function(e){if("LI"===e.target.tagName){const t=e.target.id;switch(t){case"low":qo(51),p("low");break;case"medium":qo(34),p("medium");break;case"high":qo(17),p("high");break;case"ultra":qo(1),p("ultra")}const n=document.querySelectorAll("#qualityList li");for(let e of n)e.classList.contains("selectedQuality")&&e.classList.remove("selectedQuality");document.getElementById(t).classList.add("selectedQuality"),document.getElementById("qualitySelect").classList.add("hiddenSelectionDiv")}});const T=document.getElementById("resList");T&&(T.onclick=function(e){if("LI"===e.target.tagName){const n=e.target.id;G=!1;var t=document.getElementById("player")||document.getElementById("videoElementParent");switch(n){case"144":y(256,144);break;case"240":y(426,240);break;case"360":y(640,360);break;case"480":y(854,480);break;case"720":y(1280,720);break;case"1080":y(1920,1080);break;case"auto":G=!0,y(t.clientWidth,t.clientHeight)}const o=document.querySelectorAll("#resList li");for(let e of o)e.classList.contains("selectedQuality")&&e.classList.remove("selectedQuality");document.getElementById(n).classList.add("selectedQuality"),document.getElementById("resSelect").classList.add("hiddenSelectionDiv")}});let x=document.getElementById("info4injectCopyBtn");null!==x&&x.addEventListener("click",(function(e){let t=document.getElementById("Info4injectStreamFromEditor");t.select(),navigator.clipboard.writeText(t.value).then((()=>{e3ds_alert("Copied Successfully!",{color:"blue"})})).catch((()=>{}))}));let P=document.getElementById("prioritise-quality-tgl"),I=document.getElementById("quality-params-submit");null!==P&&(P.onchange=function(e){if(P.checked){let e={PrioritiseQuality:1,LowBitrate:document.getElementById("low-bitrate-text").value,HighBitrate:document.getElementById("high-bitrate-text").value,MinFPS:document.getElementById("min-fps-text").value};S(e),console.log(e),I.onclick=function(e){let t={PrioritiseQuality:1,LowBitrate:document.getElementById("low-bitrate-text").value,HighBitrate:document.getElementById("high-bitrate-text").value,MinFPS:document.getElementById("min-fps-text").value};S(t),console.log(t)}}else{let e={PrioritiseQuality:0};S(e),console.log(e),I.onclick=null}});let R=document.getElementById("show-fps-button");null!==R&&(R.onclick=function(e){let t={Console:"stat fps"};b(t),"function"==typeof window.pixelStreaming.emitUIInteraction&&window?.pixelStreaming?.emitUIInteraction(t)});let L=document.getElementById("btn-Toggle-voipSpeaker-list");null!==L&&(L.onclick=function(e){"none"!=document.getElementById("roster").style.display?(document.getElementById("roster").style.display="none",L.src="assets/images/voipListNO.png"):(document.getElementById("flow-meeting").style.display="block",document.getElementById("roster").style.display="block",L.src="assets/images/voipListYes.png")});let B=document.getElementById("match-viewport-res-tgl");null!==B&&(B.onchange=function(e){B.checked,B.checked&&"function"==typeof window?.pixelStreamin?.config?.setFlagEnabled&&window.pixelStreaming.config.setFlagEnabled("MatchViewportRes",!0)});let A=document.getElementById("show-stats-tgl");null!==A&&(A.onchange=function(e){document.getElementById("statsContainer").style.display=e.target.checked?"block":"none"});var O=document.getElementById("kickAllGuests");O&&(O.onclick=function(e){console.log("-> SS: kickAllGuests"),In.send(JSON.stringify({type:"kickAllGuests"}))});var _=document.getElementById("KickSelctedGuest");_&&(_.onclick=function(e){console.log("-> SS: KickSelctedGuest");var t=document.getElementById("Guest-filter"),n=t.options[t.selectedIndex].value;t.options[t.selectedIndex].text,In.send(JSON.stringify({type:"KickSelctedGuest",playerIDToKick:n}))});var D=document.getElementById("DisableControlFromOthers");D&&(D.onclick=function(e){console.log("-> SS: DisableControlFromOthers"),In.send(JSON.stringify({type:"DisableControlFromOthers"}))});var H=document.getElementById("GiveControlToThisGuest");H&&(H.onclick=function(e){console.log("-> SS: GiveControlToThisGuest");var t=document.getElementById("Guest-filter"),n=t.options[t.selectedIndex].value;t.options[t.selectedIndex].text,In.send(JSON.stringify({type:"GiveControlToThisGuest",GiveControlToThisGuestID:n}))});let z=document.getElementById("BandwidthCap_params_submit");z&&(z.onclick=function(e){Bo(document.getElementById("BandwidthCap_text").value)});let W=document.getElementById("FramerateCap_params_submit");W&&(W.onclick=function(e){Ao(document.getElementById("FramerateCap_text").value)});let V=document.getElementById("editor-sidebar-closeBtn");V&&V.addEventListener("click",so);let q=document.getElementById("sendEditorUpdateToApp");q&&q.addEventListener("click",io);let $=document.getElementById("saveEditorUpdate");$&&$.addEventListener("click",ro);const j=document.getElementById("restartWebRtcButton");j&&j.addEventListener("click",(function(){"function"==typeof restartWebRtc&&(step=1,restartWebRtc()),"function"==typeof window?.pixelStreaming?.reconnect&&window.pixelStreaming.reconnect()}));let J=document.getElementById("ApplyBtn4setFramerateCap");J&&(J.onclick=function(e){Ao(document.getElementById("setFramerateCap").value)});var Q=document.getElementById("settings-button");Q&&(Q.onclick=function(e){if(console.log("-> SS: settingsButton"),1!=sn("isE3DSEngineApp"))return console.warn("Engine version below 4.26. so skipping settingsButton VideoEncoderQP -> : "+F),void Dt("Engine version below 4.26. so skipping settingsButton VideoEncoderQP -> : "+F+(Math.random()*(.12-.02)+.02).toFixed(4),{timeout:2e3,color:"blue"});!function(){let e=document.getElementById("minBitrate").value,t=document.getElementById("maxBitrate").value,n=document.getElementById("resolution").value,o=(document.getElementById("minQP").value,document.getElementById("rateCtrl").value),s=(document.getElementById("minFPS").value,document.getElementById("backbuffersize").value,document.getElementById("quality").value);var i=JSON.stringify({type:"settings",data:{quality:s,minBitrate:e,maxBitrate:t,resolution:n,rateCtrl:o}});console.log("settingsButton--\x3e "+i),In.send(i)}()});var K=document.getElementById("ApplyMaxSettingsBtn");K&&(K.onclick=function(e){if(console.log("-> SS: ApplyMaxSettingsBtn"),1!=sn("isE3DSEngineApp"))return console.warn("Engine version below 4.26. so skipping settingsButton VideoEncoderQP -> : "+F),void Dt("Engine version below 4.26. so skipping settingsButton VideoEncoderQP -> : "+F,{timeout:2e3,color:"blue"});var t=JSON.stringify({type:"settings",data:{minBitrate:2e7,maxBitrate:5e7,resolution:"1920x1080",minQP:1,rateCtrl:"CBR",minFPS:60,backbuffersize:1}});console.log("ApplyMaxSettingsBtn -> SS: "+t),In.send(t)});var X=document.getElementById("ApplyMidSettingsBtn");X&&(X.onclick=function(e){if(console.log("-> SS: ApplyMidSettingsBtn"),1!=sn("isE3DSEngineApp"))return console.error("Engine version below 4.26. so skipping ApplyMidSettingsBtn VideoEncoderQP -> : "+F),void Dt("Engine version below 4.26. so skipping ApplyMidSettingsBtn VideoEncoderQP -> : "+F);var t=JSON.stringify({type:"settings",data:{minBitrate:1e7,maxBitrate:25e6,resolution:"1280x720",minQP:30,rateCtrl:"VBR",minFPS:60,backbuffersize:1}});console.log("ApplyMidSettingsBtn -> SS: "+t),In.send(t)});var Y=document.getElementById("ApplyMinSettingsBtn");Y&&(Y.onclick=function(e){if(console.log("-> SS: ApplyMinSettingsBtn"),1!=sn("isE3DSEngineApp"))return console.warn("Engine version below 4.26. so skipping settingsButton VideoEncoderQP -> : "+F),void Dt("Engine version below 4.26. so skipping settingsButton VideoEncoderQP -> : "+F,{timeout:2e3,color:"blue"});var t=JSON.stringify({type:"settings",data:{minBitrate:4e6,maxBitrate:2e7,resolution:"800x640",minQP:50,rateCtrl:"VBR",minFPS:60,backbuffersize:1}});console.log("ApplyMinSettingsBtn -> SS: "+t),In.send(t)});let Z=document.getElementById("ApplyBtn4setBandwidthCap");Z&&(Z.onclick=function(e){Bo(document.getElementById("setBandwidthCap").value)});let ee=document.getElementById("ApplyBtn4Resulation");ee&&(ee.onclick=function(e){y(document.getElementById("ResulationX").value,document.getElementById("ResulationY").value)});let te=document.getElementById("ApplyBtn4Resulation_r");if(te&&(te.onclick=function(e){!function(e,t){let n={Console:"r.setres "+document.getElementById("ResulationX_r").value+"x"+document.getElementById("ResulationY_r").value+"w"};b(n),1==Oe&&console.log(n)}()}),muteaudio=document.getElementById("muteaudio"),null!==muteaudio&&(muteaudio.onchange=function(e){Rn&&In.send(JSON.stringify({type:"settings",mute:muteaudio.checked}))}),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){let e=document.getElementById("fullscreen-img");e&&(e.style.display="none")}let ne=document.getElementById("fullscreen-img");ne&&(ne.onclick=function(){_o()});let oe=document.getElementById("screenshot-img");oe&&(oe.onclick=function(){Vo()});let se=document.getElementById("forcePsVrModeBtn");se&&(se.onclick=function(){_webXrController.xrClicked()});let ie=document.getElementById("LatencyTestBtn");ie&&(ie.onclick=function(){"function"==typeof window?.pixelStreaming?._webRtcController?.sendLatencyTest&&window.pixelStreaming._webRtcController.sendLatencyTest(),Rn&&Rn.startLatencyTest((function(e){let t={StartTime:e};w(C.LatencyTest,t)}))}),Wo("button_720p",1280,720),Wo("button_1080p",1920,1080),Wo("button_1440p",2560,1440),Wo("button_4K",3840,2160),Wo("button_8K",7680,4320);let re=document.getElementById("match-viewport-res-tgl");null!==re&&re.checked;let ae=document.getElementById("ApplyBtn4setHighBitrate");ae&&(ae.onclick=function(e){let t=document.getElementById("setHighBitrate").value;capBpsCmd="Encoder.HighBitrate "+t;let n={Console:capBpsCmd};b(n),console.log(n)});let le=document.getElementById("ApplyBtn4setMaxBitrate");le&&(le.onclick=function(e){let t=document.getElementById("setMaxBitrate").value;capBpsCmd="Encoder.MaxBitrate "+t;let n={Console:capBpsCmd};b(n),console.log(n)});let ce=document.getElementById("Volumebar");ce&&(ce.onchange=function(e){c(this.value)});let de=document.getElementById("resoulbar");de&&(de.onchange=function(e){qo(this.value),p(this.value)});let ue=document.getElementById("ApplyBtn4setUseBackBufferSize");ue&&(ue.onclick=function(e){let t=document.getElementById("setUseBackBufferSize").value;capBpsCmd="Encoder.UseBackBufferSize "+t;let n={Console:capBpsCmd};b(n),console.log(n)});let he=document.getElementById("ApplyBtn4setPrioritiseQuality");he&&(he.onclick=function(e){let t=document.getElementById("setPrioritiseQuality").value;capBpsCmd="Encoder.PrioritiseQuality "+t;let n={Console:capBpsCmd};b(n),console.log(n)});let me=document.getElementById("ApplyBtn4setMinFPS");me&&(me.onclick=function(e){let t=document.getElementById("setMinFPS").value;capBpsCmd="Encoder.MinFPS "+t;let n={Console:capBpsCmd};b(n),console.log(n)});let ge=document.getElementById("ApplyBtn4setMinQP");ge&&(ge.onclick=function(e){let t=document.getElementById("setMinQP").value;capBpsCmd="Encoder.MinQP "+t;let n={Console:capBpsCmd};b(n),console.log(n)});let pe=document.getElementById("ApplyBtn4setLowBitrate");pe&&(pe.onclick=function(e){let t=document.getElementById("setLowBitrate").value;capBpsCmd="Encoder.LowBitrate "+t;let n={Console:capBpsCmd};b(n),console.log(n)});let fe=document.getElementById("ApplyBtn4TargetSize");fe&&(fe.onclick=function(e){let t=document.getElementById("TargetSizeX").value,n=document.getElementById("TargetSizeY").value;capBpsCmd="Encoder.TargetSize "+t+"x"+n;let o={Console:capBpsCmd};b(o),console.log(o)});let ye=document.getElementById("ApplyBtn4setRateControl");ye&&(ye.onclick=function(e){var t=document.getElementById("RateControlMethod"),n=t.options[t.selectedIndex].value;t.options[t.selectedIndex].text,capBpsCmd="Encoder.RateControl "+n;let o={Console:capBpsCmd};b(o),console.log(o)});let Se=document.getElementById("encoder-params-submit");null!==Se&&(Se.onclick=function(e){for(var t=qt.versionString.split("."),n=[],o=0;o<t.length;o++){var s=parseInt(t[o],10);isNaN(s)||n.push(s)}console.log(n),n[0];let i=document.getElementById("encoder-min-qp-text").value,r=document.getElementById("encoder-max-qp-text").value;E({ConsoleCommand:"PixelStreaming.Encoder.MinQP "+i}),E({ConsoleCommand:"PixelStreaming.Encoder.MaxQP "+r}),"function"==typeof window?.pixelStreaming?.emitCommand&&(window.pixelStreaming.emitCommand({ConsoleCommand:"PixelStreaming.Encoder.MinQP "+i}),window.pixelStreaming.emitCommand({ConsoleCommand:"PixelStreaming.Encoder.MaxQP "+r}))});let Ce=document.getElementById("UserInput");Ce&&(Ce.addEventListener("touchstart",(e=>{e.preventDefault(),Ce.focus(),setTimeout((()=>{Ce.setSelectionRange(Ce.value.length,Ce.value.length)}),0)})),Ce.oninput=function(e){setTimeout((()=>{if(Ce.setSelectionRange(Ce.value.length,Ce.value.length),ve)return;let t=e.data,n=t[t.length-1].toUpperCase(),o=n.charCodeAt(0);const s=new KeyboardEvent("keydown",{key:n,keyCode:o,which:o,code:`Key${n}`});M(new Uint8Array([C.KeyDown,a(s),s.repeat]).buffer);const i=new KeyboardEvent("keypress",{key:n,keyCode:o,charCode:n.toLowerCase().charCodeAt(0),which:n.charCodeAt(0),code:`Key${n}`});let r=new DataView(new ArrayBuffer(3));r.setUint8(0,C.KeyPress),r.setUint16(1,i.charCode,!0),M(r.buffer);const l=new KeyboardEvent("keyup",{key:n,keyCode:o,charCode:n.toLowerCase().charCodeAt(0),which:n.charCodeAt(0),code:`Key${n}`});M(new Uint8Array([C.KeyUp,a(l)]).buffer),ve=!0}),0)});let we=document.getElementById("webrtc-params-submit");null!==we&&(we.onclick=function(e){G=!1,y(document.getElementById("webrtc-low-qp-text").value,document.getElementById("webrtc-high-qp-text").value)}),"function"==typeof onHtmlBind?onHtmlBind():console.log("not found onHtmlBind"),e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onHtmlBind&&e3ds_controller.callbacks.onHtmlBind()}function Go(e){try{const t=new URL(e);return`${t.protocol}//${t.hostname}`}catch(e){return console.error("Invalid URL:",e),null}}function Ho(e){try{return new URL(e).pathname.split("/")[2]}catch(e){return console.error("Invalid URL:",e),null}}function zo(e){var t=document.getElementById("kick-other-players-button");t&&(t.value=`Kick (${e})`)}function Wo(e,t,n){var o=document.getElementById(e);o&&(o.onclick=function(o){console.log("-> "+e),y(t,n)})}function Vo(){console.log("*****captureScreenShot method invoked*****");var e=window.innerWidth,t=window.innerHeight,n=(new Date).getTime(),o=document.getElementById("canvas"),s=o.getContext("2d");o.width=e,o.height=t;var i=document.getElementById("streamingVideo");s.drawImage(i,0,0,e,t);var r=o.toDataURL("image/png").replace("image/png","image/octet-stream"),a=document.createElement("a");a.setAttribute("download",n+"_screenshot.png"),a.setAttribute("href",r),a.click()}function qo(e){console.log("setQP val: "+e),E({ConsoleCommand:"PixelStreaming.Encoder.MinQP "+e}),E({ConsoleCommand:"PixelStreaming.Encoder.MaxQP "+e}),window?.pixelStreaming?.emitConsoleCommand(`PixelStreaming.Encoder.MinQP ${e}`),window?.pixelStreaming?.emitConsoleCommand(`PixelStreaming.Encoder.MaxQP ${e}`)}window.dispatchKickEvent=function(e,t){const n=Go(_e),o=Ho(e);null!=o&&fetch(`${n}/API/${De}/${o}/KickPlayersForCS?csPlayerId=${t}`).then((e=>e.json())).then((e=>{console.log(e)}))},window.dispatchMicMuteEvent=function(e,t){const n=Go(_e),o=Ho(e);null!=o&&fetch(`${n}:${o}/API/${De}/mutePlayer?csPlayerId=${t}`).then((e=>e.text())).then((e=>{console.log(e)}))},window.dispatchToggleControl=function(e,t){null!=In&&("on"===e?In.send(JSON.stringify({type:"GiveControlToThisGuest",GiveControlToThisGuestID:t})):In.send(JSON.stringify({type:"DisableControlForThisGuest",guestId:t}))),"function"==typeof window?.pixelStreaming?.webSocketController?.webSocket?.send&&("on"===e?pixelStreaming.webSocketController.webSocket.send(JSON.stringify({type:"GiveControlToThisGuest",GiveControlToThisGuestID:t})):pixelStreaming.webSocketController.webSocket.send(JSON.stringify({type:"DisableControlForThisGuest",guestId:t})))};const $o={LockedMouse:0,HoveringMouse:1};var jo={controlScheme:$o.HoveringMouse,suppressBrowserKeys:!0,fakeMouseWithTouches:!1};function Jo(e,t,n,o){if(tn)return;Ln&&(console.log(`x: ${e}, y:${t}, dX: ${n}, dY: ${o}`),document.getElementById("skip_video").style.display="block",document.getElementById("skip_video").innerHTML=`x: ${e}, y:${t}, dX: ${n}, dY: ${o}`);let s=jn(e,t),i=Jn(n,o);var r=new DataView(new ArrayBuffer(9));r.setUint8(0,C.MouseMove),r.setUint16(1,s.x,!0),r.setUint16(3,s.y,!0),r.setInt16(5,i.x,!0),r.setInt16(7,i.y,!0),M(r.buffer)}var Qo=!1;function Ko(e,t,n){Ln&&console.log(`mouse button ${e} down at (${t}, ${n})`);let o=jn(t,n),s=new DataView(new ArrayBuffer(6));s.setUint8(0,C.MouseDown),s.setUint8(1,e),s.setUint16(2,o.x,!0),s.setUint16(4,o.y,!0),M(s.buffer)}function Xo(e,t,n){if(tn)return;if(Ln&&console.log(`mouse button ${e} up at (${t}, ${n})`),("Mac"!=Nn.os.name||2!=e||Qo)&&"Mac"==Nn.os.name&&2==e&&Qo)return;let o=jn(t,n);var s=new DataView(new ArrayBuffer(6));s.setUint8(0,C.MouseUp),s.setUint8(1,e),s.setUint16(2,o.x,!0),s.setUint16(4,o.y,!0),M(s.buffer)}function Yo(e,t,n){if(tn)return;Ln&&console.log(`mouse wheel with delta ${e} at (${t}, ${n})`);let o=jn(t,n);var s=new DataView(new ArrayBuffer(7));s.setUint8(0,C.MouseWheel),s.setInt16(1,e,!0),s.setUint16(3,o.x,!0),s.setUint16(5,o.y,!0),M(s.buffer)}const Zo={MainButton:0,AuxiliaryButton:1,SecondaryButton:2,FourthButton:3,FifthButton:4},es={PrimaryButton:1,SecondaryButton:2,AuxiliaryButton:4,FourthButton:8,FifthButton:16};function ts(e,t,n){e&es.PrimaryButton&&Xo(Zo.MainButton,t,n),e&es.SecondaryButton&&Xo(Zo.SecondaryButton,t,n),e&es.AuxiliaryButton&&Xo(Zo.AuxiliaryButton,t,n),e&es.FourthButton&&Xo(Zo.FourthButton,t,n),e&es.FifthButton&&Xo(Zo.FifthButton,t,n)}function ns(e,t,n){e&es.PrimaryButton&&Ko(Zo.MainButton,t,n),e&es.SecondaryButton&&Ko(Zo.SecondaryButton,t,n),e&es.AuxiliaryButton&&Ko(Zo.AuxiliaryButton,t,n),e&es.FourthButton&&Ko(Zo.FourthButton,t,n),e&es.FifthButton&&Ko(Zo.FifthButton,t,n)}let os=!0;function ss(e){var t=e.width/2,n=e.height/2;function o(){document.pointerLockElement===e||document.mozPointerLockElement===e?(console.log("Pointer locked"),document.addEventListener("mousemove",s,!1)):(console.log("The pointer lock status is now unlocked"),document.removeEventListener("mousemove",s,!1),os=!1)}function s(e){t+=e.movementX,n+=e.movementY,t>B&&(t-=B),n>A&&(n-=A),t<0&&(t=B+t),n<0&&(n=A-n),Jo(t,n,e.movementX,e.movementY)}e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock,e.onclick=async function(){try{await e.requestPointerLock(),os=!0}catch(e){Ye("requestPointerLock() failed: "+JSON.stringify(Nn),-4260979382),Dt("requestPointerLock() is not supported in your browser. Please try updating or using a different browser.")}},document.addEventListener("pointerlockchange",o,!1),document.addEventListener("mozpointerlockchange",o,!1),e.onmousedown=function(e){u(),Ko(e.button,t,n)},e.onmouseup=function(e){u(),Xo(e.button,t,n)},e.onwheel=function(e){u(),Yo(e.wheelDelta,t,n)},e.pressMouseButtons=function(e){ns(e.buttons,t,n)},e.releaseMouseButtons=function(e){ts(e.buttons,t,n)}}var is,rs=void 0;function as(e){if(null==qt)return clearTimeout(rs),void(rs=setTimeout((function(){console.log("registerTouchEvents---\x3e ue4ExeInfo == undefined"),as(e)}),1e3));console.log("ue4ExeInfo.versionString: "+qt.versionString),null==qt.versionString||"4.27.1.0"==qt.versionString||"4.27.2.0"==qt.versionString||qt.versionString.startsWith("5.")?function(e){let t=[9,8,7,6,5,4,3,2,1,0],n={};function o(e){let o=t.pop();void 0===o&&console.log("exhausted touch indentifiers"),n[e.identifier]=o}function s(t,o){let s=new DataView(new ArrayBuffer(2+7*o.length));s.setUint8(0,t),s.setUint8(1,o.length);let i=2;for(let t=0;t<o.length;t++){let r=o[t],a=r.clientX-e.offsetLeft,l=r.clientY-e.offsetTop;Ln&&console.log(`F${n[r.identifier]}=(${a}, ${l})`);let c=jn(a,l);s.setUint16(i,c.x,!0),i+=2,s.setUint16(i,c.y,!0),i+=2,s.setUint8(i,n[r.identifier],!0),i+=1,s.setUint8(i,255*r.force,!0),i+=1,s.setUint8(i,c.inRange?1:0,!0),i+=1}M(s.buffer)}if(jo.fakeMouseWithTouches){let t;e.ontouchstart=function(n){if(void 0===t){let o=n.changedTouches[0];t={id:o.identifier,x:o.clientX-$n.left,y:o.clientY-$n.top},e.onmouseenter(n),Ko(Zo.MainButton,t.x,t.y)}n.preventDefault()},e.ontouchend=function(n){for(let o=0;o<n.changedTouches.length;o++){let s=n.changedTouches[o];if(null!=t&&s.identifier===t.id){let o=s.clientX-$n.left,i=s.clientY-$n.top;Xo(Zo.MainButton,o,i),e.onmouseleave(n),t=void 0;break}}n.preventDefault()},e.ontouchmove=function(e){for(let n=0;n<e.touches.length;n++){let o=e.touches[n];if(null!=t&&o.identifier===t.id){let e=o.clientX-$n.left,n=o.clientY-$n.top;Jo(e,n,e-t.x,n-t.y),t.x=e,t.y=n;break}}e.preventDefault()}}else e.ontouchstart=function(e){for(let t=0;t<e.changedTouches.length;t++)o(e.changedTouches[t]);Ln&&console.log("touch start"),s(C.TouchStart,e.changedTouches),e.preventDefault()},e.ontouchend=function(e){Ln&&console.log("touch end"),s(C.TouchEnd,e.changedTouches);for(let s=0;s<e.changedTouches.length;s++)o=e.changedTouches[s],t.push(n[o.identifier]),delete n[o.identifier];var o;e.preventDefault()},e.ontouchmove=function(e){Ln&&console.log("touch move"),s(C.TouchMove,e.touches),e.preventDefault()}}(e):function(e){var t=[9,8,7,6,5,4,3,2,1,0],n={};function o(e){let o=t.pop();void 0===o&&console.log("exhausted touch indentifiers"),n[e.identifier]=o}function s(t,o){if(tn)return;let s=new DataView(new ArrayBuffer(2+6*o.length));s.setUint8(0,t),s.setUint8(1,o.length);let i=2;for(let t=0;t<o.length;t++){let r=o[t],a=r.clientX.clamp(1,e.clientWidth-5)-e.offsetLeft,l=r.clientY.clamp(1,e.clientHeight-5)-e.offsetTop;Ln&&console.log(`F${n[r.identifier]}=(${a}, ${l})`);let c=jn(a,l);s.setUint16(i,c.x,!0),i+=2,s.setUint16(i,c.y,!0),i+=2,s.setUint8(i,n[r.identifier],!0),i+=1,s.setUint8(i,255*r.force,!0),i+=1}M(s.buffer)}if(jo.fakeMouseWithTouches){var i=void 0;e.ontouchstart=function(t){if(void 0===i){let n=t.changedTouches[0];i={id:n.identifier,x:n.clientX-$n.left,y:n.clientY-$n.top},e.onmouseenter(t),Ko(Zo.MainButton,i.x,i.y)}t.preventDefault()},e.ontouchend=function(t){u();for(let n=0;n<t.changedTouches.length;n++){let o=t.changedTouches[n];if(null!=i&&o.identifier===i.id){let n=o.clientX-$n.left,s=o.clientY-$n.top;Xo(Zo.MainButton,n,s),e.onmouseleave(t),i=void 0;break}}t.preventDefault()},e.ontouchmove=function(e){for(let t=0;t<e.touches.length;t++){let n=e.touches[t];if(null!=i&&n.identifier===i.id){let e=n.clientX-$n.left,t=n.clientY-$n.top;Jo(e,t,e-i.x,t-i.y),i.x=e,i.y=t;break}}e.preventDefault()}}else e.ontouchstart=function(e){for(let t=0;t<e.changedTouches.length;t++)o(e.changedTouches[t]);Ln&&console.log("touch start"),s(C.TouchStart,e.changedTouches),e.preventDefault(),clearInterval(Dn),clearTimeout(Un),te=!1,Dn=setInterval(ee,10),Un=setTimeout((function(){clearInterval(Dn)}),1e3)},e.ontouchend=function(e){u(),Ln&&console.log("touch end"),s(C.TouchEnd,e.changedTouches);for(let s=0;s<e.changedTouches.length;s++)e.changedTouches[s],o=e.changedTouches[s],t.includes(n[o.identifier])||(t.push(n[o.identifier]),t.sort((function(e,t){return t-e}))),o.identifier in n&&delete n[o.identifier];var o;e.preventDefault()},e.ontouchmove=function(e){Ln&&console.log("touch move"),s(C.TouchMove,e.touches),e.preventDefault()}}(e)}function ls(e){console.log("restartAnimationText---\x3e : "+e)}function cs(){var e=Rn.video;if(e.paused)console.log("Status: Paused");else if(e.ended)console.log("Status: Stopped");else if(e.readyState>2)return void console.log("Status: Playing");requestAnimationFrame(cs)}function ds(){ao&&clearInterval(ao);var e=document.getElementById("streamingVideo");if(e&&(e.style.backgroundColor="black"),Rn){Lo=2,N(),Rn.video.play().then((()=>{})).catch((e=>{cs(),"The request is not allowed by the user agent or the platform in the current context, possibly because the user denied permission."!=e.message&&(console.log("xxxx Error.message : "+e.message),console.log("xxxx error.name : ",e.name),console.log("xxxx error.stack : ",e.stack),Rs(2),hs("clickableState",(e=>{ds()})))}));try{Rn.handleOnAudioTrack(Wt)}catch(e){console.log("Error in webRtcPlayerObj.handleOnAudioTrack(): "+e.message)}var t=document.getElementById("videoPlayOverlay");t&&(t.style.display="none"),document.getElementById("bottm_left_slider");var n=document.getElementById("settings");n&&(1==bt.shouldDisplayContorlBar||null==bt.shouldDisplayContorlBar?n.style.display="flex":n.style.display="none"),1==an&&(document.getElementById("flow-meeting")&&(document.getElementById("flow-meeting").style.display="block"),document.getElementById("voipControlPanel")&&(document.getElementById("voipControlPanel").style.display="flex"),document.getElementById("e3ds_bottom_panelObj_left_bottom")&&(document.getElementById("e3ds_bottom_panelObj_left_bottom").style.display="block"));var o={type:"stage5_playBtnPressed"};Q(),g(o),b(o),Ms()}M(new Uint8Array([C.RequestInitialSettings]).buffer),v(),V(),Ms();var s=document.getElementById("overlay");if(s){if(0!=sn("showPsControl")){let e=document.getElementById("overlayButton");s.style.display="block",e.style.display="block",s.style.display="block",document.getElementById("overlayPSSettings").style.display="block"}if(0!=sn("showWebrtcCtrlMenu")&&null!=sn("showWebrtcCtrlMenu")){let e=document.getElementById("overlayButton");s.style.display="block",e.style.display="block",s.style.display="block",document.getElementById("overlayWebrtcCtrlMenu").style.display="block"}}1==bt.doAutoMovement&&(h=setInterval((()=>{const e=["W","S","D"],t=e[Math.floor(Math.random()*e.length)],n=new KeyboardEvent("keydown",{key:t,keyCode:t.charCodeAt(0),which:t.charCodeAt(0),code:`Key${t.toUpperCase()}`});M(new Uint8Array([C.KeyDown,a(n),n.repeat]).buffer),setTimeout((()=>{const e=new KeyboardEvent("keypress",{key:t,keyCode:t.charCodeAt(0),charCode:t.charCodeAt(0),which:t.charCodeAt(0),code:`Key${t.toUpperCase()}`});let n=new DataView(new ArrayBuffer(3));n.setUint8(0,C.KeyPress),n.setUint16(1,e.charCode,!0),M(n.buffer)}),2e3),setTimeout((()=>{const e=new KeyboardEvent("keyup",{key:t,keyCode:t.charCodeAt(0),charCode:t.charCodeAt(0),which:t.charCodeAt(0),code:`Key${t.toUpperCase()}`});M(new Uint8Array([C.KeyUp,a(e)]).buffer)}),100)}),200))}function us(){const e=document.getElementById("popupForinjectStreamFromEditorInfo");e&&(e.style.display="none"),1==wn?(ds(),1==bt.isMilicastStreaming&&connectStream()):(Rs(2),hs("clickableState",(e=>{addToTimeRecords("playBtnClickedAt",getCurrentDate()),ds(),1==bt.isMilicastStreaming&&connectStream()})))}function hs(e,t){console.log("setOverlayCustom---\x3e 11111111111111111: "),Vn=!1;var n=document.getElementById("clickToPlay");if(!n){var o=document.getElementById("player");(n=document.createElement("div")).id="videoPlayOverlay",o.appendChild(n)}for(;n.lastChild;)n.removeChild(n.lastChild);var s=document.getElementById("playButton");if(!s){var i=document.createElement("img");i.id="playButton",i.src=null!=on?on:"https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/Play_button2.png",i.alt="!!!!!",i&&n.appendChild(i),s=i,qe=!0}s.style.display="block";var r=document.getElementById("loaderStep2");r&&Kt&&(r.style.backgroundImage=`url("${Kt}")`),n.style.display="block",function(e,t="infinite"){setTimeout((function(){ao=setInterval((function(){document.getElementById(e).classList.toggle("shake")}),1e4)}),1e4),"number"==typeof t&&document.documentElement.style.setProperty("--shake-iteration",""+2*t)}("playButton",10),g({type:"stage4_playBtnShowedUp"}),t&&n&&n.addEventListener("click",(function e(o){t(o),n.removeEventListener("click",e),document.getElementById("videoPlayOverlay")&&(n.style.display="none")})),n&&n.classList.add(e)}function ms(e){console.log("showTextOverlay---\x3e "+e),Dt(e,{timeout:2e3,color:"blue"});var t=document.createElement("div");t.id="messageOverlay",t.innerHTML=e||""}let gs=null,ps=null,fs=null,vs=[],ys=null,Ss=null,Cs=null,ws=null,bs=null;var Es;async function Ts(){if(document.querySelector(".recorded-video-wrap").style.display="none",await async function(){try{gs=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0,preferCurrentTab:!0,systemAudio:"include"}),ps=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}})}catch(e){console.error("Error accessing display media or user media:",e)}}(),gs&&ps){const e=new MediaStream([...gs.getAudioTracks(),...ps.getAudioTracks()]);fs=new MediaStream([...gs.getVideoTracks(),...e.getTracks()]),ys=new MediaRecorder(fs),ys.ondataavailable=xs,ys.onstop=Ps,ys.start(1e3),Es&&(Es.removeEventListener("click",Ts),Es.addEventListener("click",ks)),console.log("Recording started"),document.getElementById("screenRecordImg").classList.add("blinkImg")}else console.warn("No stream available.")}function ks(){ys.stop(),Es&&(Es.removeEventListener("click",ks),Es.addEventListener("click",Ts)),document.querySelector(".cancel-download").addEventListener("click",(function(){document.querySelector(".recorded-video-wrap").style.display="none"})),document.getElementById("screenRecordImg").classList.remove("blinkImg")}function xs(e){vs.push(e.data)}function Ps(e){const t=new Blob(vs,{type:"video/mp4"});vs=[],ws.href=URL.createObjectURL(t),ws.download="video.mp4",ws.disabled=!1,bs.src=URL.createObjectURL(t),bs.load(),bs.onloadeddata=function(){const e=document.querySelector(".recorded-video-wrap");e.style.display="block",e.scrollIntoView({behavior:"smooth",block:"start"}),bs.play()},gs.getTracks().forEach((e=>e.stop())),ps.getTracks().forEach((e=>e.stop())),console.log("Recording stopped")}function Is(){(Es=document.getElementById("screenRecord"))&&(lo()?Es.style.display="none":Es.style.display="block",Ss=document.querySelector(".start-recording"),Cs=document.querySelector(".stop-recording"),ws=document.querySelector(".download-video"),bs=document.querySelector(".recorded-video"),Es&&Es.addEventListener("click",Ts))}function Rs(e){console.log("showLoader: "+e),Ms(),obj=document.getElementById("loaderStep"+e),obj?obj.style.display="flex":console.log("loaderStep"+e+" does not exist")}function Ms(){var e=document.getElementById("loaderStep1");e?e.style.display="none":console.log("loaderStep1 does not exist"),(e=document.getElementById("loaderStep2"))?e.style.display="none":console.log("loaderStep2 does not exist"),(e=document.getElementById("loaderStep3"))?e.style.display="none":console.log("loaderStep3 does not exist")}window.addEventListener("load",(()=>{Is()}));var Ls=void 0;function Bs(e,t,n,o){console.log("putFile() selectedFileName"+n);var s=Ls;let i=new XMLHttpRequest;i.open("PUT",e,!0),i.setRequestHeader("Content-type",t),i.onload=function(){let t=i.responseText;if(4==i.readyState&&"200"==i.status){console.log("Successfully uploaded",t),console.log("file:",s),console.log("DIRECT URL",e.split("?")[0]);var r=e.split("?")[0],a=o+n,l=JSON.stringify({type:"askElToDownloadFileTO",url:r,downloadPath:a});In&&(console.log(" ws.send(): "+JSON.stringify(l)),In.send(l))}else console.error(t);Ls=void 0},i.onprogress=function(e){console.log("Progress",e)},i.send(s)}var As,Os=void 0,_s=0,Fs=!0;function Ds(){let e=document.getElementById("player"),t=e.getElementsByTagName("video");if(e&&t.length>0){let n=e.clientHeight/e.clientWidth,o=t[0].videoHeight/t[0].videoWidth;if(n>o){Ln&&console.log("Setup Normalize and Quantize for playerAspectRatio > videoAspectRatio");let t=n/o;jn=(n,o)=>{let s=n/e.clientWidth,i=t*(o/e.clientHeight-.5)+.5;return s<0||s>1||i<0||i>1?{inRange:!1,x:65535,y:65535}:{inRange:!0,x:65536*s,y:65536*i}},unquantizeAndDenormalizeUnsigned=(n,o)=>{let s=(o/65536-.5)/t+.5;return{x:n/65536*e.clientWidth,y:s*e.clientHeight}},Jn=(n,o)=>({x:n/(.5*e.clientWidth)*32767,y:t*o/(.5*e.clientHeight)*32767})}else{Ln&&console.log("Setup Normalize and Quantize for playerAspectRatio <= videoAspectRatio");let t=o/n;jn=(n,o)=>{let s=t*(n/e.clientWidth-.5)+.5,i=o/e.clientHeight;return s<0||s>1||i<0||i>1?{inRange:!1,x:65535,y:65535}:{inRange:!0,x:65536*s,y:65536*i}},unquantizeAndDenormalizeUnsigned=(n,o)=>{let s=o/65536;return{x:((n/65536-.5)/t+.5)*e.clientWidth,y:s*e.clientHeight}},Jn=(n,o)=>({x:t*n/(.5*e.clientWidth)*32767,y:o/(.5*e.clientHeight)*32767})}}}var Us=void 0;function Ns(e){if(Fs){var t=document.getElementById("player");if(!t)return Us&&clearTimeout(Us),void(Us=setTimeout((function(){Ns()}),100));$n=t.getBoundingClientRect(),Ds(),t.classList.contains("fixed-size")||(window.innerWidth<t.videoWidth||(window.innerHeight,t.videoHeight),function(e){let t=e.getElementsByTagName("VIDEO"),n=window.innerHeight/window.innerWidth,o=e.clientHeight/e.clientWidth,s=t.videoHeight/t.videoWidth;var i;isNaN(s)?(B=window.innerWidth,A=window.innerHeight,i="top: "+(O=0)+"px; left: "+(_=0)+"px; width: "+B+"px; height: "+A+"px; "+mn):n<o?(B=Math.floor(window.innerHeight/s),A=window.innerHeight,O=0,_=Math.floor(.5*(window.innerWidth-B)),i="top: "+O+"px; left: "+_+"px; width: "+B+"px; height: "+A+"px; cursor: "+styleCursor+"; "+mn):(B=window.innerWidth,A=Math.floor(window.innerWidth*s),i="top: "+(O=Math.floor(.5*(window.innerHeight-A)))+"px; left: "+(_=0)+"px; width: "+B+"px; height: "+A+"px; cursor: "+styleCursor+"; "+mn),function(e,t){null!=un?document.getElementById("videoPlayOverlay").style=`${t};background-image: url("${un}");`:e.style=t}(e,i)}(t))}}function Gs(){if(document.getElementById("voipUserName")&&dn&&dn.city){var e="player";dn&&dn.city&&(e=dn.city),document.getElementById("voipUserName").value=e+"_"+ei(3333)}}function Hs(e,t){return Math.floor(Math.random()*(t-e))+e}function zs(e){var t=document.getElementById("streamingVideo"),n=Nt[e];console.log("videoPlay() :",e,n),t.setAttribute("src",n),t.setAttribute("type","video/mp4"),t.autoplay=!0,Ft(t,!0),t.load();var o=document.getElementById("videoPlayOverlay");o&&(o.style.display="none")}Ns();var Ws=0;function Vs(e){var t=document.getElementById("loadingVideoElement");if(t){var n=Nt[e];console.log("videoPlay() :",e,n),t.setAttribute("src",n),t.setAttribute("type","video/mp4"),Ft(t,!0),t.load();var o=document.getElementById("videoPlayOverlay");o&&(o.style.display="none")}}function qs(e){console.log("showPageWIthMsg: "+e),self.location="/error/"+btoa(e).toString("base64")}function $s(){null!=dn&&null!=bt&&null!=bt.EmulatedGeoLocationInfo&&""!=bt.EmulatedGeoLocationInfo.longitude&&""!=bt.EmulatedGeoLocationInfo.latitude&&(dn.latitude=bt.EmulatedGeoLocationInfo.latitude,dn.longitude=bt.EmulatedGeoLocationInfo.longitude,dn.city="emulated_"+dn.city,dn.country_name="emulated_"+dn.country_name)}var js=!1;function Js(e){if(!js){js=!0,null==bt&&null!=e.appconfig&&(bt=e.appconfig),function(){var e=sn("loadingVideoList");if(null!=e&&(Nt=e),""!=(a=sn("BGI"))&&(Nt.length>0||(Kt=a,N())),""!=(a=sn("BGI4Queue"))&&(Nt.length>0||(un=a,Ns())),""!=(a=sn("Logo"))&&null!=a&&"undefined"!=a)if(Nt.length>0);else{if(null!=(Qt=a)){var t=document.getElementById("prgoressScreenLogo1img"),n=document.getElementById("playBtnScreenLogo1img");t.src=Qt,n.src=Qt,t&&(t.style.display="block"),n&&(n.style.display="block")}var o=document.getElementById("prgoressScreenLogo1");null!=o&&(o.style.display="block")}""!=(a=sn("PlayBtn"))&&(on=a);let s=sn("TitleBarIcon");if(""!=s&&null!=s||(s="/assets/images/0.png"),""!=s&&null!=s){var i=document.createElement("link"),r=document.getElementById("TitleBarIcon");i.id="TitleBarIcon",i.rel="shortcut icon",i.href=s,r&&document.head.removeChild(r),document.head.appendChild(i)}var a;if(""!=(a=sn("LoadingImg"))&&null!=a)if(Nt.length>0);else{var l=a,c=document.querySelectorAll("[id='prgoressScreenLoadingimg']");if(c.length>0)for(let e=0;e<c.length;e++)c[e].src=l,c[e].style.display="block"}}(),"0"===bt.enableDraggableSettingsBtn||void 0===bt.enableDraggableSettingsBtn?window.enableDraggableSettingsBtn="0":"1"===bt.enableDraggableSettingsBtn&&(window.enableDraggableSettingsBtn="1");try{"darkTheme"===bt.StreamingUiTheme?sessionStorage.setItem("StreamingUiTheme","darkTheme"):sessionStorage.setItem("StreamingUiTheme","whiteTheme")}catch(e){console.error(e)}if(null!=bt.closeTabOnLosingVisbility&&1==bt.closeTabOnLosingVisbility&&document.addEventListener("visibilitychange",(function(){console.log(document.visibilityState),"hidden"===document.visibilityState&&(console.log("XZZZZZZ Page minimized"),console.log("XZZZZZZ 11  window.close() cmd getting called;"),mt())})),ze=bt.mustLogin,uo=null!=bt.UseMicrophone&&1==bt.UseMicrophone,null==bt.shouldMergeXirsysTurnServer||bt.shouldMergeXirsysTurnServer,null==bt.shouldMainatainUeWindowMode||bt.shouldMainatainUeWindowMode,1==bt.shouldBroswerInitiateOffer?Me=!0:0==bt.shouldBroswerInitiateOffer?Me=!1:null==bt.shouldBroswerInitiateOffer&&(Me=!0),null!=bt.urlExpiretime){if(new Date>new Date(bt.urlExpiretime))return void qs("Url Expired");if("undefined"!=typeof e3ds_controller&&null!=e3ds_controller.configurationToOverride){var t=e3ds_controller.configurationToOverride;console.log(" found e3ds_controller.configurationToOverride:"+JSON.stringify(t));const e=Object.keys(t);for(let o=0;o<e.length;o++){const s=e[o],i=t[s];var n=bt[s];bt[s]=i,console.log("newValue --\x3e "+i),console.log("updateAppConfig --\x3e "+s+" , "+n+" , "+bt[s])}}"function"==typeof onConfigAcquire&&onConfigAcquire(),e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onConfigAcquire&&e3ds_controller.callbacks.onConfigAcquire()}var o,s;Qn(),bt.serverOwner=De,bt.appName=Zt,bt.hostMeetingId=Xt,bt.GuestMeetingId=Yt,function(){if(pe){var e=pe;for(var[t,n]of e.entries()){var o=!1;for(const[e,s]of Object.entries(bt))if(e==t){o=!0,n!=s&&("cmdLineArgs"!=e&&"exeLunchArgs"!=e||1==bt.shouldAppendOveridingcmdLineArgs&&(console.log("cmdLineArgs/exeLunchArgs  urlParams:   "+n),console.log("cmdLineArgs/exeLunchArgs  configurationObj:   "+s),n=s+" "+n,console.log("cmdLineArgs/exeLunchArgs  new:   "+n)),1==bt.shouldAppendOveridingcmdLineArgs&&(console.log("overiridng config value. Old value   "+t+" :"+n),console.log(`new value ${e}: ${s}`)),bt[e]=n);break}o||"reloadOnSuccessfulStreaming"!=t||(bt.reloadOnSuccessfulStreaming=n)}}if(null!=(r=sn("isAdminDebugging"))&&(Oe=r),Jt(Oe),1==Oe){console.log("url: "+Mt),console.log("urlVersion: "+Lt),console.log("href_emulated: "+_e),console.log("pathname: "+Bt),console.log("urlParams: ",pe),console.log(" 1111111111111 isAdminDebugging > "+Oe),console.log(Ot),console.log("accessedTopLevelDomainName: "+_t),function(){for(var e=performance.getEntriesByType("navigation"),t=0;t<e.length;t++){var n=e[t];switch(console.log("Page loading type = "+n.type),n.type,n.type){case"navigate":console.log("Navigation started by clicking a link, entering the URL in the browser's address bar, form submission, or initializing through a script operation other than reload and back_forward as listed below.");break;case"reload":console.log(" Navigation is through the browser's reload operation or location.reload()");break;case"back_forward":console.log("Navigation is through the browser's history traversal operation");break;case"prerender":console.log(" Navigation is initiated by a prerender hint");break;default:console.log("p.type: unknown")}}}(),console.log("navigator.userAgent: "+navigator.userAgent),console.log("isIniFrame() : "+Qn());var s=document.referrer;console.log("referrer:"+s),console.log("XXXXX configurationObj : "+JSON.stringify(bt))}null!=(r=sn("showbrowserMouse"))&&(ln=r),console.log(" 1111111111111 showbrowserMouse > "+ln),$.enabled=bt.isAfkEnabled,$.warnTimeout=60*bt.afkWarnTimeout,$.closeTimeout=60*bt.afkCloseTimeout;var i=document.getElementById("screenshot-img");i&&(1!=bt.enableScreenshot||co()?(0==bt.enableScreenshot||co())&&(i.style.display="none"):i.style.display="block");var r,a=document.getElementById("forcePsVrModeBtn");if(a&&(1==bt.forcePsVrMode?a.style.display="block":0==bt.forcePsVrMode&&(a.style.display="none")),an=sn("useVOIP"),console.log(" 1111111111111 useVOIP > "+an),1==an){if(co()){if("function"!=typeof document.createElement("audio").setSinkId)return console.log("this ios setSinkId is not supported"),e3ds_alert("This IOS dont support setSinkId().Disabling VOIP ",{color:"Red"}),void(an=0);console.log("this ios  setSinkId is supported"),Ye("setSinkId is supported ")}var l=sn("voipRoomName");""!=l&&null!=l?(document.getElementById("room_number")&&(document.getElementById("room_number").value=De+":"+l),navigator.permissions||/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&window.e3ds_alert("IOS browsers might not support Eagle VoIP system",{timeout:5e3}),!document.getElementById("popupForVoipUsername")||Yt||null!=bt.passwordToStart&&""!=bt.passwordToStart||(document.getElementById("popupForVoipUsername").style.display="flex",document.getElementById("voipUserName").select())):(an=0,window.e3ds_alert("No Room Name found in Voip config. So VOIP Disabled"))}else if(Xt){const e=document.getElementById("meetingControlPanel");e&&(e.style.display="flex");const t=document.getElementById("meetingGuestListDiv"),n=document.getElementById("meetingListBtn");n&&(n.onclick=function(){t&&("none"===t.style.display?t.style.display="block":t.style.display="none")})}if(null!=(r=sn("useExtendedTyping"))&&(rn=r),console.log(" 1111111111111 useExtendedTyping > "+rn),ln=sn("showbrowserMouse"),xn(),null!=(r=sn("isSpectator"))&&(tn=r),null!=sn("GuestMeetingId")&&(tn=!0),console.log(" 1111111111111 isSpectator > "+tn),null!=(r=sn("forceMeetingMode"))&&(nn=r),2==nn?tn=!0:1==nn&&(tn=!1),console.log(" 1111111111111 forceMeetingMode > "+nn),console.log(" 2222222 forceMeetingMode--\x3e isSpectator > "+tn),kn=sn("MouseControlScheme"),console.log(" ***************1111111111111 MouseControlScheme:"+kn),null!=kn)switch(!0){case 0==kn:jo.controlScheme=$o.LockedMouse;break;case 1==kn:jo.controlScheme=$o.HoveringMouse;break;default:console.log(" ***************2222222222 nada:"+kn)}if(console.log(" ***************1111111111111 inputOptions.controlScheme:"+jo.controlScheme),null!=(r=sn("ShouldAutoPlay"))&&(wn=r),1==bt.reloadOnSuccessfulStreaming&&(wn=1),"undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),1==wn||Nt.length>0?Cn=!0:0==wn&&(Cn=!1),Qn(),console.log(" 1111111111111 ShouldAutoPlay > "+wn),console.log(" 1111111111111 flag4unMuteAudio4AutoPlay > "+Cn),null!=(r=sn("fakeMouseWithTouches"))&&(bn=r),console.log(" 1111111111111 fakeMouseWithTouches > "+bn),null!=(r=sn("suppressBrowserKeys"))&&(En=r),console.log(" 1111111111111 suppressBrowserKeys > "+En),0==bn?jo.fakeMouseWithTouches=!1:1==bn&&(jo.fakeMouseWithTouches=!0),0==En?jo.suppressBrowserKeys=!1:1==En&&(jo.suppressBrowserKeys=!0),r=sn("expireOn"),console.log(" 1111111111111 expireOn > "+Tn),r&&r.endsWith("minutes")){r=r.split("minutes")[0];var c=parseFloat(r);Number.isNaN(c)||(Tn=60*c*1e3)}else c=parseFloat(r),Number.isNaN(c)||(Tn=c);console.log(" 222222222 expireOn > "+Tn),Y()}(),$s(),window.addEventListener("resize",Ns,!0),console.log("5555555555555555555  load()"),Ns(),No(),null!=bt.passwordToStart&&"undefined"!=bt.passwordToStart&&""!=bt.passwordToStart?(console.log("streamingVideo: ",document.getElementById("streamingVideo")?.style?.display),console.log("videoPlayOverlay: ",document.getElementById("videoPlayOverlay")?.style?.display),document.getElementById("videoPlayOverlay").style.display="none",document.getElementById("streamingVideo")&&(document.getElementById("streamingVideo").style.display="none"),(o=document.getElementById("popupForPasswordToStart"))&&(o.style.display="flex"),s=60,passwordTimer=setInterval((function(){const e=document.getElementById("passwordCountDown");e&&(e.innerText=`(${s})`),s<=0&&(clearInterval(passwordTimer),Qn()?qs("You did not enter the correct password. Please refresh the page."):Qn()||qs("You did not enter the correct password. To start a new session please visit: "+location.href)),s--}),1e3)):((o=document.getElementById("popupForPasswordToStart"))&&(o.style.display="none"),null==Yt?Qs():null!=Yt&&Zs()),console.log("configurationObj for v5/v4/v6: "+JSON.stringify(bt,null,"\t"))}}function Qs(){(function(){if(console.log("videoToPlay: "+Nt),Nt.length>0){var e=document.getElementById("streamingVideo");if(e){Dt("Click in the video to enable audio",{color:"blue",timeout:1e4}),e.addEventListener("ended",(e=>{console.log("Video stopped either because 1) it was over, or 2) no further data is available."),function(){if(1==sn("DoRandomSuffleInLoadingVideoAssets")){var e=Hs(0,Nt.length);zs(Ws=e)}else++Ws==Nt.length?zs(Ws=0):zs(Ws)}()})),zs(0);var t=document.getElementById("settings");t&&(1==bt.shouldDisplayContorlBar||null==bt.shouldDisplayContorlBar?t.style.display="flex":t.style.display="none")}else{const e=document.createElement("video");e.playsInline=!0,e.autoplay=!0,e.id="loadingVideoElement",e.style.zIndex=99,e.style.background="black",document.getElementById("playerUI").appendChild(e),Dt("Click in the video to enable audio",{color:"blue",timeout:1e4}),e.onclick=function(){Ft(e,!1)},e.addEventListener("ended",(e=>{console.log("Video stopped either because 1) it was over, or 2) no further data is available."),function(){if(1==sn("DoRandomSuffleInLoadingVideoAssets")){var e=Hs(0,Nt.length);Vs(Ws=e)}else++Ws==Nt.length?Vs(Ws=0):Vs(Ws)}()})),Vs(0)}}})(),function(){Fs=!0,g({type:"stage1_inqueued"});var e=void 0;null!=bt?((e={}).type="takeIdentity",e.clientType="player",e.configName=en,e.configurationObj=bt,e.serverOwner=bt.owner,e.appName=bt.appName,e.userAgent=navigator.userAgent,e.GuestMeetingId=Yt,e.url=window.location.href,e.href_emulated=window.location.href_emulated,e.userDeviceInfo=Nn,e.clientInfo=dn,e.version_fe_lib=Rt):e={type:"takeIdentity",clientType:"player",configurationObj:bt,userAgent:navigator.userAgent,serverOwner:window.location.pathname.substring(1),isIniFrame:Qn(),url:window.location.href,href_emulated:_e,appName:sn("appName"),userDeviceInfo:Nn,clientInfo:dn},console.log("77777 ws4queue.send(): "+JSON.stringify(e)),ws4queue.send(JSON.stringify(e))}()}function Ks(e){return Math.ceil(e/1073741824)}function Xs(){"use strict";if(zt){if(!gn)if(document.getElementById("InQueue_Text")&&Ys("Requesting Available Slot",""),window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket){var e,t=_e.replace("http://","ws://").replace("https://","wss://");addToTimeRecords("queue_WebSocketConnectionCalledAt",getCurrentDate()),ws4queue=new WebSocket(t),ws4queue.onerror=function(e){console.error(`ws4queue error: ${JSON.stringify(e)}`)},ws4queue.onclose=function(t){clearInterval(e),console.warn(`ws4queue closed: ${JSON.stringify(t.code)} - ${t.reason}`),"kicked"!=t.reason?4e3!=t.code&&hn&&!Gt&&(_s+=1,console.log("ws4queueReconnec() reconnectAttempt:"+_s),ws4queue=void 0,js=!1,setTimeout(Xs(),4e3)):window.location="/assets/pages/kickedOut.htm"},ws4queue.onopen=function(t){var n;addToTimeRecords("queue_WebSocketConnectionEstablishedAt",getCurrentDate()),e=setInterval((function(){ws4queue.readyState==WebSocket.CONNECTING||ws4queue.readyState==WebSocket.CLOSING||ws4queue.readyState==WebSocket.CLOSED||ws4queue.send(JSON.stringify({type:"pingQueue"}))}),1e3),"v5"==Lt||"v6"==Lt?null!=bt?Js():null==bt&&null==Yt&&(n=JSON.stringify({type:"getAppCOnfig",GuestMeetingId:Yt,appName:Zt,owner:De,uInfo:Ne,configName:en,version:ct,configurationObj:bt,urlVersion:Lt}),console.log(" ws.send(): "+n),Ut(n,ws4queue)):Js()},ws4queue.onmessage=function(e){var t=JSON.parse(e.data);if("disconnectAndretryIn"===t.type){const e=document.getElementById("videoPlayOverlay");e&&(e.style.display="flex");var n=document.getElementById("InQueue_Text");n&&(n.innerHTML="CCU Limit Reached. Trying Again in 10 sec"),gn=!1,hn=!1,ws4queue.close(4e3,"disconnectAndretryIn"),clearInterval(Os),Os=setInterval((function(){window.location.reload()}),1e4)}else"ShowThisHtmlPage"===t.type?(gn=!0,ws4queue.close(4e3,"ShowThisHtmlPage"),self.location=t.htmlPage):"AppCOnfig"===t.type||"CallOnGettingAppCOnfig"===t.type?Js(t):"TakeuserDeviceInfo"===t.type?("Oculus Browser"==(Nn=t.userDeviceInfo).client.name&&(Nn.device.type="hmd"),fn=t.matchmakerInfo,He=null!=fn.skipReporting&&fn.skipReporting,async function(){var e=new XMLHttpRequest;e.withCredentials=!0,e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE&&200===e.status){var t=JSON.parse(e.responseText);"Signed"===t?.message?(Ge=t.data,console.log("loggedInUserData: "+JSON.stringify(Ge))):"Unsigned"===t?.message&&console.warn("not signed in:",e.statusText),1==ze&&(window.location.href=o)}};const t=new URL(window.location.href).hostname.split(".").slice(-2).join(".");console.log(t);var n=void 0,o=void 0;t==fn.topLevelDomainName?(n="https://auth-restful."+fn.topLevelDomainName+"/api/v2/session/jwt",o="https://auth-fe."+fn.topLevelDomainName+"/signin?redirect="+window.location.href):"eaglepixelstreaming.com"==t?(n="https://auth-restful.eaglepixelstreaming.com/api/v2/session/jwt",o="https://asif-account.eaglepixelstreaming.com/signin?redirect="+window.location.href):"eagle3dstreaming.com"==t&&(n="https://auth-restful.eagle3dstreaming.com/api/v2/session/jwt",o="https://auth-fe.eagle3dstreaming.com/signin?redirect="+window.location.href),console.log("e3dsAuthUrl:"+n),console.log("e3dsLoginUrl:"+o),e.open("GET",n),e.onerror=function(){console.log("collectLoginInfo()  xmlHttp.onerror network errors .")};try{e.send()}catch(e){console.error(e)}}(),console.log(`userDeviceInfo : ${JSON.stringify(Nn)}`),console.log(" 1111111111111 useExtendedTyping > "+rn)):"doApprequest"===t.type?Zs():"uInfo"===t.type?Ne=t.uInfo:"ConnectPlayerTo"===t.type?(addToTimeRecords("connectPlayerToReceivedAt",getCurrentDate()),function(e){Fe=e.cirrusServer;const t=e.cirrusServer.elInfo;ke=e?.cirrusServer?.elInfo,Se&&g({type:"streamerName",value:ke.computerName}),As=t,Gt=!0,at=e.appDownloadInfo,(lt=e.streamTestResult)&&(lt.timeAppTookToStream&&(ot=Math.ceil(60*lt.timeAppTookToStream)),1==lt.successfulStream||0==lt.successfulStream&&0==lt.ue4ExeInfo.PsPluginPixelStreamingDireExist&&0==lt.ue4ExeInfo.PsPluginEntryInManifestFile&&Dt("Our record indicates Your this app verison dont have pixel streaming plugin enabled.So it cant stream  ",{color:"Red"})),g({type:"stage2_deQueued"}),console.log("222222 <- SS_Queue: msg: "+JSON.stringify(e)),Fs=!1,zt=!1,ws4queue&&ws4queue.close(4e3,"preConnectssTasks"),console.log("extractValueFromUrl('videoToPlay') :"+Nt),Nt.length<=0&&Rs(1);var n="wss://"+Fe.domain+"/ws/"+Fe.httpsPort+"/";window.ss_url=n,window.fsgsg?window.fsgsg():ce(Fe)}(t)):"redirectTo11"===t.type?(g({type:"stage2_deQueued"}),console.log("222222 <- SS_Queue: msg.data.url: "+t.url),console.log("222222 <- SS_Queue: msg: "+JSON.stringify(t)),ce(t.cirrusServer)):"UpdatePlayerWatingRank"===t.type?(null==timeRecords.firstQueueNumberReceivedAt&&addToTimeRecords("firstQueueNumberReceivedAt",getCurrentDate()),console.log("1111111111111111111111 <- SS_Queue: UpdatePlayerWatingRank: "+t.Postion),Nt.length<=0&&Ys("In Queue",t.Postion)):"ShowAnimatedInfo"===t.type?ls(t.data.info):"showTextOverlay"===t.type?(console.log("showTextOverlay: "+t.data.info),Dt(t.data.info,{color:"blue"})):"printInConsoleOnly"===t.type?console.log("printInConsoleOnly: "+t.data.info):"ShowInfoInLines"===t.type?(Dt(t.data.info,{color:"blue"}),console.log("ShowInfoInLines: "+t.data.info)):"ShowE3ds_alert"===t.type&&(Dt(t.data.info,{color:"blue"}),console.log("ShowE3ds_alert: "+t.data.info))}}else alert("Your browser doesn't support WebSocket")}else console.log("onTrailCheckPassed() returninig bcz shouldTryToReconnectQueue: "+zt)}function Ys(e,t,n){var o=document.getElementById("queueNumberText"),s="";""!==n&&void 0!==n&&(s=s+'<nav > <a data-label="global-footer" href='+n+">upload</a> </nav>");var i=document.getElementById("InQueue_Text");i&&e&&(i.innerHTML=e),o&&(o.innerHTML=t),g({type:"QueueNumberUpdated",queuePosition:t})}function ee(){if(te){if(pn)document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),pn=!1;else{let e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),screen.orientation.lock("landscape"),pn=!0}clearInterval(Dn),clearTimeout(Un),te=!1}}function Zs(){if(ws4queue&&ws4queue.readyState===Bn){if(null==dn)return console.log("trying to doApprequest but clientInfo undefined"),void oi();console.log("doing doApprequest");var e=void 0,t="appRequest";null!=Yt&&(t="RequestToJoinMeeting"),null!=bt?e={type:t,clientInfo:dn,href_emulated:_e,href:window.location.href,configName:en,urlVersion:Lt,GuestMeetingId:Yt,accessedTopLevelDomainName:_t,url_searchParams:String(pe),configurationStr:Mt[2],userDeviceInfo:Nn,version:ct,uInfo:Ne,configurationObj:bt,configuration:bt,expireOn:bt.expireOn,MouseControlScheme:bt.MouseControlScheme,showWebrtcCtrlMenu:bt.showWebrtcCtrlMenu,showPsControl:bt.showPsControl,afkWarnTimeout:bt.afkWarnTimeout,afkCloseTimeout:bt.afkCloseTimeout,isAfkEnabled:bt.isAfkEnabled,enableScreenshot:bt.enableScreenshot,useExtendedTyping:bt.useExtendedTyping,showbrowserMouse:bt.showbrowserMouse,isAdminDebugging:bt.isAdminDebugging,appName:bt.appName,owner:De,cmdLineArgs:bt.exeLunchArgs,exeLunchArgs:bt.exeLunchArgs,hostMeetingId:bt.hostMeetingId,GuestMeetingId:Yt,maxUserLimit:bt.maxUserLimit,custom_html:bt.custom_html}:(_e.replace(location.origin+"/","").replace(location.search,""),e={type:"appRequest",appName:sn("appName"),owner:De,configName:en,clientInfo:dn,cmdLineArgs:sn("cmdLineArgs"),hostMeetingId:sn("hostMeetingId"),GuestMeetingId:Yt,custom_html:sn("custom_html"),onDemand:sn("onDemand"),onDemandRegion:sn("onDemandRegion"),maxUserLimit:sn("maxUserLimit"),accessedTopLevelDomainName:_t,url_searchParams:String(pe)});var n=JSON.stringify(e);console.log("--------------- ws4queue.send Json: "+n),ws4queue.send(n)}else console.log("ws4queue not ready")}function I(e){if(null==dn||"undefined"==dn){var t=JSON.parse(e);Qe=t.ip_address,ti(t)}}function ei(e){return Math.floor(Math.random()*e)}function ti(e){null==e.latitude&&(e.latitude="38.88",console.warn("latitude undefined .so setting latitude : "+e.latitude)),null==e.longitude&&(e.longitude="-120.88",console.warn("longitude undefined .so setting longitude : "+e.longitude)),dn={ip:e.ip,city:e.city,region:e.region_name,country_name:e.country,latitude:e.latitude,longitude:e.longitude,fullInfo:e},$s(),dn.latitude,dn.longitude,JSON.stringify({type:"xirsysResponse",responseText:JSON.stringify({})}),e.city,ei(3333),Gs(),ws4queue&&ws4queue.readyState===Bn&&Zs()}function ni(){ti({ip:"ahsanHackOnUnabletoGetIpInfo",city:"ahsanHackOnUnabletoGetIpInfo",region:"ahsanHackOnUnabletoGetIpInfo",country_name:"ahsanHackOnUnabletoGetIpInfo",latitude:void 0,longitude:void 0})}function oi(e=0){if(void 0!==dn)return;const t=new XMLHttpRequest;t.onreadystatechange=function(){return 422===t.status?(console.log("collectLocationInfo() received 422 status code. Returning default clientInfo object."),void ni()):429===t.status?(console.log("collectLocationInfo() received 429 status code. Retrying after 2000ms."),null!=P&&clearTimeout(P),void(P=setTimeout(oi,2e3,e))):void(""!==t.responseText&&void 0!==t.responseText&&200===t.status?(clearTimeout(P),I(t.responseText)):e<20?(console.log("CLI() retrying after 2000ms."),null!=P&&clearTimeout(P),P=setTimeout(oi,2e3,e+1)):(console.log("collectLocationInfo() maximum retries exceeded."),ni()))},t.onerror=function(){console.log("collectLocationInfo()  xmlHttp.onerror ."),ni()},t.open("GET","https://ipgeolocation.abstractapi.com/v1/?api_key=667cb95019b04ea5beaa7c935dc5ce37",!0),t.send(null)}te=!1,Number.prototype.clamp=function(e,t){return Math.min(Math.max(this,e),t)},P=void 0,x=0,oi(),document.addEventListener("DOMContentLoaded",(function(){var e=document.querySelector(".slider-toggler"),t=document.querySelector(".slider-content"),n=document.querySelector(".toggle-img-collapsed"),o=document.querySelector(".toggle-img-expanded");e&&(e.addEventListener("click",(function(){"0px"===t.style.width||""===t.style.width?t.style.width="auto":t.style.width="0px",n.style.display="none"===n.style.display?"block":"none",o.style.display="none"===o.style.display?"block":"none"})),e.click())}));const si=()=>{e3ds_controller,e3ds_controller.main()};function ii(e){if("config"===e.type)null==qt&&null!=e.ue4ExeInfo&&(qt=e.ue4ExeInfo,vt=new Date,addToTimeRecords("time_ue4ExeInfoArrivedAt",getCurrentDate()));else if("playerCount"===e.type)zo(e.count-1);else if("muteUser"===e.type){const t=document.getElementById("button-microphone");t&&t.src.includes("voipmicOn")&&e.id==window.playerId&&t.click()}else if("offer"===e.type)addToTimeRecords("playerReceivedOfferOfAppAt",getCurrentDate()),console.log(" <- SS arvind offer --\x3e  msg.sdp: %o",e.sdp);else if("answer"===e.type)addToTimeRecords("playerReceivedAnswerOfAppAt",getCurrentDate()),console.log(" answer : "+JSON.stringify(e));else if("gettings"===e.type)console.log("message type:gettings:  "+JSON.stringify(e)),console.log("message type:gettings msg.data:  "+JSON.stringify(e.data));else if("addInExistingGuestList"===e.type)(n=document.getElementById("Guest-filter"))&&e.guestList.forEach((function(e){var t=document.createElement("option");t.text=t.value=e,n.add(t,n.length-1)}));else if("GuestJoined"===e.type){if(0==an){const t=document.getElementById("meetingGuestList");if(t){let n=document.createElement("li");n.id=`guestRow-${e.guestPlayerId}`,n.className="list-group-item",n.innerHTML=`<span>${e.guestPlayerId}</span> \n\t\t\t\t<div>\n\t\t\t\t<button title="Give Control" id="toggleControlForGuest-${e.guestPlayerId}"> <img src="https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/UIimages/controllOff.svg"/> </button> \n\t\t\t\t<button title="Kick Guest" id="kickGuest-${e.guestPlayerId}"> <img src="https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/UIimages/kick.svg"/> </button> \n\t\t\t\t</div>`,t.appendChild(n);const o=document.getElementById(`toggleControlForGuest-${e.guestPlayerId}`);o&&(o.onclick=function(){const t=o.getElementsByTagName("img")[0];let n="";t.src.includes("controllOff")?(n="on",t.src="https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/UIimages/controllOn.svg",o.title="Remove Control"):(n="off",t.src="https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/UIimages/controllOff.svg",o.title="Give Control"),window.dispatchToggleControl(n,e.guestPlayerId)});const s=document.getElementById(`kickGuest-${e.guestPlayerId}`);s&&(s.onclick=function(){In&&In.send(JSON.stringify({type:"KickSelctedGuest",playerIDToKick:e.guestPlayerId})),"function"==typeof window?.pixelStreaming?.webSocketController?.webSocket?.send&&window.pixelStreaming.webSocketController.webSocket.send(JSON.stringify({type:"KickSelctedGuest",playerIDToKick:e.guestPlayerId}))})}}if(n=document.getElementById("Guest-filter")){var t=document.createElement("option");t.text=t.value=e.guestPlayerId,n.add(t,n.length-1)}}else if("GuestLeft"===e.type){const t=document.getElementById(`guestRow-${e.guestPlayerId}`);var n;if(t&&t.remove(),n=document.getElementById("Guest-filter"))for(var o=0;o<n.length;o++)n.options[o].value==e.guestPlayerId&&n.remove(o)}else if("updateGuestName"==e.type){const t=document.getElementById(`guestRow-${e.guestPlayerId}`);t&&(t.getElementsByTagName("span")[0].innerText=e.guestName)}else if("takeChatGptAnswer"===e.type)b({ChatGptQuestion:e.ChatGptQuestion,ChatGptAnswer:e.ChatGptAnswer});else if("takeGameCustomizationData"===e.type)b(e);else if("takeUploadUrl"===e.type)Bs(e.uploadURL,e.input.content_type,e.input.file_name,e.input.pathToSaveFile);else if("handleshuttingDownVM"===e.type)Tt=!0,oe(s="shutting down this VM .So redirecting you in 3 sec to re-establish connection",5e3);else if("handleElDisconnected"===e.type){Tt=!0;var s="EL crashed: "+e.errormsg;if(Rn&&Rn.pcClient){const e=Rn.pcClient.iceConnectionState;if("connected"===e){var i="handleElDisconnected() EL crashed but Video stream is streaming. so returning";return console.log(i),void Ye(i,-4089034249)}"failed"!==e&&"disconnected"!==e&&"closed"!==e||(s=s+" ice connectionState: "+e)}s+=" .So redirecting you in 3 sec to re-establish connection",console.log(s),oe(s,5e3,!0,-972942690,"handleElDisconnected")}else if("handleStreamerDisconnected"===e.type){let e=gt(getCurrentDate(),timeRecords.datachannelconnectedAt);if(1==bt.injectStreamFromEditor){let t=`Remote Editor stream lasted for ${e} seconds`;return console.log(`postToTelegram: ${t}`),nt(t,-4767276367),void oe("Streamer Disconnected",3e3,!1)}Tt=!0,oe(s=`Stream duration: ${e||"undefined"} seconds. Streamer Disconnected.So redirecting you in 3 sec to re-establish connection`,5e3,!0,e?-0xe95c7c2279:-828953428,"StreamerDisconnected")}else if("reload"===e.type)location.reload();else if("ConfigUpdateOnClientSide"===e.type)window.location.href=window.location.href;else if("redirectTo"===e.type)console.log("222222 <- SS: msg.data.url: "+e.url),window.location.replace(e.url);else if("jsonMessageForUE4"===e.type)console.log("jsonMessageForUE4: "+JSON.stringify(e.jsonObj)),b(e.jsonObj);else if("ShowThisHtmlPage"===e.type)gn=!0,In&&In.close(),self.location=e.htmlPage;else if("setGuestId"===e.type)document.getElementById("GuestTitle")&&(document.getElementById("GuestTitle").innerHTML=e.guestId);else if("sendtoUnrealinAppPurchaseResult"===e.type)console.log("222222 <- SS: sendtoUnrealinAppPurchaseResult msg.data.info: "+e.data.purchasResult),b({purchasResult:e.data.purchasResult});else if("ShowE3ds_alert"===e.type){console.log("222222 <- SS: ShowE3ds_alert msg.data.info: "+e.data.info);var r={};null!=e.data.color&&(r.color=e.data.color),null!=e.data.timeout&&(r.timeout=e.data.timeout),Dt(e.data.info,r)}else if("includeInTimeRecords"===e.type){var a=e.timeRecords_ssSide;for(const e in a)if(timeRecords.hasOwnProperty(e)){var l=!0;if(Object.keys(timeRecords).forEach((t=>{t.startsWith(e)&&(console.log(t),timeRecords[t]===a[e])&&(l=!1)})),l){let t=1,n=e+t;for(;timeRecords.hasOwnProperty(n);)t++,n=e+t;addToTimeRecords(n,a[e])}}else addToTimeRecords(e,a[e]);console.log(timeRecords)}else if("UE5Editorlunched"===e.type){console.log(JSON.stringify(e));var c="http://"+e.url+":"+e.port;console.log("UE5Editorlunched url "+c),location.assign(c)}else if("UE4LogFromEL"===e.type)console.info(e.data.logLine);else if("showPageWIthMsg"===e.type)qs(e.data.info);else if("ShowInfoToInjectStreamFromEditor"===e.type){var d="ws://"+Fe.domain+":"+Fe.ue4StreamerToSS;console.log("injectStreamFromEditorInfo: "+d),obj=document.getElementById("loaderStep1"),obj&&(obj.style.display="none"),document.getElementById("Info4injectStreamFromEditor").value=d;var u=document.getElementById("popupForinjectStreamFromEditorInfo");u&&(u.style.display="flex")}else if("ShowInfo"===e.type){if(console.log("222222 <- SS: msg.data.info: "+e.data.info),r={},null!=e.data.color&&(r.color=e.data.color),null!=e.data.timeout&&(r.timeout=e.data.timeout),e.data.info.startsWith("showPageWIthMsg:"))return void qs(e.data.info.replace("showPageWIthMsg:",""));if(e.data.info.startsWith("EL Error:")){let t=e.data.info.replace("EL Error:","");console.error(JSON.stringify(e.data)),console.error(t),t.startsWith("Upload system having critical Isssue.")&&nt(t,-977631986),t.startsWith("No exe found in any subdirectories")&&qs("Invalid App. No exe found in any subdirectories "),Dt(t,r)}try{var h=JSON.parse(e.data.info);console.log("33333 <- SS: msg.data.info: "+JSON.stringify(h));var m=document.getElementById("Title_AcquiringProgresss"),p=document.getElementById("AcquiringProgress"),f=document.getElementById("Title_PreparingProgress"),v=document.getElementById("PreparingProgress"),y=document.getElementById("LunchingProgress"),S=document.getElementById("Title_LunchingProgress");if("AppAcquiringData"==h.datatype){null==timeRecords.AppAcquiringStartedAt&&(ge=!0,addToTimeRecords("AppAcquiringStartedAt",getCurrentDate()),nt(`App acquiring started at ${getCurrentDate()}\n`,-0xe96ac01e27)),console.log("5555 <- AppAcquiringData AcquiringProgress: "+h.data.percent);var C=document.getElementById("videoPlayOverlay");if(C&&(C.style.display="none"),e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onReceivingAppAcquiringProgress&&e3ds_controller.callbacks.onReceivingAppAcquiringProgress(h.data.percent),m.style.display="block",window.isAppPreparationprocessGoingOn=!0,it=new Date,null!==p){p.value=100*h.data.percent;var w={type:"stage3_1_AppAcquiringProgress",percent:h.data.percent};g(w),y.style.display="none",S.style.display="none",p.style.display="block",p.value>=100&&(null==timeRecords.AppAcquiringFinishedAt&&addToTimeRecords("AppAcquiringFinishedAt",getCurrentDate()),f.style.display="block",null!==v&&(v.value=0,v.style.display="block"))}}else"AppPreparationData"==h.datatype&&(null==timeRecords.AppPreparationStartedAt&&addToTimeRecords("AppPreparationStartedAt",getCurrentDate()),window.isAppPreparationprocessGoingOn=!0,it=new Date,e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onReceivingAppPreparationProgress&&e3ds_controller.callbacks.onReceivingAppPreparationProgress(h.data.percent),w={type:"stage3_2_AppPreparationProgress",percent:h.data.percent},g(w),h.data.percent>=100&&(null==timeRecords.AppPreparationFinishedAt&&addToTimeRecords("AppPreparationFinishedAt",getCurrentDate()),window.isAppPreparationprocessGoingOn=!1,Y(),Q()),null!==v&&(v.value=h.data.percent,v.style.display="block",f.style.display="block",y.style.display="none",S.style.display="none",v.value>=100&&(S.style.display="block",null!==y&&(y.value=0,y.style.display="block"))))}catch(e){}}else if("TakeuserDeviceInfo"===e.type)"Oculus Browser"==(Nn=e.userDeviceInfo).client.name&&(Nn.device.type="hmd"),console.log(`userDeviceInfo : ${JSON.stringify(Nn)}`),console.log(`elInfo : ${JSON.stringify(e.elInfo)}`),console.log(" 1111111111111 useExtendedTyping > "+rn);else if("OnLocalFileUploadingFinished"===e.type){var E=e.data.objFromUE4;if(null!=E)switch(E.cmd){case"downloadLocalFileOnUserDevice":window.open(e.data.Location,"_blank");break;case"getDownloadUrlOfLocalFile":b({type:"takeDownloadUrlOfLocalFile",downloadURL:e.data.Location,localFile:E.fileToDownload})}}else if("OnFinishingOfClientFileDownladOnEL"===e.type){let t={cmd:"onUploadedFileAvailable",filename:e.data.filename};b(t),console.log(t)}else"ue4Version"===e.type?(Vt=e.currentAppsUE4Version,Se&&g({type:"ueVersion",value:Vt?.versionString})):"PsPluginPixelStreamingDireExist"===e.type?(console.log("****PsPluginPixelStreamingDireExist : "+e.PsPluginPixelStreamingDireExist),We=e.PsPluginPixelStreamingDireExist):"PsPluginEntryInManifestFile"===e.type?(console.log("****PsPluginEntryInManifestFile : "+e.PsPluginEntryInManifestFile),Ve=e.PsPluginEntryInManifestFile):"ue4ExeInfoMsg"===e.type?(qt=e.ue4ExeInfo,Vt=qt.versionString,vt=new Date,console.log("ue4AppExe path:"+qt.ue4AppExe),se(2)):"iceCandidate"===e.type?(Rn&&Rn.handleCandidateFromServer(e.candidate),se(5)):"DisableControlFromOthers"===e.type?(tn=!0,Dt("Your control has been removed by the host",{timeout:3e3})):"AllAssetsUrls"===e.type||"AllVideoAssetsUrls"===e.type?ue(e):"All2dAssetsUrls"===e.type?de(e):"sendplayerType"===e.type?null!=e.playerId&&(ye=e.playerId,window.playerId=e.playerId,document.getElementById("popupForVoipUsername")&&Yt)&&(1==an?(document.getElementById("popupForVoipUsername").style.display="flex",document.getElementById("voipUserName").select()):(document.getElementById("joinBtn").innerText="Join Meeting",document.getElementById("popupForVoipUsername").style.display="flex",document.getElementById("voipUserName").select(),document.getElementById("popupForVoipUsernameForm").onsubmit=function(e){e.preventDefault();const t=document.getElementById("voipUserName").value;In&&In.send(JSON.stringify({type:"updateGuestName",guestPlayerId:ye,guestName:t})),"function"==typeof window?.pixelStreaming?.webSocketController?.webSocket?.send&&window.pixelStreaming.webSocketController.webSocket.send(JSON.stringify({type:"updateGuestName",guestPlayerId:ye,guestName:t})),document.getElementById("popupForVoipUsername").style.display="none"})):"GiveControlToThisGuest"===e.type?(tn=!1,Dt("You have been given control by the host",{timeout:3e3})):console.warn(`invalid SS message type: ${e.type}`)}var ri;window.onload111=function(){if(window.addEventListener("touchend",Z),window.addEventListener("mouseup",Z),"undefined"!=typeof e3ds_controller)si();else{console.error("e3ds_controller not found");let e=setInterval((()=>{"undefined"!=typeof e3ds_controller?(clearInterval(e),si()):console.error("e3ds_controller not found")}),100)}},window.onload=async function(){if(addToTimeRecords("windowOnloadExecutedAt",getCurrentDate()),window.addEventListener("touchend",Z),window.addEventListener("mouseup",Z),"undefined"!=typeof e3ds_controller)si();else{console.error("e3ds_controller not found");let e=setInterval((()=>{"undefined"!=typeof e3ds_controller?(clearInterval(e),si()):console.error("e3ds_controller not found")}),100)}},ri=()=>(()=>{"use strict";var e,t,n,o={826:e=>{const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const o=e.type;return t.push("typ"),t.push(o),"host"!==o&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const o=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<o.length;e++)n=o[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const o=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?o.push(t+"="+e.parameters[t]):o.push(t)})),t+="a=fmtp:"+n+" "+o.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},o=e.indexOf(":",t);return o>-1?(n.attribute=e.substring(t+1,o),n.value=e.substring(o+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const o=t.matchPrefix(e+n,"a=ice-ufrag:")[0],s=t.matchPrefix(e+n,"a=ice-pwd:")[0];return o&&s?{usernameFragment:o.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=t.splitLines(e)[0].split(" ");for(let s=3;s<o.length;s++){const i=o[s],r=t.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(r){const o=t.parseRtpMap(r),s=t.matchPrefix(e,"a=fmtp:"+i+" ");switch(o.parameters=s.length?t.parseFmtp(s[0]):{},o.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(t.parseRtcpFb),n.codecs.push(o),o.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(o.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const s=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{s.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let o="";o+="m="+e+" ",o+=n.codecs.length>0?"9":"0",o+=" UDP/TLS/RTP/SAVPF ",o+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",o+="c=IN IP4 0.0.0.0\r\n",o+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{o+=t.writeRtpMap(e),o+=t.writeFmtp(e),o+=t.writeRtcpFb(e)}));let s=0;return n.codecs.forEach((e=>{e.maxptime>s&&(s=e.maxptime)})),s>0&&(o+="a=maxptime:"+s+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{o+=t.writeExtmap(e)})),o},t.parseRtpEncodingParameters=function(e){const n=[],o=t.parseRtpParameters(e),s=-1!==o.fecMechanisms.indexOf("RED"),i=-1!==o.fecMechanisms.indexOf("ULPFEC"),r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),a=r.length>0&&r[0].ssrc;let l;const c=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));c.length>0&&c[0].length>1&&c[0][0]===a&&(l=c[0][1]),o.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&l&&(t.rtx={ssrc:l}),n.push(t),s&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:i?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&a&&n.push({ssrc:a});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=d}))),n},t.parseRtcpParameters=function(e){const n={},o=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];o&&(n.cname=o.value,n.ssrc=o.ssrc);const s=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=s.length>0,n.compound=0===s.length;const i=t.matchPrefix(e,"a=rtcp-mux");return n.mux=i.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const o=t.matchPrefix(e,"a=msid:");if(1===o.length)return n=o[0].substring(7).split(" "),{stream:n[0],track:n[1]};const s=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return s.length>0?(n=s[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),o=t.matchPrefix(e,"a=max-message-size:");let s;o.length>0&&(s=parseInt(o[0].substring(19),10)),isNaN(s)&&(s=65536);const i=t.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substring(12),10),protocol:n.fmt,maxMessageSize:s};const r=t.matchPrefix(e,"a=sctpmap:");if(r.length>0){const e=r[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:s}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,o){let s;const i=void 0!==n?n:2;return s=e||t.generateSessionId(),"v=0\r\no="+(o||"thisisadapterortc")+" "+s+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const o=t.splitLines(e);for(let e=0;e<o.length;e++)switch(o[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[e].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t}},s={},i=function e(t){var n=s[t];if(void 0!==n)return n.exports;var i=s[t]={exports:{}};return o[t](i,i.exports,e),i.exports}(826),r={d:(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},a={};r.d(a,{D6:()=>Le,Kr:()=>D,mC:()=>O,jr:()=>F,S_:()=>_,Ff:()=>qe,Hp:()=>$t,yC:()=>Ue,TS:()=>Re,Bs:()=>Me,CE:()=>$,EQ:()=>j,Fh:()=>ce,L7:()=>de,ys:()=>q,Lm:()=>Fe,Cx:()=>nt,bk:()=>Ce,iI:()=>we,RW:()=>oe,$o:()=>Be,IR:()=>Ae,C9:()=>et,EG:()=>ue,Cc:()=>le,ZS:()=>st,vx:()=>ne,Vy:()=>l,Tt:()=>Xe,e4:()=>C,EW:()=>c,DQ:()=>w,k$:()=>Ee,mY:()=>Pe,D4:()=>Ge,z3:()=>qt,vL:()=>Z,Lz:()=>ee,FJ:()=>te,d2:()=>ve,Eo:()=>R,kR:()=>M,UW:()=>L,GZ:()=>A,cZ:()=>B,Si:()=>he,ty:()=>T,d_:()=>ie,Bg:()=>Q,y6:()=>K,iu:()=>X,oK:()=>Y,ie:()=>ae,jG:()=>re,gw:()=>ke,rx:()=>At,x1:()=>U,Qy:()=>J,bJ:()=>ot,nV:()=>G,d4:()=>z,Ys:()=>H,Nu:()=>V,tv:()=>W,n7:()=>Ft,xV:()=>N,KB:()=>ye,eU:()=>k,R3:()=>Gt,qM:()=>fe,HH:()=>ge,ev:()=>me});class l{static GetStackTrace(){const e=new Error;let t="No Stack Available for this browser";return e.stack&&(t=e.stack.toString().replace(/Error/g,"")),t}static SetLoggerVerbosity(e){null!=this.verboseLogLevel&&(this.verboseLogLevel=e)}static Log(e,t,n){if(n>this.verboseLogLevel)return;const o=`Level: Log\nMsg: ${t}\nCaller: ${e}`;console.log(o)}static Info(e,t,n){if(n>this.verboseLogLevel)return;const o=`Level: Info\nMsg: ${t}`;console.info(o)}static Error(e,t){const n=`Level: Error\nMsg: ${t}\nCaller: ${e}`;console.error(n)}static Warning(e,t){const n=`Level: Warning\nCaller: ${e}\nMsg: ${t}`;console.warn(n)}}l.verboseLogLevel=5,(n=e||(e={})).LIST_STREAMERS="listStreamers",n.SUBSCRIBE="subscribe",n.UNSUBSCRIBE="unsubscribe",n.ICE_CANDIDATE="iceCandidate",n.OFFER="offer",n.ANSWER="answer",n.DATACHANNELREQUEST="dataChannelRequest",n.SFURECVDATACHANNELREADY="peerDataChannelsReady",n.PONG="pong";class c{sendFilter(e,t){return t}payload(){return l.Log(l.GetStackTrace(),"Sending => \n"+JSON.stringify(this,this.sendFilter,4),6),JSON.stringify(this,this.sendFilter)}}class d extends c{constructor(){super(),this.type=e.LIST_STREAMERS}}class u extends c{constructor(t){super(),this.type=e.SUBSCRIBE,this.streamerId=t}}class h extends c{constructor(){super(),this.type=e.UNSUBSCRIBE}}class m extends c{constructor(t){super(),this.type=e.PONG,this.time=t}}class p extends c{constructor(t,n){super(),this.type=e.OFFER,this.minBitrate=0,this.maxBitrate=0,t&&(this.type=t.type,this.sdp=t.sdp,this.minBitrate=n.minBitrateBps,this.maxBitrate=n.maxBitrateBps)}sendFilter(e,t){if("minBitrate"!=e&&"maxBitrate"!=e||!(t<=0))return t}}class f extends c{constructor(t,n){super(),this.type=e.ANSWER,this.minBitrate=0,this.maxBitrate=0,t&&(this.type=t.type,this.sdp=t.sdp,this.minBitrate=n.minBitrateBps,this.maxBitrate=n.maxBitrateBps)}sendFilter(e,t){if("minBitrate"!=e&&"maxBitrate"!=e||!(t<=0))return t}}class v extends c{constructor(){super(),this.type=e.DATACHANNELREQUEST}}class y extends c{constructor(){super(),this.type=e.SFURECVDATACHANNELREADY}}class S{constructor(t){this.type=e.ICE_CANDIDATE,this.candidate=t}payload(){return l.Log(l.GetStackTrace(),"Sending => \n"+JSON.stringify(this,void 0,4),6),JSON.stringify(this)}}!function(e){e.CONFIG="config",e.STREAMER_LIST="streamerList",e.STREAMER_ID_CHANGED="streamerIDChanged",e.PLAYER_COUNT="playerCount",e.OFFER="offer",e.ANSWER="answer",e.ICE_CANDIDATE="iceCandidate",e.PEER_DATA_CHANNELS="peerDataChannels",e.PING="ping",e.WARNING="warning",e.UE4_EXE_INFO_MSG="ue4ExeInfoMsg",e.SHOW_INFO="ShowInfo",e.Send_Player_Type="sendplayerType",e.Take_User_Device_Info="TakeuserDeviceInfo",e.UE4_Version="ue4Version",e.PS_PLugin_Pixel_Streaming_Dire_Exist="PsPluginPixelStreamingDireExist",e.PSPlugin_Entry_In_Manifest_File="PsPluginEntryInManifestFile",e.Include_In_Timerecords="includeInTimeRecords"}(t||(t={}));class C{}class w extends C{}function b(){var e={};null!=Nn&&(e=Nn);var t={};return null!=dn&&(t={city:dn.city,fullInfo:{city:dn.city,country_code:dn.country_code}}),{type:"takeUserDeviceInfo",userDeviceInfo:e,clientInfo:t}}class E{constructor(){this.isReceivingFreezeFrame=!1}getDataChannelInstance(){return this}createDataChannel(e,t,n){this.peerConnection=e,this.label=t,this.datachannelOptions=n,null==n&&(this.datachannelOptions={},this.datachannelOptions.ordered=!0),this.dataChannel=this.peerConnection.createDataChannel(this.label,this.datachannelOptions),this.setupDataChannel()}setupDataChannel(){this.dataChannel.binaryType="arraybuffer",this.dataChannel.onopen=e=>this.handleOnOpen(e),this.dataChannel.onclose=e=>this.handleOnClose(e),this.dataChannel.onmessage=e=>this.handleOnMessage(e),this.dataChannel.onerror=e=>this.handleOnError(e)}handleOnOpen(e){var t;setTimeout((()=>{window.pixelStreaming.emitUIInteraction(b())}),2e3),l.Log(l.GetStackTrace(),`Data Channel (${this.label}) opened.`,7),this.onOpen(null===(t=this.dataChannel)||void 0===t?void 0:t.label,e)}handleOnClose(e){var t;l.Log(l.GetStackTrace(),`Data Channel (${this.label}) closed.`,7),this.onClose(null===(t=this.dataChannel)||void 0===t?void 0:t.label,e)}handleOnMessage(e){l.Log(l.GetStackTrace(),`Data Channel (${this.label}) message: ${e}`,8)}handleOnError(e){var t;l.Log(l.GetStackTrace(),`Data Channel (${this.label}) error: ${e}`,7),this.onError(null===(t=this.dataChannel)||void 0===t?void 0:t.label,e)}onOpen(e,t){}onClose(e,t){}onError(e,t){}}class T{constructor(){this.FromUEMessageHandlers=new Map}addMessageHandler(e,t){this.FromUEMessageHandlers.set(e,t)}handleMessage(e,t){ii(JSON.parse(t)),this.FromUEMessageHandlers.has(e)&&this.FromUEMessageHandlers.get(e)(t)}static setupDefaultHandlers(e){e.signallingProtocol.addMessageHandler(t.PING,(n=>{const o=new m((new Date).getTime()).payload();l.Log(l.GetStackTrace(),t.PING+": "+n,6),e.webSocket.send(o)})),e.signallingProtocol.addMessageHandler(t.CONFIG,(n=>{l.Log(l.GetStackTrace(),t.CONFIG,6);const o=JSON.parse(n);e.onConfig(o)})),e.signallingProtocol.addMessageHandler(t.STREAMER_LIST,(n=>{l.Log(l.GetStackTrace(),t.STREAMER_LIST,6);const o=JSON.parse(n);e.onStreamerList(o)})),e.signallingProtocol.addMessageHandler(t.STREAMER_ID_CHANGED,(n=>{l.Log(l.GetStackTrace(),t.STREAMER_ID_CHANGED,6);const o=JSON.parse(n);e.onStreamerIDChanged(o)})),e.signallingProtocol.addMessageHandler(t.PLAYER_COUNT,(n=>{l.Log(l.GetStackTrace(),t.PLAYER_COUNT,6);const o=JSON.parse(n);l.Log(l.GetStackTrace(),"Player Count: "+o.count,6),e.onPlayerCount(o)})),e.signallingProtocol.addMessageHandler(t.ANSWER,(n=>{l.Log(l.GetStackTrace(),t.ANSWER,6);const o=JSON.parse(n);e.onWebRtcAnswer(o)})),e.signallingProtocol.addMessageHandler(t.OFFER,(n=>{l.Log(l.GetStackTrace(),t.OFFER,6);const o=JSON.parse(n);e.onWebRtcOffer(o)})),e.signallingProtocol.addMessageHandler(t.ICE_CANDIDATE,(n=>{l.Log(l.GetStackTrace(),t.ICE_CANDIDATE,6);const o=JSON.parse(n);e.onIceCandidate(o.candidate),se(5)})),e.signallingProtocol.addMessageHandler(t.WARNING,(e=>{l.Warning(l.GetStackTrace(),`Warning received: ${e}`)})),e.signallingProtocol.addMessageHandler(t.Send_Player_Type,(n=>{var o,s,i,r;l.Log(l.GetStackTrace(),t.Send_Player_Type,6),e.webSocket.send(JSON.stringify({type:"takePlayerType",isSpectator:void 0!==tn?tn:null,hostMeetingId:void 0!==Xt?Xt:null,appDownloadInfo:void 0!==at?at:null,GuestMeetingId:void 0!==Yt?Yt:null,version:void 0!==ct?ct:-1,uInfo:void 0!==Ne?Ne:null,userDeviceInfo:void 0!==Nn?Nn:null,configName:void 0!==en?en:null,urlVersion:void 0!==Lt?Lt:null,appName:sn("appName"),navigationType:null!==(s=null===(o=null===window||void 0===window?void 0:window.location)||void 0===o?void 0:o.href)&&void 0!==s?s:null,url:null!==(r=null===(i=null===window||void 0===window?void 0:window.location)||void 0===i?void 0:i.href)&&void 0!==r?r:null,href_emulated:void 0!==_e?_e:null,userAgent:"undefined"!=typeof navigator?navigator.userAgent:null,clientInfo:void 0!==dn?dn:{},serverOwner:void 0!==De?De:null,forceMeetingMode:void 0!==nn?nn:0,accessedTopLevelDomainName:void 0!==_t?_t:null,url_searchParams:void 0!==pe?String(pe):null,configuration:void 0!==bt?bt:null}))})),e.signallingProtocol.addMessageHandler(t.Take_User_Device_Info,(e=>{l.Log(l.GetStackTrace(),t.Take_User_Device_Info,6),window.pixelStreaming.emitUIInteraction(b())})),e.signallingProtocol.addMessageHandler(t.Include_In_Timerecords,(e=>{l.Log(l.GetStackTrace(),t.Include_In_Timerecords,6);const n=JSON.parse(e);console.log("includeintimerecords",e);var o=n.timeRecords_ssSide;for(const e in o)if(timeRecords.hasOwnProperty(e)){var s=!0;if(Object.keys(timeRecords).forEach((t=>{t.startsWith(e)&&(console.log(t),timeRecords[t]===o[e])&&(s=!1)})),s){let t=1,n=e+t;for(;timeRecords.hasOwnProperty(n);)t++,n=e+t;timeRecords[n]=o[e]}}else timeRecords[e]=o[e]})),e.signallingProtocol.addMessageHandler(t.PEER_DATA_CHANNELS,(n=>{l.Log(l.GetStackTrace(),t.PEER_DATA_CHANNELS,6);const o=JSON.parse(n);e.onWebRtcPeerDataChannels(o)})),e.signallingProtocol.addMessageHandler(t.UE4_EXE_INFO_MSG,(e=>{l.Log(l.GetStackTrace(),t.UE4_EXE_INFO_MSG,6),se(2)})),e.signallingProtocol.addMessageHandler(t.UE4_Version,(e=>{l.Log(l.GetStackTrace(),t.UE4_Version,6);const n=JSON.parse(e);Vt=null==n?void 0:n.currentAppsUE4Version,Se&&g({type:"ueVersion",value:null==Vt?void 0:Vt.versionString})})),e.signallingProtocol.addMessageHandler(t.PS_PLugin_Pixel_Streaming_Dire_Exist,(e=>{const n=JSON.parse(e);l.Log(l.GetStackTrace(),t.PS_PLugin_Pixel_Streaming_Dire_Exist,6),console.log("****PsPluginPixelStreamingDireExist : "+(null==n?void 0:n.PsPluginPixelStreamingDireExist)),We=null==n?void 0:n.PsPluginPixelStreamingDireExist})),e.signallingProtocol.addMessageHandler(t.PSPlugin_Entry_In_Manifest_File,(e=>{const n=JSON.parse(e);l.Log(l.GetStackTrace(),t.PSPlugin_Entry_In_Manifest_File,6),console.log("****PsPluginEntryInManifestFile : "+(null==n?void 0:n.PsPluginEntryInManifestFile)),Ve=null==n?void 0:n.PsPluginEntryInManifestFile}))}}class k{constructor(){this.WS_OPEN_STATE=1,this.onOpen=new EventTarget,this.onClose=new EventTarget,this.signallingProtocol=new T,T.setupDefaultHandlers(this)}connect(e){l.Log(l.GetStackTrace(),e,6);try{return this.webSocket=new WebSocket(e),this.webSocket.onopen=e=>this.handleOnOpen(e),this.webSocket.onerror=()=>this.handleOnError(),this.webSocket.onclose=e=>this.handleOnClose(e),this.webSocket.onmessage=e=>this.handleOnMessage(e),this.webSocket.onmessagebinary=e=>this.handleOnMessageBinary(e),!0}catch(e){return l.Error(e,e),!1}}handleOnMessageBinary(e){e&&e.data&&e.data.text().then((e=>{const t=new MessageEvent("messageFromBinary",{data:e});this.handleOnMessage(t)})).catch((e=>{l.Error(l.GetStackTrace(),`Failed to parse binary blob from websocket, reason: ${e}`)}))}handleOnMessage(e){if(e.data&&e.data instanceof Blob)return void this.handleOnMessageBinary(e);const t=JSON.parse(e.data);l.Log(l.GetStackTrace(),"received => \n"+JSON.stringify(JSON.parse(e.data),void 0,4),6),this.signallingProtocol.handleMessage(t.type,e.data)}handleOnOpen(e){l.Log(l.GetStackTrace(),"Connected to the signalling server via WebSocket",6),this.onOpen.dispatchEvent(new Event("open"))}handleOnError(){l.Error(l.GetStackTrace(),"WebSocket error")}handleOnClose(e){l.Log(l.GetStackTrace(),"Disconnected to the signalling server via WebSocket: "+JSON.stringify(e.code)+" - "+e.reason),this.onClose.dispatchEvent(new CustomEvent("close",{detail:e}))}requestStreamerList(){const e=new d;this.webSocket.send(e.payload())}sendSubscribe(e){const t=new u(e);this.webSocket.send(t.payload())}sendUnsubscribe(){const e=new h;this.webSocket.send(e.payload())}sendWebRtcOffer(e,t){const n=new p(e,t);this.webSocket.send(n.payload())}sendWebRtcAnswer(e,t){const n=new f(e,t);this.webSocket.send(n.payload())}sendWebRtcDatachannelRequest(){const e=new v;this.webSocket.send(e.payload())}sendSFURecvDataChannelReady(){const e=new y;this.webSocket.send(e.payload())}sendIceCandidate(e){if(l.Log(l.GetStackTrace(),"Sending Ice Candidate"),this.webSocket&&this.webSocket.readyState===this.WS_OPEN_STATE){const t=new S(e);this.webSocket.send(t.payload())}}close(){var e;null===(e=this.webSocket)||void 0===e||e.close()}onConfig(e){}onStreamerList(e){}onStreamerIDChanged(e){}onIceCandidate(e){}onWebRtcAnswer(e){}onWebRtcOffer(e){}onWebRtcPeerDataChannels(e){}onPlayerCount(e){}}class x{constructor(e){this.videoElementProvider=e,this.audioElement=document.createElement("Audio"),this.videoElementProvider.setAudioElement(this.audioElement)}handleOnTrack(e){l.Log(l.GetStackTrace(),"handleOnTrack "+JSON.stringify(e.streams),6);const t=this.videoElementProvider.getVideoElement();if(e.track&&l.Log(l.GetStackTrace(),"Got track - "+e.track.kind+" id="+e.track.id+" readyState="+e.track.readyState,6),"audio"!=e.track.kind)return"video"==e.track.kind&&t.srcObject!==e.streams[0]?(t.srcObject=e.streams[0],void l.Log(l.GetStackTrace(),"Set video source from video track ontrack.")):void 0;this.CreateAudioTrack(e.streams[0])}CreateAudioTrack(e){const t=this.videoElementProvider.getVideoElement();t.srcObject!=e&&t.srcObject&&t.srcObject!==e&&(this.audioElement.srcObject=e,l.Log(l.GetStackTrace(),"Created new audio element to play separate audio stream."))}}class P{constructor(e){this.freezeFrameHeight=0,this.freezeFrameWidth=0,this.rootDiv=e,this.rootElement=document.createElement("div"),this.rootElement.id="freezeFrame",this.rootElement.style.display="none",this.rootElement.style.pointerEvents="none",this.rootElement.style.position="absolute",this.rootElement.style.zIndex="20",this.imageElement=document.createElement("img"),this.imageElement.style.position="absolute",this.rootElement.appendChild(this.imageElement),this.rootDiv.appendChild(this.rootElement)}setElementForShow(){this.rootElement.style.display="block"}setElementForHide(){this.rootElement.style.display="none"}updateImageElementSource(e){const t=btoa(e.reduce(((e,t)=>e+String.fromCharCode(t)),""));this.imageElement.src="data:image/jpeg;base64,"+t}setDimensionsFromElementAndResize(){this.freezeFrameHeight=this.imageElement.naturalHeight,this.freezeFrameWidth=this.imageElement.naturalWidth,this.resize()}resize(){if(0!==this.freezeFrameWidth&&0!==this.freezeFrameHeight){let e=0,t=0,n=0,o=0;const s=this.rootDiv.clientWidth/this.rootDiv.clientHeight,i=this.freezeFrameWidth/this.freezeFrameHeight;s<i?(e=this.rootDiv.clientWidth,t=Math.floor(this.rootDiv.clientWidth/i),n=Math.floor(.5*(this.rootDiv.clientHeight-t)),o=0):(e=Math.floor(this.rootDiv.clientHeight*i),t=this.rootDiv.clientHeight,n=0,o=Math.floor(.5*(this.rootDiv.clientWidth-e))),this.rootElement.style.width=this.rootDiv.offsetWidth+"px",this.rootElement.style.height=this.rootDiv.offsetHeight+"px",this.rootElement.style.left="0px",this.rootElement.style.top="0px",this.imageElement.style.width=e+"px",this.imageElement.style.height=t+"px",this.imageElement.style.left=o+"px",this.imageElement.style.top=n+"px"}}}class I{constructor(e){this.receiving=!1,this.size=0,this.jpeg=void 0,this.valid=!1,this.freezeFrameDelay=50,this.freezeFrame=new P(e)}showFreezeFrame(){this.valid&&this.freezeFrame.setElementForShow()}hideFreezeFrame(){this.valid=!1,this.freezeFrame.setElementForHide()}updateFreezeFrameAndShow(e,t){this.freezeFrame.updateImageElementSource(e),this.freezeFrame.imageElement.onload=()=>{this.freezeFrame.setDimensionsFromElementAndResize(),t()}}processFreezeFrameMessage(e,t){this.receiving||(this.receiving=!0,this.valid=!1,this.size=0,this.jpeg=void 0),this.size=new DataView(e.slice(1,5).buffer).getInt32(0,!0);const n=e.slice(5);if(this.jpeg){const e=new Uint8Array(this.jpeg.length+n.length);e.set(this.jpeg,0),e.set(n,this.jpeg.length),this.jpeg=e}else this.jpeg=n,this.receiving=!0,l.Log(l.GetStackTrace(),`received first chunk of freeze frame: ${this.jpeg.length}/${this.size}`,6);this.jpeg.length===this.size?(this.receiving=!1,this.valid=!0,l.Log(l.GetStackTrace(),`received complete freeze frame ${this.size}`,6),this.updateFreezeFrameAndShow(this.jpeg,t)):this.jpeg.length>this.size&&(l.Error(l.GetStackTrace(),`received bigger freeze frame than advertised: ${this.jpeg.length}/${this.size}`),this.jpeg=void 0,this.receiving=!1)}}class R{constructor(e,t,n,o,s=(()=>{})){this.onChange=s,this.onChangeEmit=()=>{},this.id=e,this.description=n,this.label=t,this.value=o}set label(e){this._label=e,this.onChangeEmit(this._value)}get label(){return this._label}get value(){return this._value}set value(e){this._value=e,this.onChange(this._value,this),this.onChangeEmit(this._value)}}class M extends R{constructor(e,t,n,o,s,i=(()=>{})){super(e,t,n,o,i);const r=new URLSearchParams(window.location.search);if(s&&r.has(this.id)){const e=this.getUrlParamFlag();this.flag=e}else this.flag=o;this.useUrlParams=s}getUrlParamFlag(){const e=new URLSearchParams(window.location.search);return!!e.has(this.id)&&"false"!==e.get(this.id)&&"False"!==e.get(this.id)}updateURLParams(){if(this.useUrlParams){const e=new URLSearchParams(window.location.search);!0===this.flag?e.set(this.id,"true"):e.set(this.id,"false"),window.history.replaceState({},"",""!==e.toString()?`${location.pathname}?${e}`:`${location.pathname}`)}}enable(){this.flag=!0}get flag(){return!!this.value}set flag(e){this.value=e}}class L extends R{constructor(e,t,n,o,s,i,r,a=(()=>{})){super(e,t,n,i,a),this._min=o,this._max=s;const l=new URLSearchParams(window.location.search);if(r&&l.has(this.id)){const e=Number.parseFloat(l.get(this.id));this.number=Number.isNaN(e)?i:e}else this.number=i;this.useUrlParams=r}updateURLParams(){if(this.useUrlParams){const e=new URLSearchParams(window.location.search);e.set(this.id,this.number.toString()),window.history.replaceState({},"",""!==e.toString()?`${location.pathname}?${e}`:`${location.pathname}`)}}set number(e){this.value=this.clamp(e)}get number(){return this.value}clamp(e){return Math.max(Math.min(this._max,e),this._min)}get min(){return this._min}get max(){return this._max}addOnChangedListener(e){this.onChange=e}}class B extends R{constructor(e,t,n,o,s,i=(()=>{})){super(e,t,n,o,i);const r=new URLSearchParams(window.location.search);if(s&&r.has(this.id)){const e=this.getUrlParamText();this.text=e}else this.text=o;this.useUrlParams=s}getUrlParamText(){var e;const t=new URLSearchParams(window.location.search);return t.has(this.id)&&null!==(e=t.get(this.id))&&void 0!==e?e:""}updateURLParams(){if(this.useUrlParams){const e=new URLSearchParams(window.location.search);e.set(this.id,this.text),window.history.replaceState({},"",""!==e.toString()?`${location.pathname}?${e}`:`${location.pathname}`)}}get text(){return this.value}set text(e){this.value=e}}class A extends R{constructor(e,t,n,o,s,i,r=(()=>{})){super(e,t,n,[o],r),this.options=s;const a=new URLSearchParams(window.location.search),l=i&&a.has(this.id)?this.getUrlParamText():o;this.selected=l,this.useUrlParams=i}getUrlParamText(){var e;const t=new URLSearchParams(window.location.search);return t.has(this.id)&&null!==(e=t.get(this.id))&&void 0!==e?e:""}updateURLParams(){if(this.useUrlParams){const e=new URLSearchParams(window.location.search);e.set(this.id,this.selected),window.history.replaceState({},"",""!==e.toString()?`${location.pathname}?${e}`:`${location.pathname}`)}}addOnChangedListener(e){this.onChange=e}get options(){return this._options}set options(e){this._options=e,this.onChangeEmit(this.selected)}get selected(){return this.value}set selected(e){let t=this.options.filter((t=>-1!==t.indexOf(e)));t.length?this.value=t[0]:(t=this.options.filter((t=>-1!==t.indexOf(e.split(" ")[0]))),t.length&&(this.value=t[0]))}}class O extends Event{constructor(e){super("afkWarningActivate"),this.data=e}}class _ extends Event{constructor(e){super("afkWarningUpdate"),this.data=e}}class F extends Event{constructor(){super("afkWarningDeactivate")}}class D extends Event{constructor(){super("afkTimedOut")}}class U extends Event{constructor(e){super("videoEncoderAvgQP"),this.data=e}}class N extends Event{constructor(){super("webRtcSdp")}}class G extends Event{constructor(){super("webRtcAutoConnect")}}class H extends Event{constructor(){super("webRtcConnecting")}}class z extends Event{constructor(){super("webRtcConnected")}}class W extends Event{constructor(){super("webRtcFailed")}}class V extends Event{constructor(e){super("webRtcDisconnected"),this.data=e}}class q extends Event{constructor(e){super("dataChannelOpen"),this.data=e}}class $ extends Event{constructor(e){super("dataChannelClose"),this.data=e}}class j extends Event{constructor(e){super("dataChannelError"),this.data=e}}class J extends Event{constructor(){super("videoInitialized")}}class Q extends Event{constructor(){super("streamLoading")}}class K extends Event{constructor(){super("streamConnect")}}class X extends Event{constructor(){super("streamDisconnect")}}class Y extends Event{constructor(){super("streamReconnect")}}class Z extends Event{constructor(e){super("playStreamError"),this.data=e}}class ee extends Event{constructor(){super("playStream")}}class te extends Event{constructor(e){super("playStreamRejected"),this.data=e}}class ne extends Event{constructor(e){super("loadFreezeFrame"),this.data=e}}class oe extends Event{constructor(){super("hideFreezeFrame")}}class ie extends Event{constructor(e){super("statsReceived"),this.data=e}}class re extends Event{constructor(e){super("streamerListMessage"),this.data=e}}class ae extends Event{constructor(e){super("StreamerIDChangedMessage"),this.data=e}}class le extends Event{constructor(e){super("latencyTestResult"),this.data=e}}class ce extends Event{constructor(e){super("dataChannelLatencyTestResponse"),this.data=e}}class de extends Event{constructor(e){super("dataChannelLatencyTestResult"),this.data=e}}class ue extends Event{constructor(e){super("initialSettings"),this.data=e}}class he extends Event{constructor(e){super("settingsChanged"),this.data=e}}class me extends Event{constructor(){super("xrSessionStarted")}}class ge extends Event{constructor(){super("xrSessionEnded")}}class fe extends Event{constructor(e){super("xrFrame"),this.data=e}}class ve extends Event{constructor(e){super("playerCount"),this.data=e}}class ye extends Event{constructor(){super("webRtcTCPRelayDetected")}}class Ce extends EventTarget{dispatchEvent(e){return super.dispatchEvent(e)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}}class we{}we.AutoConnect="AutoConnect",we.AutoPlayVideo="AutoPlayVideo",we.AFKDetection="TimeoutIfIdle",we.BrowserSendOffer="OfferToReceive",we.HoveringMouseMode="HoveringMouse",we.ForceMonoAudio="ForceMonoAudio",we.ForceTURN="ForceTURN",we.FakeMouseWithTouches="FakeMouseWithTouches",we.IsQualityController="ControlsQuality",we.MatchViewportResolution="MatchViewportRes",we.StartVideoMuted="StartVideoMuted",we.SuppressBrowserKeys="SuppressBrowserKeys",we.UseMic="UseMic",we.KeyboardInput="KeyboardInput",we.MouseInput="MouseInput",we.TouchInput="TouchInput",we.GamepadInput="GamepadInput",we.XRControllerInput="XRControllerInput",we.WaitForStreamer="WaitForStreamer";const be=e=>Object.getOwnPropertyNames(we).some((t=>we[t]===e));class Ee{}Ee.AFKTimeoutSecs="AFKTimeout",Ee.MinQP="MinQP",Ee.MaxQP="MaxQP",Ee.WebRTCFPS="WebRTCFPS",Ee.WebRTCMinBitrate="WebRTCMinBitrate",Ee.WebRTCMaxBitrate="WebRTCMaxBitrate",Ee.MaxReconnectAttempts="MaxReconnectAttempts",Ee.StreamerAutoJoinInterval="StreamerAutoJoinInterval";const Te=e=>Object.getOwnPropertyNames(Ee).some((t=>Ee[t]===e));class ke{}ke.SignallingServerUrl="ss";const xe=e=>Object.getOwnPropertyNames(ke).some((t=>ke[t]===e));class Pe{}Pe.PreferredCodec="PreferredCodec",Pe.StreamerId="StreamerId";const Ie=e=>Object.getOwnPropertyNames(Pe).some((t=>Pe[t]===e));class Re{constructor(e={}){this.flags=new Map,this.numericParameters=new Map,this.textParameters=new Map,this.optionParameters=new Map;const{initialSettings:t,useUrlParams:n}=e;this._useUrlParams=!!n,this.populateDefaultSettings(this._useUrlParams,t)}get useUrlParams(){return this._useUrlParams}populateDefaultSettings(e,t){this.textParameters.set(ke.SignallingServerUrl,new B(ke.SignallingServerUrl,"Signalling url","Url of the signalling server",window.ss_url?window.ss_url:("https:"===location.protocol?"wss://":"ws://")+window.location.hostname+("80"===window.location.port||""===window.location.port?"":`:${window.location.port}`),e)),this.optionParameters.set(Pe.StreamerId,new A(Pe.StreamerId,"Streamer ID","The ID of the streamer to stream.",t&&t.hasOwnProperty(Pe.StreamerId)?t[Pe.StreamerId]:"",[],e)),this.optionParameters.set(Pe.PreferredCodec,new A(Pe.PreferredCodec,"Preferred Codec","The preferred codec to be used during codec negotiation","H264 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f",t&&t.hasOwnProperty(Pe.PreferredCodec)?[t[Pe.PreferredCodec]]:function(){const e=[];if(!RTCRtpReceiver.getCapabilities)return e.push("Only available on Chrome"),e;const t=/(VP\d|H26\d|AV1).*/;return RTCRtpReceiver.getCapabilities("video").codecs.forEach((n=>{const o=n.mimeType.split("/")[1]+" "+(n.sdpFmtpLine||"");null!==t.exec(o)&&e.push(o)})),e}(),e)),this.flags.set(we.AutoConnect,new M(we.AutoConnect,"Auto connect to stream","Whether we should attempt to auto connect to the signalling server or show a click to start prompt.",!0,e)),this.flags.set(we.AutoPlayVideo,new M(we.AutoPlayVideo,"Auto play video","When video is ready automatically start playing it as opposed to showing a play button.",!bt||"1"==bt.ShouldAutoPlay,e)),this.flags.set(we.BrowserSendOffer,new M(we.BrowserSendOffer,"Browser send offer","Browser will initiate the WebRTC handshake by sending the offer to the streamer",!(!t||!t.hasOwnProperty(we.BrowserSendOffer))&&t[we.BrowserSendOffer],e)),this.flags.set(we.UseMic,new M(we.UseMic,"Use microphone","Make browser request microphone access and open an input audio track.",!(!bt||"1"!=bt.UseMicrophone),e)),this.flags.set(we.StartVideoMuted,new M(we.StartVideoMuted,"Start video muted","Video will start muted if true.",!0,e)),this.flags.set(we.SuppressBrowserKeys,new M(we.SuppressBrowserKeys,"Suppress browser keys","Suppress certain browser keys that we use in UE, for example F5 to show shader complexity instead of refresh the page.",!bt||"0"!=bt.suppressBrowserKeys,e)),this.flags.set(we.IsQualityController,new M(we.IsQualityController,"Is quality controller?","True if this peer controls stream quality",!t||!t.hasOwnProperty(we.IsQualityController)||t[we.IsQualityController],e)),this.flags.set(we.ForceMonoAudio,new M(we.ForceMonoAudio,"Force mono audio","Force browser to request mono audio in the SDP",!(!t||!t.hasOwnProperty(we.ForceMonoAudio))&&t[we.ForceMonoAudio],e)),this.flags.set(we.ForceTURN,new M(we.ForceTURN,"Force TURN","Only generate TURN/Relayed ICE candidates.",!(!t||!t.hasOwnProperty(we.ForceTURN))&&t[we.ForceTURN],e)),this.flags.set(we.AFKDetection,new M(we.AFKDetection,"AFK if idle","Timeout the experience if user is AFK for a period.",!(!bt||"1"!=bt.isAfkEnabled),e)),this.flags.set(we.MatchViewportResolution,new M(we.MatchViewportResolution,"Match viewport resolution","Pixel Streaming will be instructed to dynamically resize the video stream to match the size of the video element.",!(!bt||"Dynamic"!=bt.resolutionType_ue4),e)),this.flags.set(we.HoveringMouseMode,new M(we.HoveringMouseMode,"Control Scheme: Locked Mouse","Either locked mouse, where the pointer is consumed by the video and locked to it, or hovering mouse, where the mouse is not consumed.",!(!bt||"1"!=bt.MouseControlScheme),e,((e,t)=>{t.label=`Control Scheme: ${e?"Hovering":"Locked"} Mouse`}))),this.flags.set(we.FakeMouseWithTouches,new M(we.FakeMouseWithTouches,"Fake mouse with touches","A single finger touch is converted into a mouse event. This allows a non-touch application to be controlled partially via a touch device.",!bt||"0"!=bt.fakeMouseWithTouches,e)),this.flags.set(we.KeyboardInput,new M(we.KeyboardInput,"Keyboard input","If enabled, send keyboard events to streamer",!t||!t.hasOwnProperty(we.KeyboardInput)||t[we.KeyboardInput],e)),this.flags.set(we.MouseInput,new M(we.MouseInput,"Mouse input","If enabled, send mouse events to streamer",!t||!t.hasOwnProperty(we.MouseInput)||t[we.MouseInput],e)),this.flags.set(we.TouchInput,new M(we.TouchInput,"Touch input","If enabled, send touch events to streamer",!t||!t.hasOwnProperty(we.TouchInput)||t[we.TouchInput],e)),this.flags.set(we.GamepadInput,new M(we.GamepadInput,"Gamepad input","If enabled, send gamepad events to streamer",!t||!t.hasOwnProperty(we.GamepadInput)||t[we.GamepadInput],e)),this.flags.set(we.XRControllerInput,new M(we.XRControllerInput,"XR controller input","If enabled, send XR controller events to streamer",!t||!t.hasOwnProperty(we.XRControllerInput)||t[we.XRControllerInput],e)),this.flags.set(we.WaitForStreamer,new M(we.WaitForStreamer,"Wait for streamer","Will continue trying to connect to the first streamer available.",!t||!t.hasOwnProperty(we.WaitForStreamer)||t[we.WaitForStreamer],e)),this.numericParameters.set(Ee.AFKTimeoutSecs,new L(Ee.AFKTimeoutSecs,"AFK timeout","The time (in seconds) it takes for the application to time out if AFK timeout is enabled.",0,600,bt&&bt.hasOwnProperty("afkWarnTimeout")?60*parseInt(bt.afkWarnTimeout):300,e)),this.numericParameters.set(Ee.MaxReconnectAttempts,new L(Ee.MaxReconnectAttempts,"Max Reconnects","Maximum number of reconnects the application will attempt when a streamer disconnects.",0,999,t&&t.hasOwnProperty(Ee.MaxReconnectAttempts)?t[Ee.MaxReconnectAttempts]:3,e)),this.numericParameters.set(Ee.MinQP,new L(Ee.MinQP,"Min QP","The lower bound for the quantization parameter (QP) of the encoder. 0 = Best quality, 51 = worst quality.",0,51,t&&t.hasOwnProperty(Ee.MinQP)?t[Ee.MinQP]:0,e)),this.numericParameters.set(Ee.MaxQP,new L(Ee.MaxQP,"Max QP","The upper bound for the quantization parameter (QP) of the encoder. 0 = Best quality, 51 = worst quality.",0,51,t&&t.hasOwnProperty(Ee.MaxQP)?t[Ee.MaxQP]:51,e)),this.numericParameters.set(Ee.WebRTCFPS,new L(Ee.WebRTCFPS,"Max FPS","The maximum FPS that WebRTC will try to transmit frames at.",1,999,t&&t.hasOwnProperty(Ee.WebRTCFPS)?t[Ee.WebRTCFPS]:60,e)),this.numericParameters.set(Ee.WebRTCMinBitrate,new L(Ee.WebRTCMinBitrate,"Min Bitrate (kbps)","The minimum bitrate that WebRTC should use.",0,5e5,t&&t.hasOwnProperty(Ee.WebRTCMinBitrate)?t[Ee.WebRTCMinBitrate]:0,e)),this.numericParameters.set(Ee.WebRTCMaxBitrate,new L(Ee.WebRTCMaxBitrate,"Max Bitrate (kbps)","The maximum bitrate that WebRTC should use.",0,5e5,t&&t.hasOwnProperty(Ee.WebRTCMaxBitrate)?t[Ee.WebRTCMaxBitrate]:0,e)),this.numericParameters.set(Ee.StreamerAutoJoinInterval,new L(Ee.StreamerAutoJoinInterval,"Streamer Auto Join Interval (ms)","Delay between retries when waiting for an available streamer.",500,9e5,t&&t.hasOwnProperty(Ee.StreamerAutoJoinInterval)?t[Ee.StreamerAutoJoinInterval]:3e3,e))}_addOnNumericSettingChangedListener(e,t){this.numericParameters.has(e)&&this.numericParameters.get(e).addOnChangedListener(t)}_addOnOptionSettingChangedListener(e,t){this.optionParameters.has(e)&&this.optionParameters.get(e).addOnChangedListener(t)}getNumericSettingValue(e){if(this.numericParameters.has(e))return this.numericParameters.get(e).number;throw new Error(`There is no numeric setting with the id of ${e}`)}getTextSettingValue(e){if(this.textParameters.has(e))return this.textParameters.get(e).value;throw new Error(`There is no numeric setting with the id of ${e}`)}setNumericSetting(e,t){if(!this.numericParameters.has(e))throw new Error(`There is no numeric setting with the id of ${e}`);this.numericParameters.get(e).number=t}_addOnSettingChangedListener(e,t){this.flags.has(e)&&(this.flags.get(e).onChange=t)}_addOnTextSettingChangedListener(e,t){this.textParameters.has(e)&&(this.textParameters.get(e).onChange=t)}getSettingOption(e){return this.optionParameters.get(e)}isFlagEnabled(e){return this.flags.get(e).flag}setFlagEnabled(e,t){this.flags.has(e)?this.flags.get(e).flag=t:l.Warning(l.GetStackTrace(),`Cannot toggle flag called ${e} - it does not exist in the Config.flags map.`)}setTextSetting(e,t){this.textParameters.has(e)?this.textParameters.get(e).text=t:l.Warning(l.GetStackTrace(),`Cannot set text setting called ${e} - it does not exist in the Config.textParameters map.`)}setOptionSettingOptions(e,t){this.optionParameters.has(e)?this.optionParameters.get(e).options=t:l.Warning(l.GetStackTrace(),`Cannot set text setting called ${e} - it does not exist in the Config.optionParameters map.`)}setOptionSettingValue(e,t){if(this.optionParameters.has(e)){const n=this.optionParameters.get(e),o=n.options;o.includes(t)||(o.push(t),n.options=o),n.selected=t}else l.Warning(l.GetStackTrace(),`Cannot set text setting called ${e} - it does not exist in the Config.enumParameters map.`)}setFlagLabel(e,t){this.flags.has(e)?this.flags.get(e).label=t:l.Warning(l.GetStackTrace(),`Cannot set label for flag called ${e} - it does not exist in the Config.flags map.`)}setSettings(e){for(const t of Object.keys(e))be(t)?this.setFlagEnabled(t,e[t]):Te(t)?this.setNumericSetting(t,e[t]):xe(t)?this.setTextSetting(t,e[t]):Ie(t)&&this.setOptionSettingValue(t,e[t])}getSettings(){const e={};for(const[t,n]of this.flags.entries())e[t]=n.flag;for(const[t,n]of this.numericParameters.entries())e[t]=n.number;for(const[t,n]of this.textParameters.entries())e[t]=n.text;for(const[t,n]of this.optionParameters.entries())e[t]=n.selected;return e}getFlags(){return Array.from(this.flags.values())}getTextSettings(){return Array.from(this.textParameters.values())}getNumericSettings(){return Array.from(this.numericParameters.values())}getOptionSettings(){return Array.from(this.optionParameters.values())}_registerOnChangeEvents(e){for(const t of this.flags.keys()){const n=this.flags.get(t);n&&(n.onChangeEmit=t=>e.dispatchEvent(new he({id:n.id,type:"flag",value:t,target:n})))}for(const t of this.numericParameters.keys()){const n=this.numericParameters.get(t);n&&(n.onChangeEmit=t=>e.dispatchEvent(new he({id:n.id,type:"number",value:t,target:n})))}for(const t of this.textParameters.keys()){const n=this.textParameters.get(t);n&&(n.onChangeEmit=t=>e.dispatchEvent(new he({id:n.id,type:"text",value:t,target:n})))}for(const t of this.optionParameters.keys()){const n=this.optionParameters.get(t);n&&(n.onChangeEmit=t=>e.dispatchEvent(new he({id:n.id,type:"option",value:t,target:n})))}}}var Me;!function(e){e[e.LockedMouse=0]="LockedMouse",e[e.HoveringMouse=1]="HoveringMouse"}(Me||(Me={}));class Le{constructor(e,t,n){this.closeTimeout=bt.hasOwnProperty("afkCloseTimeout")?60*parseInt(bt.afkCloseTimeout):10,this.active=!1,this.countdownActive=!1,this.warnTimer=void 0,this.countDown=0,this.countDownTimer=void 0,this.config=e,this.pixelStreaming=t,this.onDismissAfk=n,this.onAFKTimedOutCallback=()=>{console.log("AFK timed out, did you want to override this callback?")}}onAfkClick(){clearInterval(this.countDownTimer),(this.active||this.countdownActive)&&(this.startAfkWarningTimer(),this.pixelStreaming.dispatchEvent(new F))}startAfkWarningTimer(){this.config.getNumericSettingValue(Ee.AFKTimeoutSecs)>0&&this.config.isFlagEnabled(we.AFKDetection)?this.active=!0:this.active=!1,this.resetAfkWarningTimer()}stopAfkWarningTimer(){this.active=!1,this.countdownActive=!1,clearTimeout(this.warnTimer),clearInterval(this.countDownTimer)}pauseAfkWarningTimer(){this.active=!1}resetAfkWarningTimer(){this.active&&this.config.isFlagEnabled(we.AFKDetection)&&(clearTimeout(this.warnTimer),this.warnTimer=setTimeout((()=>this.activateAfkEvent()),1e3*this.config.getNumericSettingValue(Ee.AFKTimeoutSecs)))}activateAfkEvent(){this.pauseAfkWarningTimer(),this.pixelStreaming.dispatchEvent(new O({countDown:this.countDown,dismissAfk:this.onDismissAfk})),this.countDown=this.closeTimeout,this.countdownActive=!0,this.pixelStreaming.dispatchEvent(new _({countDown:this.countDown})),this.config.isFlagEnabled(we.HoveringMouseMode)||document.exitPointerLock&&document.exitPointerLock(),this.countDownTimer=setInterval((()=>{this.countDown--,0==this.countDown?(this.pixelStreaming.dispatchEvent(new D),this.onAFKTimedOutCallback(),l.Log(l.GetStackTrace(),"You have been disconnected due to inactivity"),this.stopAfkWarningTimer()):this.pixelStreaming.dispatchEvent(new _({countDown:this.countDown}))}),1e3)}}class Be{}class Ae{}class Fe{}class Ue{}class Ge{}class He{}class ze{}class qe{constructor(){this.inboundVideoStats=new Ae,this.inboundAudioStats=new Be,this.DataChannelStats=new Fe,this.outBoundVideoStats=new Ge,this.sessionStats=new He,this.streamStats=new ze,this.codecs=new Map}processStats(e){this.localCandidates=new Array,this.remoteCandidates=new Array,this.candidatePairs=new Array,e.forEach((e=>{switch(e.type){case"candidate-pair":this.handleCandidatePair(e);break;case"certificate":case"media-source":case"media-playout":case"outbound-rtp":case"peer-connection":case"remote-inbound-rtp":case"transport":break;case"codec":this.handleCodec(e);break;case"data-channel":this.handleDataChannel(e);break;case"inbound-rtp":this.handleInBoundRTP(e);break;case"local-candidate":this.handleLocalCandidate(e);break;case"remote-candidate":this.handleRemoteCandidate(e);break;case"remote-outbound-rtp":this.handleRemoteOutBound(e);break;case"track":this.handleTrack(e);break;case"stream":this.handleStream(e);break;default:l.Error(l.GetStackTrace(),"unhandled Stat Type"),l.Log(l.GetStackTrace(),e)}}))}handleStream(e){this.streamStats=e}handleCandidatePair(e){this.candidatePairs.push(e)}handleDataChannel(e){this.DataChannelStats.bytesReceived=e.bytesReceived,this.DataChannelStats.bytesSent=e.bytesSent,this.DataChannelStats.dataChannelIdentifier=e.dataChannelIdentifier,this.DataChannelStats.id=e.id,this.DataChannelStats.label=e.label,this.DataChannelStats.messagesReceived=e.messagesReceived,this.DataChannelStats.messagesSent=e.messagesSent,this.DataChannelStats.protocol=e.protocol,this.DataChannelStats.state=e.state,this.DataChannelStats.timestamp=e.timestamp}handleLocalCandidate(e){const t=new Ue;t.label="local-candidate",t.address=e.address,t.port=e.port,t.protocol=e.protocol,t.candidateType=e.candidateType,t.id=e.id,t.relayProtocol=e.relayProtocol,t.transportId=e.transportId,this.localCandidates.push(t)}handleRemoteCandidate(e){const t=new Ue;t.label="remote-candidate",t.address=e.address,t.port=e.port,t.protocol=e.protocol,t.id=e.id,t.candidateType=e.candidateType,t.relayProtocol=e.relayProtocol,t.transportId=e.transportId,this.remoteCandidates.push(t)}handleInBoundRTP(e){switch(e.kind){case"video":this.inboundVideoStats=e,null!=this.lastVideoStats&&(this.inboundVideoStats.bitrate=8*(this.inboundVideoStats.bytesReceived-this.lastVideoStats.bytesReceived)/(this.inboundVideoStats.timestamp-this.lastVideoStats.timestamp),this.inboundVideoStats.bitrate=Math.floor(this.inboundVideoStats.bitrate)),this.lastVideoStats=Object.assign({},this.inboundVideoStats);break;case"audio":this.inboundAudioStats=e,null!=this.lastAudioStats&&(this.inboundAudioStats.bitrate=8*(this.inboundAudioStats.bytesReceived-this.lastAudioStats.bytesReceived)/(this.inboundAudioStats.timestamp-this.lastAudioStats.timestamp),this.inboundAudioStats.bitrate=Math.floor(this.inboundAudioStats.bitrate)),this.lastAudioStats=Object.assign({},this.inboundAudioStats);break;default:l.Log(l.GetStackTrace(),"Kind is not handled")}}handleRemoteOutBound(e){"video"===e.kind&&(this.outBoundVideoStats.bytesSent=e.bytesSent,this.outBoundVideoStats.id=e.id,this.outBoundVideoStats.localId=e.localId,this.outBoundVideoStats.packetsSent=e.packetsSent,this.outBoundVideoStats.remoteTimestamp=e.remoteTimestamp,this.outBoundVideoStats.timestamp=e.timestamp)}handleTrack(e){"track"!==e.type||"video_label"!==e.trackIdentifier&&"video"!==e.kind||(this.inboundVideoStats.framesDropped=e.framesDropped,this.inboundVideoStats.framesReceived=e.framesReceived,this.inboundVideoStats.frameHeight=e.frameHeight,this.inboundVideoStats.frameWidth=e.frameWidth)}handleCodec(e){const t=e.id,n=`${e.mimeType.replace("video/","").replace("audio/","")}${e.sdpFmtpLine?` ${e.sdpFmtpLine}`:""}`;this.codecs.set(t,n)}handleSessionStatistics(e,t,n){const o=Date.now()-e;this.sessionStats.runTime=new Date(o).toISOString().substr(11,8).toString();const s=null===t?"Not sent yet":t?"true":"false";this.sessionStats.controlsStreamInput=s,this.sessionStats.videoEncoderAvgQP=n}isNumber(e){return"number"==typeof e&&isFinite(e)}getActiveCandidatePair(){return this.candidatePairs.find((e=>e.bytesReceived>0),null)}}const $e=(je={parseRtpParameters:()=>i.parseRtpParameters,splitSections:()=>i.splitSections},Je={},r.d(Je,je),Je);var je,Je;class Qe{static isVideoTransciever(e){return this.canTransceiverReceiveVideo(e)||this.canTransceiverSendVideo(e)}static canTransceiverReceiveVideo(e){return!!e&&("sendrecv"===e.direction||"recvonly"===e.direction)&&e.receiver&&e.receiver.track&&"video"===e.receiver.track.kind}static canTransceiverSendVideo(e){return!!e&&("sendrecv"===e.direction||"sendonly"===e.direction)&&e.sender&&e.sender.track&&"video"===e.sender.track.kind}static isAudioTransciever(e){return this.canTransceiverReceiveAudio(e)||this.canTransceiverSendAudio(e)}static canTransceiverReceiveAudio(e){return!!e&&("sendrecv"===e.direction||"recvonly"===e.direction)&&e.receiver&&e.receiver.track&&"audio"===e.receiver.track.kind}static canTransceiverSendAudio(e){return!!e&&("sendrecv"===e.direction||"sendonly"===e.direction)&&e.sender&&e.sender.track&&"audio"===e.sender.track.kind}}var Ke,Xe,Ye=function(e,t,n,o){return new(n||(n=Promise))((function(s,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}l((o=o.apply(e,t||[])).next())}))};class Ze{constructor(e,t,n){this.config=t,this.createPeerConnection(e,n)}createPeerConnection(e,t){this.config.isFlagEnabled(we.ForceTURN)&&(e.iceTransportPolicy="relay",l.Log(l.GetStackTrace(),"Forcing TURN usage by setting ICE Transport Policy in peer connection config.")),this.peerConnection=new RTCPeerConnection(e),this.peerConnection.onsignalingstatechange=e=>this.handleSignalStateChange(e),this.peerConnection.oniceconnectionstatechange=e=>this.handleIceConnectionStateChange(e),this.peerConnection.onicegatheringstatechange=e=>this.handleIceGatheringStateChange(e),this.peerConnection.ontrack=e=>this.handleOnTrack(e),this.peerConnection.onicecandidate=e=>this.handleIceCandidate(e),this.peerConnection.ondatachannel=e=>this.handleDataChannel(e),this.aggregatedStats=new qe,this.preferredCodec=t,this.updateCodecSelection=!0}createOffer(e,t){return Ye(this,void 0,void 0,(function*(){l.Log(l.GetStackTrace(),"Create Offer",6);const n="localhost"===location.hostname||"127.0.0.1"===location.hostname,o="https:"===location.protocol;let s=t.isFlagEnabled(we.UseMic);!s||n||o||(s=!1,l.Error(l.GetStackTrace(),"Microphone access in the browser will not work if you are not on HTTPS or localhost. Disabling mic access."),l.Error(l.GetStackTrace(),"For testing you can enable HTTP microphone access Chrome by visiting chrome://flags/ and enabling 'unsafely-treat-insecure-origin-as-secure'")),this.setupTransceiversAsync(s).finally((()=>{var t;null===(t=this.peerConnection)||void 0===t||t.createOffer(e).then((e=>{var t;this.showTextOverlayConnecting(),e.sdp=this.mungeSDP(e.sdp,s),null===(t=this.peerConnection)||void 0===t||t.setLocalDescription(e),this.onSendWebRTCOffer(e)})).catch((()=>{this.showTextOverlaySetupFailure()}))}))}))}receiveOffer(e,t){var n;return Ye(this,void 0,void 0,(function*(){l.Log(l.GetStackTrace(),"Receive Offer",6),null===(n=this.peerConnection)||void 0===n||n.setRemoteDescription(e).then((()=>{const e="localhost"===location.hostname||"127.0.0.1"===location.hostname,n="https:"===location.protocol;let o=t.isFlagEnabled(we.UseMic);!o||e||n||(o=!1,l.Error(l.GetStackTrace(),"Microphone access in the browser will not work if you are not on HTTPS or localhost. Disabling mic access."),l.Error(l.GetStackTrace(),"For testing you can enable HTTP microphone access Chrome by visiting chrome://flags/ and enabling 'unsafely-treat-insecure-origin-as-secure'")),this.setupTransceiversAsync(o).finally((()=>{var e;null===(e=this.peerConnection)||void 0===e||e.createAnswer().then((e=>{var t;return e.sdp=this.mungeSDP(e.sdp,o),null===(t=this.peerConnection)||void 0===t?void 0:t.setLocalDescription(e)})).then((()=>{var e;this.onSendWebRTCAnswer(null===(e=this.peerConnection)||void 0===e?void 0:e.currentLocalDescription)})).catch((()=>{l.Error(l.GetStackTrace(),"createAnswer() failed")}))}))})),this.config.setOptionSettingOptions(Pe.PreferredCodec,this.parseAvailableCodecs(e).filter((e=>this.config.getSettingOption(Pe.PreferredCodec).options.includes(e))))}))}receiveAnswer(e){var t;null===(t=this.peerConnection)||void 0===t||t.setRemoteDescription(e),this.config.setOptionSettingOptions(Pe.PreferredCodec,this.parseAvailableCodecs(e).filter((e=>this.config.getSettingOption(Pe.PreferredCodec).options.includes(e))))}generateStats(){var e;null===(e=this.peerConnection)||void 0===e||e.getStats(null).then((e=>{this.aggregatedStats.processStats(e),this.onVideoStats(this.aggregatedStats),this.updateCodecSelection&&this.aggregatedStats.inboundVideoStats.codecId&&this.config.setOptionSettingValue(Pe.PreferredCodec,this.aggregatedStats.codecs.get(this.aggregatedStats.inboundVideoStats.codecId))}))}close(){this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null)}mungeSDP(e,t){let n=e.replace(/(a=fmtp:\d+ .*level-asymmetry-allowed=.*)\r\n/gm,"$1;x-google-start-bitrate=10000;x-google-max-bitrate=100000\r\n"),o="maxaveragebitrate=510000;";return t&&(o+="sprop-maxcapturerate=48000;"),o+=this.config.isFlagEnabled(we.ForceMonoAudio)?"stereo=0;":"stereo=1;",o+="useinbandfec=1",n=n.replace("useinbandfec=1",o),n}handleOnIce(e){var t;l.Log(l.GetStackTrace(),"peerconnection handleOnIce",6),this.config.isFlagEnabled(we.ForceTURN)&&e.candidate.indexOf("relay")<0?l.Info(l.GetStackTrace(),`Dropping candidate because it was not TURN relay. | Type= ${e.type} | Protocol= ${e.protocol} | Address=${e.address} | Port=${e.port} |`,6):null===(t=this.peerConnection)||void 0===t||t.addIceCandidate(e)}handleSignalStateChange(e){l.Log(l.GetStackTrace(),"signaling state change: "+e,6)}handleIceConnectionStateChange(e){l.Log(l.GetStackTrace(),"ice connection state change: "+e,6),this.onIceConnectionStateChange(e)}handleIceGatheringStateChange(e){l.Log(l.GetStackTrace(),"ice gathering state change: "+JSON.stringify(e),6)}handleOnTrack(e){this.onTrack(e)}handleIceCandidate(e){this.onPeerIceCandidate(e)}handleDataChannel(e){this.onDataChannel(e)}onTrack(e){}onIceConnectionStateChange(e){}onPeerIceCandidate(e){}onDataChannel(e){}setupTransceiversAsync(e){var t,n,o,s,i,r,a,l,c;return Ye(this,void 0,void 0,(function*(){const d=(null===(t=this.peerConnection)||void 0===t?void 0:t.getTransceivers().length)>0;if(null===(n=this.peerConnection)||void 0===n||n.addTransceiver("video",{direction:"recvonly"}),RTCRtpReceiver.getCapabilities&&""!=this.preferredCodec)for(const e of null!==(s=null===(o=this.peerConnection)||void 0===o?void 0:o.getTransceivers())&&void 0!==s?s:[])if(e&&e.receiver&&e.receiver.track&&"video"===e.receiver.track.kind&&e.setCodecPreferences){const t=this.preferredCodec.split(" "),n=[{mimeType:"video/"+t[0],clockRate:9e4,sdpFmtpLine:t[1]?t[1]:""}];this.config.getSettingOption(Pe.PreferredCodec).options.filter((e=>e!=this.preferredCodec)).forEach((e=>{const t=e.split(" ");n.push({mimeType:"video/"+t[0],clockRate:9e4,sdpFmtpLine:t[1]?t[1]:""})}));for(const e of n)""===e.sdpFmtpLine&&delete e.sdpFmtpLine;e.setCodecPreferences(n)}if(e){const e={video:!1,audio:{autoGainControl:!1,channelCount:1,echoCancellation:!1,latency:0,noiseSuppression:!1,sampleRate:48e3,sampleSize:16,volume:1}},t=yield navigator.mediaDevices.getUserMedia(e);if(t)if(d){for(const e of null!==(a=null===(r=this.peerConnection)||void 0===r?void 0:r.getTransceivers())&&void 0!==a?a:[])if(Qe.canTransceiverReceiveAudio(e))for(const n of t.getTracks())n.kind&&"audio"==n.kind&&(e.sender.replaceTrack(n),e.direction="sendrecv")}else for(const e of t.getTracks())e.kind&&"audio"==e.kind&&(null===(l=this.peerConnection)||void 0===l||l.addTransceiver(e,{direction:"sendrecv"}));else null===(c=this.peerConnection)||void 0===c||c.addTransceiver("audio",{direction:"recvonly"})}else null===(i=this.peerConnection)||void 0===i||i.addTransceiver("audio",{direction:"recvonly"})}))}onVideoStats(e){}onSendWebRTCOffer(e){}onSendWebRTCAnswer(e){}showTextOverlayConnecting(){}showTextOverlaySetupFailure(){}parseAvailableCodecs(e){if(!RTCRtpReceiver.getCapabilities)return["Only available on Chrome"];const t=[],n=(0,$e.splitSections)(e.sdp);return n.shift(),n.forEach((e=>{const{codecs:n}=(0,$e.parseRtpParameters)(e),o=/(VP\d|H26\d|AV1).*/;n.forEach((e=>{const n=e.name+" "+Object.keys(e.parameters||{}).map((t=>t+"="+e.parameters[t])).join(";");if(null!==o.exec(n)){"VP9"==e.name&&(e.parameters={"profile-id":"0"});const n=e.name+" "+Object.keys(e.parameters||{}).map((t=>t+"="+e.parameters[t])).join(";");t.push(n)}}))})),t}}class et{constructor(){this.PixelStreamingSettings=new tt,this.EncoderSettings=new nt,this.WebRTCSettings=new ot}ueCompatible(){null!=this.WebRTCSettings.MaxFPS&&(this.WebRTCSettings.FPS=this.WebRTCSettings.MaxFPS)}}class tt{}class nt{}class ot{}class st{constructor(){this.ReceiptTimeMs=null,this.TransmissionTimeMs=null,this.PreCaptureTimeMs=null,this.PostCaptureTimeMs=null,this.PreEncodeTimeMs=null,this.PostEncodeTimeMs=null,this.EncodeMs=null,this.CaptureToSendMs=null,this.testStartTimeMs=0,this.browserReceiptTimeMs=0,this.latencyExcludingDecode=0,this.testDuration=0,this.networkLatency=0,this.browserSendLatency=0,this.frameDisplayDeltaTimeMs=0,this.endToEndLatency=0,this.encodeLatency=0}setFrameDisplayDeltaTime(e){0==this.frameDisplayDeltaTimeMs&&(this.frameDisplayDeltaTimeMs=Math.round(e))}processFields(){null!=this.EncodeMs||null==this.PreEncodeTimeMs&&null==this.PostEncodeTimeMs||(l.Log(l.GetStackTrace(),`Setting Encode Ms \n ${this.PostEncodeTimeMs} \n ${this.PreEncodeTimeMs}`,6),this.EncodeMs=this.PostEncodeTimeMs-this.PreEncodeTimeMs),null!=this.CaptureToSendMs||null==this.PreCaptureTimeMs&&null==this.PostCaptureTimeMs||(l.Log(l.GetStackTrace(),`Setting CaptureToSendMs Ms \n ${this.PostCaptureTimeMs} \n ${this.PreCaptureTimeMs}`,6),this.CaptureToSendMs=this.PostCaptureTimeMs-this.PreCaptureTimeMs)}}class it{static setExtensionFromBytes(e,t){t.receiving||(t.mimetype="",t.extension="",t.receiving=!0,t.valid=!1,t.size=0,t.data=[],t.timestampStart=(new Date).getTime(),l.Log(l.GetStackTrace(),"Received first chunk of file",6));const n=new TextDecoder("utf-16").decode(e.slice(1));l.Log(l.GetStackTrace(),n,6),t.extension=n}static setMimeTypeFromBytes(e,t){t.receiving||(t.mimetype="",t.extension="",t.receiving=!0,t.valid=!1,t.size=0,t.data=[],t.timestampStart=(new Date).getTime(),l.Log(l.GetStackTrace(),"Received first chunk of file",6));const n=new TextDecoder("utf-16").decode(e.slice(1));l.Log(l.GetStackTrace(),n,6),t.mimetype=n}static setContentsFromBytes(e,t){if(!t.receiving)return;t.size=Math.ceil(new DataView(e.slice(1,5).buffer).getInt32(0,!0)/16379);const n=e.slice(5);if(t.data.push(n),l.Log(l.GetStackTrace(),`Received file chunk: ${t.data.length}/${t.size}`,6),t.data.length===t.size){t.receiving=!1,t.valid=!0,l.Log(l.GetStackTrace(),"Received complete file",6);const e=(new Date).getTime()-t.timestampStart,n=Math.round(16*t.size*1024/e);l.Log(l.GetStackTrace(),`Average transfer bitrate: ${n}kb/s over ${e/1e3} seconds`,6);const o=new Blob(t.data,{type:t.mimetype}),s=document.createElement("a");s.setAttribute("href",URL.createObjectURL(o)),s.setAttribute("download",`transfer.${t.extension}`),document.body.append(s),s.remove()}else t.data.length>t.size&&(t.receiving=!1,l.Error(l.GetStackTrace(),`Received bigger file than advertised: ${t.data.length}/${t.size}`))}}class rt{constructor(){this.mimetype="",this.extension="",this.receiving=!1,this.size=0,this.data=[],this.valid=!1}}class lt{}lt.mainButton=0,lt.auxiliaryButton=1,lt.secondaryButton=2,lt.fourthButton=3,lt.fifthButton=4;class dt{}dt.primaryButton=1,dt.secondaryButton=2,dt.auxiliaryButton=4,dt.fourthButton=8,dt.fifthButton=16;class ut{constructor(){this.unregisterCallbacks=[]}addUnregisterCallback(e){this.unregisterCallbacks.push(e)}unregisterAll(){for(const e of this.unregisterCallbacks)e();this.unregisterCallbacks=[]}}class ht{constructor(e,t,n){this.touchEventListenerTracker=new ut,this.toStreamerMessagesProvider=e,this.videoElementProvider=t,this.coordinateConverter=n;const o=e=>this.onTouchStart(e),s=e=>this.onTouchEnd(e),i=e=>this.onTouchMove(e);document.addEventListener("touchstart",o,{passive:!1}),document.addEventListener("touchend",s,{passive:!1}),document.addEventListener("touchmove",i,{passive:!1}),this.touchEventListenerTracker.addUnregisterCallback((()=>document.removeEventListener("touchstart",o))),this.touchEventListenerTracker.addUnregisterCallback((()=>document.removeEventListener("touchend",s))),this.touchEventListenerTracker.addUnregisterCallback((()=>document.removeEventListener("touchmove",i)))}unregisterTouchEvents(){this.touchEventListenerTracker.unregisterAll()}setVideoElementParentClientRect(e){this.videoElementParentClientRect=e}onTouchStart(e){if(this.videoElementProvider.isVideoReady()&&e.target===this.videoElementProvider.getVideoElement()){if(null==this.fakeTouchFinger){const t=e.changedTouches[0];this.fakeTouchFinger=new mt(t.identifier,t.clientX-this.videoElementParentClientRect.left,t.clientY-this.videoElementParentClientRect.top);const n=this.videoElementProvider.getVideoParentElement(),o=new MouseEvent("mouseenter",t);n.dispatchEvent(o);const s=this.coordinateConverter.normalizeAndQuantizeUnsigned(this.fakeTouchFinger.x,this.fakeTouchFinger.y);this.toStreamerMessagesProvider.toStreamerHandlers.get("MouseDown")([lt.mainButton,s.x,s.y])}e.preventDefault()}}onTouchEnd(e){if(!this.videoElementProvider.isVideoReady()||null==this.fakeTouchFinger)return;const t=this.videoElementProvider.getVideoParentElement(),n=this.toStreamerMessagesProvider.toStreamerHandlers;for(let o=0;o<e.changedTouches.length;o++){const s=e.changedTouches[o];if(s.identifier===this.fakeTouchFinger.id){const e=s.clientX-this.videoElementParentClientRect.left,o=s.clientY-this.videoElementParentClientRect.top,i=this.coordinateConverter.normalizeAndQuantizeUnsigned(e,o);n.get("MouseUp")([lt.mainButton,i.x,i.y]);const r=new MouseEvent("mouseleave",s);t.dispatchEvent(r),this.fakeTouchFinger=null;break}}e.preventDefault()}onTouchMove(e){if(!this.videoElementProvider.isVideoReady()||null==this.fakeTouchFinger)return;const t=this.toStreamerMessagesProvider.toStreamerHandlers;for(let n=0;n<e.touches.length;n++){const o=e.touches[n];if(o.identifier===this.fakeTouchFinger.id){const e=o.clientX-this.videoElementParentClientRect.left,n=o.clientY-this.videoElementParentClientRect.top,s=this.coordinateConverter.normalizeAndQuantizeUnsigned(e,n),i=this.coordinateConverter.normalizeAndQuantizeSigned(e-this.fakeTouchFinger.x,n-this.fakeTouchFinger.y);t.get("MouseMove")([s.x,s.y,i.x,i.y]),this.fakeTouchFinger.x=e,this.fakeTouchFinger.y=n;break}}e.preventDefault()}}class mt{constructor(e,t,n){this.id=e,this.x=t,this.y=n}}class gt{}gt.backSpace=8,gt.shift=16,gt.control=17,gt.alt=18,gt.rightShift=253,gt.rightControl=254,gt.rightAlt=255;class pt{constructor(e,t,n){this.keyboardEventListenerTracker=new ut,this.CodeToKeyCode={Escape:27,Digit0:48,Digit1:49,Digit2:50,Digit3:51,Digit4:52,Digit5:53,Digit6:54,Digit7:55,Digit8:56,Digit9:57,Minus:173,Equal:187,Backspace:8,Tab:9,KeyQ:81,KeyW:87,KeyE:69,KeyR:82,KeyT:84,KeyY:89,KeyU:85,KeyI:73,KeyO:79,KeyP:80,BracketLeft:219,BracketRight:221,Enter:13,ControlLeft:17,KeyA:65,KeyS:83,KeyD:68,KeyF:70,KeyG:71,KeyH:72,KeyJ:74,KeyK:75,KeyL:76,Semicolon:186,Quote:222,Backquote:192,ShiftLeft:16,Backslash:220,KeyZ:90,KeyX:88,KeyC:67,KeyV:86,KeyB:66,KeyN:78,KeyM:77,Comma:188,Period:190,Slash:191,ShiftRight:253,AltLeft:18,Space:32,CapsLock:20,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,Pause:19,ScrollLock:145,NumpadDivide:111,NumpadMultiply:106,NumpadSubtract:109,NumpadAdd:107,NumpadDecimal:110,Numpad9:105,Numpad8:104,Numpad7:103,Numpad6:102,Numpad5:101,Numpad4:100,Numpad3:99,Numpad2:98,Numpad1:97,Numpad0:96,NumLock:144,ControlRight:254,AltRight:255,Home:36,End:35,ArrowUp:38,ArrowLeft:37,ArrowRight:39,ArrowDown:40,PageUp:33,PageDown:34,Insert:45,Delete:46,ContextMenu:93},this.toStreamerMessagesProvider=e,this.config=t,this.activeKeysProvider=n}registerKeyBoardEvents(){const e=e=>this.handleOnCompositionEnd(e),t=e=>this.handleOnKeyDown(e),n=e=>this.handleOnKeyUp(e),o=e=>this.handleOnKeyPress(e);document.addEventListener("compositionend",e),document.addEventListener("keydown",t),document.addEventListener("keyup",n),document.addEventListener("keypress",o),this.keyboardEventListenerTracker.addUnregisterCallback((()=>document.removeEventListener("compositionend",e))),this.keyboardEventListenerTracker.addUnregisterCallback((()=>document.removeEventListener("keydown",t))),this.keyboardEventListenerTracker.addUnregisterCallback((()=>document.removeEventListener("keyup",n))),this.keyboardEventListenerTracker.addUnregisterCallback((()=>document.removeEventListener("keypress",o)))}unregisterKeyBoardEvents(){this.keyboardEventListenerTracker.unregisterAll()}handleOnKeyDown(e){const t=this.getKeycode(e);t&&229!==t&&(l.Log(l.GetStackTrace(),`key down ${t}, repeat = ${e.repeat}`,6),this.toStreamerMessagesProvider.toStreamerHandlers.get("KeyDown")([this.getKeycode(e),e.repeat?1:0]),this.activeKeysProvider.getActiveKeys().push(t),t===gt.backSpace&&document.dispatchEvent(new KeyboardEvent("keypress",{charCode:gt.backSpace})),this.config.isFlagEnabled(we.SuppressBrowserKeys)&&this.isKeyCodeBrowserKey(t)&&e.preventDefault())}handleOnKeyUp(e){const t=this.getKeycode(e);t&&(l.Log(l.GetStackTrace(),`key up ${t}`,6),this.toStreamerMessagesProvider.toStreamerHandlers.get("KeyUp")([t]),this.config.isFlagEnabled(we.SuppressBrowserKeys)&&this.isKeyCodeBrowserKey(t)&&e.preventDefault())}handleOnKeyPress(e){if(!("charCode"in e))return void l.Warning(l.GetStackTrace(),"KeyboardEvent.charCode is deprecated in this browser, cannot send key press.");const t=e.charCode;l.Log(l.GetStackTrace(),`key press ${t}`,6),this.toStreamerMessagesProvider.toStreamerHandlers.get("KeyPress")([t])}handleOnCompositionEnd(e){e.data&&e.data.length&&e.data.split("").forEach((e=>{this.handleOnKeyDown(new KeyboardEvent("keydown",{keyCode:e.toUpperCase().charCodeAt(0),charCode:e.charCodeAt(0)})),this.handleOnKeyPress(new KeyboardEvent("keypress",{keyCode:e.toUpperCase().charCodeAt(0),charCode:e.charCodeAt(0)})),this.handleOnKeyUp(new KeyboardEvent("keyup",{keyCode:e.toUpperCase().charCodeAt(0),charCode:e.charCodeAt(0)}))}))}getKeycode(e){if(!("keyCode"in e)){const t=e;return t.code in this.CodeToKeyCode?this.CodeToKeyCode[t.code]:(l.Warning(l.GetStackTrace(),`Keyboard code of ${t.code} is not supported in our mapping, ignoring this key.`),null)}return e.keyCode===gt.shift&&"ShiftRight"===e.code?gt.rightShift:e.keyCode===gt.control&&"ControlRight"===e.code?gt.rightControl:e.keyCode===gt.alt&&"AltRight"===e.code?gt.rightAlt:e.keyCode}isKeyCodeBrowserKey(e){return e>=112&&e<=123||9===e}}class ft{constructor(e,t,n){this.x=0,this.y=0,this.updateMouseMovePositionEvent=e=>{this.updateMouseMovePosition(e)},this.mouseEventListenerTracker=new ut,this.videoElementProvider=e,this.mouseController=t,this.activeKeysProvider=n;const o=this.videoElementProvider.getVideoParentElement();this.x=o.getBoundingClientRect().width/2,this.y=o.getBoundingClientRect().height/2,this.coord=this.mouseController.coordinateConverter.normalizeAndQuantizeUnsigned(this.x,this.y)}unregisterMouseEvents(){this.mouseEventListenerTracker.unregisterAll()}lockStateChange(){const e=this.videoElementProvider.getVideoParentElement(),t=this.mouseController.toStreamerMessagesProvider.toStreamerHandlers;if(document.pointerLockElement===e||document.mozPointerLockElement===e)l.Log(l.GetStackTrace(),"Pointer locked",6),document.addEventListener("mousemove",this.updateMouseMovePositionEvent,!1),this.mouseEventListenerTracker.addUnregisterCallback((()=>document.removeEventListener("mousemove",this.updateMouseMovePositionEvent,!1)));else{l.Log(l.GetStackTrace(),"The pointer lock status is now unlocked",6),document.removeEventListener("mousemove",this.updateMouseMovePositionEvent,!1);let e=this.activeKeysProvider.getActiveKeys();const n=new Set(e),o=[];n.forEach((e=>{o[e]})),o.forEach((e=>{t.get("KeyUp")([e])})),e=[]}}updateMouseMovePosition(e){if(!this.videoElementProvider.isVideoReady())return;const t=this.mouseController.toStreamerMessagesProvider.toStreamerHandlers,n=this.videoElementProvider.getVideoParentElement().clientWidth,o=this.videoElementProvider.getVideoParentElement().clientHeight;this.x+=e.movementX,this.y+=e.movementY,this.x>n&&(this.x-=n),this.y>o&&(this.y-=o),this.x<0&&(this.x=n+this.x),this.y<0&&(this.y=o-this.y),this.coord=this.mouseController.coordinateConverter.normalizeAndQuantizeUnsigned(this.x,this.y);const s=this.mouseController.coordinateConverter.normalizeAndQuantizeSigned(e.movementX,e.movementY);t.get("MouseMove")([this.coord.x,this.coord.y,s.x,s.y])}handleMouseDown(e){this.videoElementProvider.isVideoReady()&&this.mouseController.toStreamerMessagesProvider.toStreamerHandlers.get("MouseDown")([e.button,this.coord.x,this.coord.y])}handleMouseUp(e){this.videoElementProvider.isVideoReady()&&this.mouseController.toStreamerMessagesProvider.toStreamerHandlers.get("MouseUp")([e.button,this.coord.x,this.coord.y])}handleMouseWheel(e){this.videoElementProvider.isVideoReady()&&this.mouseController.toStreamerMessagesProvider.toStreamerHandlers.get("MouseWheel")([e.wheelDelta,this.coord.x,this.coord.y])}handleMouseDouble(e){this.videoElementProvider.isVideoReady()&&this.mouseController.toStreamerMessagesProvider.toStreamerHandlers.get("MouseDouble")([e.button,this.coord.x,this.coord.y])}handlePressMouseButtons(e){this.videoElementProvider.isVideoReady()&&this.mouseController.pressMouseButtons(e.buttons,this.x,this.y)}handleReleaseMouseButtons(e){this.videoElementProvider.isVideoReady()&&this.mouseController.releaseMouseButtons(e.buttons,this.x,this.y)}}class vt{constructor(e){this.mouseController=e}unregisterMouseEvents(){}updateMouseMovePosition(e){if(!this.mouseController.videoElementProvider.isVideoReady())return;l.Log(l.GetStackTrace(),"MouseMove",6);const t=this.mouseController.coordinateConverter.normalizeAndQuantizeUnsigned(e.offsetX,e.offsetY),n=this.mouseController.coordinateConverter.normalizeAndQuantizeSigned(e.movementX,e.movementY);this.mouseController.toStreamerMessagesProvider.toStreamerHandlers.get("MouseMove")([t.x,t.y,n.x,n.y]),e.preventDefault()}handleMouseDown(e){if(!this.mouseController.videoElementProvider.isVideoReady())return;l.Log(l.GetStackTrace(),"onMouse Down",6);const t=this.mouseController.coordinateConverter.normalizeAndQuantizeUnsigned(e.offsetX,e.offsetY);this.mouseController.toStreamerMessagesProvider.toStreamerHandlers.get("MouseDown")([e.button,t.x,t.y]),e.preventDefault()}handleMouseUp(e){if(!this.mouseController.videoElementProvider.isVideoReady())return;l.Log(l.GetStackTrace(),"onMouse Up",6);const t=this.mouseController.coordinateConverter.normalizeAndQuantizeUnsigned(e.offsetX,e.offsetY);this.mouseController.toStreamerMessagesProvider.toStreamerHandlers.get("MouseUp")([e.button,t.x,t.y]),e.preventDefault()}handleContextMenu(e){this.mouseController.videoElementProvider.isVideoReady()&&e.preventDefault()}handleMouseWheel(e){if(!this.mouseController.videoElementProvider.isVideoReady())return;const t=this.mouseController.coordinateConverter.normalizeAndQuantizeUnsigned(e.offsetX,e.offsetY);this.mouseController.toStreamerMessagesProvider.toStreamerHandlers.get("MouseWheel")([e.wheelDelta,t.x,t.y]),e.preventDefault()}handleMouseDouble(e){if(!this.mouseController.videoElementProvider.isVideoReady())return;const t=this.mouseController.coordinateConverter.normalizeAndQuantizeUnsigned(e.offsetX,e.offsetY);this.mouseController.toStreamerMessagesProvider.toStreamerHandlers.get("MouseDouble")([e.button,t.x,t.y])}handlePressMouseButtons(e){this.mouseController.videoElementProvider.isVideoReady()&&(l.Log(l.GetStackTrace(),"onMouse press",6),this.mouseController.pressMouseButtons(e.buttons,e.offsetX,e.offsetY))}handleReleaseMouseButtons(e){this.mouseController.videoElementProvider.isVideoReady()&&(l.Log(l.GetStackTrace(),"onMouse release",6),this.mouseController.releaseMouseButtons(e.buttons,e.offsetX,e.offsetY))}}class yt{constructor(e,t,n,o){this.mouseEventListenerTracker=new ut,this.toStreamerMessagesProvider=e,this.coordinateConverter=n,this.videoElementProvider=t,this.activeKeysProvider=o,this.registerMouseEnterAndLeaveEvents()}unregisterMouseEvents(){this.mouseEventListenerTracker.unregisterAll()}registerLockedMouseEvents(e){const t=this.videoElementProvider.getVideoParentElement(),n=new ft(this.videoElementProvider,e,this.activeKeysProvider);if(t.requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock,t.requestPointerLock){const e=()=>{t.requestPointerLock()};t.addEventListener("click",e),this.mouseEventListenerTracker.addUnregisterCallback((()=>t.removeEventListener("click",e)))}const o=()=>n.lockStateChange();document.addEventListener("pointerlockchange",o,!1),document.addEventListener("mozpointerlockchange",o,!1),this.mouseEventListenerTracker.addUnregisterCallback((()=>document.removeEventListener("pointerlockchange",o,!1))),this.mouseEventListenerTracker.addUnregisterCallback((()=>document.removeEventListener("mozpointerlockchange",o,!1)));const s=e=>n.handleMouseDown(e),i=e=>n.handleMouseUp(e),r=e=>n.handleMouseWheel(e),a=e=>n.handleMouseDouble(e);t.addEventListener("mousedown",s),t.addEventListener("mouseup",i),t.addEventListener("wheel",r),t.addEventListener("dblclick",a),this.mouseEventListenerTracker.addUnregisterCallback((()=>t.removeEventListener("mousedown",s))),this.mouseEventListenerTracker.addUnregisterCallback((()=>t.removeEventListener("mouseup",i))),this.mouseEventListenerTracker.addUnregisterCallback((()=>t.removeEventListener("wheel",r))),this.mouseEventListenerTracker.addUnregisterCallback((()=>t.removeEventListener("dblclick",a))),this.mouseEventListenerTracker.addUnregisterCallback((()=>n.unregisterMouseEvents())),this.mouseEventListenerTracker.addUnregisterCallback((()=>{!document.exitPointerLock||document.pointerLockElement!==t&&document.mozPointerLockElement!==t||document.exitPointerLock()}))}registerHoveringMouseEvents(e){const t=this.videoElementProvider.getVideoParentElement(),n=new vt(e),o=e=>n.updateMouseMovePosition(e),s=e=>n.handleMouseDown(e),i=e=>n.handleMouseUp(e),r=e=>n.handleContextMenu(e),a=e=>n.handleMouseWheel(e),l=e=>n.handleMouseDouble(e);t.addEventListener("mousemove",o),t.addEventListener("mousedown",s),t.addEventListener("mouseup",i),t.addEventListener("contextmenu",r),t.addEventListener("wheel",a),t.addEventListener("dblclick",l),this.mouseEventListenerTracker.addUnregisterCallback((()=>t.removeEventListener("mousemove",o))),this.mouseEventListenerTracker.addUnregisterCallback((()=>t.removeEventListener("mousedown",s))),this.mouseEventListenerTracker.addUnregisterCallback((()=>t.removeEventListener("mouseup",i))),this.mouseEventListenerTracker.addUnregisterCallback((()=>t.removeEventListener("contextmenu",r))),this.mouseEventListenerTracker.addUnregisterCallback((()=>t.removeEventListener("wheel",a))),this.mouseEventListenerTracker.addUnregisterCallback((()=>t.removeEventListener("dblclick",l))),this.mouseEventListenerTracker.addUnregisterCallback((()=>n.unregisterMouseEvents()))}registerMouseEnterAndLeaveEvents(){const e=this.videoElementProvider.getVideoParentElement(),t=e=>{this.videoElementProvider.isVideoReady()&&(l.Log(l.GetStackTrace(),"Mouse Entered",6),this.sendMouseEnter(),this.pressMouseButtons(e.buttons,e.x,e.y))},n=e=>{this.videoElementProvider.isVideoReady()&&(l.Log(l.GetStackTrace(),"Mouse Left",6),this.sendMouseLeave(),this.releaseMouseButtons(e.buttons,e.x,e.y))};e.addEventListener("mouseenter",t),e.addEventListener("mouseleave",n),this.mouseEventListenerTracker.addUnregisterCallback((()=>e.removeEventListener("mouseenter",t))),this.mouseEventListenerTracker.addUnregisterCallback((()=>e.removeEventListener("mouseleave",n)))}releaseMouseButtons(e,t,n){const o=this.coordinateConverter.normalizeAndQuantizeUnsigned(t,n);e&dt.primaryButton&&this.sendMouseUp(lt.mainButton,o.x,o.y),e&dt.secondaryButton&&this.sendMouseUp(lt.secondaryButton,o.x,o.y),e&dt.auxiliaryButton&&this.sendMouseUp(lt.auxiliaryButton,o.x,o.y),e&dt.fourthButton&&this.sendMouseUp(lt.fourthButton,o.x,o.y),e&dt.fifthButton&&this.sendMouseUp(lt.fifthButton,o.x,o.y)}pressMouseButtons(e,t,n){if(!this.videoElementProvider.isVideoReady())return;const o=this.coordinateConverter.normalizeAndQuantizeUnsigned(t,n);e&dt.primaryButton&&this.sendMouseDown(lt.mainButton,o.x,o.y),e&dt.secondaryButton&&this.sendMouseDown(lt.secondaryButton,o.x,o.y),e&dt.auxiliaryButton&&this.sendMouseDown(lt.auxiliaryButton,o.x,o.y),e&dt.fourthButton&&this.sendMouseDown(lt.fourthButton,o.x,o.y),e&dt.fifthButton&&this.sendMouseDown(lt.fifthButton,o.x,o.y)}sendMouseEnter(){this.videoElementProvider.isVideoReady()&&this.toStreamerMessagesProvider.toStreamerHandlers.get("MouseEnter")()}sendMouseLeave(){this.videoElementProvider.isVideoReady()&&this.toStreamerMessagesProvider.toStreamerHandlers.get("MouseLeave")()}sendMouseDown(e,t,n){this.videoElementProvider.isVideoReady()&&(l.Log(l.GetStackTrace(),`mouse button ${e} down at (${t}, ${n})`,6),this.toStreamerMessagesProvider.toStreamerHandlers.get("MouseDown")([e,t,n]))}sendMouseUp(e,t,n){if(!this.videoElementProvider.isVideoReady())return;l.Log(l.GetStackTrace(),`mouse button ${e} up at (${t}, ${n})`,6);const o=this.coordinateConverter.normalizeAndQuantizeUnsigned(t,n);this.toStreamerMessagesProvider.toStreamerHandlers.get("MouseUp")([e,o.x,o.y])}}class St{constructor(e,t,n){this.fingers=[9,8,7,6,5,4,3,2,1,0],this.fingerIds=new Map,this.maxByteValue=255,this.touchEventListenerTracker=new ut,this.toStreamerMessagesProvider=e,this.videoElementProvider=t,this.coordinateConverter=n,this.videoElementParent=t.getVideoElement();const o=e=>this.onTouchStart(e),s=e=>this.onTouchEnd(e),i=e=>this.onTouchMove(e);this.videoElementParent.addEventListener("touchstart",o),this.videoElementParent.addEventListener("touchend",s),this.videoElementParent.addEventListener("touchmove",i),this.touchEventListenerTracker.addUnregisterCallback((()=>this.videoElementParent.removeEventListener("touchstart",o))),this.touchEventListenerTracker.addUnregisterCallback((()=>this.videoElementParent.removeEventListener("touchend",s))),this.touchEventListenerTracker.addUnregisterCallback((()=>this.videoElementParent.removeEventListener("touchmove",i))),l.Log(l.GetStackTrace(),"Touch Events Registered",6);const r=e=>{e.preventDefault()};document.addEventListener("touchmove",r),this.touchEventListenerTracker.addUnregisterCallback((()=>document.removeEventListener("touchmove",r)))}unregisterTouchEvents(){this.touchEventListenerTracker.unregisterAll()}rememberTouch(e){const t=this.fingers.pop();void 0===t&&l.Log(l.GetStackTrace(),"exhausted touch identifiers",6),this.fingerIds.set(e.identifier,t)}forgetTouch(e){this.fingers.push(this.fingerIds.get(e.identifier)),this.fingers.sort((function(e,t){return t-e})),this.fingerIds.delete(e.identifier)}onTouchStart(e){if(this.videoElementProvider.isVideoReady()){for(let t=0;t<e.changedTouches.length;t++)this.rememberTouch(e.changedTouches[t]);l.Log(l.GetStackTrace(),"touch start",6),this.emitTouchData("TouchStart",e.changedTouches),e.preventDefault()}}onTouchEnd(e){if(this.videoElementProvider.isVideoReady()){l.Log(l.GetStackTrace(),"touch end",6),this.emitTouchData("TouchEnd",e.changedTouches);for(let t=0;t<e.changedTouches.length;t++)this.forgetTouch(e.changedTouches[t]);e.preventDefault()}}onTouchMove(e){this.videoElementProvider.isVideoReady()&&(l.Log(l.GetStackTrace(),"touch move",6),this.emitTouchData("TouchMove",e.touches),e.preventDefault())}emitTouchData(e,t){if(!this.videoElementProvider.isVideoReady())return;const n=this.videoElementProvider.getVideoParentElement().getBoundingClientRect(),o=this.toStreamerMessagesProvider.toStreamerHandlers;for(let s=0;s<t.length;s++){const i=1,r=t[s],a=r.clientX-n.left,c=r.clientY-n.top;l.Log(l.GetStackTrace(),`F${this.fingerIds.get(r.identifier)}=(${a}, ${c})`,6);const d=this.coordinateConverter.normalizeAndQuantizeUnsigned(a,c);switch(e){case"TouchStart":o.get("TouchStart")([i,d.x,d.y,this.fingerIds.get(r.identifier),this.maxByteValue*(r.force>0?r.force:1),d.inRange?1:0]);break;case"TouchEnd":o.get("TouchEnd")([i,d.x,d.y,this.fingerIds.get(r.identifier),this.maxByteValue*r.force,d.inRange?1:0]);break;case"TouchMove":o.get("TouchMove")([i,d.x,d.y,this.fingerIds.get(r.identifier),this.maxByteValue*(r.force>0?r.force:1),d.inRange?1:0])}}}}class Ct{constructor(e){this.gamePadEventListenerTracker=new ut,this.toStreamerMessagesProvider=e,this.requestAnimationFrame=(window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.requestAnimationFrame).bind(window);const t=window;if(window.addEventListener("beforeunload",(e=>this.onBeforeUnload(e))),"GamepadEvent"in t){const e=e=>this.gamePadConnectHandler(e),t=e=>this.gamePadDisconnectHandler(e);window.addEventListener("gamepadconnected",e),window.addEventListener("gamepaddisconnected",t),this.gamePadEventListenerTracker.addUnregisterCallback((()=>window.removeEventListener("gamepadconnected",e))),this.gamePadEventListenerTracker.addUnregisterCallback((()=>window.removeEventListener("gamepaddisconnected",t)))}else if("WebKitGamepadEvent"in t){const e=e=>this.gamePadConnectHandler(e),t=e=>this.gamePadDisconnectHandler(e);window.addEventListener("webkitgamepadconnected",e),window.addEventListener("webkitgamepaddisconnected",t),this.gamePadEventListenerTracker.addUnregisterCallback((()=>window.removeEventListener("webkitgamepadconnected",e))),this.gamePadEventListenerTracker.addUnregisterCallback((()=>window.removeEventListener("webkitgamepaddisconnected",t)))}if(this.controllers=[],navigator.getGamepads)for(const e of navigator.getGamepads())e&&this.gamePadConnectHandler(new GamepadEvent("gamepadconnected",{gamepad:e}))}unregisterGamePadEvents(){this.gamePadEventListenerTracker.unregisterAll();for(const e of this.controllers)void 0!==e.id&&this.onGamepadDisconnected(e.id);this.controllers=[],this.onGamepadConnected=()=>{},this.onGamepadDisconnected=()=>{}}gamePadConnectHandler(e){l.Log(l.GetStackTrace(),"Gamepad connect handler",6);const t=e.gamepad,n={currentState:t,prevState:t,id:void 0};this.controllers.push(n),this.controllers[t.index].currentState=t,this.controllers[t.index].prevState=t,l.Log(l.GetStackTrace(),"gamepad: "+t.id+" connected",6),window.requestAnimationFrame((()=>this.updateStatus())),this.onGamepadConnected()}gamePadDisconnectHandler(e){l.Log(l.GetStackTrace(),"Gamepad disconnect handler",6),l.Log(l.GetStackTrace(),"gamepad: "+e.gamepad.id+" disconnected",6);const t=this.controllers[e.gamepad.index];delete this.controllers[e.gamepad.index],this.controllers=this.controllers.filter((e=>void 0!==e)),this.onGamepadDisconnected(t.id)}scanGamePads(){const e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];for(let t=0;t<e.length;t++)e[t]&&e[t].index in this.controllers&&(this.controllers[e[t].index].currentState=e[t])}updateStatus(){this.scanGamePads();const e=this.toStreamerMessagesProvider.toStreamerHandlers;for(const t of this.controllers){const n=void 0===t.id?this.controllers.indexOf(t):t.id,o=t.currentState;for(let o=0;o<t.currentState.buttons.length;o++){const s=t.currentState.buttons[o],i=t.prevState.buttons[o];s.pressed?o==Ke.LeftTrigger?e.get("GamepadAnalog")([n,5,s.value]):o==Ke.RightTrigger?e.get("GamepadAnalog")([n,6,s.value]):e.get("GamepadButtonPressed")([n,o,i.pressed?1:0]):!s.pressed&&i.pressed&&(o==Ke.LeftTrigger?e.get("GamepadAnalog")([n,5,0]):o==Ke.RightTrigger?e.get("GamepadAnalog")([n,6,0]):e.get("GamepadButtonReleased")([n,o,0]))}for(let t=0;t<o.axes.length;t+=2){const s=parseFloat(o.axes[t].toFixed(4)),i=-parseFloat(o.axes[t+1].toFixed(4));e.get("GamepadAnalog")([n,t+1,s]),e.get("GamepadAnalog")([n,t+2,i])}this.controllers[n].prevState=o}this.controllers.length>0&&this.requestAnimationFrame((()=>this.updateStatus()))}onGamepadResponseReceived(e){for(const t of this.controllers)if(void 0===t.id){t.id=e;break}}onGamepadConnected(){}onGamepadDisconnected(e){}onBeforeUnload(e){for(const e of this.controllers)this.onGamepadDisconnected(e.id)}}!function(e){e[e.RightClusterBottomButton=0]="RightClusterBottomButton",e[e.RightClusterRightButton=1]="RightClusterRightButton",e[e.RightClusterLeftButton=2]="RightClusterLeftButton",e[e.RightClusterTopButton=3]="RightClusterTopButton",e[e.LeftShoulder=4]="LeftShoulder",e[e.RightShoulder=5]="RightShoulder",e[e.LeftTrigger=6]="LeftTrigger",e[e.RightTrigger=7]="RightTrigger",e[e.SelectOrBack=8]="SelectOrBack",e[e.StartOrForward=9]="StartOrForward",e[e.LeftAnalogPress=10]="LeftAnalogPress",e[e.RightAnalogPress=11]="RightAnalogPress",e[e.LeftClusterTopButton=12]="LeftClusterTopButton",e[e.LeftClusterBottomButton=13]="LeftClusterBottomButton",e[e.LeftClusterLeftButton=14]="LeftClusterLeftButton",e[e.LeftClusterRightButton=15]="LeftClusterRightButton",e[e.CentreButton=16]="CentreButton",e[e.LeftStickHorizontal=0]="LeftStickHorizontal",e[e.LeftStickVertical=1]="LeftStickVertical",e[e.RightStickHorizontal=2]="RightStickHorizontal",e[e.RightStickVertical=3]="RightStickVertical"}(Ke||(Ke={}));class wt{constructor(e,t,n){this.activeKeys=new Et,this.toStreamerMessagesProvider=e,this.videoElementProvider=t,this.coordinateConverter=n}registerKeyBoard(e){l.Log(l.GetStackTrace(),"Register Keyboard Events",7);const t=new pt(this.toStreamerMessagesProvider,e,this.activeKeys);return t.registerKeyBoardEvents(),t}registerMouse(e){l.Log(l.GetStackTrace(),"Register Mouse Events",7);const t=new yt(this.toStreamerMessagesProvider,this.videoElementProvider,this.coordinateConverter,this.activeKeys);switch(e){case Me.LockedMouse:t.registerLockedMouseEvents(t);break;case Me.HoveringMouse:t.registerHoveringMouseEvents(t);break;default:l.Info(l.GetStackTrace(),"unknown Control Scheme Type Defaulting to Locked Mouse Events"),t.registerHoveringMouseEvents(t)}return t}registerTouch(e,t){if(l.Log(l.GetStackTrace(),"Registering Touch",6),e){const e=new ht(this.toStreamerMessagesProvider,this.videoElementProvider,this.coordinateConverter);return e.setVideoElementParentClientRect(t),e}return new St(this.toStreamerMessagesProvider,this.videoElementProvider,this.coordinateConverter)}registerGamePad(){return l.Log(l.GetStackTrace(),"Register Game Pad",7),new Ct(this.toStreamerMessagesProvider)}}class Et{constructor(){this.activeKeys=[],this.activeKeys=[]}getActiveKeys(){return this.activeKeys}}class Tt{constructor(e,t){this.lastTimeResized=(new Date).getTime(),this.videoElement=document.createElement("video"),this.config=t,this.videoElement.id="streamingVideo",this.videoElement.disablePictureInPicture=!0,this.videoElement.playsInline=!0,this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.pointerEvents="all",e.appendChild(this.videoElement),this.onResizePlayerCallback=()=>{console.log("Resolution changed, restyling player, did you forget to override this function?")},this.onMatchViewportResolutionCallback=()=>{console.log("Resolution changed and match viewport resolution is turned on, did you forget to override this function?")},this.videoElement.onclick=()=>{null!=this.audioElement&&this.audioElement.paused&&this.audioElement.play(),this.videoElement.paused&&this.videoElement.play()},this.videoElement.onloadedmetadata=()=>{this.onVideoInitialized()},window.addEventListener("resize",(()=>this.resizePlayerStyle()),!0),window.addEventListener("orientationchange",(()=>this.onOrientationChange()))}setAudioElement(e){this.audioElement=e}play(){return this.videoElement.muted=this.config.isFlagEnabled(we.StartVideoMuted),this.videoElement.autoplay=this.config.isFlagEnabled(we.AutoPlayVideo),this.videoElement.play()}isPaused(){return this.videoElement.paused}isVideoReady(){return void 0!==this.videoElement.readyState&&this.videoElement.readyState>0}hasVideoSource(){return void 0!==this.videoElement.srcObject&&null!==this.videoElement.srcObject}getVideoElement(){return this.videoElement}getVideoParentElement(){return this.videoElement.parentElement}setVideoEnabled(e){this.videoElement.srcObject.getTracks().forEach((t=>t.enabled=e))}onVideoInitialized(){}onOrientationChange(){clearTimeout(this.orientationChangeTimeout),this.orientationChangeTimeout=window.setTimeout((()=>{this.resizePlayerStyle()}),500)}resizePlayerStyle(){const e=this.getVideoParentElement();e&&(this.updateVideoStreamSize(),e.classList.contains("fixed-size")||this.resizePlayerStyleToFillParentElement(),this.onResizePlayerCallback())}resizePlayerStyleToFillParentElement(){const e=this.getVideoParentElement();let t;t="0"==bt.showbrowserMouse?"cursor: none":bt.mouseCursorPointerStyle,e.setAttribute("style","top: 0px; left: 0px; width: 100%; height: 100%;"+t+";")}updateVideoStreamSize(){if("Dynamic"===bt.resolutionType_ue4)if((new Date).getTime()-this.lastTimeResized>300){const e=this.getVideoParentElement();e?this.onMatchViewportResolutionCallback(e.clientWidth,e.clientHeight):this.onMatchViewportResolutionCallback(window.innerWidth,window.innerHeight),this.lastTimeResized=(new Date).getTime()}else l.Log(l.GetStackTrace(),"Resizing too often - skipping",6),clearTimeout(this.resizeTimeoutHandle),this.resizeTimeoutHandle=window.setTimeout((()=>this.updateVideoStreamSize()),100)}}class kt{constructor(){this.toStreamerHandlers=new Map,this.fromStreamerHandlers=new Map,this.toStreamerMessages=new Map,this.fromStreamerMessages=new Map}populateDefaultProtocol(){this.toStreamerMessages.set("IFrameRequest",{id:0,structure:[]}),this.toStreamerMessages.set("RequestQualityControl",{id:1,structure:[]}),this.toStreamerMessages.set("FpsRequest",{id:2,structure:[]}),this.toStreamerMessages.set("AverageBitrateRequest",{id:3,structure:[]}),this.toStreamerMessages.set("StartStreaming",{id:4,structure:[]}),this.toStreamerMessages.set("StopStreaming",{id:5,structure:[]}),this.toStreamerMessages.set("LatencyTest",{id:6,structure:["string"]}),this.toStreamerMessages.set("RequestInitialSettings",{id:7,structure:[]}),this.toStreamerMessages.set("TestEcho",{id:8,structure:[]}),this.toStreamerMessages.set("DataChannelLatencyTest",{id:9,structure:[]}),this.toStreamerMessages.set("UIInteraction",{id:50,structure:["string"]}),this.toStreamerMessages.set("Command",{id:51,structure:["string"]}),this.toStreamerMessages.set("KeyDown",{id:60,structure:["uint8","uint8"]}),this.toStreamerMessages.set("KeyUp",{id:61,structure:["uint8"]}),this.toStreamerMessages.set("KeyPress",{id:62,structure:["uint16"]}),this.toStreamerMessages.set("MouseEnter",{id:70,structure:[]}),this.toStreamerMessages.set("MouseLeave",{id:71,structure:[]}),this.toStreamerMessages.set("MouseDown",{id:72,structure:["uint8","uint16","uint16"]}),this.toStreamerMessages.set("MouseUp",{id:73,structure:["uint8","uint16","uint16"]}),this.toStreamerMessages.set("MouseMove",{id:74,structure:["uint16","uint16","int16","int16"]}),this.toStreamerMessages.set("MouseWheel",{id:75,structure:["int16","uint16","uint16"]}),this.toStreamerMessages.set("MouseDouble",{id:76,structure:["uint8","uint16","uint16"]}),this.toStreamerMessages.set("TouchStart",{id:80,structure:["uint8","uint16","uint16","uint8","uint8","uint8"]}),this.toStreamerMessages.set("TouchEnd",{id:81,structure:["uint8","uint16","uint16","uint8","uint8","uint8"]}),this.toStreamerMessages.set("TouchMove",{id:82,structure:["uint8","uint16","uint16","uint8","uint8","uint8"]}),this.toStreamerMessages.set("GamepadConnected",{id:93,structure:[]}),this.toStreamerMessages.set("GamepadButtonPressed",{id:90,structure:["uint8","uint8","uint8"]}),this.toStreamerMessages.set("GamepadButtonReleased",{id:91,structure:["uint8","uint8","uint8"]}),this.toStreamerMessages.set("GamepadAnalog",{id:92,structure:["uint8","uint8","double"]}),this.toStreamerMessages.set("GamepadDisconnected",{id:94,structure:["uint8"]}),this.fromStreamerMessages.set(0,"QualityControlOwnership"),this.fromStreamerMessages.set(1,"Response"),this.fromStreamerMessages.set(2,"Command"),this.fromStreamerMessages.set(3,"FreezeFrame"),this.fromStreamerMessages.set(4,"UnfreezeFrame"),this.fromStreamerMessages.set(5,"VideoEncoderAvgQP"),this.fromStreamerMessages.set(6,"LatencyTest"),this.fromStreamerMessages.set(7,"InitialSettings"),this.fromStreamerMessages.set(8,"FileExtension"),this.fromStreamerMessages.set(9,"FileMimeType"),this.fromStreamerMessages.set(10,"FileContents"),this.fromStreamerMessages.set(11,"TestEcho"),this.fromStreamerMessages.set(12,"InputControlOwnership"),this.fromStreamerMessages.set(13,"GamepadResponse"),this.fromStreamerMessages.set(14,"DataChannelLatencyTest"),this.fromStreamerMessages.set(255,"Protocol")}registerMessageHandler(e,t,n){switch(e){case Xe.ToStreamer:this.toStreamerHandlers.set(t,n);break;case Xe.FromStreamer:this.fromStreamerHandlers.set(t,n);break;default:l.Log(l.GetStackTrace(),`Unknown message direction ${e}`)}}}!function(e){e[e.ToStreamer=0]="ToStreamer",e[e.FromStreamer=1]="FromStreamer"}(Xe||(Xe={}));class xt{constructor(){this.responseEventListeners=new Map}addResponseEventListener(e,t){this.responseEventListeners.set(e,t)}removeResponseEventListener(e){this.responseEventListeners.delete(e)}onResponse(e){l.Log(l.GetStackTrace(),"DataChannelReceiveMessageType.Response",6);const t=new TextDecoder("utf-16").decode(e.slice(1));l.Log(l.GetStackTrace(),t,6),this.responseEventListeners.forEach((e=>{e(t)}))}}class Pt{constructor(e,t){this.dataChannelSender=e,this.toStreamerMessagesMapProvider=t}sendMessageToStreamer(e,t){void 0===t&&(t=[]);const n=this.toStreamerMessagesMapProvider.toStreamerMessages.get(e);if(void 0===n)return void l.Error(l.GetStackTrace(),`Attempted to send a message to the streamer with message type: ${e}, but the frontend hasn't been configured to send such a message. Check you've added the message type in your cpp`);if(n.structure&&t&&n.structure.length!==t.length)return void l.Error(l.GetStackTrace(),`Provided message data doesn't match expected layout. Expected [ ${n.structure.map((e=>{switch(e){case"uint8":case"uint16":case"int16":case"float":case"double":return"number";case"string":return"string"}})).toString()} ] but received [ ${t.map((e=>typeof e)).toString()} ]`);let o=0;const s=new TextEncoder;t.forEach(((e,t)=>{switch(n.structure[t]){case"uint8":o+=1;break;case"uint16":case"int16":o+=2;break;case"float":o+=4;break;case"double":o+=8;break;case"string":o+=2,o+=2*s.encode(e).length}}));const i=new DataView(new ArrayBuffer(o+1));i.setUint8(0,n.id);let r=1;t.forEach(((e,t)=>{switch(n.structure[t]){case"uint8":i.setUint8(r,e),r+=1;break;case"uint16":i.setUint16(r,e,!0),r+=2;break;case"int16":i.setInt16(r,e,!0),r+=2;break;case"float":i.setFloat32(r,e,!0),r+=4;break;case"double":i.setFloat64(r,e,!0),r+=8;break;case"string":i.setUint16(r,e.length,!0),r+=2;for(let t=0;t<e.length;t++)i.setUint16(r,e.charCodeAt(t),!0),r+=2}})),this.dataChannelSender.canSend()?this.dataChannelSender.sendData(i.buffer):l.Info(l.GetStackTrace(),`Data channel cannot send yet, skipping sending message: ${e} - ${new Uint8Array(i.buffer)}`)}}class It{constructor(e){this.sendMessageController=e}SendRequestQualityControl(){this.sendMessageController.sendMessageToStreamer("RequestQualityControl")}SendMaxFpsRequest(){this.sendMessageController.sendMessageToStreamer("FpsRequest")}SendAverageBitrateRequest(){this.sendMessageController.sendMessageToStreamer("AverageBitrateRequest")}SendStartStreaming(){this.sendMessageController.sendMessageToStreamer("StartStreaming")}SendStopStreaming(){this.sendMessageController.sendMessageToStreamer("StopStreaming")}SendRequestInitialSettings(){this.sendMessageController.sendMessageToStreamer("RequestInitialSettings")}}class Rt{constructor(e){this.dataChannelProvider=e}canSend(){return void 0!==this.dataChannelProvider.getDataChannelInstance().dataChannel&&"open"==this.dataChannelProvider.getDataChannelInstance().dataChannel.readyState}sendData(e){const t=this.dataChannelProvider.getDataChannelInstance();if("open"==t.dataChannel.readyState){if(this.resetAfkWarningTimerOnDataSend(),tn)return;t.dataChannel.send(e),l.Log(l.GetStackTrace(),`Message Sent: ${new Uint8Array(e)}`,6)}else l.Error(l.GetStackTrace(),`Message Failed: ${new Uint8Array(e)}`)}resetAfkWarningTimerOnDataSend(){}}class Mt{constructor(e){this.videoElementProvider=e,this.normalizeAndQuantizeUnsignedFunc=()=>{throw new Error("Normalize and quantize unsigned, method not implemented.")},this.normalizeAndQuantizeSignedFunc=()=>{throw new Error("Normalize and unquantize signed, method not implemented.")},this.denormalizeAndUnquantizeUnsignedFunc=()=>{throw new Error("Denormalize and unquantize unsigned, method not implemented.")}}normalizeAndQuantizeUnsigned(e,t){return this.normalizeAndQuantizeUnsignedFunc(e,t)}unquantizeAndDenormalizeUnsigned(e,t){return this.denormalizeAndUnquantizeUnsignedFunc(e,t)}normalizeAndQuantizeSigned(e,t){return this.normalizeAndQuantizeSignedFunc(e,t)}setupNormalizeAndQuantize(){if(this.videoElementParent=this.videoElementProvider.getVideoParentElement(),this.videoElement=this.videoElementProvider.getVideoElement(),this.videoElementParent&&this.videoElement){const e=this.videoElementParent.clientHeight/this.videoElementParent.clientWidth,t=this.videoElement.videoHeight/this.videoElement.videoWidth;e>t?(l.Log(l.GetStackTrace(),"Setup Normalize and Quantize for playerAspectRatio > videoAspectRatio",6),this.ratio=e/t,this.normalizeAndQuantizeUnsignedFunc=(e,t)=>this.normalizeAndQuantizeUnsignedPlayerBigger(e,t),this.normalizeAndQuantizeSignedFunc=(e,t)=>this.normalizeAndQuantizeSignedPlayerBigger(e,t),this.denormalizeAndUnquantizeUnsignedFunc=(e,t)=>this.denormalizeAndUnquantizeUnsignedPlayerBigger(e,t)):(l.Log(l.GetStackTrace(),"Setup Normalize and Quantize for playerAspectRatio <= videoAspectRatio",6),this.ratio=t/e,this.normalizeAndQuantizeUnsignedFunc=(e,t)=>this.normalizeAndQuantizeUnsignedPlayerSmaller(e,t),this.normalizeAndQuantizeSignedFunc=(e,t)=>this.normalizeAndQuantizeSignedPlayerSmaller(e,t),this.denormalizeAndUnquantizeUnsignedFunc=(e,t)=>this.denormalizeAndUnquantizeUnsignedPlayerSmaller(e,t))}}normalizeAndQuantizeUnsignedPlayerBigger(e,t){const n=e/this.videoElementParent.clientWidth,o=this.ratio*(t/this.videoElementParent.clientHeight-.5)+.5;return n<0||n>1||o<0||o>1?new Bt(!1,65535,65535):new Bt(!0,65536*n,65536*o)}denormalizeAndUnquantizeUnsignedPlayerBigger(e,t){const n=e/65536,o=(t/65536-.5)/this.ratio+.5;return new At(n*this.videoElementParent.clientWidth,o*this.videoElementParent.clientHeight)}normalizeAndQuantizeSignedPlayerBigger(e,t){const n=e/(.5*this.videoElementParent.clientWidth),o=this.ratio*t/(.5*this.videoElementParent.clientHeight);return new Ot(32767*n,32767*o)}normalizeAndQuantizeUnsignedPlayerSmaller(e,t){const n=this.ratio*(e/this.videoElementParent.clientWidth-.5)+.5,o=t/this.videoElementParent.clientHeight;return n<0||n>1||o<0||o>1?new Bt(!1,65535,65535):new Bt(!0,65536*n,65536*o)}denormalizeAndUnquantizeUnsignedPlayerSmaller(e,t){const n=(e/65536-.5)/this.ratio+.5,o=t/65536;return new At(n*this.videoElementParent.clientWidth,o*this.videoElementParent.clientHeight)}normalizeAndQuantizeSignedPlayerSmaller(e,t){const n=this.ratio*e/(.5*this.videoElementParent.clientWidth),o=t/(.5*this.videoElementParent.clientHeight);return new Ot(32767*n,32767*o)}}class Bt{constructor(e,t,n){this.inRange=e,this.x=t,this.y=n}}class At{constructor(e,t){this.x=e,this.y=t}}class Ot{constructor(e,t){this.x=e,this.y=t}}class Ft{constructor(e,t){this.shouldShowPlayOverlay=!0,this.autoJoinTimer=void 0,this.config=e,this.pixelStreaming=t,this.responseController=new xt,this.file=new rt,this.sdpConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.afkController=new Le(this.config,this.pixelStreaming,this.onAfkTriggered.bind(this)),this.afkController.onAFKTimedOutCallback=()=>{this.closeSignalingServer("You have been disconnected due to inactivity")},this.freezeFrameController=new I(this.pixelStreaming.videoElementParent),this.videoPlayer=new Tt(this.pixelStreaming.videoElementParent,this.config),this.videoPlayer.onVideoInitialized=()=>this.handleVideoInitialized(),this.videoPlayer.onMatchViewportResolutionCallback=(e,t)=>{const n={"Resolution.Width":e,"Resolution.Height":t};this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify(n)])},this.videoPlayer.onResizePlayerCallback=()=>{this.setUpMouseAndFreezeFrame()},this.streamController=new x(this.videoPlayer),this.coordinateConverter=new Mt(this.videoPlayer),this.sendrecvDataChannelController=new E,this.recvDataChannelController=new E,this.registerDataChannelEventEmitters(this.sendrecvDataChannelController),this.registerDataChannelEventEmitters(this.recvDataChannelController),this.dataChannelSender=new Rt(this.sendrecvDataChannelController),this.dataChannelSender.resetAfkWarningTimerOnDataSend=()=>this.afkController.resetAfkWarningTimer(),this.streamMessageController=new kt,this.webSocketController=new k,this.webSocketController.onConfig=e=>this.handleOnConfigMessage(e),this.webSocketController.onStreamerList=e=>this.handleStreamerListMessage(e),this.webSocketController.onStreamerIDChanged=e=>this.handleStreamerIDChangedMessage(e),this.webSocketController.onPlayerCount=e=>{this.pixelStreaming._onPlayerCount(e.count)},this.webSocketController.onOpen.addEventListener("open",(()=>{this.config.isFlagEnabled(we.BrowserSendOffer)})),this.webSocketController.onClose.addEventListener("close",(e=>{const t=this.shouldReconnect&&1001!=e.detail.code&&this.config.getNumericSettingValue(Ee.MaxReconnectAttempts)>0,n=this.disconnectMessage?this.disconnectMessage:e.detail.reason;this.pixelStreaming._onDisconnect(n,!t&&!this.isReconnecting),this.afkController.stopAfkWarningTimer(),this.statsTimerHandle&&void 0!==this.statsTimerHandle&&window.clearInterval(this.statsTimerHandle),this.setVideoEncoderAvgQP(0),this.setTouchInputEnabled(!1),this.setMouseInputEnabled(!1),this.setKeyboardInputEnabled(!1),this.setGamePadInputEnabled(!1),t&&setTimeout((()=>{this.isReconnecting=!0,this.reconnectAttempt++,this.tryReconnect(e.detail.reason)}),2e3)})),this.sendMessageController=new Pt(this.dataChannelSender,this.streamMessageController),this.toStreamerMessagesController=new It(this.sendMessageController),this.registerMessageHandlers(),this.streamMessageController.populateDefaultProtocol(),this.inputClassesFactory=new wt(this.streamMessageController,this.videoPlayer,this.coordinateConverter),this.isUsingSFU=!1,this.isQualityController=!1,this.preferredCodec="",this.shouldReconnect=!0,this.isReconnecting=!1,this.reconnectAttempt=0,this.config._addOnOptionSettingChangedListener(Pe.StreamerId,(e=>{""!==e&&(this.peerConnectionController.peerConnection.close(),this.peerConnectionController.createPeerConnection(this.peerConfig,this.preferredCodec),this.subscribedStream=e,this.webSocketController.sendSubscribe(e))})),this.setVideoEncoderAvgQP(-1),this.signallingUrlBuilder=()=>{let e=this.config.getTextSettingValue(ke.SignallingServerUrl);return this.config.isFlagEnabled(we.BrowserSendOffer)&&(e+="?"+we.BrowserSendOffer+"=true"),e}}requestUnquantizedAndDenormalizeUnsigned(e,t){return this.coordinateConverter.unquantizeAndDenormalizeUnsigned(e,t)}handleOnMessage(e){const t=new Uint8Array(e.data);console.log(e.data),l.Log(l.GetStackTrace(),"Message incoming:"+t,6);const n=this.streamMessageController.fromStreamerMessages.get(t[0]);this.streamMessageController.fromStreamerHandlers.get(n)(e.data)}registerMessageHandlers(){this.streamMessageController.registerMessageHandler(Xe.FromStreamer,"QualityControlOwnership",(e=>this.onQualityControlOwnership(e))),this.streamMessageController.registerMessageHandler(Xe.FromStreamer,"Response",(e=>this.responseController.onResponse(e))),this.streamMessageController.registerMessageHandler(Xe.FromStreamer,"Command",(e=>{this.onCommand(e)})),this.streamMessageController.registerMessageHandler(Xe.FromStreamer,"FreezeFrame",(e=>this.onFreezeFrameMessage(e))),this.streamMessageController.registerMessageHandler(Xe.FromStreamer,"UnfreezeFrame",(()=>this.invalidateFreezeFrameAndEnableVideo())),this.streamMessageController.registerMessageHandler(Xe.FromStreamer,"VideoEncoderAvgQP",(e=>this.handleVideoEncoderAvgQP(e))),this.streamMessageController.registerMessageHandler(Xe.FromStreamer,"LatencyTest",(e=>this.handleLatencyTestResult(e))),this.streamMessageController.registerMessageHandler(Xe.FromStreamer,"DataChannelLatencyTest",(e=>this.handleDataChannelLatencyTestResponse(e))),this.streamMessageController.registerMessageHandler(Xe.FromStreamer,"InitialSettings",(e=>this.handleInitialSettings(e))),this.streamMessageController.registerMessageHandler(Xe.FromStreamer,"FileExtension",(e=>this.onFileExtension(e))),this.streamMessageController.registerMessageHandler(Xe.FromStreamer,"FileMimeType",(e=>this.onFileMimeType(e))),this.streamMessageController.registerMessageHandler(Xe.FromStreamer,"FileContents",(e=>this.onFileContents(e))),this.streamMessageController.registerMessageHandler(Xe.FromStreamer,"TestEcho",(()=>{})),this.streamMessageController.registerMessageHandler(Xe.FromStreamer,"InputControlOwnership",(e=>this.onInputControlOwnership(e))),this.streamMessageController.registerMessageHandler(Xe.FromStreamer,"GamepadResponse",(e=>this.onGamepadResponse(e))),this.streamMessageController.registerMessageHandler(Xe.FromStreamer,"Protocol",(e=>this.onProtocolMessage(e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"IFrameRequest",(()=>this.sendMessageController.sendMessageToStreamer("IFrameRequest"))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"RequestQualityControl",(()=>this.sendMessageController.sendMessageToStreamer("RequestQualityControl"))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"FpsRequest",(()=>this.sendMessageController.sendMessageToStreamer("FpsRequest"))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"AverageBitrateRequest",(()=>this.sendMessageController.sendMessageToStreamer("AverageBitrateRequest"))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"StartStreaming",(()=>this.sendMessageController.sendMessageToStreamer("StartStreaming"))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"StopStreaming",(()=>this.sendMessageController.sendMessageToStreamer("StopStreaming"))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"LatencyTest",(e=>this.sendMessageController.sendMessageToStreamer("LatencyTest",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"RequestInitialSettings",(()=>this.sendMessageController.sendMessageToStreamer("RequestInitialSettings"))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"TestEcho",(()=>{})),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"UIInteraction",(e=>this.sendMessageController.sendMessageToStreamer("UIInteraction",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"Command",(e=>this.sendMessageController.sendMessageToStreamer("Command",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"TextboxEntry",(e=>this.sendMessageController.sendMessageToStreamer("TextboxEntry",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"KeyDown",(e=>this.sendMessageController.sendMessageToStreamer("KeyDown",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"KeyUp",(e=>this.sendMessageController.sendMessageToStreamer("KeyUp",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"KeyPress",(e=>this.sendMessageController.sendMessageToStreamer("KeyPress",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"MouseEnter",(e=>this.sendMessageController.sendMessageToStreamer("MouseEnter",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"MouseLeave",(e=>this.sendMessageController.sendMessageToStreamer("MouseLeave",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"MouseDown",(e=>this.sendMessageController.sendMessageToStreamer("MouseDown",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"MouseUp",(e=>this.sendMessageController.sendMessageToStreamer("MouseUp",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"MouseMove",(e=>this.sendMessageController.sendMessageToStreamer("MouseMove",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"MouseWheel",(e=>this.sendMessageController.sendMessageToStreamer("MouseWheel",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"MouseDouble",(e=>this.sendMessageController.sendMessageToStreamer("MouseDouble",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"TouchStart",(e=>this.sendMessageController.sendMessageToStreamer("TouchStart",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"TouchEnd",(e=>this.sendMessageController.sendMessageToStreamer("TouchEnd",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"TouchMove",(e=>this.sendMessageController.sendMessageToStreamer("TouchMove",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"GamepadConnected",(()=>this.sendMessageController.sendMessageToStreamer("GamepadConnected"))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"GamepadButtonPressed",(e=>this.sendMessageController.sendMessageToStreamer("GamepadButtonPressed",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"GamepadButtonReleased",(e=>this.sendMessageController.sendMessageToStreamer("GamepadButtonReleased",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"GamepadAnalog",(e=>this.sendMessageController.sendMessageToStreamer("GamepadAnalog",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"GamepadDisconnected",(e=>this.sendMessageController.sendMessageToStreamer("GamepadDisconnected",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"XRHMDTransform",(e=>this.sendMessageController.sendMessageToStreamer("XRHMDTransform",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"XRControllerTransform",(e=>this.sendMessageController.sendMessageToStreamer("XRControllerTransform",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"XRSystem",(e=>this.sendMessageController.sendMessageToStreamer("XRSystem",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"XRButtonTouched",(e=>this.sendMessageController.sendMessageToStreamer("XRButtonTouched",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"XRButtonPressed",(e=>this.sendMessageController.sendMessageToStreamer("XRButtonPressed",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"XRButtonReleased",(e=>this.sendMessageController.sendMessageToStreamer("XRButtonReleased",e))),this.streamMessageController.registerMessageHandler(Xe.ToStreamer,"XRAnalog",(e=>this.sendMessageController.sendMessageToStreamer("XRAnalog",e)))}onCommand(e){l.Log(l.GetStackTrace(),"DataChannelReceiveMessageType.Command",6);const t=new TextDecoder("utf-16").decode(e.slice(1));l.Log(l.GetStackTrace(),"Data Channel Command: "+t,6);const n=JSON.parse(t);"onScreenKeyboard"===n.command&&this.pixelStreaming._activateOnScreenKeyboard(n)}onProtocolMessage(e){try{const t=new TextDecoder("utf-16").decode(e.slice(1)),n=JSON.parse(t);Object.prototype.hasOwnProperty.call(n,"Direction")||l.Error(l.GetStackTrace(),"Malformed protocol received. Ensure the protocol message contains a direction");const o=n.Direction;delete n.Direction,l.Log(l.GetStackTrace(),`Received new ${o==Xe.FromStreamer?"FromStreamer":"ToStreamer"} protocol. Updating existing protocol...`),Object.keys(n).forEach((e=>{const t=n[e];switch(o){case Xe.ToStreamer:if(!Object.prototype.hasOwnProperty.call(t,"id"))return void l.Error(l.GetStackTrace(),`ToStreamer->${e} protocol definition was malformed as it didn't contain at least an id\n\n                                           Definition was: ${JSON.stringify(t,null,2)}`);if("UIInteraction"===e||"Command"===e||"LatencyTest"===e)return;this.streamMessageController.toStreamerHandlers.get(e)?this.streamMessageController.toStreamerMessages.set(e,t):l.Error(l.GetStackTrace(),`There was no registered handler for "${e}" - try adding one using registerMessageHandler(MessageDirection.ToStreamer, "${e}", myHandler)`);break;case Xe.FromStreamer:if(!Object.prototype.hasOwnProperty.call(t,"id"))return void l.Error(l.GetStackTrace(),`FromStreamer->${e} protocol definition was malformed as it didn't contain at least an id\n\n                            Definition was: ${JSON.stringify(t,null,2)}`);this.streamMessageController.fromStreamerHandlers.get(e)?this.streamMessageController.fromStreamerMessages.set(t.id,e):l.Error(l.GetStackTrace(),`There was no registered handler for "${t}" - try adding one using registerMessageHandler(MessageDirection.FromStreamer, "${e}", myHandler)`);break;default:l.Error(l.GetStackTrace(),`Unknown direction: ${o}`)}})),this.toStreamerMessagesController.SendRequestInitialSettings(),this.toStreamerMessagesController.SendRequestQualityControl()}catch(e){l.Log(l.GetStackTrace(),e)}}onInputControlOwnership(e){const t=new Uint8Array(e);l.Log(l.GetStackTrace(),"DataChannelReceiveMessageType.InputControlOwnership",6);const n=new Boolean(t[1]).valueOf();l.Log(l.GetStackTrace(),`Received input controller message - will your input control the stream: ${n}`),this.pixelStreaming._onInputControlOwnership(n)}onGamepadResponse(e){const t=new TextDecoder("utf-16").decode(e.slice(1)),n=JSON.parse(t);this.gamePadController.onGamepadResponseReceived(n.controllerId)}onAfkTriggered(){this.afkController.onAfkClick(),this.videoPlayer.isPaused()&&this.videoPlayer.hasVideoSource()&&this.playStream()}setAfkEnabled(e){e?this.onAfkTriggered():this.afkController.stopAfkWarningTimer()}tryReconnect(e){this.webSocketController?(this.isReconnecting=!0,this.webSocketController.webSocket&&this.webSocketController.webSocket.readyState!=WebSocket.CLOSED?(this.closeSignalingServer(`${e} Restarting stream...`),setTimeout((()=>{this.tryReconnect(e)}),3e3)):(this.pixelStreaming._onWebRtcAutoConnect(),this.connectToSignallingServer())):l.Log(l.GetStackTrace(),"The Web Socket Controller does not exist so this will not work right now.")}loadFreezeFrameOrShowPlayOverlay(){this.pixelStreaming.dispatchEvent(new ne({shouldShowPlayOverlay:this.shouldShowPlayOverlay,isValid:this.freezeFrameController.valid,jpegData:this.freezeFrameController.jpeg})),!0===this.shouldShowPlayOverlay?(l.Log(l.GetStackTrace(),"showing play overlay"),this.resizePlayerStyle()):(l.Log(l.GetStackTrace(),"showing freeze frame"),this.freezeFrameController.showFreezeFrame()),setTimeout((()=>{this.videoPlayer.setVideoEnabled(!1)}),this.freezeFrameController.freezeFrameDelay)}onFreezeFrameMessage(e){l.Log(l.GetStackTrace(),"DataChannelReceiveMessageType.FreezeFrame",6);const t=new Uint8Array(e);this.freezeFrameController.processFreezeFrameMessage(t,(()=>this.loadFreezeFrameOrShowPlayOverlay()))}invalidateFreezeFrameAndEnableVideo(){l.Log(l.GetStackTrace(),"DataChannelReceiveMessageType.FreezeFrame",6),setTimeout((()=>{this.pixelStreaming.dispatchEvent(new oe),this.freezeFrameController.hideFreezeFrame()}),this.freezeFrameController.freezeFrameDelay),this.videoPlayer.getVideoElement()&&this.videoPlayer.setVideoEnabled(!0)}onFileExtension(e){const t=new Uint8Array(e);it.setExtensionFromBytes(t,this.file)}onFileMimeType(e){const t=new Uint8Array(e);it.setMimeTypeFromBytes(t,this.file)}onFileContents(e){const t=new Uint8Array(e);it.setContentsFromBytes(t,this.file)}playStream(){if(!this.videoPlayer.getVideoElement()){const e="Could not play video stream because the video player was not initialized correctly.";return this.pixelStreaming.dispatchEvent(new Z({message:e})),l.Error(l.GetStackTrace(),e),void this.closeSignalingServer("Stream not initialized correctly")}if(this.videoPlayer.hasVideoSource()){if(this.setTouchInputEnabled(this.config.isFlagEnabled(we.TouchInput)),this.pixelStreaming.dispatchEvent(new ee),this.streamController.audioElement.srcObject){const e=this.config.isFlagEnabled(we.StartVideoMuted);this.streamController.audioElement.muted=e,e?this.playVideo():this.streamController.audioElement.play().then((()=>{this.playVideo()})).catch((e=>{l.Log(l.GetStackTrace(),e),l.Log(l.GetStackTrace(),"Browser does not support autoplaying video without interaction - to resolve this we are going to show the play button overlay."),this.pixelStreaming.dispatchEvent(new te({reason:e}))}))}else this.playVideo();this.shouldShowPlayOverlay=!1,this.freezeFrameController.showFreezeFrame()}else l.Warning(l.GetStackTrace(),"Cannot play stream, the video element has no srcObject to play.")}playVideo(){this.videoPlayer.play().catch((e=>{this.streamController.audioElement.srcObject&&this.streamController.audioElement.pause(),l.Log(l.GetStackTrace(),e),l.Log(l.GetStackTrace(),"Browser does not support autoplaying video without interaction - to resolve this we are going to show the play button overlay."),this.pixelStreaming.dispatchEvent(new te({reason:e}))}))}autoPlayVideoOrSetUpPlayOverlay(){const e=document.getElementById("playerUI");e&&(e.style.display="none");const t=document.getElementById("loadingVideoElement");t&&(t.pause(),t.src="",t.remove()),"1"==bt.ShouldAutoPlay&&this.playStream(),this.resizePlayerStyle()}connectToSignallingServer(){this.locallyClosed=!1,this.shouldReconnect=!0,this.disconnectMessage=null;const e=this.signallingUrlBuilder();this.webSocketController.connect(e)}startSession(e){if(this.peerConfig=e,this.config.isFlagEnabled(we.ForceTURN)&&!this.checkTurnServerAvailability(e))return l.Info(l.GetStackTrace(),"No turn server was found in the Peer Connection Options. TURN cannot be forced, closing connection. Please use STUN instead"),void this.closeSignalingServer("TURN cannot be forced, closing connection. Please use STUN instead.");this.peerConnectionController=new Ze(this.peerConfig,this.config,this.preferredCodec),this.peerConnectionController.onVideoStats=e=>this.handleVideoStats(e),this.peerConnectionController.onSendWebRTCOffer=e=>this.handleSendWebRTCOffer(e),this.peerConnectionController.onSendWebRTCAnswer=e=>this.handleSendWebRTCAnswer(e),this.peerConnectionController.onPeerIceCandidate=e=>this.handleSendIceCandidate(e),this.peerConnectionController.onDataChannel=e=>this.handleDataChannel(e),this.peerConnectionController.showTextOverlayConnecting=()=>this.pixelStreaming._onWebRtcConnecting(),this.peerConnectionController.showTextOverlaySetupFailure=()=>this.pixelStreaming._onWebRtcFailed();let t=!1;this.peerConnectionController.onIceConnectionStateChange=()=>{!t&&["connected","completed"].includes(this.peerConnectionController.peerConnection.iceConnectionState)&&(this.pixelStreaming._onWebRtcConnected(),t=!0)},this.peerConnectionController.onTrack=e=>this.streamController.handleOnTrack(e),this.config.isFlagEnabled(we.BrowserSendOffer)&&(this.sendrecvDataChannelController.createDataChannel(this.peerConnectionController.peerConnection,"cirrus",this.datachannelOptions),this.sendrecvDataChannelController.handleOnMessage=e=>this.handleOnMessage(e),this.peerConnectionController.createOffer(this.sdpConstraints,this.config))}checkTurnServerAvailability(e){if(!e.iceServers)return l.Info(l.GetStackTrace(),"A turn sever was not found"),!1;for(const t of e.iceServers)for(const e of t.urls)if(e.includes("turn"))return l.Log(l.GetStackTrace(),`A turn sever was found at ${e}`),!0;return l.Info(l.GetStackTrace(),"A turn sever was not found"),!1}handleOnConfigMessage(e){this.resizePlayerStyle(),this.startSession(e.peerConnectionOptions),this.webSocketController.onWebRtcAnswer=e=>this.handleWebRtcAnswer(e),this.webSocketController.onWebRtcOffer=e=>this.handleWebRtcOffer(e),this.webSocketController.onWebRtcPeerDataChannels=e=>this.handleWebRtcSFUPeerDatachannels(e),this.webSocketController.onIceCandidate=e=>this.handleIceCandidate(e)}handleStreamerListMessage(e){l.Log(l.GetStackTrace(),`Got streamer list ${e.ids}`,6);let t=null;var n=this.config.getSettingOption(Pe.StreamerId);n.selected.toString().trim()&&(t=n.selected);const o=[...e.ids];o.unshift(""),this.config.setOptionSettingOptions(Pe.StreamerId,o);let s=null;const i=this.config.isFlagEnabled(we.WaitForStreamer),r=this.config.getNumericSettingValue(Ee.MaxReconnectAttempts),a=this.config.getNumericSettingValue(Ee.StreamerAutoJoinInterval),c=this.config.useUrlParams,d=new URLSearchParams(window.location.search);c&&d.has(Pe.StreamerId)?t=d.get(Pe.StreamerId):this.subscribedStream&&(t=this.subscribedStream),t&&e.ids.includes(t)?s=t:t&&i||1!=e.ids.length||(s=e.ids[0]),s?(this.isReconnecting=!1,this.reconnectAttempt=0,this.config.setOptionSettingValue(Pe.StreamerId,s)):i&&(this.reconnectAttempt<r?(this.isReconnecting=!0,this.reconnectAttempt++,setTimeout((()=>{this.webSocketController.requestStreamerList()}),a)):(this.reconnectAttempt=0,this.isReconnecting=!1,this.shouldReconnect=!1)),this.pixelStreaming.dispatchEvent(new re({messageStreamerList:e,autoSelectedStreamerId:s,wantedStreamerId:t}))}handleStreamerIDChangedMessage(e){const t=e.newID;var n=this.config.getSettingOption(Pe.StreamerId),o=n.onChange;n.onChange=()=>{};for(var s=n.options,i=0;i<s.length;++i)if(s[i]==this.subscribedStream){s[i]=t;break}n.options=s,n.selected=t,n.onChange=o,this.subscribedStream=e.newID,this.pixelStreaming.dispatchEvent(new ae({newID:t}))}handleWebRtcAnswer(e){l.Log(l.GetStackTrace(),`Got answer sdp ${e.sdp}`,6);const t={sdp:e.sdp,type:"answer"};this.peerConnectionController.receiveAnswer(t),this.handlePostWebrtcNegotiation()}handleWebRtcOffer(e){l.Log(l.GetStackTrace(),`Got offer sdp ${e.sdp}`,6),this.isUsingSFU=!!e.sfu&&e.sfu,this.isUsingSFU&&(this.peerConnectionController.preferredCodec="");const t={sdp:e.sdp,type:"offer"};this.peerConnectionController.receiveOffer(t,this.config),this.handlePostWebrtcNegotiation()}handleWebRtcSFUPeerDatachannels(e){const t={ordered:!0,negotiated:!0,id:e.sendStreamId},n=e.sendStreamId!=e.recvStreamId;if(this.sendrecvDataChannelController.createDataChannel(this.peerConnectionController.peerConnection,n?"send-datachannel":"datachannel",t),n){const t={ordered:!0,negotiated:!0,id:e.recvStreamId};this.recvDataChannelController.createDataChannel(this.peerConnectionController.peerConnection,"recv-datachannel",t),this.recvDataChannelController.handleOnOpen=()=>this.webSocketController.sendSFURecvDataChannelReady(),this.recvDataChannelController.handleOnMessage=e=>this.handleOnMessage(e)}else this.sendrecvDataChannelController.handleOnMessage=e=>this.handleOnMessage(e)}handlePostWebrtcNegotiation(){this.afkController.startAfkWarningTimer(),this.pixelStreaming._onWebRtcSdp(),this.statsTimerHandle&&void 0!==this.statsTimerHandle&&window.clearInterval(this.statsTimerHandle),this.statsTimerHandle=window.setInterval((()=>this.getStats()),1e3),this.setMouseInputEnabled(this.config.isFlagEnabled(we.MouseInput)),this.setKeyboardInputEnabled(this.config.isFlagEnabled(we.KeyboardInput)),this.setGamePadInputEnabled(this.config.isFlagEnabled(we.GamepadInput))}handleIceCandidate(e){l.Log(l.GetStackTrace(),"Web RTC Controller: onWebRtcIce",6);const t=new RTCIceCandidate(e);this.peerConnectionController.handleOnIce(t)}handleSendIceCandidate(e){l.Log(l.GetStackTrace(),"OnIceCandidate",6),e.candidate&&e.candidate.candidate&&this.webSocketController.sendIceCandidate(e.candidate)}handleDataChannel(e){l.Log(l.GetStackTrace(),"Data channel created for us by browser as we are a receiving peer.",6),this.sendrecvDataChannelController.dataChannel=e.channel,this.sendrecvDataChannelController.setupDataChannel(),this.sendrecvDataChannelController.handleOnMessage=e=>this.handleOnMessage(e)}handleSendWebRTCOffer(e){l.Log(l.GetStackTrace(),"Sending the offer to the Server",6);const t={minBitrateBps:1e3*this.config.getNumericSettingValue(Ee.WebRTCMinBitrate),maxBitrateBps:1e3*this.config.getNumericSettingValue(Ee.WebRTCMaxBitrate)};this.webSocketController.sendWebRtcOffer(e,t)}handleSendWebRTCAnswer(e){l.Log(l.GetStackTrace(),"Sending the answer to the Server",6);const t={minBitrateBps:1e3*this.config.getNumericSettingValue(Ee.WebRTCMinBitrate),maxBitrateBps:1e3*this.config.getNumericSettingValue(Ee.WebRTCMaxBitrate)};this.webSocketController.sendWebRtcAnswer(e,t),this.isUsingSFU&&this.webSocketController.sendWebRtcDatachannelRequest()}setUpMouseAndFreezeFrame(){this.videoElementParentClientRect=this.videoPlayer.getVideoParentElement().getBoundingClientRect(),this.coordinateConverter.setupNormalizeAndQuantize(),this.freezeFrameController.freezeFrame.resize()}closeSignalingServer(e){var t;this.locallyClosed=!0,this.shouldReconnect=!1,this.disconnectMessage=e,null===(t=this.webSocketController)||void 0===t||t.close()}closePeerConnection(){var e;null===(e=this.peerConnectionController)||void 0===e||e.close()}close(){this.closeSignalingServer(""),this.closePeerConnection()}getStats(){this.peerConnectionController.generateStats()}sendLatencyTest(){this.latencyStartTime=Date.now(),this.streamMessageController.toStreamerHandlers.get("LatencyTest")([JSON.stringify({StartTime:this.latencyStartTime})])}sendDataChannelLatencyTest(e){this.streamMessageController.toStreamerHandlers.get("DataChannelLatencyTest")([JSON.stringify(e)])}sendEncoderMinQP(e){l.Log(l.GetStackTrace(),`MinQP=${e}\n`,6),null!=e&&this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({"Encoder.MinQP":e})])}sendEncoderMaxQP(e){l.Log(l.GetStackTrace(),`MaxQP=${e}\n`,6),null!=e&&this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({"Encoder.MaxQP":e})])}sendWebRTCMinBitrate(e){l.Log(l.GetStackTrace(),`WebRTC Min Bitrate=${e}`,6),null!=e&&this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({"WebRTC.MinBitrate":e})])}sendWebRTCMaxBitrate(e){l.Log(l.GetStackTrace(),`WebRTC Max Bitrate=${e}`,6),null!=e&&this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({"WebRTC.MaxBitrate":e})])}sendWebRTCFps(e){l.Log(l.GetStackTrace(),`WebRTC FPS=${e}`,6),null!=e&&(this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({"WebRTC.Fps":e})]),this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({"WebRTC.MaxFps":e})]))}sendShowFps(){l.Log(l.GetStackTrace(),"----   Sending show stat to UE   ----",6),this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({"stat.fps":""})])}sendIframeRequest(){l.Log(l.GetStackTrace(),"----   Sending Request for an IFrame  ----",6),this.streamMessageController.toStreamerHandlers.get("IFrameRequest")()}emitUIInteraction(e){l.Log(l.GetStackTrace(),"----   Sending custom UIInteraction message   ----",6),this.streamMessageController.toStreamerHandlers.get("UIInteraction")([JSON.stringify(e)])}emitCommand(e){l.Log(l.GetStackTrace(),"----   Sending custom Command message   ----",6),this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify(e)])}emitConsoleCommand(e){l.Log(l.GetStackTrace(),"----   Sending custom Command:ConsoleCommand message   ----",6),this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({ConsoleCommand:e})])}sendRequestQualityControlOwnership(){l.Log(l.GetStackTrace(),"----   Sending Request to Control Quality  ----",6),this.toStreamerMessagesController.SendRequestQualityControl()}handleLatencyTestResult(e){l.Log(l.GetStackTrace(),"DataChannelReceiveMessageType.latencyTest",6);const t=new TextDecoder("utf-16").decode(e.slice(1)),n=new st;Object.assign(n,JSON.parse(t)),n.processFields(),n.testStartTimeMs=this.latencyStartTime,n.browserReceiptTimeMs=Date.now(),n.latencyExcludingDecode=~~(n.browserReceiptTimeMs-n.testStartTimeMs),n.testDuration=~~(n.TransmissionTimeMs-n.ReceiptTimeMs),n.networkLatency=~~(n.latencyExcludingDecode-n.testDuration),n.frameDisplayDeltaTimeMs&&n.browserReceiptTimeMs&&(n.endToEndLatency=(n.frameDisplayDeltaTimeMs,n.networkLatency,~~+n.CaptureToSendMs)),this.pixelStreaming._onLatencyTestResult(n)}handleDataChannelLatencyTestResponse(e){l.Log(l.GetStackTrace(),"DataChannelReceiveMessageType.dataChannelLatencyResponse",6);const t=new TextDecoder("utf-16").decode(e.slice(1)),n=JSON.parse(t);this.pixelStreaming._onDataChannelLatencyTestResponse(n)}handleInitialSettings(e){l.Log(l.GetStackTrace(),"DataChannelReceiveMessageType.InitialSettings",6);const t=new TextDecoder("utf-16").decode(e.slice(1)),n=JSON.parse(t),o=new et;n.Encoder&&(o.EncoderSettings=n.Encoder),n.WebRTC&&(o.WebRTCSettings=n.WebRTC),n.PixelStreaming&&(o.PixelStreamingSettings=n.PixelStreaming),n.ConfigOptions&&void 0!==n.ConfigOptions.DefaultToHover&&this.config.setFlagEnabled(we.HoveringMouseMode,!!n.ConfigOptions.DefaultToHover),o.ueCompatible(),l.Log(l.GetStackTrace(),t,6),this.pixelStreaming._onInitialSettings(o)}handleVideoEncoderAvgQP(e){l.Log(l.GetStackTrace(),"DataChannelReceiveMessageType.VideoEncoderAvgQP",6);const t=Number(new TextDecoder("utf-16").decode(e.slice(1)));this.setVideoEncoderAvgQP(t)}handleVideoInitialized(){this.pixelStreaming._onVideoInitialized(),this.autoPlayVideoOrSetUpPlayOverlay(),this.resizePlayerStyle(),this.videoPlayer.updateVideoStreamSize()}onQualityControlOwnership(e){const t=new Uint8Array(e);l.Log(l.GetStackTrace(),"DataChannelReceiveMessageType.QualityControlOwnership",6),this.isQualityController=new Boolean(t[1]).valueOf(),l.Log(l.GetStackTrace(),`Received quality controller message, will control quality: ${this.isQualityController}`),this.pixelStreaming._onQualityControlOwnership(this.isQualityController)}handleVideoStats(e){this.pixelStreaming._onVideoStats(e)}resizePlayerStyle(){this.videoPlayer.resizePlayerStyle()}setPreferredCodec(e){this.preferredCodec=e,this.peerConnectionController&&(this.peerConnectionController.preferredCodec=e,this.peerConnectionController.updateCodecSelection=!1)}setVideoEncoderAvgQP(e){this.videoAvgQp=e,this.pixelStreaming._onVideoEncoderAvgQP(this.videoAvgQp)}setKeyboardInputEnabled(e){var t;null===(t=this.keyboardController)||void 0===t||t.unregisterKeyBoardEvents(),e&&(this.keyboardController=this.inputClassesFactory.registerKeyBoard(this.config))}setMouseInputEnabled(e){var t;if(null===(t=this.mouseController)||void 0===t||t.unregisterMouseEvents(),e){let e=Me.HoveringMouse;try{e="1"===(null==bt?void 0:bt.MouseControlScheme)?Me.HoveringMouse:Me.LockedMouse}catch(t){e=Me.HoveringMouse}this.mouseController=this.inputClassesFactory.registerMouse(e)}}setTouchInputEnabled(e){var t;null===(t=this.touchController)||void 0===t||t.unregisterTouchEvents(),e&&(this.touchController=this.inputClassesFactory.registerTouch(this.config.isFlagEnabled(we.FakeMouseWithTouches),this.videoElementParentClientRect))}setGamePadInputEnabled(e){var t;null===(t=this.gamePadController)||void 0===t||t.unregisterGamePadEvents(),e&&(this.gamePadController=this.inputClassesFactory.registerGamePad(),this.gamePadController.onGamepadConnected=()=>{this.streamMessageController.toStreamerHandlers.get("GamepadConnected")()},this.gamePadController.onGamepadDisconnected=e=>{this.streamMessageController.toStreamerHandlers.get("GamepadDisconnected")([e])})}registerDataChannelEventEmitters(e){e.onOpen=(e,t)=>this.pixelStreaming.dispatchEvent(new q({label:e,event:t})),e.onClose=(e,t)=>this.pixelStreaming.dispatchEvent(new $({label:e,event:t})),e.onError=(e,t)=>this.pixelStreaming.dispatchEvent(new j({label:e,event:t}))}registerMessageHandler(e,t,n){t===Xe.FromStreamer&&void 0===n&&l.Warning(l.GetStackTrace(),`Unable to register handler for ${e} as no handler was passed`),this.streamMessageController.registerMessageHandler(t,e,(o=>void 0===n&&t===Xe.ToStreamer?this.sendMessageController.sendMessageToStreamer(e,o):n(o)))}}class Dt{static vertexShader(){return"\n\t\tattribute vec2 a_position;\n\t\tattribute vec2 a_texCoord;\n\n\t\t// input\n\t\tuniform vec2 u_resolution;\n\t\tuniform vec4 u_offset;\n\n\t\t//\n\t\tvarying vec2 v_texCoord;\n\n\t\tvoid main() {\n\t\t   // convert the rectangle from pixels to 0.0 to 1.0\n\t\t   vec2 zeroToOne = a_position / u_resolution;\n\n\t\t   // convert from 0->1 to 0->2\n\t\t   vec2 zeroToTwo = zeroToOne * 2.0;\n\n\t\t   // convert from 0->2 to -1->+1 (clipspace)\n\t\t   vec2 clipSpace = zeroToTwo - 1.0;\n\n\t\t   gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n\t\t   // pass the texCoord to the fragment shader\n\t\t   // The GPU will interpolate this value between points.\n\t\t   v_texCoord = (a_texCoord * u_offset.xy) + u_offset.zw;\n\t\t}\n\t\t"}static fragmentShader(){return"\n\t\tprecision mediump float;\n\n\t\t// our texture\n\t\tuniform sampler2D u_image;\n\n\t\t// the texCoords passed in from the vertex shader.\n\t\tvarying vec2 v_texCoord;\n\n\t\tvoid main() {\n\t\t   gl_FragColor = texture2D(u_image, v_texCoord);\n\t\t}\n\t\t"}}class Ut{static deepCopyGamepad(e){return JSON.parse(JSON.stringify({buttons:e.buttons.map((e=>JSON.parse(JSON.stringify({pressed:e.pressed,touched:e.touched})))),axes:e.axes}))}}class Nt{constructor(e){this.toStreamerMessagesProvider=e,this.controllers=[]}updateStatus(e,t,n){if(e.gamepad){const o=t.getPose(e.gripSpace,n);if(!o)return;let s=0;e.profiles.includes("htc-vive")?s=1:e.profiles.includes("oculus-touch")&&(s=2),this.toStreamerMessagesProvider.toStreamerHandlers.get("XRSystem")([s]);let i=2;switch(e.handedness){case"left":i=0;break;case"right":i=1}const r=o.transform.matrix,a=[];for(let e=0;e<16;e++)a[e]=new Float32Array([r[e]])[0];this.toStreamerMessagesProvider.toStreamerHandlers.get("XRControllerTransform")([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15],i]),void 0===this.controllers[i]&&(this.controllers[i]={prevState:void 0,currentState:void 0,id:void 0},this.controllers[i].prevState=Ut.deepCopyGamepad(e.gamepad)),this.controllers[i].currentState=Ut.deepCopyGamepad(e.gamepad);const l=this.controllers[i],c=l.currentState,d=l.prevState;for(let e=0;e<c.buttons.length;e++){const t=c.buttons[e],n=d.buttons[e];t.pressed?this.toStreamerMessagesProvider.toStreamerHandlers.get("XRButtonPressed")([i,e,n.pressed?1:0]):!t.pressed&&n.pressed&&this.toStreamerMessagesProvider.toStreamerHandlers.get("XRButtonReleased")([i,e,0]),t.touched&&!t.pressed?this.toStreamerMessagesProvider.toStreamerHandlers.get("XRButtonPressed")([i,3,n.touched?1:0]):!t.touched&&n.touched&&this.toStreamerMessagesProvider.toStreamerHandlers.get("XRButtonReleased")([i,3,0])}for(let e=0;e<c.axes.length;e++)this.toStreamerMessagesProvider.toStreamerHandlers.get("XRAnalog")([i,e,c.axes[e]]);this.controllers[i].prevState=c}}}class Gt{constructor(e){this.xrSession=null,this.webRtcController=e,this.xrControllers=[],this.xrGamepadController=new Nt(this.webRtcController.streamMessageController),this.onSessionEnded=new EventTarget,this.onSessionStarted=new EventTarget,this.onFrame=new EventTarget}xrClicked(){this.xrSession?this.xrSession.end():navigator.xr.requestSession("immersive-vr").then((e=>{this.onXrSessionStarted(e)}))}onXrSessionEnded(){l.Log(l.GetStackTrace(),"XR Session ended"),this.xrSession=null,this.onSessionEnded.dispatchEvent(new Event("xrSessionEnded"))}onXrSessionStarted(e){l.Log(l.GetStackTrace(),"XR Session started"),this.xrSession=e,this.xrSession.addEventListener("end",(()=>{this.onXrSessionEnded()}));const t=document.createElement("canvas");this.gl=t.getContext("webgl2",{xrCompatible:!0}),this.xrSession.updateRenderState({baseLayer:new XRWebGLLayer(this.xrSession,this.gl)});const n=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(n,Dt.vertexShader()),this.gl.compileShader(n);const o=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(o,Dt.fragmentShader()),this.gl.compileShader(o);const s=this.gl.createProgram();this.gl.attachShader(s,n),this.gl.attachShader(s,o),this.gl.linkProgram(s),this.gl.useProgram(s),this.positionLocation=this.gl.getAttribLocation(s,"a_position"),this.texcoordLocation=this.gl.getAttribLocation(s,"a_texCoord"),this.positionBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.enableVertexAttribArray(this.positionLocation);const i=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.texcoordBuffer=this.gl.createBuffer(),this.resolutionLocation=this.gl.getUniformLocation(s,"u_resolution"),this.offsetLocation=this.gl.getUniformLocation(s,"u_offset"),e.requestReferenceSpace("local").then((e=>{this.xrRefSpace=e,this.xrSession.requestAnimationFrame(((e,t)=>this.onXrFrame(e,t)))})),this.onSessionStarted.dispatchEvent(new Event("xrSessionStarted"))}onXrFrame(e,t){const n=t.getViewerPose(this.xrRefSpace);if(n){const e=n.transform.matrix,t=[];for(let n=0;n<16;n++)t[n]=new Float32Array([e[n]])[0];this.webRtcController.streamMessageController.toStreamerHandlers.get("XRHMDTransform")([t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]]);const o=this.xrSession.renderState.baseLayer;this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,o.framebuffer),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.webRtcController.videoPlayer.getVideoElement()),this.render(this.webRtcController.videoPlayer.getVideoElement())}this.webRtcController.config.isFlagEnabled(we.XRControllerInput)&&this.xrSession.inputSources.forEach(((e,n,o)=>{this.xrGamepadController.updateStatus(e,t,this.xrRefSpace)}),this),this.xrSession.requestAnimationFrame(((e,t)=>this.onXrFrame(e,t))),this.onFrame.dispatchEvent(new fe({time:e,frame:t}))}render(e){if(!this.gl)return;const t=this.xrSession.renderState.baseLayer;let n,o,s,i,r;this.gl.viewport(0,0,t.framebufferWidth,t.framebufferHeight),this.gl.uniform4f(this.offsetLocation,1,1,0,0),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,e.videoWidth,0,0,e.videoHeight,0,e.videoHeight,e.videoWidth,0,e.videoWidth,e.videoHeight]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),n=2,o=this.gl.FLOAT,s=!1,i=0,r=0,this.gl.vertexAttribPointer(this.positionLocation,n,o,s,i,r),this.gl.enableVertexAttribArray(this.texcoordLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordBuffer),n=2,o=this.gl.FLOAT,s=!1,i=0,r=0,this.gl.vertexAttribPointer(this.texcoordLocation,n,o,s,i,r),this.gl.uniform2f(this.resolutionLocation,e.videoWidth,e.videoHeight);const a=this.gl.TRIANGLES;r=0,this.gl.drawArrays(a,r,6)}static isSessionSupported(e){return navigator.xr?navigator.xr.isSessionSupported(e):new Promise((()=>!1))}}class Ht{constructor(e){this.editTextButton=null,this.hiddenInput=null,"ontouchstart"in document.documentElement&&this.createOnScreenKeyboardHelpers(e)}unquantizeAndDenormalizeUnsigned(e,t){return null}createOnScreenKeyboardHelpers(e){this.hiddenInput||(this.hiddenInput=document.createElement("input"),this.hiddenInput.id="hiddenInput",this.hiddenInput.maxLength=0,e.appendChild(this.hiddenInput)),this.editTextButton||(this.editTextButton=document.createElement("button"),this.editTextButton.id="editTextButton",this.editTextButton.innerHTML="edit text",e.appendChild(this.editTextButton),this.editTextButton.classList.add("hiddenState"),this.editTextButton.addEventListener("touchend",(e=>{this.hiddenInput.focus(),e.preventDefault()})))}showOnScreenKeyboard(e){if(e.showOnScreenKeyboard){this.editTextButton.classList.remove("hiddenState");const t=this.unquantizeAndDenormalizeUnsigned(e.x,e.y);this.editTextButton.style.top=t.y.toString()+"px",this.editTextButton.style.left=(t.x-40).toString()+"px"}else this.editTextButton.classList.add("hiddenState"),this.hiddenInput.blur()}}class zt{constructor(e){this.seq=e.Seq,this.playerSentTimestamp=Date.now(),this.requestFillerSize=e.Filler?e.Filler.length:0}update(e){this.playerReceivedTimestamp=Date.now(),this.streamerReceivedTimestamp=e.ReceivedTimestamp,this.streamerSentTimestamp=e.SentTimestamp,this.responseFillerSize=e.Filler?e.Filler.length:0}}class Wt{constructor(e,t){this.sink=e,this.callback=t,this.records=new Map,this.seq=0}start(e){return!this.isRunning()&&(this.startTime=Date.now(),this.records.clear(),this.interval=setInterval((()=>{Date.now()-this.startTime>=e.duration?this.stop():this.sendRequest(e.requestSize,e.responseSize)}).bind(this),Math.floor(1e3/e.rps)),!0)}stop(){this.interval&&(clearInterval(this.interval),this.interval=void 0,this.callback(this.produceResult()))}produceResult(){const e=new Map(this.records);return{records:e,dataChannelRtt:Math.ceil(Array.from(this.records.values()).reduce(((e,t)=>e+(t.playerReceivedTimestamp-t.playerSentTimestamp)),0)/this.records.size),playerToStreamerTime:Math.ceil(Array.from(this.records.values()).reduce(((e,t)=>e+(t.streamerReceivedTimestamp-t.playerSentTimestamp)),0)/this.records.size),streamerToPlayerTime:Math.ceil(Array.from(this.records.values()).reduce(((e,t)=>e+(t.playerReceivedTimestamp-t.streamerSentTimestamp)),0)/this.records.size),exportLatencyAsCSV:()=>{let t="Timestamp;RTT;PlayerToStreamer;StreamerToPlayer;\n";return e.forEach((e=>{t+=e.playerSentTimestamp+";",t+=e.playerReceivedTimestamp-e.playerSentTimestamp+";",t+=e.streamerReceivedTimestamp-e.playerSentTimestamp+";",t+=e.playerReceivedTimestamp-e.streamerSentTimestamp+";",t+="\n"})),t}}}isRunning(){return!!this.interval}receive(e){if(!this.isRunning())return;if(!e)return void l.Error(l.GetStackTrace(),"Undefined response from server");let t=this.records.get(e.Seq);t&&t.update(e)}sendRequest(e,t){let n=this.createRequest(e,t),o=new zt(n);this.records.set(o.seq,o),this.sink(n)}createRequest(e,t){return{Seq:this.seq++,FillResponseSize:t,Filler:e?"A".repeat(e):""}}}class qt{constructor(e,t){this.allowConsoleCommands=!1,this.config=e,(null==t?void 0:t.videoElementParent)&&(this._videoElementParent=t.videoElementParent),this._eventEmitter=new Ce,this.configureSettings(),this.setWebRtcPlayerController(new Ft(this.config,this)),this.onScreenKeyboardHelper=new Ht(this.videoElementParent),this.onScreenKeyboardHelper.unquantizeAndDenormalizeUnsigned=(e,t)=>this._webRtcController.requestUnquantizedAndDenormalizeUnsigned(e,t),this._activateOnScreenKeyboard=e=>this.onScreenKeyboardHelper.showOnScreenKeyboard(e),this._webXrController=new Gt(this._webRtcController),this._setupWebRtcTCPRelayDetection=this._setupWebRtcTCPRelayDetection.bind(this),this._eventEmitter.addEventListener("webRtcConnected",(e=>{this._eventEmitter.addEventListener("statsReceived",this._setupWebRtcTCPRelayDetection)}))}get videoElementParent(){return this._videoElementParent||(this._videoElementParent=document.createElement("div"),this._videoElementParent.id="videoElementParent"),this._videoElementParent}configureSettings(){this.config._addOnSettingChangedListener(we.IsQualityController,(e=>{!0!==e||this._webRtcController.isQualityController||this._webRtcController.sendRequestQualityControlOwnership()})),this.config._addOnSettingChangedListener(we.AFKDetection,(e=>{this._webRtcController.setAfkEnabled(e)})),this.config._addOnSettingChangedListener(we.MatchViewportResolution,(()=>{this._webRtcController.videoPlayer.updateVideoStreamSize()})),this.config._addOnSettingChangedListener(we.HoveringMouseMode,(e=>{this.config.setFlagLabel(we.HoveringMouseMode,`Control Scheme: ${e?"Hovering":"Locked"} Mouse`),this._webRtcController.setMouseInputEnabled(this.config.isFlagEnabled(we.MouseInput))})),this.config._addOnSettingChangedListener(we.KeyboardInput,(e=>{this._webRtcController.setKeyboardInputEnabled(e)})),this.config._addOnSettingChangedListener(we.MouseInput,(e=>{this._webRtcController.setMouseInputEnabled(e)})),this.config._addOnSettingChangedListener(we.TouchInput,(e=>{this._webRtcController.setTouchInputEnabled(e)})),this.config._addOnSettingChangedListener(we.GamepadInput,(e=>{this._webRtcController.setGamePadInputEnabled(e)})),this.config._addOnNumericSettingChangedListener(Ee.MinQP,(e=>{l.Log(l.GetStackTrace(),"--------  Sending MinQP  --------",7),this._webRtcController.sendEncoderMinQP(e),l.Log(l.GetStackTrace(),"-------------------------------------------",7)})),this.config._addOnNumericSettingChangedListener(Ee.MaxQP,(e=>{l.Log(l.GetStackTrace(),"--------  Sending encoder settings  --------",7),this._webRtcController.sendEncoderMaxQP(e),l.Log(l.GetStackTrace(),"-------------------------------------------",7)})),this.config._addOnNumericSettingChangedListener(Ee.WebRTCMinBitrate,(e=>{l.Log(l.GetStackTrace(),"--------  Sending web rtc settings  --------",7),this._webRtcController.sendWebRTCMinBitrate(1e3*e),l.Log(l.GetStackTrace(),"-------------------------------------------",7)})),this.config._addOnNumericSettingChangedListener(Ee.WebRTCMaxBitrate,(e=>{l.Log(l.GetStackTrace(),"--------  Sending web rtc settings  --------",7),this._webRtcController.sendWebRTCMaxBitrate(1e3*e),l.Log(l.GetStackTrace(),"-------------------------------------------",7)})),this.config._addOnNumericSettingChangedListener(Ee.WebRTCFPS,(e=>{l.Log(l.GetStackTrace(),"--------  Sending web rtc settings  --------",7),this._webRtcController.sendWebRTCFps(e),l.Log(l.GetStackTrace(),"-------------------------------------------",7)})),this.config._addOnOptionSettingChangedListener(Pe.PreferredCodec,(e=>{this._webRtcController&&this._webRtcController.setPreferredCodec(e)})),this.config._registerOnChangeEvents(this._eventEmitter)}_activateOnScreenKeyboard(e){throw new Error("Method not implemented.")}_onInputControlOwnership(e){this._inputController=e}setWebRtcPlayerController(e){this._webRtcController=e,this._webRtcController.setPreferredCodec(this.config.getSettingOption(Pe.PreferredCodec).selected),this._webRtcController.resizePlayerStyle(),this.checkForAutoConnect()}connect(){this._eventEmitter.dispatchEvent(new K),this._webRtcController.connectToSignallingServer()}reconnect(){this._eventEmitter.dispatchEvent(new Y),this._webRtcController.tryReconnect("Reconnecting...")}disconnect(){this._eventEmitter.dispatchEvent(new X),this._webRtcController.close()}play(){this._onStreamLoading(),this._webRtcController.playStream()}checkForAutoConnect(){this._onWebRtcAutoConnect(),this._webRtcController.connectToSignallingServer()}unmuteMicrophone(e=!1){if(!this.config.isFlagEnabled("UseMic"))return e?(this.config.setFlagEnabled("UseMic",!0),void this.reconnect()):void l.Warning(l.GetStackTrace(),"Trying to unmute mic, but PixelStreaming was initialized with no microphone track. Call with forceEnable == true to re-connect with a mic track.");this.setMicrophoneMuted(!1)}muteMicrophone(){this.config.isFlagEnabled("UseMic")?this.setMicrophoneMuted(!0):l.Info(l.GetStackTrace(),"Trying to mute mic, but PixelStreaming has no microphone track, so sending sound is already disabled.")}setMicrophoneMuted(e){var t,n,o,s;for(const i of null!==(s=null===(o=null===(n=null===(t=this._webRtcController)||void 0===t?void 0:t.peerConnectionController)||void 0===n?void 0:n.peerConnection)||void 0===o?void 0:o.getTransceivers())&&void 0!==s?s:[])Qe.canTransceiverSendAudio(i)&&(i.sender.track.enabled=!e)}_onWebRtcAutoConnect(){this._eventEmitter.dispatchEvent(new G)}_onWebRtcSdp(){this._eventEmitter.dispatchEvent(new N)}_onStreamLoading(){this._eventEmitter.dispatchEvent(new Q)}_onDisconnect(e,t){this._eventEmitter.dispatchEvent(new V({eventString:e,allowClickToReconnect:t}))}_onWebRtcConnecting(){this._eventEmitter.dispatchEvent(new H)}_onWebRtcConnected(){this._eventEmitter.dispatchEvent(new z)}_onWebRtcFailed(){this._eventEmitter.dispatchEvent(new W)}_onVideoInitialized(){this._eventEmitter.dispatchEvent(new J),this._videoStartTime=Date.now()}_onLatencyTestResult(e){this._eventEmitter.dispatchEvent(new le({latencyTimings:e}))}_onDataChannelLatencyTestResponse(e){this._eventEmitter.dispatchEvent(new ce({response:e}))}_onVideoStats(e){this._videoStartTime&&void 0!==this._videoStartTime||(this._videoStartTime=Date.now()),e.handleSessionStatistics(this._videoStartTime,this._inputController,this._webRtcController.videoAvgQp),this._eventEmitter.dispatchEvent(new ie({aggregatedStats:e}))}_onVideoEncoderAvgQP(e){this._eventEmitter.dispatchEvent(new U({avgQP:e}))}_onInitialSettings(e){var t;this._eventEmitter.dispatchEvent(new ue({settings:e})),e.PixelStreamingSettings&&(this.allowConsoleCommands=null!==(t=e.PixelStreamingSettings.AllowPixelStreamingCommands)&&void 0!==t&&t,!1===this.allowConsoleCommands&&l.Info(l.GetStackTrace(),"-AllowPixelStreamingCommands=false, sending arbitrary console commands from browser to UE is disabled."));const n=this.config.useUrlParams,o=new URLSearchParams(window.location.search);l.Info(l.GetStackTrace(),`using URL parameters ${n}`),e.EncoderSettings&&(this.config.setNumericSetting(Ee.MinQP,n&&o.has(Ee.MinQP)?Number.parseFloat(o.get(Ee.MinQP)):e.EncoderSettings.MinQP),this.config.setNumericSetting(Ee.MaxQP,n&&o.has(Ee.MaxQP)?Number.parseFloat(o.get(Ee.MaxQP)):e.EncoderSettings.MaxQP)),e.WebRTCSettings&&(this.config.setNumericSetting(Ee.WebRTCMinBitrate,n&&o.has(Ee.WebRTCMinBitrate)?Number.parseFloat(o.get(Ee.WebRTCMinBitrate)):e.WebRTCSettings.MinBitrate/1e3),this.config.setNumericSetting(Ee.WebRTCMaxBitrate,n&&o.has(Ee.WebRTCMaxBitrate)?Number.parseFloat(o.get(Ee.WebRTCMaxBitrate)):e.WebRTCSettings.MaxBitrate/1e3),this.config.setNumericSetting(Ee.WebRTCFPS,n&&o.has(Ee.WebRTCFPS)?Number.parseFloat(o.get(Ee.WebRTCFPS)):e.WebRTCSettings.FPS))}_onQualityControlOwnership(e){this.config.setFlagEnabled(we.IsQualityController,e)}_onPlayerCount(e){this._eventEmitter.dispatchEvent(new ve({count:e}))}_setupWebRtcTCPRelayDetection(e){let t=e.data.aggregatedStats.getActiveCandidatePair();if(null!=t){let n=e.data.aggregatedStats.localCandidates.find((e=>e.id==t.localCandidateId),null);null!=n&&"relay"==n.candidateType&&"tcp"==n.relayProtocol&&this._eventEmitter.dispatchEvent(new ye),this._eventEmitter.removeEventListener("statsReceived",this._setupWebRtcTCPRelayDetection)}}requestLatencyTest(){return!!this._webRtcController.videoPlayer.isVideoReady()&&(this._webRtcController.sendLatencyTest(),!0)}requestDataChannelLatencyTest(e){return!!this._webRtcController.videoPlayer.isVideoReady()&&(this._dataChannelLatencyTestController||(this._dataChannelLatencyTestController=new Wt(this._webRtcController.sendDataChannelLatencyTest.bind(this._webRtcController),(e=>{this._eventEmitter.dispatchEvent(new de({result:e}))})),this.addEventListener("dataChannelLatencyTestResponse",(({data:{response:e}})=>{this._dataChannelLatencyTestController.receive(e)}))),this._dataChannelLatencyTestController.start(e))}requestShowFps(){return!!this._webRtcController.videoPlayer.isVideoReady()&&(this._webRtcController.sendShowFps(),!0)}requestIframe(){return!!this._webRtcController.videoPlayer.isVideoReady()&&(this._webRtcController.sendIframeRequest(),!0)}emitUIInteraction(e){return!!this._webRtcController.videoPlayer.isVideoReady()&&(this._webRtcController.emitUIInteraction(e),!0)}emitCommand(e){return!(!this._webRtcController.videoPlayer.isVideoReady()||!this.allowConsoleCommands&&"ConsoleCommand"in e||(this._webRtcController.emitCommand(e),0))}emitConsoleCommand(e){return!(!this.allowConsoleCommands||!this._webRtcController.videoPlayer.isVideoReady()||(this._webRtcController.emitConsoleCommand(e),0))}addResponseEventListener(e,t){this._webRtcController.responseController.addResponseEventListener(e,t)}removeResponseEventListener(e){this._webRtcController.responseController.removeResponseEventListener(e)}dispatchEvent(e){return this._eventEmitter.dispatchEvent(e)}addEventListener(e,t){this._eventEmitter.addEventListener(e,t)}removeEventListener(e,t){this._eventEmitter.removeEventListener(e,t)}toggleXR(){this.webXrController.xrClicked()}setSignallingUrlBuilder(e){this._webRtcController.signallingUrlBuilder=e}get webSocketController(){return this._webRtcController.webSocketController}get webXrController(){return this._webXrController}registerMessageHandler(e,t,n){t!==Xe.FromStreamer||void 0!==n?t===Xe.ToStreamer&&void 0===n?this._webRtcController.streamMessageController.registerMessageHandler(t,e,(t=>this._webRtcController.sendMessageController.sendMessageToStreamer(e,t))):this._webRtcController.streamMessageController.registerMessageHandler(t,e,(e=>n(e))):l.Warning(l.GetStackTrace(),`Unable to register an undefined handler for ${e}`)}get toStreamerHandlers(){return this._webRtcController.streamMessageController.toStreamerHandlers}isReconnecting(){return this._webRtcController.isReconnecting}}class $t{}var jt=a.Hp,Jt=a.TS,Qt=a.iI,Kt=a.Vy,Zt=a.k$,on=a.mY,rn=a.z3,an=a.kR,ln=a.gw,cn=a.R3;function un(){return un=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},un.apply(this,arguments)}var hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};const mn="object"===("undefined"==typeof window?"undefined":hn(window))&&"object"===("undefined"==typeof document?"undefined":hn(document))&&9===document.nodeType;function gn(e){return gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gn(e)}function pn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(s=function(e){if("object"!==gn(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!==gn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===gn(s)?s:String(s)),o)}var s}function fn(e,t,n){return t&&pn(e.prototype,t),n&&pn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function vn(e,t){return vn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},vn(e,t)}function yn(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,vn(e,t)}function Sn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Cn={}.constructor;function wn(e){if(null==e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(wn);if(e.constructor!==Cn)return e;var t={};for(var n in e)t[n]=wn(e[n]);return t}function bn(e,t,n){void 0===e&&(e="unnamed");var o=n.jss,s=wn(t);return o.plugins.onCreateRule(e,s,n)||(e[0],null)}var En=function(e,t){for(var n="",o=0;o<e.length&&"!important"!==e[o];o++)n&&(n+=t),n+=e[o];return n},Tn=function(e){if(!Array.isArray(e))return e;var t="";if(Array.isArray(e[0]))for(var n=0;n<e.length&&"!important"!==e[n];n++)t&&(t+=", "),t+=En(e[n]," ");else t=En(e,", ");return"!important"===e[e.length-1]&&(t+=" !important"),t};function kn(e){return e&&!1===e.format?{linebreak:"",space:""}:{linebreak:"\n",space:" "}}function xn(e,t){for(var n="",o=0;o<t;o++)n+="  ";return n+e}function Pn(e,t,n){void 0===n&&(n={});var o="";if(!t)return o;var s=n.indent,i=void 0===s?0:s,r=t.fallbacks;!1===n.format&&(i=-1/0);var a=kn(n),l=a.linebreak,c=a.space;if(e&&i++,r)if(Array.isArray(r))for(var d=0;d<r.length;d++){var u=r[d];for(var h in u){var m=u[h];null!=m&&(o&&(o+=l),o+=xn(h+":"+c+Tn(m)+";",i))}}else for(var g in r){var p=r[g];null!=p&&(o&&(o+=l),o+=xn(g+":"+c+Tn(p)+";",i))}for(var f in t){var v=t[f];null!=v&&"fallbacks"!==f&&(o&&(o+=l),o+=xn(f+":"+c+Tn(v)+";",i))}return(o||n.allowEmpty)&&e?(o&&(o=""+l+o+l),xn(""+e+c+"{"+o,--i)+xn("}",i)):o}var In=/([[\].#*$><+~=|^:(),"'`\s])/g,Rn="undefined"!=typeof CSS&&CSS.escape,Mn=function(e){return Rn?Rn(e):e.replace(In,"\\$1")},Ln=function(){function e(e,t,n){this.type="style",this.isProcessed=!1;var o=n.sheet,s=n.Renderer;this.key=e,this.options=n,this.style=t,o?this.renderer=o.renderer:s&&(this.renderer=new s)}return e.prototype.prop=function(e,t,n){if(void 0===t)return this.style[e];var o=!!n&&n.force;if(!o&&this.style[e]===t)return this;var s=t;n&&!1===n.process||(s=this.options.jss.plugins.onChangeValue(t,e,this));var i=null==s||!1===s,r=e in this.style;if(i&&!r&&!o)return this;var a=i&&r;if(a?delete this.style[e]:this.style[e]=s,this.renderable&&this.renderer)return a?this.renderer.removeProperty(this.renderable,e):this.renderer.setProperty(this.renderable,e,s),this;var l=this.options.sheet;return l&&l.attached,this},e}(),Bn=function(e){function t(t,n,o){var s;s=e.call(this,t,n,o)||this;var i=o.selector,r=o.scoped,a=o.sheet,l=o.generateId;return i?s.selectorText=i:!1!==r&&(s.id=l(Sn(Sn(s)),a),s.selectorText="."+Mn(s.id)),s}yn(t,e);var n=t.prototype;return n.applyTo=function(e){var t=this.renderer;if(t){var n=this.toJSON();for(var o in n)t.setProperty(e,o,n[o])}return this},n.toJSON=function(){var e={};for(var t in this.style){var n=this.style[t];"object"!=typeof n?e[t]=n:Array.isArray(n)&&(e[t]=Tn(n))}return e},n.toString=function(e){var t=this.options.sheet,n=t&&t.options.link?un({},e,{allowEmpty:!0}):e;return Pn(this.selectorText,this.style,n)},fn(t,[{key:"selector",set:function(e){if(e!==this.selectorText){this.selectorText=e;var t=this.renderer,n=this.renderable;n&&t&&(t.setSelector(n,e)||t.replaceRule(n,this))}},get:function(){return this.selectorText}}]),t}(Ln),An={onCreateRule:function(e,t,n){return"@"===e[0]||n.parent&&"keyframes"===n.parent.type?null:new Bn(e,t,n)}},On={indent:1,children:!0},_n=/@([\w-]+)/,Fn=function(){function e(e,t,n){this.type="conditional",this.isProcessed=!1,this.key=e;var o=e.match(_n);for(var s in this.at=o?o[1]:"unknown",this.query=n.name||"@"+this.at,this.options=n,this.rules=new ao(un({},n,{parent:this})),t)this.rules.add(s,t[s]);this.rules.process()}var t=e.prototype;return t.getRule=function(e){return this.rules.get(e)},t.indexOf=function(e){return this.rules.indexOf(e)},t.addRule=function(e,t,n){var o=this.rules.add(e,t,n);return o?(this.options.jss.plugins.onProcessRule(o),o):null},t.replaceRule=function(e,t,n){var o=this.rules.replace(e,t,n);return o&&this.options.jss.plugins.onProcessRule(o),o},t.toString=function(e){void 0===e&&(e=On);var t=kn(e).linebreak;if(null==e.indent&&(e.indent=On.indent),null==e.children&&(e.children=On.children),!1===e.children)return this.query+" {}";var n=this.rules.toString(e);return n?this.query+" {"+t+n+t+"}":""},e}(),Dn=/@media|@supports\s+/,Un={onCreateRule:function(e,t,n){return Dn.test(e)?new Fn(e,t,n):null}},Gn={indent:1,children:!0},Hn=/@keyframes\s+([\w-]+)/,zn=function(){function e(e,t,n){this.type="keyframes",this.at="@keyframes",this.isProcessed=!1;var o=e.match(Hn);o&&o[1]?this.name=o[1]:this.name="noname",this.key=this.type+"-"+this.name,this.options=n;var s=n.scoped,i=n.sheet,r=n.generateId;for(var a in this.id=!1===s?this.name:Mn(r(this,i)),this.rules=new ao(un({},n,{parent:this})),t)this.rules.add(a,t[a],un({},n,{parent:this}));this.rules.process()}return e.prototype.toString=function(e){void 0===e&&(e=Gn);var t=kn(e).linebreak;if(null==e.indent&&(e.indent=Gn.indent),null==e.children&&(e.children=Gn.children),!1===e.children)return this.at+" "+this.id+" {}";var n=this.rules.toString(e);return n&&(n=""+t+n+t),this.at+" "+this.id+" {"+n+"}"},e}(),Wn=/@keyframes\s+/,Vn=/\$([\w-]+)/g,qn=function(e,t){return"string"==typeof e?e.replace(Vn,(function(e,n){return n in t?t[n]:e})):e},$n=function(e,t,n){var o=e[t],s=qn(o,n);s!==o&&(e[t]=s)},jn={onCreateRule:function(e,t,n){return"string"==typeof e&&Wn.test(e)?new zn(e,t,n):null},onProcessStyle:function(e,t,n){return"style"===t.type&&n?("animation-name"in e&&$n(e,"animation-name",n.keyframes),"animation"in e&&$n(e,"animation",n.keyframes),e):e},onChangeValue:function(e,t,n){var o=n.options.sheet;if(!o)return e;switch(t){case"animation":case"animation-name":return qn(e,o.keyframes);default:return e}}},Jn=function(e){function t(){return e.apply(this,arguments)||this}return yn(t,e),t.prototype.toString=function(e){var t=this.options.sheet,n=t&&t.options.link?un({},e,{allowEmpty:!0}):e;return Pn(this.key,this.style,n)},t}(Ln),Qn={onCreateRule:function(e,t,n){return n.parent&&"keyframes"===n.parent.type?new Jn(e,t,n):null}},Kn=function(){function e(e,t,n){this.type="font-face",this.at="@font-face",this.isProcessed=!1,this.key=e,this.style=t,this.options=n}return e.prototype.toString=function(e){var t=kn(e).linebreak;if(Array.isArray(this.style)){for(var n="",o=0;o<this.style.length;o++)n+=Pn(this.at,this.style[o]),this.style[o+1]&&(n+=t);return n}return Pn(this.at,this.style,e)},e}(),Xn=/@font-face/,Yn={onCreateRule:function(e,t,n){return Xn.test(e)?new Kn(e,t,n):null}},Zn=function(){function e(e,t,n){this.type="viewport",this.at="@viewport",this.isProcessed=!1,this.key=e,this.style=t,this.options=n}return e.prototype.toString=function(e){return Pn(this.key,this.style,e)},e}(),eo={onCreateRule:function(e,t,n){return"@viewport"===e||"@-ms-viewport"===e?new Zn(e,t,n):null}},to=function(){function e(e,t,n){this.type="simple",this.isProcessed=!1,this.key=e,this.value=t,this.options=n}return e.prototype.toString=function(e){if(Array.isArray(this.value)){for(var t="",n=0;n<this.value.length;n++)t+=this.key+" "+this.value[n]+";",this.value[n+1]&&(t+="\n");return t}return this.key+" "+this.value+";"},e}(),no={"@charset":!0,"@import":!0,"@namespace":!0},oo={onCreateRule:function(e,t,n){return e in no?new to(e,t,n):null}},so=[An,Un,jn,Qn,Yn,eo,oo],io={process:!0},ro={force:!0,process:!0},ao=function(){function e(e){this.map={},this.raw={},this.index=[],this.counter=0,this.options=e,this.classes=e.classes,this.keyframes=e.keyframes}var t=e.prototype;return t.add=function(e,t,n){var o=this.options,s=o.parent,i=o.sheet,r=o.jss,a=o.Renderer,l=o.generateId,c=o.scoped,d=un({classes:this.classes,parent:s,sheet:i,jss:r,Renderer:a,generateId:l,scoped:c,name:e,keyframes:this.keyframes,selector:void 0},n),u=e;e in this.raw&&(u=e+"-d"+this.counter++),this.raw[u]=t,u in this.classes&&(d.selector="."+Mn(this.classes[u]));var h=bn(u,t,d);if(!h)return null;this.register(h);var m=void 0===d.index?this.index.length:d.index;return this.index.splice(m,0,h),h},t.replace=function(e,t,n){var o=this.get(e),s=this.index.indexOf(o);o&&this.remove(o);var i=n;return-1!==s&&(i=un({},n,{index:s})),this.add(e,t,i)},t.get=function(e){return this.map[e]},t.remove=function(e){this.unregister(e),delete this.raw[e.key],this.index.splice(this.index.indexOf(e),1)},t.indexOf=function(e){return this.index.indexOf(e)},t.process=function(){var e=this.options.jss.plugins;this.index.slice(0).forEach(e.onProcessRule,e)},t.register=function(e){this.map[e.key]=e,e instanceof Bn?(this.map[e.selector]=e,e.id&&(this.classes[e.key]=e.id)):e instanceof zn&&this.keyframes&&(this.keyframes[e.name]=e.id)},t.unregister=function(e){delete this.map[e.key],e instanceof Bn?(delete this.map[e.selector],delete this.classes[e.key]):e instanceof zn&&delete this.keyframes[e.name]},t.update=function(){var e,t,n;if("string"==typeof(arguments.length<=0?void 0:arguments[0])?(e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1],n=arguments.length<=2?void 0:arguments[2]):(t=arguments.length<=0?void 0:arguments[0],n=arguments.length<=1?void 0:arguments[1],e=null),e)this.updateOne(this.get(e),t,n);else for(var o=0;o<this.index.length;o++)this.updateOne(this.index[o],t,n)},t.updateOne=function(t,n,o){void 0===o&&(o=io);var s=this.options,i=s.jss.plugins,r=s.sheet;if(t.rules instanceof e)t.rules.update(n,o);else{var a=t.style;if(i.onUpdate(n,t,r,o),o.process&&a&&a!==t.style){for(var l in i.onProcessStyle(t.style,t,r),t.style){var c=t.style[l];c!==a[l]&&t.prop(l,c,ro)}for(var d in a){var u=t.style[d],h=a[d];null==u&&u!==h&&t.prop(d,null,ro)}}}},t.toString=function(e){for(var t="",n=this.options.sheet,o=!!n&&n.options.link,s=kn(e).linebreak,i=0;i<this.index.length;i++){var r=this.index[i].toString(e);(r||o)&&(t&&(t+=s),t+=r)}return t},e}(),lo=function(){function e(e,t){for(var n in this.attached=!1,this.deployed=!1,this.classes={},this.keyframes={},this.options=un({},t,{sheet:this,parent:this,classes:this.classes,keyframes:this.keyframes}),t.Renderer&&(this.renderer=new t.Renderer(this)),this.rules=new ao(this.options),e)this.rules.add(n,e[n]);this.rules.process()}var t=e.prototype;return t.attach=function(){return this.attached||(this.renderer&&this.renderer.attach(),this.attached=!0,this.deployed||this.deploy()),this},t.detach=function(){return this.attached?(this.renderer&&this.renderer.detach(),this.attached=!1,this):this},t.addRule=function(e,t,n){var o=this.queue;this.attached&&!o&&(this.queue=[]);var s=this.rules.add(e,t,n);return s?(this.options.jss.plugins.onProcessRule(s),this.attached?this.deployed?(o?o.push(s):(this.insertRule(s),this.queue&&(this.queue.forEach(this.insertRule,this),this.queue=void 0)),s):s:(this.deployed=!1,s)):null},t.replaceRule=function(e,t,n){var o=this.rules.get(e);if(!o)return this.addRule(e,t,n);var s=this.rules.replace(e,t,n);return s&&this.options.jss.plugins.onProcessRule(s),this.attached?this.deployed?(this.renderer&&(s?o.renderable&&this.renderer.replaceRule(o.renderable,s):this.renderer.deleteRule(o)),s):s:(this.deployed=!1,s)},t.insertRule=function(e){this.renderer&&this.renderer.insertRule(e)},t.addRules=function(e,t){var n=[];for(var o in e){var s=this.addRule(o,e[o],t);s&&n.push(s)}return n},t.getRule=function(e){return this.rules.get(e)},t.deleteRule=function(e){var t="object"==typeof e?e:this.rules.get(e);return!(!t||this.attached&&!t.renderable)&&(this.rules.remove(t),!(this.attached&&t.renderable&&this.renderer)||this.renderer.deleteRule(t.renderable))},t.indexOf=function(e){return this.rules.indexOf(e)},t.deploy=function(){return this.renderer&&this.renderer.deploy(),this.deployed=!0,this},t.update=function(){var e;return(e=this.rules).update.apply(e,arguments),this},t.updateOne=function(e,t,n){return this.rules.updateOne(e,t,n),this},t.toString=function(e){return this.rules.toString(e)},e}(),co=function(){function e(){this.plugins={internal:[],external:[]},this.registry={}}var t=e.prototype;return t.onCreateRule=function(e,t,n){for(var o=0;o<this.registry.onCreateRule.length;o++){var s=this.registry.onCreateRule[o](e,t,n);if(s)return s}return null},t.onProcessRule=function(e){if(!e.isProcessed){for(var t=e.options.sheet,n=0;n<this.registry.onProcessRule.length;n++)this.registry.onProcessRule[n](e,t);e.style&&this.onProcessStyle(e.style,e,t),e.isProcessed=!0}},t.onProcessStyle=function(e,t,n){for(var o=0;o<this.registry.onProcessStyle.length;o++)t.style=this.registry.onProcessStyle[o](t.style,t,n)},t.onProcessSheet=function(e){for(var t=0;t<this.registry.onProcessSheet.length;t++)this.registry.onProcessSheet[t](e)},t.onUpdate=function(e,t,n,o){for(var s=0;s<this.registry.onUpdate.length;s++)this.registry.onUpdate[s](e,t,n,o)},t.onChangeValue=function(e,t,n){for(var o=e,s=0;s<this.registry.onChangeValue.length;s++)o=this.registry.onChangeValue[s](o,t,n);return o},t.use=function(e,t){void 0===t&&(t={queue:"external"});var n=this.plugins[t.queue];-1===n.indexOf(e)&&(n.push(e),this.registry=[].concat(this.plugins.external,this.plugins.internal).reduce((function(e,t){for(var n in t)n in e&&e[n].push(t[n]);return e}),{onCreateRule:[],onProcessRule:[],onProcessStyle:[],onProcessSheet:[],onChangeValue:[],onUpdate:[]}))},e}(),uo=function(){function e(){this.registry=[]}var t=e.prototype;return t.add=function(e){var t=this.registry,n=e.options.index;if(-1===t.indexOf(e))if(0===t.length||n>=this.index)t.push(e);else for(var o=0;o<t.length;o++)if(t[o].options.index>n)return void t.splice(o,0,e)},t.reset=function(){this.registry=[]},t.remove=function(e){var t=this.registry.indexOf(e);this.registry.splice(t,1)},t.toString=function(e){for(var t=void 0===e?{}:e,n=t.attached,o=function(e,t){if(null==e)return{};var n,o,s={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(s[n]=e[n]);return s}(t,["attached"]),s=kn(o).linebreak,i="",r=0;r<this.registry.length;r++){var a=this.registry[r];null!=n&&a.attached!==n||(i&&(i+=s),i+=a.toString(o))}return i},fn(e,[{key:"index",get:function(){return 0===this.registry.length?0:this.registry[this.registry.length-1].options.index}}]),e}(),ho=new uo,mo="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window&&window.Math===Math?window:"undefined"!=typeof self&&self.Math===Math?self:Function("return this")(),go="2f1acc6c3a606b082e5eef5e54414ffb";null==mo[go]&&(mo[go]=0);var po=mo[go]++,fo=function(e){void 0===e&&(e={});var t=0;return function(n,o){t+=1;var s="",i="";return o&&(o.options.classNamePrefix&&(i=o.options.classNamePrefix),null!=o.options.jss.id&&(s=String(o.options.jss.id))),e.minify?""+(i||"c")+po+s+t:i+n.key+"-"+po+(s?"-"+s:"")+"-"+t}},vo=function(e){var t;return function(){return t||(t=e()),t}},yo=function(e,t){try{return e.attributeStyleMap?e.attributeStyleMap.get(t):e.style.getPropertyValue(t)}catch(e){return""}},So=function(e,t,n){try{var o=n;if(Array.isArray(n)&&(o=Tn(n)),e.attributeStyleMap)e.attributeStyleMap.set(t,o);else{var s=o?o.indexOf("!important"):-1,i=s>-1?o.substr(0,s-1):o;e.style.setProperty(t,i,s>-1?"important":"")}}catch(e){return!1}return!0},Co=function(e,t){try{e.attributeStyleMap?e.attributeStyleMap.delete(t):e.style.removeProperty(t)}catch(e){}},wo=function(e,t){return e.selectorText=t,e.selectorText===t},bo=vo((function(){return document.querySelector("head")})),Eo=vo((function(){var e=document.querySelector('meta[property="csp-nonce"]');return e?e.getAttribute("content"):null})),To=function(e,t,n){try{"insertRule"in e?e.insertRule(t,n):"appendRule"in e&&e.appendRule(t)}catch(e){return!1}return e.cssRules[n]},ko=function(e,t){var n=e.cssRules.length;return void 0===t||t>n?n:t},xo=function(){function e(e){this.getPropertyValue=yo,this.setProperty=So,this.removeProperty=Co,this.setSelector=wo,this.hasInsertedRules=!1,this.cssRules=[],e&&ho.add(e),this.sheet=e;var t,n=this.sheet?this.sheet.options:{},o=n.media,s=n.meta,i=n.element;this.element=i||((t=document.createElement("style")).textContent="\n",t),this.element.setAttribute("data-jss",""),o&&this.element.setAttribute("media",o),s&&this.element.setAttribute("data-meta",s);var r=Eo();r&&this.element.setAttribute("nonce",r)}var t=e.prototype;return t.attach=function(){if(!this.element.parentNode&&this.sheet){!function(e,t){var n=t.insertionPoint,o=function(e){var t=ho.registry;if(t.length>0){var n=function(e,t){for(var n=0;n<e.length;n++){var o=e[n];if(o.attached&&o.options.index>t.index&&o.options.insertionPoint===t.insertionPoint)return o}return null}(t,e);if(n&&n.renderer)return{parent:n.renderer.element.parentNode,node:n.renderer.element};if(n=function(e,t){for(var n=e.length-1;n>=0;n--){var o=e[n];if(o.attached&&o.options.insertionPoint===t.insertionPoint)return o}return null}(t,e),n&&n.renderer)return{parent:n.renderer.element.parentNode,node:n.renderer.element.nextSibling}}var o=e.insertionPoint;if(o&&"string"==typeof o){var s=function(e){for(var t=bo(),n=0;n<t.childNodes.length;n++){var o=t.childNodes[n];if(8===o.nodeType&&o.nodeValue.trim()===e)return o}return null}(o);if(s)return{parent:s.parentNode,node:s.nextSibling}}return!1}(t);if(!1!==o&&o.parent)o.parent.insertBefore(e,o.node);else if(n&&"number"==typeof n.nodeType){var s=n,i=s.parentNode;i&&i.insertBefore(e,s.nextSibling)}else bo().appendChild(e)}(this.element,this.sheet.options);var e=Boolean(this.sheet&&this.sheet.deployed);this.hasInsertedRules&&e&&(this.hasInsertedRules=!1,this.deploy())}},t.detach=function(){if(this.sheet){var e=this.element.parentNode;e&&e.removeChild(this.element),this.sheet.options.link&&(this.cssRules=[],this.element.textContent="\n")}},t.deploy=function(){var e=this.sheet;e&&(e.options.link?this.insertRules(e.rules):this.element.textContent="\n"+e.toString()+"\n")},t.insertRules=function(e,t){for(var n=0;n<e.index.length;n++)this.insertRule(e.index[n],n,t)},t.insertRule=function(e,t,n){if(void 0===n&&(n=this.element.sheet),e.rules){var o=e,s=n;if("conditional"===e.type||"keyframes"===e.type){var i=ko(n,t);if(!1===(s=To(n,o.toString({children:!1}),i)))return!1;this.refCssRule(e,i,s)}return this.insertRules(o.rules,s),s}var r=e.toString();if(!r)return!1;var a=ko(n,t),l=To(n,r,a);return!1!==l&&(this.hasInsertedRules=!0,this.refCssRule(e,a,l),l)},t.refCssRule=function(e,t,n){e.renderable=n,e.options.parent instanceof lo&&this.cssRules.splice(t,0,n)},t.deleteRule=function(e){var t=this.element.sheet,n=this.indexOf(e);return-1!==n&&(t.deleteRule(n),this.cssRules.splice(n,1),!0)},t.indexOf=function(e){return this.cssRules.indexOf(e)},t.replaceRule=function(e,t){var n=this.indexOf(e);return-1!==n&&(this.element.sheet.deleteRule(n),this.cssRules.splice(n,1),this.insertRule(t,n))},t.getRules=function(){return this.element.sheet.cssRules},e}(),Po=0,Io=function(){function e(e){this.id=Po++,this.version="10.9.2",this.plugins=new co,this.options={id:{minify:!1},createGenerateId:fo,Renderer:mn?xo:null,plugins:[]},this.generateId=fo({minify:!1});for(var t=0;t<so.length;t++)this.plugins.use(so[t],{queue:"internal"});this.setup(e)}var t=e.prototype;return t.setup=function(e){return void 0===e&&(e={}),e.createGenerateId&&(this.options.createGenerateId=e.createGenerateId),e.id&&(this.options.id=un({},this.options.id,e.id)),(e.createGenerateId||e.id)&&(this.generateId=this.options.createGenerateId(this.options.id)),null!=e.insertionPoint&&(this.options.insertionPoint=e.insertionPoint),"Renderer"in e&&(this.options.Renderer=e.Renderer),e.plugins&&this.use.apply(this,e.plugins),this},t.createStyleSheet=function(e,t){void 0===t&&(t={});var n=t.index;"number"!=typeof n&&(n=0===ho.index?0:ho.index+1);var o=new lo(e,un({},t,{jss:this,generateId:t.generateId||this.generateId,insertionPoint:this.options.insertionPoint,Renderer:this.options.Renderer,index:n}));return this.plugins.onProcessSheet(o),o},t.removeStyleSheet=function(e){return e.detach(),ho.remove(e),this},t.createRule=function(e,t,n){if(void 0===t&&(t={}),void 0===n&&(n={}),"object"==typeof e)return this.createRule(void 0,e,t);var o=un({},n,{name:e,jss:this,Renderer:this.options.Renderer});o.generateId||(o.generateId=this.generateId),o.classes||(o.classes={}),o.keyframes||(o.keyframes={});var s=bn(e,t,o);return s&&this.plugins.onProcessRule(s),s},t.use=function(){for(var e=this,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return n.forEach((function(t){e.plugins.use(t)})),this},e}();"object"==typeof CSS&&null!=CSS&&CSS;const Ro=new Io(void 0);var Mo="@global",Lo=function(){function e(e,t,n){for(var o in this.type="global",this.at=Mo,this.isProcessed=!1,this.key=e,this.options=n,this.rules=new ao(un({},n,{parent:this})),t)this.rules.add(o,t[o]);this.rules.process()}var t=e.prototype;return t.getRule=function(e){return this.rules.get(e)},t.addRule=function(e,t,n){var o=this.rules.add(e,t,n);return o&&this.options.jss.plugins.onProcessRule(o),o},t.replaceRule=function(e,t,n){var o=this.rules.replace(e,t,n);return o&&this.options.jss.plugins.onProcessRule(o),o},t.indexOf=function(e){return this.rules.indexOf(e)},t.toString=function(e){return this.rules.toString(e)},e}(),Bo=function(){function e(e,t,n){this.type="global",this.at=Mo,this.isProcessed=!1,this.key=e,this.options=n;var o=e.substr(8);this.rule=n.jss.createRule(o,t,un({},n,{parent:this}))}return e.prototype.toString=function(e){return this.rule?this.rule.toString(e):""},e}(),Ao=/\s*,\s*/g;function Oo(e,t){for(var n=e.split(Ao),o="",s=0;s<n.length;s++)o+=t+" "+n[s].trim(),n[s+1]&&(o+=", ");return o}const _o=function(){return{onCreateRule:function(e,t,n){if(!e)return null;if(e===Mo)return new Lo(e,t,n);if("@"===e[0]&&"@global "===e.substr(0,8))return new Bo(e,t,n);var o=n.parent;return o&&("global"===o.type||o.options.parent&&"global"===o.options.parent.type)&&(n.scoped=!1),n.selector||!1!==n.scoped||(n.selector=e),null},onProcessRule:function(e,t){"style"===e.type&&t&&(function(e,t){var n=e.options,o=e.style,s=o?o[Mo]:null;if(s){for(var i in s)t.addRule(i,s[i],un({},n,{selector:Oo(i,e.selector)}));delete o[Mo]}}(e,t),function(e,t){var n=e.options,o=e.style;for(var s in o)if("@"===s[0]&&s.substr(0,7)===Mo){var i=Oo(s.substr(7),e.selector);t.addRule(i,o[s],un({},n,{selector:i})),delete o[s]}}(e,t))}}};var Fo=/[A-Z]/g,Do=/^ms-/,Uo={};function Go(e){return"-"+e.toLowerCase()}const Ho=function(e){if(Uo.hasOwnProperty(e))return Uo[e];var t=e.replace(Fo,Go);return Uo[e]=Do.test(t)?"-"+t:t};function zo(e){var t={};for(var n in e)t[0===n.indexOf("--")?n:Ho(n)]=e[n];return e.fallbacks&&(Array.isArray(e.fallbacks)?t.fallbacks=e.fallbacks.map(zo):t.fallbacks=zo(e.fallbacks)),t}const Wo=function(){return{onProcessStyle:function(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++)e[t]=zo(e[t]);return e}return zo(e)},onChangeValue:function(e,t,n){if(0===t.indexOf("--"))return e;var o=Ho(t);return t===o?e:(n.prop(o,e),null)}}};var Vo={d:(e,t)=>{for(var n in t)Vo.o(t,n)&&!Vo.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},qo={};Vo.d(qo,{nR:()=>ss,JI:()=>Xo,lg:()=>Ms,j9:()=>Rs,Xk:()=>Yo,Tv:()=>Zo,hv:()=>os,vo:()=>ns,ME:()=>Ko,eF:()=>_s,zF:()=>es,Y3:()=>bs,JH:()=>Es,C4:()=>Ts,U$:()=>xs,II:()=>ks,Yi:()=>ts,ny:()=>Qo});const $o=(jo={CandidatePairStats:()=>jt,Flags:()=>Qt,Logger:()=>Kt,NumericParameters:()=>Zt,OptionParameters:()=>on,SettingFlag:()=>an,TextParameters:()=>ln,WebXRController:()=>cn},Jo={},Vo.d(Jo,jo),Jo);var jo,Jo,Qo;class Ko{constructor(e,t,n){this.rootDiv=e,this.rootElement=t,this.textElement=n,this.rootElement.appendChild(this.textElement),this.hide(),this.rootDiv.appendChild(this.rootElement)}show(){this.rootElement.classList.remove("hiddenState")}hide(){this.rootElement.classList.add("hiddenState")}}class Xo extends Ko{constructor(e,t,n){super(e,t,n),this.onActionCallback=()=>{$o.Logger.Info($o.Logger.GetStackTrace(),"Did you forget to set the onAction callback in your overlay?")}}update(e){null==e&&null==e||(this.textElement.innerHTML=e)}onAction(e){this.onActionCallback=e}activate(){this.onActionCallback()}}class Yo extends Xo{static createRootElement(){const e=document.createElement("div");return e.id="connectOverlay",e.className="clickableState",e}static createContentElement(){const e=document.createElement("div");return e.id="connectButton",e.innerHTML="Click to start",e}constructor(e){super(e,Yo.createRootElement(),Yo.createContentElement()),this.rootElement.addEventListener("click",(()=>{this.activate()}))}}class Zo extends Xo{static createRootElement(){const e=document.createElement("div");return e.id="disconnectOverlay",e.className="clickableState",e}static createContentElement(){const e=document.createElement("div");return e.id="disconnectButton",e.innerHTML="Click To Restart",e}constructor(e){super(e,Zo.createRootElement(),Zo.createContentElement()),this.rootElement.addEventListener("click",(()=>{this.activate()}))}}class es extends Xo{static createRootElement(){const e=document.createElement("div");return e.id="playOverlay",e.className="clickableState",e}static createContentElement(){const e=bt.PlayBtn,t=document.createElement("img");return t.id="playButton",t.src=""!==e&&null!=e&&null!=e?e:"https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/Play_button2.png",t.alt="Start Streaming",t}constructor(e){super(e,es.createRootElement(),es.createContentElement()),this.rootElement.addEventListener("click",(()=>{this.activate()}))}}class ts extends Ko{constructor(e,t,n){super(e,t,n)}update(e){null==e&&null==e||(this.textElement.innerHTML=e)}}class ns extends ts{static createRootElement(){const e=document.createElement("div");return e.id="infoOverlay",e.className="textDisplayState",e}static createContentElement(){const e=document.createElement("div");return e.id="messageOverlayInner",e}constructor(e){super(e,ns.createRootElement(),ns.createContentElement())}}class os extends ts{static createRootElement(){const e=document.createElement("div");return e.id="errorOverlay",e.className="textDisplayState",e}static createContentElement(){const e=document.createElement("div");return e.id="errorOverlayInner",e}constructor(e){super(e,os.createRootElement(),os.createContentElement())}}class ss extends Xo{static createRootElement(){const e=document.createElement("div");return e.id="afkOverlay",e.className="clickableState",e}static createContentElement(){const e=document.createElement("div");return e.id="afkOverlayInner",e.innerHTML='<center>No activity detected<br>Disconnecting in <span id="afkCountDownNumber"></span> seconds<br>Click to continue<br></center>',e}constructor(e){super(e,ss.createRootElement(),ss.createContentElement()),this.rootElement.addEventListener("click",(()=>{this.activate()}))}updateCountdown(e){this.textElement.innerHTML=`<center>No activity detected<br>Disconnecting in <span id="afkCountDownNumber">${e}</span> seconds<br>Click to continue<br></center>`}}class is{get rootElement(){return this._rootElement}set rootElement(e){e.onclick=()=>this.toggleFullscreen(),this._rootElement=e}constructor(){this.isFullscreen=!1,document.addEventListener("webkitfullscreenchange",(()=>this.onFullscreenChange()),!1),document.addEventListener("mozfullscreenchange",(()=>this.onFullscreenChange()),!1),document.addEventListener("fullscreenchange",(()=>this.onFullscreenChange()),!1),document.addEventListener("MSFullscreenChange",(()=>this.onFullscreenChange()),!1)}toggleFullscreen(){if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen();else{const e=this.fullscreenElement;if(!e)return;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullscreen?e.mozRequestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()}this.onFullscreenChange()}onFullscreenChange(){this.isFullscreen=document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement&&null!==document.msFullscreenElement||document.fullscreenElement&&null!==document.fullscreenElement}}class rs extends is{constructor(e){super(),this.rootElement=e}}class as extends is{constructor(){super();const e=document.createElement("button");e.type="button",e.classList.add("UiTool"),e.id="fullscreen-btn",e.appendChild(this.maximizeIcon),e.appendChild(this.minimizeIcon),e.appendChild(this.tooltipText),this.rootElement=e}get tooltipText(){return this._tooltipText||(this._tooltipText=document.createElement("span"),this._tooltipText.classList.add("tooltiptext"),this._tooltipText.innerHTML="Fullscreen"),this._tooltipText}get maximizeIcon(){if(!this._maximizeIcon){this._maximizeIcon=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._maximizeIcon.setAttributeNS(null,"id","maximizeIcon"),this._maximizeIcon.setAttributeNS(null,"x","0px"),this._maximizeIcon.setAttributeNS(null,"y","0px"),this._maximizeIcon.setAttributeNS(null,"viewBox","0 0 384.97 384.97");const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("svgIcon"),this._maximizeIcon.appendChild(e);const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttributeNS(null,"d","M384.97,12.03c0-6.713-5.317-12.03-12.03-12.03H264.847c-6.833,0-11.922,5.39-11.934,12.223c0,6.821,5.101,11.838,11.934,11.838h96.062l-0.193,96.519c0,6.833,5.197,12.03,12.03,12.03c6.833-0.012,12.03-5.197,12.03-12.03l0.193-108.369c0-0.036-0.012-0.06-0.012-0.084C384.958,12.09,384.97,12.066,384.97,12.03z");const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttributeNS(null,"d","M120.496,0H12.403c-0.036,0-0.06,0.012-0.096,0.012C12.283,0.012,12.247,0,12.223,0C5.51,0,0.192,5.317,0.192,12.03L0,120.399c0,6.833,5.39,11.934,12.223,11.934c6.821,0,11.838-5.101,11.838-11.934l0.192-96.339h96.242c6.833,0,12.03-5.197,12.03-12.03C132.514,5.197,127.317,0,120.496,0z");const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttributeNS(null,"d","M120.123,360.909H24.061v-96.242c0-6.833-5.197-12.03-12.03-12.03S0,257.833,0,264.667v108.092c0,0.036,0.012,0.06,0.012,0.084c0,0.036-0.012,0.06-0.012,0.096c0,6.713,5.317,12.03,12.03,12.03h108.092c6.833,0,11.922-5.39,11.934-12.223C132.057,365.926,126.956,360.909,120.123,360.909z");const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttributeNS(null,"d","M372.747,252.913c-6.833,0-11.85,5.101-11.838,11.934v96.062h-96.242c-6.833,0-12.03,5.197-12.03,12.03s5.197,12.03,12.03,12.03h108.092c0.036,0,0.06-0.012,0.084-0.012c0.036-0.012,0.06,0.012,0.096,0.012c6.713,0,12.03-5.317,12.03-12.03V264.847C384.97,258.014,379.58,252.913,372.747,252.913z"),e.appendChild(t),e.appendChild(n),e.appendChild(o),e.appendChild(s)}return this._maximizeIcon}get minimizeIcon(){if(!this._minimizeIcon){this._minimizeIcon=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._minimizeIcon.setAttributeNS(null,"id","minimizeIcon"),this._minimizeIcon.setAttributeNS(null,"x","0px"),this._minimizeIcon.setAttributeNS(null,"y","0px"),this._minimizeIcon.setAttributeNS(null,"viewBox","0 0 385.331 385.331");const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("svgIcon"),this._minimizeIcon.appendChild(e);const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttributeNS(null,"d","M264.943,156.665h108.273c6.833,0,11.934-5.39,11.934-12.211c0-6.833-5.101-11.85-11.934-11.838h-96.242V36.181c0-6.833-5.197-12.03-12.03-12.03s-12.03,5.197-12.03,12.03v108.273c0,0.036,0.012,0.06,0.012,0.084c0,0.036-0.012,0.06-0.012,0.096C252.913,151.347,258.23,156.677,264.943,156.665z");const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttributeNS(null,"d","M120.291,24.247c-6.821,0-11.838,5.113-11.838,11.934v96.242H12.03c-6.833,0-12.03,5.197-12.03,12.03c0,6.833,5.197,12.03,12.03,12.03h108.273c0.036,0,0.06-0.012,0.084-0.012c0.036,0,0.06,0.012,0.096,0.012c6.713,0,12.03-5.317,12.03-12.03V36.181C132.514,29.36,127.124,24.259,120.291,24.247z");const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttributeNS(null,"d","M120.387,228.666H12.115c-6.833,0.012-11.934,5.39-11.934,12.223c0,6.833,5.101,11.85,11.934,11.838h96.242v96.423c0,6.833,5.197,12.03,12.03,12.03c6.833,0,12.03-5.197,12.03-12.03V240.877c0-0.036-0.012-0.06-0.012-0.084c0-0.036,0.012-0.06,0.012-0.096C132.418,233.983,127.1,228.666,120.387,228.666z");const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttributeNS(null,"d","M373.3,228.666H265.028c-0.036,0-0.06,0.012-0.084,0.012c-0.036,0-0.06-0.012-0.096-0.012c-6.713,0-12.03,5.317-12.03,12.03v108.273c0,6.833,5.39,11.922,12.223,11.934c6.821,0.012,11.838-5.101,11.838-11.922v-96.242H373.3c6.833,0,12.03-5.197,12.03-12.03S380.134,228.678,373.3,228.666z"),e.appendChild(t),e.appendChild(n),e.appendChild(o),e.appendChild(s)}return this._minimizeIcon}onFullscreenChange(){super.onFullscreenChange();const e=this.minimizeIcon,t=this.maximizeIcon;this.isFullscreen?(e.style.display="inline",e.style.transform="translate(0, 0)",t.style.display="none"):(e.style.display="none",t.style.display="inline",t.style.transform="translate(0, 0)")}}class ls{get rootElement(){return this._rootElement||(this._rootElement=document.createElement("button"),this._rootElement.type="button",this._rootElement.classList.add("UiTool"),this._rootElement.id="settingsBtn",this._rootElement.appendChild(this.settingsIcon),this._rootElement.appendChild(this.tooltipText)),this._rootElement}get tooltipText(){return this._tooltipText||(this._tooltipText=document.createElement("span"),this._tooltipText.classList.add("tooltiptext"),this._tooltipText.innerHTML="Settings"),this._tooltipText}get settingsIcon(){if(!this._settingsIcon){this._settingsIcon=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._settingsIcon.setAttributeNS(null,"id","settingsIcon"),this._settingsIcon.setAttributeNS(null,"x","0px"),this._settingsIcon.setAttributeNS(null,"y","0px"),this._settingsIcon.setAttributeNS(null,"viewBox","0 0 478.703 478.703");const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("svgIcon"),this._settingsIcon.appendChild(e);const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttributeNS(null,"d","M454.2,189.101l-33.6-5.7c-3.5-11.3-8-22.2-13.5-32.6l19.8-27.7c8.4-11.8,7.1-27.9-3.2-38.1l-29.8-29.8\t\t\tc-5.6-5.6-13-8.7-20.9-8.7c-6.2,0-12.1,1.9-17.1,5.5l-27.8,19.8c-10.8-5.7-22.1-10.4-33.8-13.9l-5.6-33.2\t\t\tc-2.4-14.3-14.7-24.7-29.2-24.7h-42.1c-14.5,0-26.8,10.4-29.2,24.7l-5.8,34c-11.2,3.5-22.1,8.1-32.5,13.7l-27.5-19.8\t\t\tc-5-3.6-11-5.5-17.2-5.5c-7.9,0-15.4,3.1-20.9,8.7l-29.9,29.8c-10.2,10.2-11.6,26.3-3.2,38.1l20,28.1\t\t\tc-5.5,10.5-9.9,21.4-13.3,32.7l-33.2,5.6c-14.3,2.4-24.7,14.7-24.7,29.2v42.1c0,14.5,10.4,26.8,24.7,29.2l34,5.8\t\t\tc3.5,11.2,8.1,22.1,13.7,32.5l-19.7,27.4c-8.4,11.8-7.1,27.9,3.2,38.1l29.8,29.8c5.6,5.6,13,8.7,20.9,8.7c6.2,0,12.1-1.9,17.1-5.5\t\t\tl28.1-20c10.1,5.3,20.7,9.6,31.6,13l5.6,33.6c2.4,14.3,14.7,24.7,29.2,24.7h42.2c14.5,0,26.8-10.4,29.2-24.7l5.7-33.6\t\t\tc11.3-3.5,22.2-8,32.6-13.5l27.7,19.8c5,3.6,11,5.5,17.2,5.5l0,0c7.9,0,15.3-3.1,20.9-8.7l29.8-29.8c10.2-10.2,11.6-26.3,3.2-38.1\t\t\tl-19.8-27.8c5.5-10.5,10.1-21.4,13.5-32.6l33.6-5.6c14.3-2.4,24.7-14.7,24.7-29.2v-42.1\t\t\tC478.9,203.801,468.5,191.501,454.2,189.101z M451.9,260.401c0,1.3-0.9,2.4-2.2,2.6l-42,7c-5.3,0.9-9.5,4.8-10.8,9.9\t\t\tc-3.8,14.7-9.6,28.8-17.4,41.9c-2.7,4.6-2.5,10.3,0.6,14.7l24.7,34.8c0.7,1,0.6,2.5-0.3,3.4l-29.8,29.8c-0.7,0.7-1.4,0.8-1.9,0.8\t\t\tc-0.6,0-1.1-0.2-1.5-0.5l-34.7-24.7c-4.3-3.1-10.1-3.3-14.7-0.6c-13.1,7.8-27.2,13.6-41.9,17.4c-5.2,1.3-9.1,5.6-9.9,10.8l-7.1,42\t\t\tc-0.2,1.3-1.3,2.2-2.6,2.2h-42.1c-1.3,0-2.4-0.9-2.6-2.2l-7-42c-0.9-5.3-4.8-9.5-9.9-10.8c-14.3-3.7-28.1-9.4-41-16.8\t\t\tc-2.1-1.2-4.5-1.8-6.8-1.8c-2.7,0-5.5,0.8-7.8,2.5l-35,24.9c-0.5,0.3-1,0.5-1.5,0.5c-0.4,0-1.2-0.1-1.9-0.8l-29.8-29.8\t\t\tc-0.9-0.9-1-2.3-0.3-3.4l24.6-34.5c3.1-4.4,3.3-10.2,0.6-14.8c-7.8-13-13.8-27.1-17.6-41.8c-1.4-5.1-5.6-9-10.8-9.9l-42.3-7.2\t\t\tc-1.3-0.2-2.2-1.3-2.2-2.6v-42.1c0-1.3,0.9-2.4,2.2-2.6l41.7-7c5.3-0.9,9.6-4.8,10.9-10c3.7-14.7,9.4-28.9,17.1-42\t\t\tc2.7-4.6,2.4-10.3-0.7-14.6l-24.9-35c-0.7-1-0.6-2.5,0.3-3.4l29.8-29.8c0.7-0.7,1.4-0.8,1.9-0.8c0.6,0,1.1,0.2,1.5,0.5l34.5,24.6\t\t\tc4.4,3.1,10.2,3.3,14.8,0.6c13-7.8,27.1-13.8,41.8-17.6c5.1-1.4,9-5.6,9.9-10.8l7.2-42.3c0.2-1.3,1.3-2.2,2.6-2.2h42.1\t\t\tc1.3,0,2.4,0.9,2.6,2.2l7,41.7c0.9,5.3,4.8,9.6,10,10.9c15.1,3.8,29.5,9.7,42.9,17.6c4.6,2.7,10.3,2.5,14.7-0.6l34.5-24.8\t\t\tc0.5-0.3,1-0.5,1.5-0.5c0.4,0,1.2,0.1,1.9,0.8l29.8,29.8c0.9,0.9,1,2.3,0.3,3.4l-24.7,34.7c-3.1,4.3-3.3,10.1-0.6,14.7\t\t\tc7.8,13.1,13.6,27.2,17.4,41.9c1.3,5.2,5.6,9.1,10.8,9.9l42,7.1c1.3,0.2,2.2,1.3,2.2,2.6v42.1H451.9z");const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttributeNS(null,"d","M239.4,136.001c-57,0-103.3,46.3-103.3,103.3s46.3,103.3,103.3,103.3s103.3-46.3,103.3-103.3S296.4,136.001,239.4,136.001z M239.4,315.601c-42.1,0-76.3-34.2-76.3-76.3s34.2-76.3,76.3-76.3s76.3,34.2,76.3,76.3S281.5,315.601,239.4,315.601z"),e.appendChild(t),e.appendChild(n)}return this._settingsIcon}}class cs{get rootElement(){return this._rootElement||(this._rootElement=document.createElement("button"),this._rootElement.type="button",this._rootElement.classList.add("UiTool"),this._rootElement.id="statsBtn",this._rootElement.appendChild(this.statsIcon),this._rootElement.appendChild(this.tooltipText)),this._rootElement}get tooltipText(){return this._tooltipText||(this._tooltipText=document.createElement("span"),this._tooltipText.classList.add("tooltiptext"),this._tooltipText.innerHTML="Information"),this._tooltipText}get statsIcon(){if(!this._statsIcon){this._statsIcon=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._statsIcon.setAttributeNS(null,"id","statsIcon"),this._statsIcon.setAttributeNS(null,"x","0px"),this._statsIcon.setAttributeNS(null,"y","0px"),this._statsIcon.setAttributeNS(null,"viewBox","0 0 330 330");const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("svgIcon"),this._statsIcon.appendChild(e);const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttributeNS(null,"d","M165,0.008C74.019,0.008,0,74.024,0,164.999c0,90.977,74.019,164.992,165,164.992s165-74.015,165-164.992C330,74.024,255.981,0.008,165,0.008z M165,299.992c-74.439,0-135-60.557-135-134.992S90.561,30.008,165,30.008s135,60.557,135,134.991C300,239.436,239.439,299.992,165,299.992z");const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttributeNS(null,"d","M165,130.008c-8.284,0-15,6.716-15,15v99.983c0,8.284,6.716,15,15,15s15-6.716,15-15v-99.983C180,136.725,173.284,130.008,165,130.008z");const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttributeNS(null,"d","M165,70.011c-3.95,0-7.811,1.6-10.61,4.39c-2.79,2.79-4.39,6.66-4.39,10.61s1.6,7.81,4.39,10.61c2.79,2.79,6.66,4.39,10.61,4.39s7.81-1.6,10.609-4.39c2.79-2.8,4.391-6.66,4.391-10.61s-1.601-7.82-4.391-10.61C172.81,71.61,168.95,70.011,165,70.011z"),e.appendChild(t),e.appendChild(n),e.appendChild(o)}return this._statsIcon}}class ds{get rootElement(){return this._rootElement||(this._rootElement=document.createElement("button"),this._rootElement.type="button",this._rootElement.classList.add("UiTool"),this._rootElement.id="xrBtn",this._rootElement.appendChild(this.xrIcon),this._rootElement.appendChild(this.tooltipText)),this._rootElement}get tooltipText(){return this._tooltipText||(this._tooltipText=document.createElement("span"),this._tooltipText.classList.add("tooltiptext"),this._tooltipText.innerHTML="XR"),this._tooltipText}get xrIcon(){if(!this._xrIcon){this._xrIcon=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._xrIcon.setAttributeNS(null,"id","xrIcon"),this._xrIcon.setAttributeNS(null,"x","0px"),this._xrIcon.setAttributeNS(null,"y","0px"),this._xrIcon.setAttributeNS(null,"viewBox","0 0 100 100");const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("svgIcon"),this._xrIcon.appendChild(e);const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttributeNS(null,"d","M29 41c-5 0-9 4-9 9s4 9 9 9 9-4 9-9-4-9-9-9zm0 14c-2.8 0-5-2.2-5-5s2.2-5 5-5 5 2.2 5 5-2.2 5-5 5zm42-14c-5 0-9 4-9 9s4 9 9 9 9-4 9-9-4-9-9-9zm0 14c-2.8 0-5-2.2-5-5s2.2-5 5-5 5 2.2 5 5-2.2 5-5 5zm12-31H17c-6.6 0-12 5.4-12 12v28c0 6.6 5.4 12 12 12h14.5c3.5 0 6.8-1.5 9-4.1l3.5-4c1.5-1.7 3.7-2.7 6-2.7s4.5 1 6 2.7l3.5 4c2.3 2.6 5.6 4.1 9 4.1H83c6.6 0 12-5.4 12-12V36c0-6.6-5.4-12-12-12zm8 40c0 4.4-3.6 8-8 8H68.5c-2.3 0-4.5-1-6-2.7l-3.5-4c-2.3-2.6-5.6-4.1-9-4.1-3.5 0-6.8 1.5-9 4.1l-3.5 4C36 71 33.8 72 31.5 72H17c-4.4 0-8-3.6-8-8V36c0-4.4 3.6-8 8-8h66c4.4 0 8 3.6 8 8v28z"),e.appendChild(t)}return this._xrIcon}}function us(e){return!e||!!e&&e.isEnabled}function hs(e){return null==e||e.creationMode===Qo.CreateDefaultElement}!function(e){e[e.CreateDefaultElement=0]="CreateDefaultElement",e[e.UseCustomElement=1]="UseCustomElement",e[e.Disable=2]="Disable"}(Qo||(Qo={}));class ms{constructor(e){e&&!hs(e.statsButtonType)||(this.statsIcon=new cs),e&&!hs(e.settingsButtonType)||(this.settingsIcon=new ls),e&&!hs(e.fullscreenButtonType)||(this.fullscreenIcon=new as),e&&!hs(e.xrIconType)||(this.xrIcon=new ds)}get rootElement(){return this._rootElement||(this._rootElement=document.createElement("div"),this._rootElement.id="controls",this._rootElement.style.display="none",this.fullscreenIcon&&this._rootElement.appendChild(this.fullscreenIcon.rootElement),this.settingsIcon&&this._rootElement.appendChild(this.settingsIcon.rootElement),this.statsIcon&&this._rootElement.appendChild(this.statsIcon.rootElement),this.xrIcon&&$o.WebXRController.isSessionSupported("immersive-vr").then((e=>{e&&this._rootElement.appendChild(this.xrIcon.rootElement)}))),this._rootElement}}class gs{constructor(e,t){this._label=e,this._buttonText=t}addOnClickListener(e){this.button.addEventListener("click",e)}get button(){return this._button||(this._button=document.createElement("input"),this._button.type="button",this._button.value=this._buttonText,this._button.classList.add("overlay-button"),this._button.classList.add("btn-flat")),this._button}get rootElement(){if(!this._rootElement){this._rootElement=document.createElement("div"),this._rootElement.classList.add("setting");const e=document.createElement("div");e.innerText=this._label,this._rootElement.appendChild(e);const t=document.createElement("label");t.classList.add("btn-overlay"),this._rootElement.appendChild(t),t.appendChild(this.button)}return this._rootElement}}class ps{constructor(){this._rootElement=null}get rootElement(){if(!this._rootElement){this._rootElement=document.createElement("div"),this._rootElement.id="settings-panel",this._rootElement.classList.add("panel-wrap");const e=document.createElement("div");e.classList.add("panel"),this._rootElement.appendChild(e);const t=document.createElement("div");t.id="settingsHeading",t.textContent="Settings",e.appendChild(t),e.appendChild(this.settingsCloseButton),e.appendChild(this.settingsContentElement)}return this._rootElement}get settingsContentElement(){return this._settingsContentElement||(this._settingsContentElement=document.createElement("div"),this._settingsContentElement.id="settingsContent"),this._settingsContentElement}get settingsCloseButton(){return this._settingsCloseButton||(this._settingsCloseButton=document.createElement("div"),this._settingsCloseButton.id="settingsClose"),this._settingsCloseButton}show(){this.rootElement.classList.contains("panel-wrap-visible")||this.rootElement.classList.add("panel-wrap-visible")}toggleVisibility(){this.rootElement.classList.toggle("panel-wrap-visible")}hide(){this.rootElement.classList.contains("panel-wrap-visible")&&this.rootElement.classList.remove("panel-wrap-visible")}}class fs{get rootElement(){if(!this._rootElement){this._rootElement=document.createElement("section"),this._rootElement.classList.add("settingsContainer");const e=document.createElement("div");e.id="latencyTestHeader",e.classList.add("settings-text"),e.classList.add("settingsHeader"),this._rootElement.appendChild(e);const t=document.createElement("div");t.innerHTML="Latency Test",e.appendChild(t),e.appendChild(this.latencyTestButton);const n=document.createElement("div");n.id="latencyTestContainer",n.classList.add("d-none"),this._rootElement.appendChild(n),n.appendChild(this.latencyTestResultsElement)}return this._rootElement}get latencyTestResultsElement(){return this._latencyTestResultsElement||(this._latencyTestResultsElement=document.createElement("div"),this._latencyTestResultsElement.id="latencyStatsResults",this._latencyTestResultsElement.classList.add("StatsResult")),this._latencyTestResultsElement}get latencyTestButton(){return this._latencyTestButton||(this._latencyTestButton=document.createElement("input"),this._latencyTestButton.type="button",this._latencyTestButton.value="Run Test",this._latencyTestButton.id="btn-start-latency-test",this._latencyTestButton.classList.add("streamTools-button"),this._latencyTestButton.classList.add("btn-flat")),this._latencyTestButton}handleTestResult(e){$o.Logger.Log($o.Logger.GetStackTrace(),e.toString(),6);let t="";t+="<div>Net latency RTT (ms): "+e.networkLatency+"</div>",t+="<div>UE Encode (ms): "+e.EncodeMs+"</div>",t+="<div>UE Capture (ms): "+e.CaptureToSendMs+"</div>",t+="<div>Browser send latency (ms): "+e.browserSendLatency+"</div>",t+=e.frameDisplayDeltaTimeMs&&e.browserReceiptTimeMs?"<div>Browser receive latency (ms): "+e.frameDisplayDeltaTimeMs+"</div>":"",t+="<div>Total latency (excluding browser) (ms): "+e.latencyExcludingDecode+"</div>",t+=e.endToEndLatency?"<div>Total latency (ms): "+e.endToEndLatency+"</div>":"",this.latencyTestResultsElement.innerHTML=t;const n=document.getElementById("LatencyStats");n&&(n.innerHTML=t)}}class vs{static formatBytes(e,t){if(0===e)return"0";const n=t<0?0:t,o=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,o)).toFixed(n))+" "+["Bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"][o]}}class ys{get rootElement(){if(!this._rootElement){this._rootElement=document.createElement("section"),this._rootElement.classList.add("settingsContainer");const e=document.createElement("div");e.id="dataChannelLatencyTestHeader",e.classList.add("settings-text"),e.classList.add("settingsHeader"),this._rootElement.appendChild(e);const t=document.createElement("div");t.innerHTML="Data Channel Latency Test",e.appendChild(t),e.appendChild(this.latencyTestButton);const n=document.createElement("div");n.id="dataChannelLatencyTestContainer",n.classList.add("d-none"),this._rootElement.appendChild(n),n.appendChild(this.latencyTestResultsElement)}return this._rootElement}get latencyTestResultsElement(){return this._latencyTestResultsElement||(this._latencyTestResultsElement=document.createElement("div"),this._latencyTestResultsElement.id="dataChannelLatencyStatsResults",this._latencyTestResultsElement.classList.add("StatsResult")),this._latencyTestResultsElement}get latencyTestButton(){return this._latencyTestButton||(this._latencyTestButton=document.createElement("input"),this._latencyTestButton.type="button",this._latencyTestButton.value="Run Test",this._latencyTestButton.id="btn-start-data-channel-latency-test",this._latencyTestButton.classList.add("streamTools-button"),this._latencyTestButton.classList.add("btn-flat")),this._latencyTestButton}handleTestResult(e){if($o.Logger.Log($o.Logger.GetStackTrace(),e.toString(),6),isNaN(e.dataChannelRtt))return void(this.latencyTestResultsElement.innerHTML="<div>Not supported</div>");let t="";t+="<div>Data channel RTT (ms): "+e.dataChannelRtt+"</div>",e.playerToStreamerTime>=0&&e.streamerToPlayerTime>=0&&(t+="<div>Player to Streamer path (ms): "+e.playerToStreamerTime+"</div>",t+="<div>Streamer to Player path (ms): "+e.streamerToPlayerTime+"</div>"),this.latencyTestResultsElement.innerHTML=t;let n=document.createElement("input");n.type="button",n.value="Download",n.classList.add("streamTools-button"),n.classList.add("btn-flat"),n.onclick=()=>{let t=new Blob([e.exportLatencyAsCSV()],{type:"text/plain"}),n=document.createElement("a"),o=URL.createObjectURL(t);n.href=o,n.download="data_channel_latency_test_results.csv",document.body.appendChild(n),n.click(),setTimeout((function(){document.body.removeChild(n),window.URL.revokeObjectURL(o)}),0)},this.latencyTestResultsElement.appendChild(n)}handleTestStart(){this.latencyTestResultsElement.innerHTML="<div>Test in progress</div>"}}class Ss{}class Cs{constructor(){this.statsMap=new Map,this.latencyTest=new fs,this.dataChannelLatencyTest=new ys}get rootElement(){if(!this._rootElement){this._rootElement=document.createElement("div"),this._rootElement.id="stats-panel",this._rootElement.classList.add("panel-wrap");const e=document.createElement("div");e.classList.add("panel"),this._rootElement.appendChild(e);const t=document.createElement("div");t.id="statsHeading",t.textContent="Information",e.appendChild(t),e.appendChild(this.statsCloseButton),e.appendChild(this.statsContentElement)}return this._rootElement}get statsContentElement(){if(!this._statsContentElement){this._statsContentElement=document.createElement("div"),this._statsContentElement.id="statsContent";const e=document.createElement("div");e.id="streamToolsStats",e.classList.add("container");const t=document.createElement("div");t.id="ControlStats",t.classList.add("row");const n=document.createElement("section");n.id="statistics",n.classList.add("settingsContainer");const o=document.createElement("div");o.id="statisticsHeader",o.classList.add("settings-text"),o.classList.add("settingsHeader");const s=document.createElement("div");s.innerHTML="Session Stats",this._statsContentElement.appendChild(e),e.appendChild(t),t.appendChild(n),n.appendChild(o),o.appendChild(s),n.appendChild(this.statisticsContainer),t.appendChild(this.latencyTest.rootElement),t.appendChild(this.dataChannelLatencyTest.rootElement)}return this._statsContentElement}get statisticsContainer(){return this._statisticsContainer||(this._statisticsContainer=document.createElement("div"),this._statisticsContainer.id="statisticsContainer",this._statisticsContainer.classList.add("d-none"),this._statisticsContainer.appendChild(this.statsResult)),this._statisticsContainer}get statsResult(){return this._statsResult||(this._statsResult=document.createElement("div"),this._statsResult.id="statisticsResult",this._statsResult.classList.add("StatsResult")),this._statsResult}get statsCloseButton(){return this._statsCloseButton||(this._statsCloseButton=document.createElement("div"),this._statsCloseButton.id="statsClose"),this._statsCloseButton}onDisconnect(){this.latencyTest.latencyTestButton.onclick=()=>{},this.dataChannelLatencyTest.latencyTestButton.onclick=()=>{}}onVideoInitialized(e){this.latencyTest.latencyTestButton.onclick=()=>{e.requestLatencyTest()},this.dataChannelLatencyTest.latencyTestButton.onclick=()=>{e.requestDataChannelLatencyTest({duration:1e3,rps:10,requestSize:200,responseSize:200})&&this.dataChannelLatencyTest.handleTestStart()}}configure(e){e.DisableLatencyTest&&(this.latencyTest.latencyTestButton.disabled=!0,this.latencyTest.latencyTestButton.title="Disabled by -PixelStreamingDisableLatencyTester=true",this.dataChannelLatencyTest.latencyTestButton.disabled=!0,this.dataChannelLatencyTest.latencyTestButton.title="Disabled by -PixelStreamingDisableLatencyTester=true",$o.Logger.Info($o.Logger.GetStackTrace(),"-PixelStreamingDisableLatencyTester=true, requesting latency report from the the browser to UE is disabled."))}show(){this.rootElement.classList.contains("panel-wrap-visible")||this.rootElement.classList.add("panel-wrap-visible")}toggleVisibility(){this.rootElement.classList.toggle("panel-wrap-visible")}hide(){this.rootElement.classList.contains("panel-wrap-visible")&&this.rootElement.classList.remove("panel-wrap-visible")}handlePlayerCount(e){this.addOrUpdateStat("PlayerCountStat","Players",e.toString())}handleStats(e){var t,n,o,s,i;const r=new Intl.NumberFormat(window.navigator.language,{maximumFractionDigits:0}),a=vs.formatBytes(e.inboundVideoStats.bytesReceived,2);this.addOrUpdateStat("InboundDataStat","Received",a);const l=Object.prototype.hasOwnProperty.call(e.inboundVideoStats,"packetsLost")?r.format(e.inboundVideoStats.packetsLost):"Chrome only";this.addOrUpdateStat("PacketsLostStat","Packets Lost",l),e.inboundVideoStats.bitrate&&this.addOrUpdateStat("VideoBitrateStat","Video Bitrate (kbps)",e.inboundVideoStats.bitrate.toString()),e.inboundAudioStats.bitrate&&this.addOrUpdateStat("AudioBitrateStat","Audio Bitrate (kbps)",e.inboundAudioStats.bitrate.toString());const c=Object.prototype.hasOwnProperty.call(e.inboundVideoStats,"frameWidth")&&e.inboundVideoStats.frameWidth&&Object.prototype.hasOwnProperty.call(e.inboundVideoStats,"frameHeight")&&e.inboundVideoStats.frameHeight?e.inboundVideoStats.frameWidth+"x"+e.inboundVideoStats.frameHeight:"Chrome only";this.addOrUpdateStat("VideoResStat","Video resolution",c);const d=Object.prototype.hasOwnProperty.call(e.inboundVideoStats,"framesDecoded")?r.format(e.inboundVideoStats.framesDecoded):"Chrome only";this.addOrUpdateStat("FramesDecodedStat","Frames Decoded",d),e.inboundVideoStats.framesPerSecond&&this.addOrUpdateStat("FramerateStat","Framerate",e.inboundVideoStats.framesPerSecond.toString()),this.addOrUpdateStat("FramesDroppedStat","Frames dropped",null===(t=e.inboundVideoStats.framesDropped)||void 0===t?void 0:t.toString()),e.inboundVideoStats.codecId&&this.addOrUpdateStat("VideoCodecStat","Video codec",null!==(o=null===(n=e.codecs.get(e.inboundVideoStats.codecId))||void 0===n?void 0:n.split(" ")[0])&&void 0!==o?o:""),e.inboundAudioStats.codecId&&this.addOrUpdateStat("AudioCodecStat","Audio codec",null!==(i=null===(s=e.codecs.get(e.inboundAudioStats.codecId))||void 0===s?void 0:s.split(" ")[0])&&void 0!==i?i:"");let u=null!=e.getActiveCandidatePair()?e.getActiveCandidatePair():new $o.CandidatePairStats;const h=Object.prototype.hasOwnProperty.call(u,"currentRoundTripTime")&&e.isNumber(u.currentRoundTripTime)?r.format(1e3*u.currentRoundTripTime):"Can't calculate";this.addOrUpdateStat("RTTStat","Net RTT (ms)",h),this.addOrUpdateStat("DurationStat","Duration",e.sessionStats.runTime),this.addOrUpdateStat("ControlsInputStat","Controls stream input",e.sessionStats.controlsStreamInput),this.addOrUpdateStat("QPStat","Video quantization parameter",e.sessionStats.videoEncoderAvgQP.toString()),$o.Logger.Log($o.Logger.GetStackTrace(),`--------- Stats ---------\n ${e}\n------------------------`,6)}addOrUpdateStat(e,t,n){const o=`${t}: ${n}`;if(this.statsMap.has(e)){const t=this.statsMap.get(e);void 0!==t&&(t.element.innerHTML=o)}else{const s=new Ss;s.id=e,s.stat=n,s.title=t,s.element=document.createElement("div"),s.element.innerHTML=o,this.statsResult.appendChild(s.element),this.statsMap.set(e,s)}!function(){const e=document.getElementById("statistics");let t="";if(void 0!==As&&As.systemInfo&&As.systemInfo.graphics){if(As.systemInfo.cpu){let e=As.systemInfo.cpu;t+=`<div id="cpu-stats" style="color: lime">CPU: ${e.manufacturer} ${e.brand??"Unknown"}</div>`}As.systemInfo.graphics.controllers&&As.systemInfo.graphics.controllers.length>0&&(t+=`<div id="gpu-stats" style="color: lime">GPU: ${As.systemInfo.graphics.controllers[0].model??"Unknown"}</div>`),As.systemInfo.memory&&(t+=`<div id="total-memory-stats" style="color: lime">Total Memory: ${Ks(As.systemInfo.memory.total??0)} GB</div>`)}e&&(t+=e.innerHTML);let n=document.getElementById("statsInfoExtra");n&&(n.innerHTML=t);const o=document.getElementById("stats");o&&(o.innerHTML=e.innerHTML)}()}}class ws{constructor(){this.videoEncoderAvgQP=-1,this.statsText="",this.color="",this.orangeQP=26,this.redQP=35}get rootElement(){return this._rootElement||(this._rootElement=document.createElement("div"),this._rootElement.id="connection",this._rootElement.classList.add("UiTool"),this._rootElement.appendChild(this.qualityStatus),this._rootElement.appendChild(this.qualityText),this.updateQpTooltip(-1)),this._rootElement}get qualityText(){return this._qualityText||(this._qualityText=document.createElement("span"),this._qualityText.id="qualityText",this._qualityText.classList.add("tooltiptext")),this._qualityText}get qualityStatus(){return this._qualityStatus||(this._qualityStatus=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._qualityStatus.setAttributeNS(null,"id","connectionStrength"),this._qualityStatus.setAttributeNS(null,"x","0px"),this._qualityStatus.setAttributeNS(null,"y","0px"),this._qualityStatus.setAttributeNS(null,"viewBox","0 0 494.45 494.45"),this.qualityStatus.appendChild(this.dot),this.qualityStatus.appendChild(this.middle),this.qualityStatus.appendChild(this.outer),this.qualityStatus.appendChild(this.inner)),this._qualityStatus}get dot(){return this._dot||(this._dot=document.createElementNS("http://www.w3.org/2000/svg","circle"),this._dot.setAttributeNS(null,"id","dot"),this._dot.setAttributeNS(null,"cx","247.125"),this._dot.setAttributeNS(null,"cy","398.925"),this._dot.setAttributeNS(null,"r","35.3")),this._dot}get outer(){return this._outer||(this._outer=document.createElementNS("http://www.w3.org/2000/svg","path"),this._outer.setAttributeNS(null,"id","outer"),this._outer.setAttributeNS(null,"d","M467.925,204.625c-6.8,0-13.5-2.6-18.7-7.8c-111.5-111.4-292.7-111.4-404.1,0c-10.3,10.3-27.1,10.3-37.4,0s-10.3-27.1,0-37.4c64-64,149-99.2,239.5-99.2s175.5,35.2,239.5,99.2c10.3,10.3,10.3,27.1,0,37.4C481.425,202.025,474.625,204.625,467.925,204.625z")),this._outer}get middle(){return this._middle||(this._middle=document.createElementNS("http://www.w3.org/2000/svg","path"),this._middle.setAttributeNS(null,"id","middle"),this._middle.setAttributeNS(null,"d","M395.225,277.325c-6.8,0-13.5-2.6-18.7-7.8c-71.4-71.3-187.4-71.3-258.8,0c-10.3,10.3-27.1,10.3-37.4,0s-10.3-27.1,0-37.4c92-92,241.6-92,333.6,0c10.3,10.3,10.3,27.1,0,37.4C408.725,274.725,401.925,277.325,395.225,277.325z")),this._middle}get inner(){return this._inner||(this._inner=document.createElementNS("http://www.w3.org/2000/svg","path"),this._inner.setAttributeNS(null,"id","inner"),this._inner.setAttributeNS(null,"d","M323.625,348.825c-6.8,0-13.5-2.6-18.7-7.8c-15.4-15.4-36-23.9-57.8-23.9s-42.4,8.5-57.8,23.9c-10.3,10.3-27.1,10.3-37.4,0c-10.3-10.3-10.3-27.1,0-37.4c25.4-25.4,59.2-39.4,95.2-39.4s69.8,14,95.2,39.5c10.3,10.3,10.3,27.1,0,37.4C337.225,346.225,330.425,348.825,323.625,348.825z")),this._inner}blinkVideoQualityStatus(e){const t=document.getElementById("networkQualityStatus"),n=document.getElementById("qualityStatus");let o=e,s=1;const i=setInterval((()=>{s-=.1,this.qualityText.style.opacity=String(Math.abs(2*(s-.5))),t&&(t.style.opacity=String(Math.abs(2*(s-.5)))),n&&(n.style.opacity=String(Math.abs(2*(s-.5)))),s<=.1&&(0==--o?clearInterval(i):s=1)}),100/e)}updateQpTooltip(e){const t=document.getElementById("networkQualityStatus"),n=document.getElementById("qualityStatus");this.videoEncoderAvgQP=e,e>this.redQP?(this.color="red",this.blinkVideoQualityStatus(2),t&&(t.className=`${this.color}Status`),n&&(n.className=`${this.color}Status`),this.statsText=`<div style="color: ${this.color}">Poor encoding quality</div>`,this.outer.setAttributeNS(null,"fill","#3c3b40"),this.middle.setAttributeNS(null,"fill","#3c3b40"),this.inner.setAttributeNS(null,"fill",this.color),this.dot.setAttributeNS(null,"fill",this.color)):e>this.orangeQP?(this.color="orange",this.blinkVideoQualityStatus(1),t&&(t.className=`${this.color}Status`),n&&(n.className=`${this.color}Status`),this.statsText=`<div style="color: ${this.color}">Blocky encoding quality</div>`,this.outer.setAttributeNS(null,"fill","#3c3b40"),this.middle.setAttributeNS(null,"fill",this.color),this.inner.setAttributeNS(null,"fill",this.color),this.dot.setAttributeNS(null,"fill",this.color)):e<=0?(this.color="#b0b0b0",this.outer.setAttributeNS(null,"fill","#3c3b40"),this.middle.setAttributeNS(null,"fill","#3c3b40"),this.inner.setAttributeNS(null,"fill","#3c3b40"),this.dot.setAttributeNS(null,"fill","#3c3b40"),this.statsText=`<div style="color: ${this.color}">Not connected</div>`):(this.color="lime",t&&(t.className=`${this.color}Status`),n&&(n.className=`${this.color}Status`),this.qualityStatus.style.opacity="1",this.statsText=`<div style="color: ${this.color}">Clear encoding quality</div>`,this.outer.setAttributeNS(null,"fill",this.color),this.middle.setAttributeNS(null,"fill",this.color),this.inner.setAttributeNS(null,"fill",this.color),this.dot.setAttributeNS(null,"fill",this.color)),this.qualityText.innerHTML=this.statsText}}class bs{constructor(e){this._setting=e}get setting(){return this._setting}get rootElement(){return this._rootElement||(this._rootElement=document.createElement("div")),this._rootElement}}class Es extends bs{constructor(e){super(e),this.label=e.label,this.flag=e.flag}get setting(){return this._setting}get settingsTextElem(){return this._settingsTextElem||(this._settingsTextElem=document.createElement("div"),this._settingsTextElem.innerText=this.setting._label,this._settingsTextElem.title=this.setting.description),this._settingsTextElem}get checkbox(){return this._checkbox||(this._checkbox=document.createElement("input"),this._checkbox.type="checkbox"),this._checkbox}get rootElement(){if(!this._rootElement){this._rootElement=document.createElement("div"),this._rootElement.id=this.setting.id,this._rootElement.classList.add("setting"),this._rootElement.appendChild(this.settingsTextElem);const e=document.createElement("label");e.classList.add("tgl-switch"),this._rootElement.appendChild(e),this.checkbox.title=this.setting.description,this.checkbox.classList.add("tgl"),this.checkbox.classList.add("tgl-flat");const t=document.createElement("div");t.classList.add("tgl-slider"),e.appendChild(this.checkbox),e.appendChild(t),this.checkbox.addEventListener("change",(()=>{this.setting.flag!==this.checkbox.checked&&(this.setting.flag=this.checkbox.checked,this.setting.updateURLParams())}))}return this._rootElement}set flag(e){this.checkbox.checked=e}get flag(){return this.checkbox.checked}set label(e){this.settingsTextElem.innerText=e}get label(){return this.settingsTextElem.innerText}}class Ts extends bs{constructor(e){super(e),this.label=this.setting.label,this.number=this.setting.number}get setting(){return this._setting}get settingsTextElem(){return this._settingsTextElem||(this._settingsTextElem=document.createElement("label"),this._settingsTextElem.innerText=this.setting.label,this._settingsTextElem.title=this.setting.description),this._settingsTextElem}get spinner(){return this._spinner||(this._spinner=document.createElement("input"),this._spinner.type="number",this._spinner.min=this.setting.min.toString(),this._spinner.max=this.setting.max.toString(),this._spinner.value=this.setting.number.toString(),this._spinner.title=this.setting.description,this._spinner.classList.add("form-control")),this._spinner}get rootElement(){return this._rootElement||(this._rootElement=document.createElement("div"),this._rootElement.classList.add("setting"),this._rootElement.classList.add("form-group"),this._rootElement.appendChild(this.settingsTextElem),this._rootElement.appendChild(this.spinner),this.spinner.onchange=e=>{const t=e.target,n=Number.parseFloat(t.value);Number.isNaN(n)?($o.Logger.Warning($o.Logger.GetStackTrace(),`Could not parse value change into a valid number - value was ${t.value}, resetting value to ${this.setting.min}`),this.setting.number!==this.setting.min&&(this.setting.number=this.setting.min)):this.setting.number!==n&&(this.setting.number=n,this.setting.updateURLParams())}),this._rootElement}set number(e){this.spinner.value=this.setting.clamp(e).toString()}get number(){return+this.spinner.value}set label(e){this.settingsTextElem.innerText=e}get label(){return this.settingsTextElem.innerText}}class ks extends bs{constructor(e){super(e),this.label=this.setting.label,this.text=this.setting.text}get setting(){return this._setting}get settingsTextElem(){return this._settingsTextElem||(this._settingsTextElem=document.createElement("div"),this._settingsTextElem.innerText=this.setting.label,this._settingsTextElem.title=this.setting.description),this._settingsTextElem}get textbox(){return this._textbox||(this._textbox=document.createElement("input"),this._textbox.classList.add("form-control"),this._textbox.type="textbox"),this._textbox}get rootElement(){if(!this._rootElement){this._rootElement=document.createElement("div"),this._rootElement.id=this.setting.id,this._rootElement.classList.add("setting"),this._rootElement.appendChild(this.settingsTextElem);const e=document.createElement("label");this._rootElement.appendChild(e),this.textbox.title=this.setting.description,e.appendChild(this.textbox),this.textbox.addEventListener("input",(()=>{this.setting.text!==this.textbox.value&&(this.setting.text=this.textbox.value,this.setting.updateURLParams())}))}return this._rootElement}set text(e){this.textbox.value=e}get text(){return this.textbox.value}set label(e){this.settingsTextElem.innerText=e}get label(){return this.settingsTextElem.innerText}}class xs extends bs{constructor(e){super(e),this.label=this.setting.label,this.options=this.setting.options,this.selected=this.setting.selected}get setting(){return this._setting}get selector(){return this._selector||(this._selector=document.createElement("select"),this._selector.classList.add("form-control"),this._selector.classList.add("settings-option")),this._selector}get settingsTextElem(){return this._settingsTextElem||(this._settingsTextElem=document.createElement("div"),this._settingsTextElem.innerText=this.setting.label,this._settingsTextElem.title=this.setting.description),this._settingsTextElem}set label(e){this.settingsTextElem.innerText=e}get label(){return this.settingsTextElem.innerText}get rootElement(){if(!this._rootElement){this._rootElement=document.createElement("div"),this._rootElement.id=this.setting.id,this._rootElement.classList.add("setting"),this._rootElement.classList.add("form-group"),this._rootElement.appendChild(this.settingsTextElem);const e=document.createElement("label");this._rootElement.appendChild(e),this.selector.title=this.setting.description,e.appendChild(this.selector),this.selector.onchange=()=>{this.setting.selected!==this.selector.value&&(this.setting.selected=this.selector.value,this.setting.updateURLParams())}}return this._rootElement}set options(e){for(let e=this.selector.options.length-1;e>=0;e--)this.selector.remove(e);e.forEach((e=>{const t=document.createElement("option");t.value=e,t.innerHTML=e,this.selector.appendChild(t)}))}get options(){return[...this.selector.options].map((e=>e.value))}set selected(e){const t=this.options.filter((t=>-1!==t.indexOf(e)));t.length&&(this.selector.value=t[0])}get selected(){return this.selector.value}disable(){this.selector.disabled=!0}enable(){this.selector.disabled=!1}}const Ps="LightMode";class Rs{constructor(e){this.customFlags=new Map,this.flagsUi=new Map,this.numericParametersUi=new Map,this.textParametersUi=new Map,this.optionParametersUi=new Map,this.createCustomUISettings(e.useUrlParams),this.registerSettingsUIComponents(e)}createCustomUISettings(e){this.customFlags.set(Ps,new $o.SettingFlag(Ps,"Color Scheme: Dark Mode","Page styling will be either light or dark",!1,e,((e,t)=>{t.label=`Color Scheme: ${e?"Light":"Dark"} Mode`})))}registerSettingsUIComponents(e){for(const t of e.getFlags())this.flagsUi.set(t.id,new Es(t));for(const e of Array.from(this.customFlags.values()))this.flagsUi.set(e.id,new Es(e));for(const t of e.getTextSettings())this.textParametersUi.set(t.id,new ks(t));for(const t of e.getNumericSettings())this.numericParametersUi.set(t.id,new Ts(t));for(const t of e.getOptionSettings())this.optionParametersUi.set(t.id,new xs(t))}buildSectionWithHeading(e,t){const n=document.createElement("section");n.classList.add("settingsContainer");const o=document.createElement("div");return o.classList.add("settingsHeader"),o.classList.add("settings-text"),o.textContent=t,n.appendChild(o),e.appendChild(n),n}populateSettingsElement(e){const t=this.buildSectionWithHeading(e,"Pixel Streaming");this.addSettingText(t,this.textParametersUi.get($o.TextParameters.SignallingServerUrl)),this.addSettingOption(t,this.optionParametersUi.get($o.OptionParameters.StreamerId)),this.addSettingFlag(t,this.flagsUi.get($o.Flags.AutoConnect)),this.addSettingFlag(t,this.flagsUi.get($o.Flags.AutoPlayVideo)),this.addSettingFlag(t,this.flagsUi.get($o.Flags.BrowserSendOffer)),this.addSettingFlag(t,this.flagsUi.get($o.Flags.UseMic)),this.addSettingFlag(t,this.flagsUi.get($o.Flags.StartVideoMuted)),this.addSettingFlag(t,this.flagsUi.get($o.Flags.IsQualityController)),this.addSettingFlag(t,this.flagsUi.get($o.Flags.ForceMonoAudio)),this.addSettingFlag(t,this.flagsUi.get($o.Flags.ForceTURN)),this.addSettingFlag(t,this.flagsUi.get($o.Flags.SuppressBrowserKeys)),this.addSettingFlag(t,this.flagsUi.get($o.Flags.AFKDetection)),this.addSettingFlag(t,this.flagsUi.get($o.Flags.WaitForStreamer)),this.addSettingNumeric(t,this.numericParametersUi.get($o.NumericParameters.AFKTimeoutSecs)),this.addSettingNumeric(t,this.numericParametersUi.get($o.NumericParameters.MaxReconnectAttempts)),this.addSettingNumeric(t,this.numericParametersUi.get($o.NumericParameters.StreamerAutoJoinInterval));const n=this.buildSectionWithHeading(e,"UI");this.addSettingFlag(n,this.flagsUi.get($o.Flags.MatchViewportResolution)),this.addSettingFlag(n,this.flagsUi.get($o.Flags.HoveringMouseMode)),this.addSettingFlag(n,this.flagsUi.get(Ps));const o=this.buildSectionWithHeading(e,"Input");this.addSettingFlag(o,this.flagsUi.get($o.Flags.KeyboardInput)),this.addSettingFlag(o,this.flagsUi.get($o.Flags.MouseInput)),this.addSettingFlag(o,this.flagsUi.get($o.Flags.TouchInput)),this.addSettingFlag(o,this.flagsUi.get($o.Flags.GamepadInput)),this.addSettingFlag(o,this.flagsUi.get($o.Flags.XRControllerInput));const s=this.buildSectionWithHeading(e,"Encoder");this.addSettingNumeric(s,this.numericParametersUi.get($o.NumericParameters.MinQP)),this.addSettingNumeric(s,this.numericParametersUi.get($o.NumericParameters.MaxQP));const i=this.optionParametersUi.get($o.OptionParameters.PreferredCodec);this.addSettingOption(s,this.optionParametersUi.get($o.OptionParameters.PreferredCodec)),i&&[...i.selector.options].map((e=>e.value)).includes("Only available on Chrome")&&i.disable();const r=this.buildSectionWithHeading(e,"WebRTC");this.addSettingNumeric(r,this.numericParametersUi.get($o.NumericParameters.WebRTCFPS)),this.addSettingNumeric(r,this.numericParametersUi.get($o.NumericParameters.WebRTCMinBitrate)),this.addSettingNumeric(r,this.numericParametersUi.get($o.NumericParameters.WebRTCMaxBitrate))}addSettingText(e,t){t&&(e.appendChild(t.rootElement),this.textParametersUi.set(t.setting.id,t))}addSettingFlag(e,t){t&&(e.appendChild(t.rootElement),this.flagsUi.set(t.setting.id,t))}addSettingNumeric(e,t){t&&(e.appendChild(t.rootElement),this.numericParametersUi.set(t.setting.id,t))}addSettingOption(e,t){t&&(e.appendChild(t.rootElement),this.optionParametersUi.set(t.setting.id,t))}onSettingsChanged({data:{id:e,target:t,type:n}}){if("flag"===n){const n=e,o=t,s=this.flagsUi.get(n);s&&(s.flag!==o.flag&&(s.flag=o.flag),s.label!==o.label&&(s.label=o.label))}else if("number"===n){const n=e,o=t,s=this.numericParametersUi.get(n);s&&(s.number!==o.number&&(s.number=o.number),s.label!==o.label&&(s.label=o.label))}else if("text"===n){const n=e,o=t,s=this.textParametersUi.get(n);s&&(s.text!==o.text&&(s.text=o.text),s.label!==o.label&&(s.label=o.label))}else if("option"===n){const n=e,o=t,s=this.optionParametersUi.get(n);if(s){const e=s.options,t=o.options;e.length===t.length&&e.every((e=>t.includes(e)))||(s.options=o.options),s.selected!==o.selected&&(s.selected=o.selected),s.label!==o.label&&(s.label=o.label)}}}addCustomFlagOnSettingChangedListener(e,t){this.customFlags.has(e)&&(this.customFlags.get(e).onChange=t)}setCustomFlagLabel(e,t){this.customFlags.has(e)?(this.customFlags.get(e).label=t,this.flagsUi.get(e).label=t):$o.Logger.Warning($o.Logger.GetStackTrace(),`Cannot set label for flag called ${e} - it does not exist in the Config.flags map.`)}isCustomFlagEnabled(e){return this.customFlags.get(e).flag}}class Ms{constructor(e){this._options=e,this.stream=e.stream,this.onColorModeChanged=e.onColorModeChanged,this.configUI=new Rs(this.stream.config),this.createOverlays(),us(e.statsPanelConfig)&&(this.statsPanel=new Cs,this.uiFeaturesElement.appendChild(this.statsPanel.rootElement)),us(e.settingsPanelConfig)&&(this.settingsPanel=new ps,this.uiFeaturesElement.appendChild(this.settingsPanel.rootElement),this.configureSettings()),e.videoQpIndicatorConfig&&e.videoQpIndicatorConfig.disableIndicator||(this.videoQpIndicator=new ws,this.uiFeaturesElement.appendChild(this.videoQpIndicator.rootElement)),this.createButtons(),this.registerCallbacks(),this.showConnectOrAutoConnectOverlays(),this.setColorMode(this.configUI.isCustomFlagEnabled(Ps))}createOverlays(){this.disconnectOverlay=new Zo(this.stream.videoElementParent),this.connectOverlay=new Yo(this.stream.videoElementParent),this.playOverlay=new es(this.stream.videoElementParent),this.infoOverlay=new ns(this.stream.videoElementParent),this.errorOverlay=new os(this.stream.videoElementParent),this.afkOverlay=new ss(this.stream.videoElementParent),this.disconnectOverlay.onAction((()=>this.stream.reconnect())),this.connectOverlay.onAction((()=>this.stream.connect())),this.playOverlay.onAction((()=>this.stream.play()))}createButtons(){const e={statsButtonType:this._options.statsPanelConfig?this._options.statsPanelConfig.visibilityButtonConfig:void 0,settingsButtonType:this._options.settingsPanelConfig?this._options.settingsPanelConfig.visibilityButtonConfig:void 0,fullscreenButtonType:this._options.fullScreenControlsConfig,xrIconType:this._options.xrControlsConfig},t=new ms(e);this.uiFeaturesElement.appendChild(t.rootElement);const n=this._options.fullScreenControlsConfig&&this._options.fullScreenControlsConfig.creationMode===Qo.UseCustomElement?new rs(this._options.fullScreenControlsConfig.customElement):t.fullscreenIcon;n&&(n.fullscreenElement=/iPad|iPhone|iPod/.test(navigator.userAgent)?this.stream.videoElementParent.getElementsByTagName("video")[0]:this.rootElement);const o=t.settingsIcon?t.settingsIcon.rootElement:this._options.settingsPanelConfig.visibilityButtonConfig.customElement;o&&(o.onclick=()=>this.settingsClicked()),this.settingsPanel&&(this.settingsPanel.settingsCloseButton.onclick=()=>this.settingsClicked());const s=t.xrIcon?t.xrIcon.rootElement:this._options.xrControlsConfig.creationMode===Qo.UseCustomElement?this._options.xrControlsConfig.customElement:void 0;s&&(s.onclick=()=>this.stream.toggleXR());const i=t.statsIcon?t.statsIcon.rootElement:this._options.statsPanelConfig.visibilityButtonConfig.customElement;if(i&&(i.onclick=()=>this.statsClicked()),this.statsPanel&&(this.statsPanel.statsCloseButton.onclick=()=>this.statsClicked()),this.settingsPanel){const e=new gs("Show FPS","Toggle");e.addOnClickListener((()=>{this.stream.requestShowFps()}));const t=new gs("Restart Stream","Restart");t.addOnClickListener((()=>{this.stream.reconnect()}));const n=new gs("Request keyframe","Request");n.addOnClickListener((()=>{this.stream.requestIframe()}));const o=this.configUI.buildSectionWithHeading(this.settingsPanel.settingsContentElement,"Commands");o.appendChild(e.rootElement),o.appendChild(n.rootElement),o.appendChild(t.rootElement)}}configureSettings(){this.configUI.populateSettingsElement(this.settingsPanel.settingsContentElement),this.configUI.addCustomFlagOnSettingChangedListener(Ps,(e=>{this.configUI.setCustomFlagLabel(Ps,`Color Scheme: ${e?"Light":"Dark"} Mode`),this.setColorMode(e)}))}registerCallbacks(){this.stream.addEventListener("afkWarningActivate",(({data:{countDown:e,dismissAfk:t}})=>this.showAfkOverlay(e,t))),this.stream.addEventListener("afkWarningUpdate",(({data:{countDown:e}})=>this.afkOverlay.updateCountdown(e))),this.stream.addEventListener("afkWarningDeactivate",(()=>this.afkOverlay.hide())),this.stream.addEventListener("afkTimedOut",(()=>this.afkOverlay.hide())),this.stream.addEventListener("videoEncoderAvgQP",(({data:{avgQP:e}})=>this.onVideoEncoderAvgQP(e))),this.stream.addEventListener("webRtcSdp",(()=>this.onWebRtcSdp())),this.stream.addEventListener("webRtcAutoConnect",(()=>this.onWebRtcAutoConnect())),this.stream.addEventListener("webRtcConnecting",(()=>this.onWebRtcConnecting())),this.stream.addEventListener("webRtcConnected",(()=>this.onWebRtcConnected())),this.stream.addEventListener("webRtcFailed",(()=>this.onWebRtcFailed())),this.stream.addEventListener("webRtcDisconnected",(({data:{eventString:e,allowClickToReconnect:t}})=>this.onDisconnect(e,t))),this.stream.addEventListener("videoInitialized",(()=>this.onVideoInitialized())),this.stream.addEventListener("streamLoading",(()=>{var e;this.onStreamLoading();const t=null===(e=null==bt?void 0:bt.autoEnterImmersiveVr)||void 0===e||e,n=document.getElementById("xrBtn");n&&(t?n.click():function(){const e=document.getElementById("settings-items");if(!e)return;"100%"===e.style.width||(e.style.width="100%",document.getElementById("settings-icon").style.transform="rotate(-90deg)",document.getElementById("settings-icon").style.transition="transform 0.5s");const t=document.getElementById("vrBtn");t&&t.classList.add("throbbing")}())})),this.stream.addEventListener("playStreamError",(({data:{message:e}})=>this.onPlayStreamError(e))),this.stream.addEventListener("playStream",(()=>this.onPlayStream())),this.stream.addEventListener("playStreamRejected",(({data:{reason:e}})=>this.onPlayStreamRejected(e))),this.stream.addEventListener("loadFreezeFrame",(({data:{shouldShowPlayOverlay:e}})=>this.onLoadFreezeFrame(e))),this.stream.addEventListener("statsReceived",(({data:{aggregatedStats:e}})=>this.onStatsReceived(e))),this.stream.addEventListener("latencyTestResult",(({data:{latencyTimings:e}})=>this.onLatencyTestResults(e))),this.stream.addEventListener("dataChannelLatencyTestResult",(({data:{result:e}})=>this.onDataChannelLatencyTestResults(e))),this.stream.addEventListener("streamerListMessage",(({data:{messageStreamerList:e,autoSelectedStreamerId:t,wantedStreamerId:n}})=>this.handleStreamerListMessage(e,t,n))),this.stream.addEventListener("settingsChanged",(e=>this.configUI.onSettingsChanged(e))),this.stream.addEventListener("playerCount",(({data:{count:e}})=>this.onPlayerCount(e))),this.stream.addEventListener("webRtcTCPRelayDetected",(({})=>$o.Logger.Warning($o.Logger.GetStackTrace(),"Stream quailty degraded due to network enviroment, stream is relayed over TCP.")))}get rootElement(){return this._rootElement||(this._rootElement=document.createElement("div"),this._rootElement.id="playerUIEpic",this._rootElement.classList.add("noselect"),this._rootElement.appendChild(this.stream.videoElementParent),this._rootElement.appendChild(this.uiFeaturesElement)),this._rootElement}get uiFeaturesElement(){return this._uiFeatureElement||(this._uiFeatureElement=document.createElement("div"),this._uiFeatureElement.id="uiFeatures",this._uiFeatureElement.style.display="none"),this._uiFeatureElement}showDisconnectOverlay(e){this.hideCurrentOverlay(),this.updateDisconnectOverlay(e),this.disconnectOverlay.show(),this.currentOverlay=this.disconnectOverlay}updateDisconnectOverlay(e){this.disconnectOverlay.update(e)}onDisconnectionAction(){this.disconnectOverlay.activate()}hideCurrentOverlay(){null!=this.currentOverlay&&(this.currentOverlay.hide(),this.currentOverlay=null)}showConnectOverlay(){this.hideCurrentOverlay(),this.connectOverlay.show(),this.currentOverlay=this.connectOverlay}showPlayOverlay(){this.hideCurrentOverlay(),this.playOverlay.show(),this.currentOverlay=this.playOverlay}showTextOverlay(e){this.hideCurrentOverlay(),this.infoOverlay.update(e),this.infoOverlay.show(),this.currentOverlay=this.infoOverlay}showErrorOverlay(e){this.hideCurrentOverlay(),this.errorOverlay.update(e),this.errorOverlay.show(),this.currentOverlay=this.errorOverlay}settingsClicked(){var e;null===(e=this.statsPanel)||void 0===e||e.hide(),this.settingsPanel.toggleVisibility()}statsClicked(){var e;null===(e=this.settingsPanel)||void 0===e||e.hide(),this.statsPanel.toggleVisibility()}onConnectAction(){this.connectOverlay.activate()}onPlayAction(){this.playOverlay.activate()}showAfkOverlay(e,t){this.hideCurrentOverlay(),this.afkOverlay.updateCountdown(e),this.afkOverlay.onAction((()=>t())),this.afkOverlay.show(),this.currentOverlay=this.afkOverlay}showConnectOrAutoConnectOverlays(){this.stream.config.isFlagEnabled($o.Flags.AutoConnect)||this.showConnectOverlay()}onWebRtcAutoConnect(){this.showTextOverlay("Auto Connecting Now")}onWebRtcSdp(){this.showTextOverlay("WebRTC Connection Negotiated")}onStreamLoading(){const e=document.createElement("span");e.className="visually-hidden",e.innerHTML="Loading...";const t=document.createElement("div");t.id="loading-spinner",t.className="spinner-border ms-2",t.setAttribute("role","status"),t.appendChild(e),this.showTextOverlay("Loading Stream "+t.outerHTML)}onDisconnect(e,t){var n;const o="Disconnected"+(e?`: ${e}`:"");t?this.showDisconnectOverlay(`${o} Click To Restart.`):this.showErrorOverlay(o),null===(n=this.statsPanel)||void 0===n||n.onDisconnect()}onWebRtcConnecting(){this.showTextOverlay("Starting connection to server, please wait")}onWebRtcConnected(){this.showTextOverlay("WebRTC connected, waiting for video")}onWebRtcFailed(){this.showErrorOverlay("Unable to setup video")}onLoadFreezeFrame(e){!0===e&&($o.Logger.Log($o.Logger.GetStackTrace(),"showing play overlay"),this.showPlayOverlay())}onPlayStream(){this.hideCurrentOverlay()}onPlayStreamError(e){this.showErrorOverlay(e)}onPlayStreamRejected(e){this.showPlayOverlay()}onVideoInitialized(){var e;"1"!=bt.ShouldAutoPlay&&this.showPlayOverlay(),null===(e=this.statsPanel)||void 0===e||e.onVideoInitialized(this.stream),function(){if(document.getElementById("statsInfoExtra"))return;const e=document.createElement("div");e.id="statsInfoExtra",e.style.display="none",document.body.appendChild(e)}(),function(){if(document.getElementById("rotateOverlay"))return;const e=document.createElement("div");e.id="rotateOverlay",e.style.display="none",e.classList.add("overlay"),document.getElementById("playerUIEpic").appendChild(e)}(),function(){if(document.getElementById("canvas"))return;const e=document.createElement("canvas");e.id="canvas",e.style.display="none",document.getElementById("playerUIEpic").appendChild(e)}(),function(){if(document.querySelector(".recorded-video-wrap"))return;const e=document.createElement("div");e.className="recorded-video-wrap",e.style.display="none";const t=document.createElement("h2");t.className="text-xl text-gray-500 uppercase font-light mb-4",t.textContent="Recorded video";const n=document.createElement("video");n.src="",n.style.cssText="max-width: 400px; position: static;",n.className="recorded-video bg-black w-full h-auto mb-8",n.controls=!0;const o=document.createElement("div");o.className="download-wrap";const s=document.createElement("a");s.className="download-video",s.textContent="Download",s.href="#";const i=document.createElement("a");i.className="cancel-download",i.textContent="Cancel",o.appendChild(s),o.appendChild(i),e.appendChild(t),e.appendChild(n),e.appendChild(o),document.getElementById("playerUIEpic").appendChild(e)}(),function(){if("0"===bt.shouldDisplayContorlBar)return;if(document.getElementById("e3ds_bg"))return;const e=document.createElement("div");e.id="e3ds_bg";const t=document.createElement("div");t.id="settings",t.style.display="flex";const n=document.createElement("div");n.classList.add("panelInput__div");const o=document.createElement("div");o.style.cssText="display: flex; gap: 7px; width: 100%;";const s=document.createElement("span");s.className="volumeTitle",s.textContent="volume:";const i=document.createElement("div");i.style.cssText="width: 100%; display: flex; flex-direction: column; gap: 7px; margin-top: 5px;";const r=document.createElement("input");r.setAttribute("aria-label","Current Time"),r.type="range",r.id="Volumebar",r.value="1",r.min="0",r.max="1",r.step="0.1";const a=document.createElement("div");a.className="volumeValues",["0","4","8","10"].forEach((e=>{const t=document.createElement("span");t.textContent=e,a.appendChild(t)})),i.appendChild(r),i.appendChild(a),o.appendChild(s),o.appendChild(i),n.appendChild(o);const l=document.createElement("div");l.classList.add("qlInput__div","show__qlDiv");const c=document.createElement("div");c.style.cssText="display: flex; gap: 7px; width: 100%;";const d=document.createElement("span");d.className="resulTitle",d.textContent="Quality:";const u=document.createElement("div");u.style.width="100%";const h=document.createElement("input");h.setAttribute("aria-label","Current Time"),h.type="range",h.id="resoulbar",h.value="0",h.min="0",h.max="51",h.step="1";const m=document.createElement("div");m.className="resulValues",["LOW","MID","HIGH"].forEach((e=>{const t=document.createElement("span");t.textContent=e,m.appendChild(t)})),u.appendChild(h),u.appendChild(m),c.appendChild(d),c.appendChild(u),l.appendChild(c);const g=document.createElement("div");g.id="qualitySelect",g.className="hiddenSelectionDiv";const p=document.createElement("p");p.style.cssText="text-align: center; padding: 5px 0;",p.textContent="Quallity";const f=document.createElement("hr"),v=document.createElement("ul");v.id="qualityList",["Ultra","High","Medium","Low"].forEach((e=>{const t=document.createElement("li");t.id=e.toLowerCase(),t.textContent=e,v.appendChild(t)}));const y=document.createElement("hr"),S=document.createElement("p");S.id="qlControll",S.style.cssText="text-align: center; padding: 5px 0; cursor: pointer;",S.textContent="Advanced",g.appendChild(p),g.appendChild(f),g.appendChild(v),g.appendChild(y),"1"===Oe&&g.appendChild(S);const C=document.createElement("div");C.id="resSelect",C.className="hiddenSelectionDiv";const w=document.createElement("hr"),b=document.createElement("ul");b.id="resList",["1080p","720p","480p","360p","240p","144p","Auto"].forEach((e=>{const t=document.createElement("li");t.id=e.replace("p",""),t.textContent=e,b.appendChild(t)})),C.appendChild(w),C.appendChild(b);const E=document.createElement("div");E.id="settings-items";const T=(e,t,n,o,s)=>{const i=document.createElement("button");i.id=e,i.className="settings-item";const r=document.createElement("img");return r.src=t,null!=s&&(r.id=s),r.alt=n,r.style.cssText=o,i.appendChild(r),i};"1"==bt.enableScreenshot&&E.appendChild(T("screenshot-img","https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/camera.svg","")),E.appendChild(T("screenRecord","https://img.icons8.com/stencil/48/record.png","screen record","padding: 13px;","screenRecordImg")),E.appendChild(T("infoBtn","https://img.icons8.com/flat-round/48/info.png","info","padding: 13px;","infoIcon")),E.appendChild(T("qualityBtn","https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/galleryI.svg","quality","","qualityIcon")),document.getElementById("xrBtn")&&E.appendChild(T("vrBtn","/assets/images/vrIcon.png","VR-Btn","padding: 5px","vrIcon")),E.appendChild(T("AudioBtn","https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/UIimages/mute.svg","volume","","AudioBtnImg")),E.appendChild(T("fullscreen-img","https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/fullscreen.svg",""));const k=document.createElement("div");k.id="gear-container";const x=document.createElement("span");x.id="networkQualityStatus",x.className="greyStatus",x.innerHTML="&#9679";const P=document.createElement("img");P.id="settings-icon",P.src="https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/settingGear%20(3).png",P.alt="",k.appendChild(x),k.appendChild(P),t.appendChild(n),t.appendChild(l),t.appendChild(g),t.appendChild(C),t.appendChild(E),t.appendChild(k),e.appendChild(t);const I=function(){if("0"==bt.showPsControl)return null;const e=document.createElement("div");return e.id="overlay",e.style.width="300px",e.style.padding="15px",e.className="overlay",e.innerHTML='\n               <div id="qualityStatus" class="greyStatus">&#9679</div>\n               <div id="overlayButton"  >+</div>\n               \x3c!-- <div id="overlayButton"  onclick="onExpandOverlay_Click()">+</div> --\x3e\n               <div id="hostSettings" style="display: none;" >\n                  <div id="GuestList">\n                     <div class="settings-text">GuestList</div>\n                     <label class="btn-overlay">\n                     <select id="Guest-filter"   >\n                     </select>\n                  </label>\n               </div>\n               <div id="GiveControlToThisGuest">\n                  \x3c!-- <div class="settings-text">GiveControlToThisGuest</div> --\x3e\n                  <label class="btn-overlay">\n                     <input type="button" id="GiveControlToThisGuest" class="overlay-button btn-flat"\n                        value="GiveControlToThisGuest">\n                  </label>\n               </div>\n               <div id="DisableControlFromOthers">\n                  \x3c!-- <div class="settings-text">DisableControlFromOthers</div> --\x3e\n                  <label class="btn-overlay">\n                     <input type="button" id="DisableControlFromOthers" class="overlay-button btn-flat"\n                        value="DisableAllOthersControl">\n                  </label>\n               </div>\n               <div id="KickSelctedGuest">\n                  \x3c!-- <div class="settings-text">KickSelctedGuest</div> --\x3e\n                  <label class="btn-overlay">\n                     <input type="button" id="KickSelctedGuest" class="overlay-button btn-flat" value="KickSelctedGuest">\n                  </label>\n               </div>\n               <div id="kickAllGuests">\n                  \x3c!-- <div class="settings-text">kickAllGuests</div> --\x3e\n                  <label class="btn-overlay">\n                     <input type="button" id="kickAllGuests" class="overlay-button btn-flat" value="kickAllGuests">\n                     </label>\n                  </div>\n               </div>\n                     <div id="GuestSettings"  style="display: none;">\n                        <label id="GuestTitle" style="display: block;"  >HTML</label>\n                     </div>\n               <div>\n               </div>\n            \n             <div id="overlayWebrtcCtrlMenu" style="display: none">\n                  <button id="restartWebRtcButton">Restart ICE</button>\n              </div>\n            \n              <div id="overlayPSSettings"\n              style="display: none; height: 500px; width: 100%; overflow: hidden scroll; margin-top: 15px;">\n              <div id="KickOthers">\n                 <div class="settings-text">Kick all other players</div>\n                 <label class="btn-overlay">\n                    <input type="button" id="kick-other-players-button" class="overlay-button btn-flat" value="Kick">\n                 </label>\n              </div>\n              <div id="FillWindow">\n                 <div class="settings-text">Enlarge Display to Fill Window</div>\n                 <label class="tgl-switch">\n                    <input type="checkbox" id="enlarge-display-to-fill-window-tgl" class="tgl tgl-flat" checked>\n                    <div class="tgl-slider"></div>\n                 </label>\n              </div>\n              <div id="QualityControlOwnership"  style="display: flex; justify-content: space-between; align-items: baseline;">\n                 <div class="settings-text">Quality control ownership</div>\n                 <label class="tgl-switch">\n                    <input type="checkbox" id="quality-control-ownership-tgl" class="tgl tgl-flat">\n                    <div class="tgl-slider"></div>\n                 </label>\n              </div>\n                       \n            \n             <div id="ConsoleCmd">\n                 <div class="settings-text">Console Command</div>\n                 <div id="encoderParamsContainer" class="collapse">\n                    <div>\n                       \n                       <div class="encoder__step">\n                          \n                          <input type="text" placeholder="write your Console Command"  class="form-control" id="ConsoleCmd_text" value="stat fps"/>\n                       </div>\n                       \n            \n                      \n                       <div class="apply__btn">\n                          <input id="ConsoleCmd_submit" class="btn btn-primary btn-lg mt-3" type="button" value="Send cmd">\n                       </div>\n                    </div>\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t <div >\n                       \n                       <div class="encoder__step">\n                          \n                          <input type="text" placeholder="put your string to send to unreal"  class="form-control" id="dataToSendToUnreal_text" value="your sample  string"/>\n                       </div>\n                       \n            \n                      \n                       <div class="apply__btn">\n                          <input id="dataToSendToUnreal_submit" class="btn btn-primary btn-lg mt-3" type="button" value="Send To Unreal">\n                       </div>\n\t\t\t\t\t   \n\t\t\t\t\t    <div class="apply__btn">\n                          <input id="sendRandomdataToUnrealFast_submit" class="btn btn-primary btn-lg mt-3" type="button" value="send Random data To Unreal Fast">\n                       </div>\n\t\t\t\t\t   \n                    </div>\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n                 </div>\n              </div>\n          \n          \n          \n          \n          \n              <div id="EncoderSettings">\n                 <div class="settings-text">Encoder Settings</div>\n                 <div id="encoderParamsContainer" class="collapse">\n                    <div >\n                       <div class="encoder__step">\n                          <label for="encoder-rate-control" class="settings-text">Rate Control</label>\n                          <select id="encoder-rate-control">\n                             <option value="CBR" selected>CBR</option>\n                             <option value="VBR">VBR</option>\n                             <option value="ConstQP">ConstQP</option>\n                          </select>\n                       </div>\n                       <div class="encoder__step">\n                          <label for="encoder-target-bitrate-text">Target Bitrate (kbps)</label>\n                          <input type="number" class="form-control" id="encoder-target-bitrate-text" value="0" min="0"\n                             max="100000" />\n                       </div>\n                       <div class="encoder__step">\n                          <label for="encoder-max-bitrate-text">Max Bitrate (kbps)</label>\n                          <input type="number" class="form-control" id="encoder-max-bitrate-text" value="0" min="0"\n                             max="100000" />\n                       </div>\n                       <div class="encoder__step">\n                          <label for="encoder-min-qp-text">Min QP</label>\n                          <input type="number" class="form-control" id="encoder-min-qp-text" value="0" min="0"\n                             max="999" />\n                       </div>\n                       <div class="encoder__step">\n                          <label for="encoder-max-qp-text">Max QP</label>\n                          <input type="number" class="form-control" id="encoder-max-qp-text" value="0" min="0"\n                             max="999" />\n                       </div>\n                       <div class="encoder__step">\n                          <div class="settings-text">Filler Data</div>\n                          <label class="tgl-switch">\n                             <input type="checkbox" id="encoder-filler-data-tgl" class="tgl tgl-flat">\n                             <div class="tgl-slider"></div>\n                          </label>\n                       </div>\n                       <div class="encoder__step">\n                          <label for="encoder-multipass" class="settings-text">Multipass</label>\n                          <select id="encoder-multipass">\n                             <option value="DISABLED" selected>DISABLED</option>\n                             <option value="QUARTER">QUARTER</option>\n                             <option value="FULL">FULL</option>\n                          </select>\n                       </div>\n                       <div class="apply__btn">\n                          <input id="encoder-params-submit" class="btn btn-primary btn-lg mt-3" type="button" value="Apply">\n                       </div>\n                    </div>\n                 </div>\n              </div>\n              <div id="WebRTCSettings">\n                 <div class="settings-text">WebRTC Settings</div>\n                 <div id="webrtcParamsContainer" class="collapse">\n                    <div >\n                       <div class="encoder__step">\n                          <label for="webrtc-degradation-pref">Degradation Pref</label>\n                          <select id="webrtc-degradation-pref">\n                             <option value="BALANCED">BALANCED</option>\n                             <option value="MAINTAIN_FRAMERATE">MAINTAIN_FRAMERATE</option>\n                             <option value="MAINTAIN_RESOLUTION">MAINTAIN_RESOLUTION</option>\n                          </select>\n                       </div>\n                       <div class="encoder__step">\n                          <label for="webrtc-max-fps-text">Max FPS</label>\n                          <input type="number" class="form-control" id="webrtc-max-fps-text" value="1" min="1"\n                          max="999" />\n                       </div>\n                       <div class="encoder__step">\n                          <label for="webrtc-min-bitrate-text">Min Bitrate (kbps)</label>\n                          <input type="number" class="form-control" id="webrtc-min-bitrate-text" value="0" min="0"\n                          max="100000" />\n                       </div>\n                       <div class="encoder__step">\n                          <label for="webrtc-max-bitrate-text">Max Bitrate (kbps)</label>\n                          <input type="number" class="form-control" id="webrtc-max-bitrate-text" value="0" min="0"\n                          max="100000" />\n                       </div>\n                       <div class="encoder__step">\n                          <label for="webrtc-low-qp-text">Low QP Threshold</label>\n                          <input type="number" class="form-control" id="webrtc-low-qp-text" value="0" min="0"\n                          max="999" />\n                       </div>\n                       <div class="encoder__step">\n                          <label for="webrtc-high-qp-text">High QP Threshold</label>\n                          <input type="number" class="form-control" id="webrtc-high-qp-text" value="0" min="0"\n                          max="999" />\n                       </div>\n                       <div class="apply__btn">\n                          <input id="webrtc-params-submit" class="btn btn-primary btn-lg mt-3" type="button" value="Apply">\n                       </div>\n                    </div>\n                 </div>\n              </div>\n              <div id="ShowFPS">\n                 <div class="settings-text">Show FPS</div>\n                 <label class="btn-overlay">\n                    <input type="button" id="show-fps-button" class="overlay-button btn-flat" value="Toggle">\n                 </label>\n              </div>\n              <div id="MatchViewportResolution">\n                 <div class="settings-text">Match Viewport Resolution</div>\n                 <label class="tgl-switch">\n                    <input type="checkbox" id="match-viewport-res-tgl" class="tgl tgl-flat">\n                    <div class="tgl-slider"></div>\n                 </label>\n              </div>\n              <div id="Stats">\n                 <div style="display: flex; justify-content: space-between; align-items: center;">\n                    <div class="settings-text">Show Stats</div>\n                    <label class="tgl-switch">\n                       <input type="checkbox" id="show-stats-tgl" class="tgl tgl-flat" checked>\n                       <div class="tgl-slider"></div>\n                    </label>\n                 </div>\n                 <div id="statsContainer" class="statsContainer">\n                    <div id="stats" class="stats"></div>\n                 </div>\n              </div>\n              <div id="LatencyTest">\n                 <Button id="LatencyTestBtn" >Test Latency</Button>\n                 <div id="LatencyStatsContainer" class="statsContainer">\n                    <div id=LatencyStats class="stats">No stats yet...</div>\n                 </div>\n              </div>\n           </div>',e}();if(I&&e.appendChild(I),document.getElementById("playerUIEpic").appendChild(e),document.getElementById("vrBtn")&&document.getElementById("xrBtn")&&(document.getElementById("vrBtn").onclick=function(){document.getElementById("xrBtn").click()}),Is(),function(){const e=document.getElementsByTagName("script");for(let t=0;t<e.length;t++)if("src/bottompanel.js"===e[t].src.split(window.location.host+"/")[1])return!0;return!1}())console.log("bottompanel.js already exists");else{const e=document.createElement("script");e.type="text/javascript",e.src="src/bottompanel.js",document.body.appendChild(e)}}(),No()}onVideoEncoderAvgQP(e){this.videoQpIndicator&&this.videoQpIndicator.updateQpTooltip(e)}onInitialSettings(e){var t;e.PixelStreamingSettings&&(null===(t=this.statsPanel)||void 0===t||t.configure(e.PixelStreamingSettings))}onStatsReceived(e){var t;null===(t=this.statsPanel)||void 0===t||t.handleStats(e)}onLatencyTestResults(e){var t;null===(t=this.statsPanel)||void 0===t||t.latencyTest.handleTestResult(e)}onDataChannelLatencyTestResults(e){var t;null===(t=this.statsPanel)||void 0===t||t.dataChannelLatencyTest.handleTestResult(e)}onPlayerCount(e){var t;null===(t=this.statsPanel)||void 0===t||t.handlePlayerCount(e)}handleStreamerListMessage(e,t,n){const o=this.stream.config.isFlagEnabled($o.Flags.WaitForStreamer),s=this.stream.isReconnecting();let i=null,r=!0;t||(o&&n?s?(i=`Waiting for ${n} to become available.`,r=!1):(i=`Gave up waiting for ${n} to become available. Click to try again`,e.ids.length>0&&(i+=" or select a streamer from the settings menu."),r=!0):0==e.ids.length?s?(i="Waiting for a streamer to become available.",r=!1):(i="No streamers available. Click to try again.",r=!0):(i="Multiple streamers available. Select one from the settings menu.",r=!1),r?this.showDisconnectOverlay(i):this.showTextOverlay(i))}setColorMode(e){this.onColorModeChanged&&this.onColorModeChanged(e)}}const Ls=(e=>{var t={};return Vo.d(t,e),t})({default:()=>Ro}),Bs=(e=>{var t={};return Vo.d(t,e),t})({default:()=>_o}),Os=(e=>{var t={};return Vo.d(t,e),t})({default:()=>Wo});class _s{constructor(e){this.defaultLightModePalette={"--color0":"#e2e0dd80","--color1":"#FFFFFF","--color2":"#000000","--color3":"#0585fe","--color4":"#35b350","--color5":"#ffab00","--color6":"#e1e2dd","--color7":"#c3c4bf"},this.defaultDarkModePalette={"--color0":"#1D1F2280","--color1":"#000000","--color2":"#FFFFFF","--color3":"#0585fe","--color4":"#35b350","--color5":"#ffab00","--color6":"#1e1d22","--color7":"#3c3b40"},this.defaultStyles={":root":{"--color0":"#1D1F2280","--color1":"#000000","--color2":"#FFFFFF","--color3":"#0585fe","--color4":"#35b350","--color5":"#ffab00","--color6":"#1e1d22","--color7":"#3c3b40","--color8":"#41008c","--color9":"#3e0070","--color10":"#2e0052","--color11":"rgba(65,0,139,1)"},".noselect":{userSelect:"none"},"#playerUIEpic":{width:"100%",height:"100%",position:"relative"},"#videoElementParent":{width:"100%",height:"100%",position:"absolute",backgroundColor:"var(--color1)"},"#uiFeatures":{width:"100%",height:"100%",zIndex:"30",position:"relative",color:"var(--color2)",pointerEvents:"none",overflow:"hidden"},".UiTool .tooltiptext":{visibility:"hidden",width:"auto",color:"var(--color2)",textAlign:"center",borderRadius:"15px",padding:"0px 10px",fontFamily:"'Montserrat', sans-serif",fontSize:"0.75rem",letterSpacing:"0.75px",position:"absolute",top:"0",transform:"translateY(25%)",left:"125%",zIndex:"20"},".UiTool:hover .tooltiptext":{visibility:"visible",backgroundColor:"var(--color7)"},"#connection .tooltiptext":{top:"125%",transform:"translateX(-25%)",left:"0",zIndex:"20",padding:"5px 10px"},"#connection":{position:"absolute",bottom:"8%",left:"5%",fontFamily:"'Michroma', sans-serif",height:"3rem",width:"3rem",pointerEvents:"all"},"#settings-panel .tooltiptext":{display:"block",top:"125%",transform:"translateX(-50%)",left:"0",zIndex:"20",padding:"5px 10px",border:"3px solid var(--color3)",width:"max-content",fallbacks:[{width:"max-content"},{border:"3px solid var(--color3)"},{padding:"5px 10px"},{zIndex:"20"},{left:"0"},{transform:"translateX(-50%)"},{top:"125%"},{display:"block"}]},"#controls":{position:"absolute",top:"3%",left:"2%",fontFamily:"'Michroma', sans-serif",pointerEvents:"all",display:"block"},"#controls>*":{marginBottom:"0.5rem",borderRadius:"50%",display:"block",height:"2rem",lineHeight:"1.75rem",padding:"0.5rem"},"#controls #additionalinfo":{textAlign:"center",fontFamily:"'Montserrat', sans-serif"},"#fullscreen-btn":{padding:"0.6rem !important"},"#minimizeIcon":{display:"none"},"#settingsBtn, #statsBtn":{cursor:"pointer"},"#uiFeatures button":{backgroundColor:"var(--color7)",border:"1px solid var(--color7)",color:"var(--color2)",position:"relative",width:"3rem",height:"3rem",padding:"0.5rem",textAlign:"center"},"#uiFeatures button:hover":{backgroundColor:"var(--color3)",border:"3px solid var(--color3)",transition:"0.25s ease",paddingLeft:"0.55rem",paddingTop:"0.55rem"},"#uiFeatures button:active":{border:"3px solid var(--color3)",backgroundColor:"var(--color7)",paddingLeft:"0.55rem",paddingTop:"0.55rem"},".btn-flat":{backgroundColor:"transparent",color:"var(--color2)",fontFamily:"'Montserrat'",fontWeight:"bold",border:"3px solid var(--color3)",borderRadius:"1rem",fontSize:"0.75rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",cursor:"pointer",textAlign:"center"},".btn-flat:hover":{backgroundColor:"var(--color3)",transition:"ease 0.3s"},".btn-flat:disabled":{background:"var(--color7)",borderColor:"var(--color3)",color:"var(--color3)",cursor:"default"},".btn-flat:active":{backgroundColor:"transparent"},".btn-flat:focus":{outline:"none"},"#uiFeatures img":{width:"100%",height:"100%"},".panel-wrap":{position:"absolute",top:"0",bottom:"0",right:"0",height:"100%",minWidth:"20vw",maxWidth:"90vw",transform:"translateX(100%)",transition:".3s ease-out",pointerEvents:"all",backdropFilter:"blur(10px)","-webkit-backdrop-filter":"blur(10px)",overflowY:"auto",overflowX:"hidden",backgroundColor:"var(--color0)"},".panel-wrap-visible":{transform:"translateX(0%)"},".panel":{overflowY:"auto",padding:"1em"},"#settingsHeading, #statsHeading":{display:"inline-block",fontSize:"2em",marginBlockStart:"0.67em",marginBlockEnd:"0.67em",marginInlineStart:"0px",marginInlineEnd:"0px",position:"relative",padding:"0 0 0 2rem"},"#settingsClose, #statsClose":{margin:"0.5rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",paddingRight:"0.5rem",fontSize:"2em",float:"right"},"#settingsClose:after, #statsClose:after":{paddingLeft:"0.5rem",display:"inline-block",content:'"\\00d7"'},"#settingsClose:hover, #statsClose:hover":{color:"var(--color3)",transition:"ease 0.3s"},"#settingsContent, #statsContent":{marginLeft:"2rem",marginRight:"2rem"},".setting":{display:"flex",flexDirection:"row",justifyContent:"space-between",padding:"0.15rem 10px 0.15rem 10px"},".settings-text":{color:"var(--color2)",verticalAlign:"middle",fontWeight:"normal"},".settings-option":{width:"100%",textOverflow:"ellipsis",whiteSpace:"nowrap"},"#connectOverlay, #playOverlay, #infoOverlay, #errorOverlay, #afkOverlay, #disconnectOverlay":{zIndex:"30",position:"absolute",color:"var(--color2)",fontSize:"1.8em",width:"100%",height:"100%",backgroundColor:"var(--color1)",alignItems:"center",justifyContent:"center",textTransform:"uppercase"},".clickableState":{alignItems:"center",justifyContent:"center",display:"flex",cursor:"pointer"},".textDisplayState":{display:"flex"},".hiddenState":{display:"none"},"#playButton, #connectButton":{display:"inline-block",height:"auto",zIndex:"30"},"img#playButton":{maxWidth:"241px",width:"10%"},"#uiInteraction":{position:"fixed"},"#UIInteractionButtonBoundary":{padding:"2px"},"#UIInteractionButton":{cursor:"pointer"},"#hiddenInput":{position:"absolute",left:"-10%",width:"0px",opacity:"0"},"#editTextButton":{position:"absolute",height:"40px",width:"40px"},".btn-overlay":{verticalAlign:"middle",display:"inline-block"},".tgl-switch":{verticalAlign:"middle",display:"inline-block"},".tgl-switch .tgl":{display:"none"},".tgl, .tgl:after, .tgl:before, .tgl *, .tgl *:after, .tgl *:before, .tgl+.tgl-slider":{"-webkit-box-sizing":"border-box",boxSizing:"border-box"},".tgl::-moz-selection, .tgl:after::-moz-selection, .tgl:before::-moz-selection, .tgl *::-moz-selection, .tgl *:after::-moz-selection, .tgl *:before::-moz-selection, .tgl+.tgl-slider::-moz-selection":{background:"none"},".tgl::selection, .tgl:after::selection, .tgl:before::selection, .tgl *::selection, .tgl *:after::selection, .tgl *:before::selection, .tgl+.tgl-slider::selection":{background:"none"},".tgl-slider":{},".tgl+.tgl-slider":{outline:"0",display:"block",width:"40px",height:"18px",position:"relative",cursor:"pointer",userSelect:"none"},".tgl+.tgl-slider:after, .tgl+.tgl-slider:before":{position:"relative",display:"block",content:'""',width:"50%",height:"100%"},".tgl+.tgl-slider:after":{left:"0"},".tgl+.tgl-slider:before":{display:"none"},".tgl-flat+.tgl-slider":{padding:"2px","-webkit-transition":"all .2s ease",transition:"all .2s ease",background:"var(--color6)",border:"3px solid var(--color7)",borderRadius:"2em"},".tgl-flat+.tgl-slider:after":{"-webkit-transition":"all .2s ease",transition:"all .2s ease",background:"var(--color7)",content:'""',borderRadius:"1em"},".tgl-flat:checked+.tgl-slider":{border:"3px solid var(--color3)"},".tgl-flat:checked+.tgl-slider:after":{left:"50%",background:"var(--color3)"},".btn-apply":{display:"block !important",marginLeft:"auto",marginRight:"auto",width:"40%"},".form-control":{backgroundColor:"var(--color7)",border:"2px solid var(--color7)",borderRadius:"4px",color:"var(--color2)",textAlign:"right",fontFamily:"inherit"},".form-control:hover":{borderColor:"var(--color7)"},".form-group":{paddingTop:"4px",display:"grid",gridTemplateColumns:"80% 20%",rowGap:"4px",paddingRight:"10px",paddingLeft:"10px"},".form-group label":{verticalAlign:"middle",fontWeight:"normal"},".settingsContainer":{display:"flex",flexDirection:"column",borderBottom:"1px solid var(--color7)",paddingTop:"10px",paddingBottom:"10px"},".settingsContainer> :first-child":{marginTop:"4px",marginBottom:"4px",fontWeight:"bold",justifyContent:"space-between",display:"flex",flexDirection:"row",alignItems:"baseline"},".collapse":{paddingLeft:"5%"},"#streamTools":{borderBottomRightRadius:"5px",borderBottomLeftRadius:"5px",userSelect:"none",position:"absolute",top:"0",right:"2%",zIndex:"100",border:"4px solid var(--colour8)",borderTopWidth:"0px"},".settingsHeader":{fontStyle:"italic"},"#streamToolsHeader":{display:"flex",flexDirection:"row",justifyContent:"space-between",borderBottom:"1px solid var(--colour8)",backgroundColor:"var(--color7)"},".streamTools":{backgroundColor:"var(--color2)",fontFamily:"var(--buttonFont)",fontWeight:"lighter",color:"var(--color7)"},".streamTools-shown>#streamToolsSettings, .streamTools-shown>#streamToolsStats":{display:"block"},"#streamToolsToggle":{width:"100%"},"#qualityStatus":{fontSize:"37px",paddingRight:"4px"},".svgIcon":{fill:"var(--color2)"}};const{customStyles:t,lightModePalette:n,darkModePalette:o,jssInsertionPoint:s}=null!=e?e:{},i={plugins:[(0,Bs.default)(),(0,Os.default)()],insertionPoint:s};Ls.default.setup(i),this.customStyles=t,this.lightModePalette=null!=n?n:this.defaultLightModePalette,this.darkModePalette=null!=o?o:this.defaultDarkModePalette}applyStyleSheet(){Ls.default.createStyleSheet({"@global":Object.assign(Object.assign({},this.defaultStyles),this.customStyles)}).attach()}applyPalette(e){const t=document.querySelector(":root");t.style.setProperty("--color0",e["--color0"]),t.style.setProperty("--color1",e["--color1"]),t.style.setProperty("--color2",e["--color2"]),t.style.setProperty("--color3",e["--color3"]),t.style.setProperty("--color4",e["--color4"]),t.style.setProperty("--color5",e["--color5"]),t.style.setProperty("--color6",e["--color6"]),t.style.setProperty("--color7",e["--color7"])}setColorMode(e){e?this.applyPalette(this.lightModePalette):this.applyPalette(this.darkModePalette)}}var Fs=qo.lg,Ds=new(0,qo.eF);return Ds.applyStyleSheet(),window.fsgsg=function(){console.log("11111 done");var e=new Jt({useUrlParams:!0}),t=new rn(e),n=new Fs({stream:t,onColorModeChanged:function(e){return Ds.setColorMode(e)}});document.body.appendChild(n.rootElement),window.pixelStreaming=t},{}})(),e.exports=ri()}},t={};!function n(o){var s=t[o];if(void 0!==s)return s.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}(242)})();